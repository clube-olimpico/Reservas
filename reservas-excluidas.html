<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Reservas Excluídas</title>
    <style>
        body {
            font-family: Arial, sans-serif;  
            margin: 0;
            padding: 10px;
            background-color: #f4f4f4; 
        }

        h1 {
            text-align: center;
            font-size: 22px;
        }

        .filters {
            display: grid;  
            grid-template-columns: 120px 1fr;  
            gap: 10px;
            margin-bottom: 15px;
            align-items: center;
            position: relative;
        }

        .filters label {
            font-size: 16px;
            font-weight: bold; 
            text-align: left;  
        }

        .filters input,
        .filters select,
        .filters button {
            font-size: 16px;
            padding: 8px;
            box-sizing: border-box;  
        }

        .filters input,
        .filters select {
            justify-self: end;
            width: calc(100% - 10px);
        }

        .filters button {
            grid-column: 1 / 3;
            background-color: #007bff;
            color: white;
            border: none;
            cursor: pointer;
            font-weight: bold;
        }

        .filters button:hover {
            background-color: #0056b3;
        }

        .log-entry {
            background: white;
            padding: 10px;
            margin-bottom: 10px;
            border-radius: 5px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            font-size: 16px;
        }

        .log-entry p {
            margin: 5px 0;
        }

        @media (max-width: 480px) {
            h1 {
                font-size: 20px;
            }

            .filters {
                grid-template-columns: 1fr;
            }

            .filters label,
            .filters input,
            .filters select,
            .filters button {
                width: 100%;
            }
			
			.botoes-acoes {
				flex-wrap: nowrap;
			}

			.botoes-acoes button {
				font-size: 14px !important;
				padding: 8px !important;
			}

			.botoes-acoes .pdf-button {
				font-size: 12px !important;
				padding: 6px 8px !important;
				max-width: 50px !important;
				flex: 0 0 50px !important;
			}
			
			.botoes-acoes .ordenar-button {
			font-size: 18px !important; /* maior destaque */
			font-weight: bold !important; /* negrito */
			padding: 6px 8px !important;
			max-width: 50px !important;
			flex: 0 0 50px !important;
			text-align: center;
		}

        .icone-seta {
		  font-size: 24px !important;
		  font-weight: bold !important;
		  line-height: 1;
		}

			
			
        }
		
		#total-registros-container {
			position: fixed;
			bottom: 0;
			left: 0;
			width: 100%;
			background-color: #f8f9fa; /* Cor de fundo */
			text-align: center;
			font-weight: bold;
			padding: 10px;
			border-top: 2px solid #ccc; /* Linha separadora */
		}
		
		.botoes-acoes {
			grid-column: 1 / 3;
			display: flex;
			justify-content: space-between;
			gap: 10px;
		}

		.botoes-acoes button {
			font-size: 16px;
			padding: 10px;
			font-weight: bold;
			border: none;
			cursor: pointer;
			flex: 1;
			box-sizing: border-box;
		}

		.botoes-acoes .pdf-button {
			background-color: #28a745;
			color: white;
			max-width: 100px;
			flex: none;
		}
		
		.ordenar-button {
			max-width: 140px;
			padding: 6px 10px;
			font-size: 14px;
			flex: none;
		}

/* Estilos para a tela de carregamento */

/* Estilos para a tela de carregamento */
    .loading-screen {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(255, 255, 255, 1); /* fundo branco sólido */
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        z-index: 9999;
        color: black;
        font-size: 24px;
    }
    
    .loading-spinner {
        border: 5px solid #f3f3f3;
        border-top: 5px solid #3498db;
        border-radius: 50%;
        width: 50px;
        height: 50px;
        animation: spin 1s linear infinite;
        margin-bottom: 15px;
    }
    
    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }

    </style>
</head>

<body>

<div class="loading-screen" id="loadingScreen">
        <div class="loading-spinner"></div>
        <div>Carregando... Aguarde.</div>
    </div>

    <div id="conteudo" style="display: none;">
    <h1>Reservas Excluídas</h1>

    <div class="filters">
        <label for="quadra">Quadra:</label>
        <select id="quadra">
            <option value="">Todas</option>
        </select>

        <label for="data">Data da Reserva:</label>
        <input type="date" id="data">

        <label for="jogador">Jogador:</label>
        <input type="text" id="jogador" placeholder="Digite um nome">

        <label for="duracao">Duração:</label>
        <select id="duracao">
            <option value="">Todas</option>
            <option value="1 Hora">1 Hora</option>
            <option value="2 Horas">2 Horas</option>
            <option value="2 Horas - Pirâmide">Pirâmide</option>
			<option value="Convidado">Convidado</option>
        </select>
		
		<label for="status">Status:</label>
		<select id="status" onchange="atualizarCorStatus(this)">
			<option value="" style="color: black;">Todas</option>
			<option value="pendente" style="color: orange; font-weight: bold;">Pendente</option>
			<option value="confirmada" style="color: green; font-weight: bold;">Confirmada</option>
			<option value="cancelada" style="color: #db7093; font-weight: bold;">Cancelada</option>
			<option value="expirada" style="color: red; font-weight: bold;">Expirada</option>
			<option value="modo-antigo" style="color: gray; font-weight: bold;">Sem Status</option>
		</select>

        <div class="botoes-acoes">
			<button onclick="filtrarLogs()">Filtrar</button>
			<button onclick="alternarOrdenacao()" id="botaoOrdenacao" class="ordenar-button">Ordenar</button>

			<button onclick="gerarPDF()" class="pdf-button">PDF</button>
		</div>

    </div>

    <div id="logs"></div>

<script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-database-compat.js"></script> 
<script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-auth-compat.js"></script> 

<script>
    
// Adicione este bloco no início do seu script
const firebaseConfig = {
    apiKey: "SUA_API_KEY",
    authDomain: "agenda-5ce95.firebaseapp.com",
    databaseURL: "https://agenda-5ce95-default-rtdb.firebaseio.com/",
    projectId: "agenda-5ce95",
    storageBucket: "agenda-5ce95.appspot.com",
    messagingSenderId: "852007565195",
    appId: "1:852007565195:web:d7bd789d140858f53f618e"
};
const app = firebase.initializeApp(firebaseConfig);
const db = firebase.database();


let logs = [];
let ordemCrescente = true; // A ordem inicial é crescente
let logsFiltrados = []; // Armazena os dados filtrados
let githubToken = ''; // Variável global para armazenar o token
	
	
function isMobile() {
    return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
} 



// Substitua o seu bloco fetch original por este

showLoading()

const url = `https://clube-olimpico.github.io/Reservas/logs/reservas-excluidas.json?t=${new Date().getTime()}`;

fetch(url)
  .then(r => r.json())
  .then(data => {
    // ==========================================================
    // INÍCIO DA CORREÇÃO DEFINITIVA
    // ==========================================================
    // 1. Atribui um ID persistente a cada log (seu índice original no arquivo)
    const allLogsWithId = data.map((log, index) => ({ ...log, id: index }));
    
    // 2. Pega a lista de IDs que já foram excluídos nesta sessão
    const idsExcluidos = JSON.parse(sessionStorage.getItem('idsExcluidos')) || [];

    // 3. Filtra a lista completa, removendo os logs cujo ID persistente já foi excluído
    logs = allLogsWithId.filter(log => !idsExcluidos.includes(log.id));
    // ==========================================================
    // FIM DA CORREÇÃO
    // ==========================================================

    // Ordena inicialmente a lista já filtrada em ordem crescente
    logs.sort((a, b) => {
      const [dataStrA, horaStrA] = a.exclusao.split(' ');
      const [dataStrB, horaStrB] = b.exclusao.split(' ');
      const dataA = new Date(dataStrA.split('/').reverse().join('-') + 'T' + horaStrA);
      const dataB = new Date(dataStrB.split('/').reverse().join('-') + 'T' + horaStrB);
      return dataA - dataB;
    });

    exibirLogs(logs);

    // Atualiza o texto do botão de ordenação
    const botao = document.getElementById("botaoOrdenacao");
    const simbolo = "↓";
    botao.innerHTML = isMobile()
      ? `<span class="icone-seta">↓</span>`
      : "↓ Decrescente";
      
    // Esconde o loading após tudo estar carregado e processado
    setTimeout(() => {
        hideLoading();
    }, 200); // 1000 milissegundos = 1 segundo
  })
  .catch(error => {
    console.error('Erro ao carregar dados:', error);
    // Esconde o loading mesmo em caso de erro
    hideLoading();
    // Opcional: mostrar mensagem de erro ao usuário
    alert('Erro ao carregar os dados. Por favor, tente recarregar a página.');
  });
  
  
  
// Substitua sua função inteira por esta
function alternarOrdenacao() {
  ordemCrescente = !ordemCrescente;

  // Usa a lista que está sendo exibida (filtrada ou não) para reordenar
  const listaParaOrdenar = logsFiltrados.length ? logsFiltrados : logs;
  const botao = document.getElementById("botaoOrdenacao");
  const simbolo = ordemCrescente ? "↓" : "↑";

  listaParaOrdenar.sort((a, b) => {
    const [dataStrA, horaStrA] = a.exclusao.split(' ');
    const [dataStrB, horaStrB] = b.exclusao.split(' ');
    const dataA = new Date(dataStrA.split('/').reverse().join('-') + 'T' + horaStrA);
    const dataB = new Date(dataStrB.split('/').reverse().join('-') + 'T' + horaStrB);
    return ordemCrescente ? dataA - dataB : dataB - dataA;
  });

  botao.innerHTML = isMobile()
    ? `<span class="icone-seta">${simbolo}</span>`
    : (ordemCrescente ? "↓ Decrescente" : "↑ Crescente");

  exibirLogs(listaParaOrdenar);
}




		

        if (isMobile()) {
            const dataInput = document.getElementById("data");

            dataInput.type = "text";
            dataInput.value = "dd/mm/aaaa";

            dataInput.addEventListener("focus", () => {
                if (dataInput.value === "dd/mm/aaaa") {
                    dataInput.value = "";
                    dataInput.type = "date";
                    setTimeout(() => dataInput.showPicker(), 10);
                }
            });

            dataInput.addEventListener("blur", () => {
                if (dataInput.value === "") {
                    dataInput.type = "text";
                    dataInput.value = "dd/mm/aaaa";
                }
            });
        }
		
		
// Substitua sua função 'exibirLogs' por esta versão completa
// Substitua sua função 'exibirLogs' por esta versão completa
function exibirLogs(lista) {
    const logsContainer = document.getElementById('logs'); 
    logsContainer.innerHTML = '';
    const fragment = document.createDocumentFragment();

    lista.forEach((log) => {
        const logEntryDiv = document.createElement('div');
        logEntryDiv.className = 'log-entry';
        
        let dataParts = log.exclusao.split(' ');
        let dataFormatada = dataParts[0].split('/').reverse().join('-') + 'T' + dataParts[1] + ':00';
        let date = new Date(dataFormatada);
        let formattedDate = isNaN(date) ? 'Data inválida' : date.toLocaleString('pt-BR', { day: '2-digit', month: '2-digit', year: 'numeric', hour: '2-digit', minute: '2-digit' }).replace(',', '');
        let duracaoDisplay = log.duracao;
        if (typeof duracaoDisplay === 'number') { duracaoDisplay = duracaoDisplay === 3 ? "2 Horas - Pirâmide" : duracaoDisplay === 2 ? "2 Horas" : "1 Hora"; }
        
        let jogadoresHtml = '';
        if (log.confirmacoes) {
            let nomesColoridos = [];
            log.jogadores.forEach(jogador => {
                const apelido = jogador.split(' - ').pop();
                const status = log.confirmacoes[apelido]; 
                let statusTexto = '';
                const styleBase = "cursor: pointer; font-weight: bold; -webkit-user-select: none; user-select: none;";

                if (status === 'confirmado') {
                    statusTexto = 'Confirmado';
                    nomesColoridos.push(`<span onclick="mostrarStatusJogador('${jogador}', '${statusTexto}')" style="${styleBase} color: green;">${jogador}</span>`);
                } else if (status === 'pendente') {
                    statusTexto = 'Pendente';
                    nomesColoridos.push(`<span onclick="mostrarStatusJogador('${jogador}', '${statusTexto}')" style="${styleBase} color: orange;">${jogador}</span>`);
                } else if (status === 'recusado') {
                    statusTexto = 'Recusado';
                    nomesColoridos.push(`<span onclick="mostrarStatusJogador('${jogador}', '${statusTexto}')" style="${styleBase} color: red;">${jogador}</span>`);
                } else {
                    nomesColoridos.push(`<span>${jogador}</span>`);
                }
            });
            jogadoresHtml = nomesColoridos.join(', ');
        } else {
            jogadoresHtml = log.jogadores.join(', ');
        }

        // ---> INÍCIO DA ALTERAÇÃO (RESULTADO COLAPSÁVEL) <---
        let resultadoHtml = '';
        if (log.resultado) {
            const resultadoId = `resultado-${log.id}`; // Cria um ID único para o contêiner do resultado

            let detalhesPlacar = '<ul style="margin: 0; padding-left: 20px; font-size: 0.9em; list-style-type: disc;">';

            if (log.resultado.set1 && log.resultado.set1.placar) {
                let placarSet1 = `1º Set: ${log.resultado.set1.placar}`;
                if (log.resultado.set1.tiebreak) { placarSet1 += ` (${log.resultado.set1.tiebreak})`; }
                detalhesPlacar += `<li>${placarSet1}</li>`;
            }
            if (log.resultado.set2 && log.resultado.set2.placar) {
                let placarSet2 = `2º Set: ${log.resultado.set2.placar}`;
                if (log.resultado.set2.tiebreak) { placarSet2 += ` (${log.resultado.set2.tiebreak})`; }
                detalhesPlacar += `<li>${placarSet2}</li>`;
            }
            if (log.resultado.set3) {
                detalhesPlacar += `<li>3º Set: ${log.resultado.set3}</li>`;
            }
            if (log.resultado.vencedor) {
                detalhesPlacar += `<li style="margin-top: 4px;"><strong>Vencedor(a):</strong> <span style="color: green; font-weight: bold;">${log.resultado.vencedor.toUpperCase()}</span></li>`;
            }
            detalhesPlacar += '</ul>';
            
            // Monta o HTML com o link clicável e o contêiner de detalhes oculto
            resultadoHtml = `
                <p style="margin-top: 8px; margin-bottom: 2px;">
                    <strong>Resultado do Jogo:</strong> 
                    <a href="javascript:void(0);" onclick="toggleResultado('${resultadoId}', this)" style="color: #007bff; text-decoration: none; font-weight: normal;">Ver Detalhes</a>
                </p>
                <div id="${resultadoId}" style="display: none;">
                    ${detalhesPlacar}
                </div>
            `;
        }
        // ---> FIM DA ALTERAÇÃO <---

        let detalhesConfirmacao = '';
        if (log.statusNoMomentoDaExclusao) {
            let statusStyle = log.statusNoMomentoDaExclusao.includes('pendente') ? 'color: orange;' : log.statusNoMomentoDaExclusao.includes('expirada') ? 'color: red;' : log.statusNoMomentoDaExclusao.includes('cancelada') ? 'color: #db7093;' : 'color: green;';
            detalhesConfirmacao += `<p style="font-size: 0.9em; margin-top: 8px;"><strong>Status:</strong> <span style="${statusStyle} font-weight: bold;">${log.statusNoMomentoDaExclusao.toUpperCase()}</span></p>`;
            if (log.organizadorDaReserva) { detalhesConfirmacao += `<p style="font-size: 0.9em;"><strong>Organizador:</strong> ${log.organizadorDaReserva}</p>`; }
        }
        
        let motivoHtml = '';
        if (log.motivo) {
            motivoHtml = `<p style="font-size: 0.9em;"><strong>Motivo:</strong> <span style="font-style: italic; color: #555;">${log.motivo}</span></p>`;
        }
        
        logEntryDiv.innerHTML = `
            <button onclick="solicitarExclusaoLog(${log.id})" style="float: right; cursor: pointer; background: #f2f2f2; color: #dc3545; border: 1px solid #dc3545; border-radius: 50%; width: 24px; height: 24px; font-size: 14px; font-weight: bold; line-height: 22px; text-align: center; padding: 0;">X</button>
            <p><strong>Exclusão: ${formattedDate}</strong></p>
            <p><strong>Data da Reserva:</strong> ${log.data}</p>
            <p>${log.quadra} | ${log.horario}</p>
            <p>Duração: ${duracaoDisplay || 'N/A'}</p>
            <p>Jogadores: ${jogadoresHtml}</p>
            ${resultadoHtml}
            <p>Excluído por: <strong>${log.usuario || 'N/A'}</strong></p>
            ${detalhesConfirmacao}
            ${motivoHtml} 
            <hr>
        `;
        fragment.appendChild(logEntryDiv);
    });
    logsContainer.appendChild(fragment);
    document.getElementById('total-registros').textContent = `Total de registros: ${lista.length}`;
}



// Substitua sua função solicitarExclusaoLog por esta
function solicitarExclusaoLog(logId) {
    // A função agora encontra o log pelo 'id' persistente
    const logParaExcluir = logs.find(log => log.id === logId);

    if (!logParaExcluir) {
        alert("Erro: Não foi possível encontrar o registro do log para exclusão.");
        return;
    }

    const resumoDaReserva = `\n\nQuadra: ${logParaExcluir.quadra}\n` +
                           `Data: ${logParaExcluir.data}\n` +
                           `Horário: ${logParaExcluir.horario}\n` +
                           `Jogadores: ${logParaExcluir.jogadores.join(', ')}`;

    if (confirm(`⚠️ Atenção!\n\nTem certeza que deseja excluir este registro do log permanentemente? A ação não pode ser desfeita.` + resumoDaReserva)) {
        
        // "Lembramos" o ID persistente do log que foi excluído
        let idsExcluidos = JSON.parse(sessionStorage.getItem('idsExcluidos')) || [];
        if (!idsExcluidos.includes(logId)) {
            idsExcluidos.push(logId);
        }
        sessionStorage.setItem('idsExcluidos', JSON.stringify(idsExcluidos));
        
        const indexParaRemover = logs.findIndex(log => log.id === logId);
        if (indexParaRemover > -1) {
            logs.splice(indexParaRemover, 1);
            if (logsFiltrados.length > 0) {
                const indexFiltrado = logsFiltrados.findIndex(log => log.id === logId);
                if (indexFiltrado > -1) {
                    logsFiltrados.splice(indexFiltrado, 1);
                }
            }
            const listaParaExibir = logsFiltrados.length > 0 ? logsFiltrados : logs;
            exibirLogs(listaParaExibir);
            salvarLogsNoGithub(logs);
        }
    }
}




// Substitua sua função salvarLogsNoGithub por esta
async function salvarLogsNoGithub(logsParaSalvar) {
    const token = githubToken;
    if (!token) {
        alert("Token de autenticação do GitHub não foi carregado. A página será recarregada para tentar novamente.");
        location.reload();
        return;
    }

    const usuarioGit = 'clube-olimpico';
    const repo = 'Reservas';
    const caminhoArquivo = 'logs/reservas-excluidas.json';
    const url = `https://api.github.com/repos/${usuarioGit}/${repo}/contents/${caminhoArquivo}`;

    try {
        let response = await fetch(url, { 
            headers: { 'Authorization': `token ${token}`, 'Accept': 'application/vnd.github.v3+json' },
            cache: 'no-cache'
        });
        if (!response.ok) throw new Error(`Erro ao buscar arquivo: ${response.status}`);
        let fileData = await response.json();

        // Antes de salvar, remove o campo 'id' temporário para manter o arquivo limpo
        const logsLimpos = logsParaSalvar.map(({ id, ...resto }) => resto);

        response = await fetch(url, {
            method: 'PUT',
            headers: { 'Authorization': `token ${token}`, 'Content-Type': 'application/json' },
            body: JSON.stringify({
                message: `Log removido por usuário em ${new Date().toLocaleString('pt-BR')}`,
                content: utf8_to_b64(JSON.stringify(logsLimpos, null, 2)),
                sha: fileData.sha
            }),
            cache: 'no-cache'
        });

        if (!response.ok) throw new Error(`Falha no upload: ${response.status}`);
        
        console.log("✅ Log excluído e salvo no GitHub com sucesso!");
        // A MENSAGEM DE SUCESSO AGORA É OPCIONAL, POIS A UI JÁ FOI ATUALIZADA
        // alert("Registro de log excluído com sucesso!"); 
        
        // --- CORREÇÃO PRINCIPAL ---
        // A linha location.reload() foi REMOVIDA daqui.

    } catch (erro) {
        console.error('❌ Erro ao salvar o arquivo de logs no GitHub:', erro);
        alert("Ocorreu um erro ao tentar salvar a exclusão do log. A página será recarregada para garantir a consistência dos dados.");
        location.reload(true); // Recarrega a página apenas em caso de erro
    }
}


        function filtrarLogs() {
			const quadra = document.getElementById('quadra').value.trim();
			const dataInput = document.getElementById('data');
			const jogador = document.getElementById('jogador').value.toLowerCase().trim();
			const duracao = document.getElementById('duracao').value.trim();
			const status = document.getElementById('status').value.trim(); // Pega o valor do novo filtro

			const data = (dataInput.value === "dd/mm/aaaa" || dataInput.value === "") ? null : dataInput.value;

			logsFiltrados = logs.filter(log => {
				const condQuadra = quadra === "" || quadra.toLowerCase() === "todas" || log.quadra === quadra;
				const condData = !data || log.data === data.split('-').reverse().join('-');
				const condJogador = !jogador || log.jogadores.some(j => j.toLowerCase().includes(jogador));

				let condDuracao = true;
				if (duracao === "Pirâmide") {
					condDuracao = log.duracao && log.duracao.includes("2 Horas") && log.duracao.toLowerCase().includes("mide") && !log.duracao.includes("1 Hora");
				} else if (duracao === "2 Horas") {
					condDuracao = log.duracao === "2 Horas" && !log.duracao.includes("Pirâmide");
				} else if (duracao === "1 Hora") {
					condDuracao = log.duracao === duracao;
				} else if (duracao === "Convidado") {
					condDuracao = log.jogadores.some(j => j.toLowerCase().includes("convidado"));
				} else if (duracao) {
					condDuracao = log.duracao === duracao;
				}

				// ==========================================================
				// INÍCIO DA NOVA LÓGICA DE FILTRO DE STATUS
				// ==========================================================
				let condStatus = true;
				if (status) {
					// Lógica para a sua nova opção "Sem Status"
					if (status === 'modo-antigo') {
						condStatus = !log.statusNoMomentoDaExclusao;
					} else {
						// Lógica para os outros status
						condStatus = log.statusNoMomentoDaExclusao && log.statusNoMomentoDaExclusao.toLowerCase().startsWith(status);
					}
				}
				// ==========================================================
				// FIM DA NOVA LÓGICA
				// ==========================================================

				return condQuadra && condData && condJogador && condDuracao && condStatus;
			});
			 
			exibirLogs(logsFiltrados);
		}
		
		
function gerarPDF() {
	const { jsPDF } = window.jspdf;
	const pdf = new jsPDF("p", "mm", "a4");
	const pageHeight = 297;
	const margin = 10;
	let y = margin;

	const totalContainer = document.getElementById("total-registros-container");
	totalContainer.style.display = "none";

	const logEntries = document.querySelectorAll('.log-entry');
	const total = document.getElementById("total-registros").textContent;

	let nomeArquivo = "Reservas";
	switch (document.getElementById("duracao").value) {
		case "1 Hora":
			nomeArquivo = "Reservas-1-Hora";
			break;
		case "2 Horas":
			nomeArquivo = "Reservas-2-Horas";
			break;
		case "2 Horas - Pirâmide":
			nomeArquivo = "Reservas-Piramide";
			break;
		case "Convidado":
			nomeArquivo = "Reservas-Convidados";
			break;
		default:
			nomeArquivo = "Reservas-Filtradas";
	}

	// Função auxiliar para processar logs de forma assíncrona
	const processarLogs = async () => {
		for (let i = 0; i < logEntries.length; i++) {
			const entry = logEntries[i];
			await html2canvas(entry, { scale: 2 }).then(canvas => {
				const imgData = canvas.toDataURL('image/png');
				const imgWidth = 190; // largura com margens
				const imgHeight = (canvas.height * imgWidth) / canvas.width;

				// Se passar do limite da página, adiciona uma nova
				if (y + imgHeight > pageHeight - margin) {
					pdf.addPage();
					y = margin;
				}

				pdf.addImage(imgData, 'PNG', margin, y, imgWidth, imgHeight);
				y += imgHeight + 5; // espaçamento entre entradas
			});
		}

		// Após todos os logs, adiciona o total de registros no final
		if (y + 10 > pageHeight - margin) {
			pdf.addPage();
			y = margin;
		}
		const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
		pdf.setFontSize(isMobile ? 30 : 12);
		pdf.text(total, margin, pageHeight - 10);


		pdf.save(`${nomeArquivo}.pdf`);
		totalContainer.style.display = "block";
	};

	processarLogs();
}







// Adicione esta nova função ao seu script
function carregarToken() {
    db.ref('sistemas/config/githubToken').once('value', (snapshot) => {
        if (snapshot.exists()) {
            githubToken = snapshot.val();
            console.log("✅ Token do GitHub carregado com sucesso.");
        } else {
            console.error("❌ Token do GitHub não encontrado no Firebase em /sistemas/config/githubToken");
        }
    });
}

// Chama a função para carregar o token quando a página carregar
window.onload = function() {
    carregarToken();
	atualizarCorStatus(document.getElementById('status'));
};

// Função auxiliar para codificar corretamente strings com caracteres especiais
function utf8_to_b64(str) {
    return btoa(unescape(encodeURIComponent(str)));
}

function showLoading() {
    document.getElementById('loadingScreen').style.display = 'flex';
}

function hideLoading() {
    document.getElementById('loadingScreen').style.display = 'none';
    document.getElementById('conteudo').style.display = 'block';
}

function atualizarCorStatus(selectElement) {
    // Pega a opção que está selecionada no momento
    const selectedOption = selectElement.options[selectElement.selectedIndex];
    
    // Pega a cor e o peso da fonte do estilo da opção selecionada
    const color = selectedOption.style.color;
    const fontWeight = selectedOption.style.fontWeight;

    // Aplica a cor e o peso da fonte ao próprio elemento <select>
    selectElement.style.color = color || 'black'; // Usa preto como padrão
    selectElement.style.fontWeight = fontWeight || 'normal'; // Usa peso normal como padrão
}

function mostrarStatusJogador(nomeJogador, status) {
    alert(`${nomeJogador}: ${status}`);
}


// Adicione esta nova função ao seu script
function toggleResultado(resultadoId, linkElement) {
    const resultadoDiv = document.getElementById(resultadoId);
    if (resultadoDiv) {
        if (resultadoDiv.style.display === 'none') {
            resultadoDiv.style.display = 'block';
            linkElement.textContent = 'Ocultar Detalhes';
        } else {
            resultadoDiv.style.display = 'none';
            linkElement.textContent = 'Ver Detalhes';
        }
    }
}

</script>
	
<div id="total-registros-container">
    <span id="total-registros">Total de registros: 0</span>
</div>
</div>

</body>

</html>
