<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Reservas - Watch</title>

    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-database-compat.js"></script>

    <style>
        /* Estilos otimizados para um ecrã de relógio */
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background-color: #000000;
            color: #ffffff;
            text-align: center;
            margin: 0;
            padding: 5px;
            box-sizing: border-box;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            -webkit-user-select: none;
            user-select: none;
        }

        .container {
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: row;
            align-items: center;
            gap: 8px;
        }

        .main-content {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            height: 100%;
            overflow: hidden;
        }

        .header {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 5px 0;
            flex-shrink: 0;
        }

        .nav-button {
            background-color: #444;
            border: none;
            color: white;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            flex-shrink: 0;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        #quadra-nome {
            font-size: 1.2em;
            font-weight: bold;
        }

        .reservas-lista {
            flex-grow: 1;
            overflow-y: auto;
            border-top: 1px solid #333;
            border-bottom: 1px solid #333;
            margin-top: 10px;
            padding: 10px 0;
        }

        .reservas-lista::-webkit-scrollbar {
            width: 4px;
        }

        .reservas-lista::-webkit-scrollbar-thumb {
            background: #555;
            border-radius: 2px;
        }

        .reserva-item {
            padding: 8px 5px;
            border-bottom: 1px solid #222;
        }

        .reserva-item:last-child {
            border-bottom: none;
        }

        .horario {
            font-weight: bold;
            color: #4CAF50;
            font-size: 1.1em;
        }

        .jogadores {
            font-size: 0.95em;
            color: #dddddd;
            word-wrap: break-word;
        }

        .loading-text {
            font-style: italic;
            color: #888;
        }
    </style>
</head>

<body>


    <div class="container">
        <button id="prev-quadra" class="nav-button">&lt;</button>
        <div class="main-content">
            <div class="header">
                <span id="quadra-nome">Carregando...</span>
            </div>
            <div id="reservas-lista" class="reservas-lista">
                <p class="loading-text">A carregar reservas...</p>
            </div>
        </div>
        <button id="next-quadra" class="nav-button">&gt;</button>
    </div>

    <script>
        const firebaseConfig = {
            apiKey: "YOUR_API_KEY",
            authDomain: "agenda-5ce95.firebaseapp.com",
            databaseURL: "https://agenda-5ce95-default-rtdb.firebaseio.com/",
            projectId: "agenda-5ce95",
            storageBucket: "agenda-5ce95.appspot.com",
            messagingSenderId: "852007565195",
            appId: "1:852007565195:web:d7bd789d140858f53f618e"
        };
        const app = firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        const quadras = ["Quadra 1 - Coberta", "Quadra 2 - Aberta", "Quadra 3 - Coberta"];
        let quadraAtualIndex = 0;
        let todasAsReservas = {};
        const quadraNomeEl = document.getElementById('quadra-nome');
        const listaReservasEl = document.getElementById('reservas-lista');
        const prevButton = document.getElementById('prev-quadra');
        const nextButton = document.getElementById('next-quadra');
        function mostrarReservasDaQuadra() {
            const nomeDaQuadra = quadras[quadraAtualIndex];
            quadraNomeEl.textContent = nomeDaQuadra.replace(" - ", "\n");
            const reservasDaQuadra = todasAsReservas[nomeDaQuadra] || {};
            listaReservasEl.innerHTML = '';
            const reservasOrdenadas = Object.values(reservasDaQuadra)
                .filter(r => r.borda)
                .sort((a, b) => a.hora - b.hora);
            if (reservasOrdenadas.length === 0) {
                listaReservasEl.innerHTML = '<p class="loading-text">Nenhuma reserva para hoje.</p>';
                return;
            }
            reservasOrdenadas.forEach(reserva => {
                const horaFim = reserva.hora + reserva.duracao;
                const horarioTexto = `${String(reserva.hora).padStart(2, '0')}:00 - ${String(horaFim).padStart(2, '0')}:00`;
                let jogadoresTexto = reserva.jogadores;
                if (reserva.duracao === 2) {
                    const key2 = `${reserva.dia}_${reserva.hora + 1}`;
                    const segundaParte = reservasDaQuadra[key2];
                    if (segundaParte && segundaParte.jogadores) {
                        const jogadoresUnicos = [...new Set([...jogadoresTexto.split(', '), ...segundaParte.jogadores.split(', ')])];
                        jogadoresTexto = jogadoresUnicos.join(', ');
                    }
                }
                const itemDiv = document.createElement('div');
                itemDiv.className = 'reserva-item';
                itemDiv.innerHTML = `<div class="horario">${horarioTexto}</div><div class="jogadores">${jogadoresTexto}</div>`;
                listaReservasEl.appendChild(itemDiv);
            });
        }
        prevButton.addEventListener('click', () => {
            quadraAtualIndex = (quadraAtualIndex - 1 + quadras.length) % quadras.length;
            mostrarReservasDaQuadra();
        });
        nextButton.addEventListener('click', () => {
            quadraAtualIndex = (quadraAtualIndex + 1) % quadras.length;
            mostrarReservasDaQuadra();
        });
        function carregarDadosIniciais() {
            const hoje = new Date();
            const diaDaSemanaHoje = hoje.getDay() === 0 ? 7 : hoje.getDay();
            const reservasRef = database.ref("sistemas/reservas");
            reservasRef.on('value', (snapshot) => {
                const data = snapshot.val() || {};
                todasAsReservas = {};
                for (const quadra in data) {
                    todasAsReservas[quadra] = {};
                    for (const key in data[quadra]) {
                        const reserva = data[quadra][key];
                        if (reserva.dia === diaDaSemanaHoje) {
                            todasAsReservas[quadra][key] = reserva;
                        }
                    }
                }
                mostrarReservasDaQuadra();
            }, (error) => {
                console.error("Erro ao carregar dados do Firebase:", error);
                listaReservasEl.innerHTML = '<p class="loading-text">Erro de conexão.</p>';
            });
        }
        carregarDadosIniciais();
    </script>

</body>
</html>
