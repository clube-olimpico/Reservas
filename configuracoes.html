<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    
    <title>Configurações do Sistema</title>

    <link rel="manifest" href="manifest-config.json">
    
    <meta name="theme-color" content="#4CAF50">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Configurações">

    <link rel="apple-touch-icon" href="logo-config-1.png">
    <link rel="icon" href="logo-config-1.png" type="image/png">

    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-database-compat.js"></script>

<style>

/* --- TRUQUE: ESCONDE A OPÇÃO SELECIONADA DA LISTA --- */ 
#perfilSelect option:checked {
    display: none;
}

body {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; 
    background-color: #f8f9fa;
    color: #212529;
    padding: 10px;
    display: flex;
    font-size: 18px;
    justify-content: center;
    align-items: flex-start; 
    
    /* --- MUDANÇAS PARA FIXAR A TELA --- */
    height: 100vh;       /* Força a altura exata da tela (antes era min-height) */
    margin: 0;
    overflow: hidden;    /* Remove completamente a rolagem */
    /* ---------------------------------- */
    
    box-sizing: border-box;  
}

.container {
    display: flex;
    align-items: center;
    margin-bottom: 10px;
    gap: 10px; 
}

/* --- CSS PARA O NOVO GERENCIADOR DE HORÁRIOS --- */

.tabela-config-horarios {
    width: 100%; border-collapse: collapse; margin-top: 10px;
}
.tabela-config-horarios th, .tabela-config-horarios td {
    padding: 10px 8px; text-align: center; border-bottom: 1px solid #eee;
}
.tabela-config-horarios th {
    background-color: #f8f9fa; font-size: 0.95em; color: #555;
}
.tabela-config-horarios input[type="time"] {
    width: 85px; padding: 5px; text-align: center; border: 1px solid #ccc; border-radius: 4px;
}
.tabela-config-horarios td:first-child { text-align: left; font-weight: 500; }

/* --- ESTILO PARA HORÁRIO PADRÃO FECHADO --- */
.tabela-config-horarios tr.fechado-padrao td {
    background-color: #ffebee !important; /* Vermelho claro */
    color: #a94442; /* Texto levemente avermelhado */
}

/* Deixa os inputs com aparência de desabilitados */
.tabela-config-horarios tr.fechado-padrao input,
.tabela-config-horarios tr.fechado-padrao select {
    background-color: transparent !important;
}

.tabela-horarios-scroll, .lista-dias-scroll {
    max-height: 400px; overflow-y: auto; border: 1px solid #ddd; border-radius: 4px; background: #fff;
}
.lista-dias-scroll { padding: 0; background-color: #fafafa; }

/* Linha de Dia Especial */
.linha-dia-especial {
    display: flex; align-items: center; gap: 10px; padding: 8px 10px; border-bottom: 1px solid #eee; background: #fff;
}
.linha-dia-especial:hover { background-color: #f0f8ff; }
.linha-dia-especial .dia-label { flex: 1; font-size: 0.95em; font-weight: 500; color: #333; }
.linha-dia-especial select { width: 100px !important; min-width: 100px; padding: 5px; }
.linha-dia-especial input[type="time"] { width: 80px; padding: 5px; }

.linha-dia-especial.fechado { background-color: #ffebee; }
.linha-dia-especial.fechado input[type="time"] { opacity: 0.5; pointer-events: none; background-color: #eee; }

@media (max-width: 600px) {
    .linha-dia-especial { flex-wrap: wrap; padding: 10px; }
    .linha-dia-especial span.dia-label { width: 100%; margin-bottom: 5px; font-weight: bold; border-bottom: 1px dashed #eee; }
    .linha-dia-especial input[type="time"], .linha-dia-especial select { flex: 1; }
}
/* --- FIM ESTILOS HORÁRIOS --- */

.container label[for="Sistema"] {
    width: auto; margin-right: 10px; font-weight: bold; display: inline-block; text-align: left; min-width: 100px;
}

#sistema { font-weight: bold; }

/* Pirâmide */
#piramide .piramide-ativa-container { justify-content: center; width: auto; }
#piramide .piramide-ativa-container label { width: auto; margin-right: 10px; font-weight: bold; }
#piramide .piramide-ativa-container select { width: 80px; border: 1px solid #ccc; border-radius: 5px; max-width: 4px; }
#piramide .piramide-botoes-container { display: flex; justify-content: space-between; max-width: 400px; width: 90%; margin: 0 auto; }
#piramide .piramide-botao { flex: 1; margin: 0 5px; padding: 10px; box-sizing: border-box; }
#piramide .piramide-botao:first-child { margin-left: 0; }
#piramide .piramide-botao:last-child { margin-right: 0; }

.quadra-container { margin-bottom: 5px; gap: 10px; }

/* Formulário Principal */
.form-container {
    box-sizing: border-box; /* Adicionado para travar a largura */
    padding: 20px; background: #ffffff; border: none; border-radius: 12px; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08); width: 400px; text-align: center; margin: 10px auto;
}

.title-container { display: flex; flex-direction: column; align-items: center; text-align: center; margin-bottom: 5px; }
.title-container span { font-family: 'Arial', sans-serif; font-size: 1.3em; font-weight: bold; line-height: 1.0em; letter-spacing: 3px; text-align: center; }

label { font-weight: bold; width: 190px; white-space: nowrap; text-align: left; display: inline-block; }
select { flex: 1; padding: 5px; box-sizing: border-box; width: auto; min-width: 80px; }

button {
    margin-top: auto; margin-bottom: 20px; padding: 10px; font-size: 17px; background-color: #4CAF50; color: white; border: none; cursor: pointer; width: 250px; max-width: 90%; align-self: center; display: block;
}
button:hover { background-color: #45a049; }

#sistema.on { color: white; background-color: green; }
#sistema.off { color: white; background-color: red; }
#piramideAtiva { font-weight: bold; margin-top: 0; }
.piramide-on { color: green; }
.piramide-off { color: red; }

#loading { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 2rem; text-align: center; z-index: 1000; }
#content { display: none; }
.hr-line { border: 0; height: 6px; background: linear-gradient(to bottom, #cccccc, #dddddd, #eeeeee, #ffffff); width: 90%; max-width: 99%; margin: 10px auto; }

/* Abas */
.convidados-container, .piramde-container, .duplas-container { margin-top: 20px; }
.convidados-container, .convidados-quadras, .convidados-dias, .convidados-options,
.piramde-container, .piramde-quadras, .piramde-dias, .piramde-options,
.duplas-options { width: 100%; max-width: 100%; overflow-x: hidden; box-sizing: border-box; padding: 0 10px; }

.convidados-options label, .piramde-options label { display: flex; align-items: center; white-space: nowrap; width: 100%; }
#convidados, #piramde { overflow-x: hidden !important; max-width: 100% !important; width: 100%; }
body.convidados-ativo, body.piramde-ativo { overflow-x: hidden !important; }

.centraliza-checkbox { display: flex; justify-content: center; align-items: center; width: 100%; margin-top: 10px; }
#piramideQuadra1, #piramideQuadra2, #piramideQuadra3 { margin-right: 7px; }
#PiramideDiasQuadra1, #PiramideDiasQuadra2, #PiramideDiasQuadra3 { margin-left: 7px; }

/* Duplas */
#DuplasDiasQuadra1.disabled, #DuplasDiasQuadra2.disabled, #DuplasDiasQuadra3.disabled { cursor: not-allowed; color: #999; }
#duplas .duplas-ativa-container { display: flex; align-items: center; justify-content: center; width: 100%; margin-top: 5px; }
#duplas .duplas-ativa-container label { width: auto; margin-right: 10px; font-weight: bold; }
#duplas .duplas-ativa-container select { width: 80px; border: 1px solid #ccc; border-radius: 5px; max-width: 4px; font-weight: bold; }
#duplas .duplas-botoes-container { display: flex; justify-content: space-between; max-width: 400px; width: 90%; margin: 0 auto; margin-bottom: 0px; }
#duplas .centraliza-checkbox { margin-top: -10px; margin-bottom: 10px; }
#duplas .duplas-botao { flex: 1; margin: 0 5px; padding: 10px; box-sizing: border-box; background-color: #4CAF50; color: white; }

/* --- CORREÇÃO DO BOTÃO ATIVO DE DUPLAS --- */
.duplas-botao.ativo,
.duplas-botao.ativo:focus,
.duplas-botao.ativo:hover { 
    background-color: #2E7D32 !important; /* Verde Escuro Forçado */
    color: white !important;              /* Texto Branco */
    font-weight: bold !important; 
    box-shadow: 0 0 5px rgba(0,0,0,0.3) !important;
    border: 1px solid #1b5e20 !important; /* Borda escura para definição */
    outline: none !important;             /* Remove qualquer borda azul/preta de foco */
}


#duplas .duplas-day-container { margin-bottom: 5px; }
.duplas-day-container > label { font-weight: normal; display: flex; align-items: center; width: auto; }
.duplas-time-wrapper { padding-left: 25px; margin-top: 4px; }
#duplas .duplas-time-wrapper { padding-left: 5px; margin-top: 0px; }
.horario-input { width: 60px; margin: 0 5px; text-align: center; }
#duplasQuadra1Ativa, #duplasQuadra2Ativa, #duplasQuadra3Ativa { margin-right: 7px; }
#DuplasDiasQuadra1, #DuplasDiasQuadra2, #DuplasDiasQuadra3 { margin-left: 7px; cursor: pointer; -webkit-user-select: none; -ms-user-select: none; user-select: none; }
#duplas .duplas-day-container > label { font-size: 15px; }
#duplas .horario-input { font-size: 15px; }
#duplasAtiva.duplas-on { color: green; font-weight: bold; }
#duplasAtiva.duplas-off { color: red; font-weight: bold; }
#duplasRanking.ranking-on { color: green; font-weight: bold; }
#duplasRanking.ranking-off { color: red; font-weight: bold; }
#labelDuplasRanking.clickable-reset { cursor: pointer; user-select: none; -webkit-user-select: none; -ms-user-select: none; }

/* Responsivo */
@media (max-width: 768px) {
    .form-container { width: 90%; padding: 10px; margin: 1px auto; box-sizing: border-box; }
    #sistema { width: 70px; min-width: 70px; flex: none; }
    #usuariosOnline { margin-left: auto; }
    .form-container .container > label { width: 150px; }
    
    #reservas .container label { width: 198px; flex-shrink: 0; }
    #reservas .container select { max-width: 170px; width: 100%; margin-left: auto; flex: initial; }
    
    /* NOVO: Ajuste do gerenciador no mobile */
    #tipoConfiguracaoHorario { max-width: 100% !important; margin-left: 0 !important; }

    .convidados-options { margin-left: -20px; white-space: nowrap; }
	
    .convidados-options label { max-width: 100%; white-space: nowrap; font-size: 15px; }
    .piramde-options label { 
        max-width: 100%; 
        white-space: nowrap !important; /* FORÇA O TEXTO A FICAR EM UMA LINHA SÓ */
        font-size: 14px !important;     /* Diminui 1px para garantir que caiba na tela */
        overflow: visible;
    }
    
	
	#piramideInicio, #piramideFim, #piramideSeparador { font-size: 0.8em !important; }
    #piramideInicio { margin-left: 4px !important; }
    #piramideSeparador { margin: 0 2px !important; }
    .duplas-day-container > label { font-size: 15px; }
    .horario-input { font-size: 14px; }
    #piramide .piramide-botoes-container, #duplas .duplas-botoes-container { width: 100%; }
    #piramide .piramide-botao, #duplas .duplas-botao { flex: 1; margin: 5px; margin-top: 0px; padding: 10px; height: 35px; line-height: 15px; box-sizing: border-box; font-size: 16px; white-space: nowrap; align-items: center; justify-content: center; }
    .centraliza-checkbox { margin-top: 7px; }
    #duplas .centraliza-checkbox { display: flex; justify-content: center; align-items: center; width: 100%; margin-top: -12px; margin-bottom: 0; }
    

	
    #main-content { min-height: 500px; position: relative; width: 100%; max-width: 100%; overflow: hidden; box-sizing: border-box; }
    .tab-content { display: none; padding: 10px; width: 100%; max-width: 100%; box-sizing: border-box; position: absolute; top: 40px; left: 0; bottom: 0; overflow-y: auto; }
    .tab-content-active { display: block; }
    .tabs .tab { padding: 8px 10px; font-size: 16px; white-space: nowrap; }
}

.tab-content { display: none; padding: 10px; width: 100%; max-width: 100%; overflow: hidden; box-sizing: border-box; }
.tab-content-active { display: block; }
.tabs { display: flex; justify-content: center; margin-top: 10px; margin-bottom: 15px; }
.tab { padding: 10px 20px; cursor: pointer; background: none; border: none; border-bottom: 3px solid transparent; color: #6c757d; font-weight: 500; transition: all 0.2s ease-in-out; height: auto; display: flex; align-items: center; margin-bottom: -20px; }
.tab:hover { color: #0056b3; }
.tab.active { background: none; font-weight: 600; color: #007bff; border-bottom-color: #007bff; }

#usuariosOnline { background-color: #f2f2f2; font-weight: bold; border: 1px solid black; padding: 5px; }



input[id$="Exceto17_19"] { margin-left: 20px; }
input[id$="Exceto7_12"] { margin-left: 20px; }
input[id$="Exceto8_12"] { margin-left: 20px; }
#convidados { overflow-x: hidden !important; max-width: 100% !important; width: 100%; margin-top: 30px; }
input:disabled, select:disabled, button:disabled { cursor: not-allowed; opacity: 0.7; }
.piramide-botao { background-color: #4CAF50; color: white; }

/* --- CORREÇÃO DO BOTÃO ATIVO DA PIRÂMIDE --- */
.piramide-botao.ativo,
.piramide-botao.ativo:focus,
.piramide-botao.ativo:hover { 
    background-color: #2E7D32 !important; /* Verde Escuro Forçado */
    color: white !important;              /* Texto Branco */
    font-weight: bold !important; 
    box-shadow: 0 0 5px rgba(0,0,0,0.3) !important;
    border: 1px solid #1b5e20 !important; /* Borda escura para definição */
    outline: none !important;             /* Remove qualquer borda azul/preta de foco */
}

/* Modais Gerais */

/* Atualize a classe .modal-overlay para ter o desfoque */
.modal-overlay {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.6); /* Fundo escuro transparente */
    z-index: 2000;
    justify-content: center;
    align-items: center;
    
    /* ADICIONE ISTO PARA O EFEITO DE DESFOQUE (MARCA D'ÁGUA) */
    backdrop-filter: blur(5px);
    -webkit-backdrop-filter: blur(5px); /* Para funcionar no iPhone/Safari */
}

.modal-content { background-color: white; padding: 20px; border-radius: 8px; box-shadow: 0 5px 15px rgba(0,0,0,0.3); width: 90%; max-width: 400px; max-height: 90vh; overflow-y: auto; }
.modal-content h2 { margin-top: 0; color: #333; border-bottom: 1px solid #eee; padding-bottom: 10px; margin-bottom: 20px; text-align: center; }
.modal-content .container { gap: 15px; }
.modal-content .container label { width: 90px; flex-shrink: 0; text-align: left; font-size: 16px; }
.modal-content .container input[type="text"], .modal-content .container input[type="date"], .modal-content .container .time-input-wrapper { flex: 1; }
.modal-content .container input { padding: 8px; border: 1px solid #ccc; border-radius: 4px; font-size: 16px; width: 100%; box-sizing: border-box; }
.modal-content .time-input-wrapper { display: flex; align-items: center; gap: 10px; }
.modal-content .modal-buttons { justify-content: flex-end; width: 100%; margin-top: 15px; display: flex; gap: 10px; }
.modal-buttons button { padding: 8px 15px; border-radius: 5px; cursor: pointer; font-size: 16px; width: auto; margin: 0; }
.modal-buttons .btn-adicionar { background-color: #4CAF50; color: white; border: none; }
.modal-buttons .btn-fechar { background-color: #f44336; color: white; border: none; }
.modal-content hr { width: 100%; border: none; border-top: 1px solid #eee; margin: 20px 0; }
.modal-content h3 { margin-bottom: 10px; font-size: 1.1em; }
#listaExcecoes ul, #listaBloqueios ul { list-style: none; padding: 0; }
#listaExcecoes li, #listaBloqueios li { background-color: #f9f9f9; padding: 10px; border-radius: 4px; margin-bottom: 5px; display: flex; justify-content: space-between; align-items: center; font-size: 15px; }
#listaExcecoes .btn-remover, #listaBloqueios .btn-remover { background-color: #e57373; color: white; border: none; cursor: pointer; border-radius: 50%; width: 22px; height: 22px; padding: 0; font-size: 12px; font-weight: bold; display: flex; align-items: center; justify-content: center; line-height: 1; }
.no-select { -webkit-user-select: none; -ms-user-select: none; user-select: none; }
.dias-semana-label { display: flex; align-items: center; font-weight: normal; font-size: 16px; padding: 8px 0; cursor: pointer; gap: 10px; }
#reservasPorConfirmacao.confirmacao-on { color: green; }
#reservasPorConfirmacao.confirmacao-off { color: red; }
#edicaoOrganizador.edicao-on { color: green; }
#edicaoOrganizador.edicao-off { color: red; }

#otimizacaoHorarios.quebra-on { color: green; font-weight: normal; }
#otimizacaoHorarios.quebra-off { color: red; font-weight: normal; }

#otimizacaoHorarios, #edicaoOrganizador, #reservasPorConfirmacao, #sistema, #piramideAtiva, #duplasAtiva { -webkit-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none; }
.input-group { display: flex; align-items: center; flex: 1; }
.input-group select { width: 100%; }
.add-button { width: auto; max-width: none; margin: 0; padding: 0; background: none; border: none; color: #007bff; cursor: pointer; font-size: 28px; font-weight: 400; line-height: 1; margin-left: 8px; }
.add-button:hover { color: #0056b3; }
.input-group input[type="text"] { width: 100%; padding: 5px; box-sizing: border-box; border: 1px solid #ced4da; border-radius: .25rem; }
#arbitro[readonly] { background-color: #e9ecef; cursor: default; }
.swap-button { width: auto; max-width: none; margin: 0; padding: 0; background: none; border: none; color: #6c757d; cursor: pointer; font-size: 20px; line-height: 1; margin-left: 8px; }
.swap-button:hover { color: #343a40; }
#reservas .container select {
    max-width: 170px !important;   /* Força o tamanho igual ao antigo */
    width: 100% !important;
    margin-left: auto !important;  /* Empurra para a direita */
    flex: initial !important;      /* Impede que o campo estique e invada o label */
}
.lista-jogadores-scroll { max-height: 300px; overflow-y: auto; border: 1px solid #eee; border-radius: 4px; margin-top: 15px; }
.item-jogador { padding: 12px 10px; cursor: pointer; border-bottom: 1px solid #f0f0f0; font-size: 16px; }
.item-jogador:last-child { border-bottom: none; }
.item-jogador:hover { background-color: #f5f5f5; }
.label-help { cursor: help; }


/* AJUSTE PC: Alinha o bloco de baixo com o de cima */
#reservas > div {
    box-sizing: border-box; /* Inclui borda e padding no cálculo da largura */
    width: 400px;           /* Mesma largura do bloco de cima */
    margin: 10px auto;      /* Centraliza igual ao bloco de cima */
    display: block;
}



/* --- CORREÇÃO FINAL E SEGURA (V5) --- */

/* 1. CONFIGURAÇÃO DO BOX (Ajuste Estrutural) */
#reservas .form-container {
    margin-top: 0 !important;
    border-top: 1px solid #eee;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
    padding-bottom: 20px;
    border-radius: 0 0 12px 12px !important; /* Fecha a borda embaixo */
}

/* 2. ALINHAMENTO DA LINHA (FLEXBOX SEGURO) */
.form-container .container {
    margin-bottom: 5px !important; /* Reduzi para ficar compacto igual à tela-1 */
    min-height: 30px; /* Altura mínima consistente */
    align-items: center;
}

/* 3. COMPORTAMENTO NO COMPUTADOR (RÍGIDO) 
   Aqui voltamos para a configuração que funcionou no seu print 'config-pc.jpg' */

#reservas .form-container .container label {
    flex: 0 0 190px !important;  /* TRAVADO: Largura fixa de 190px */
    width: 190px !important;     /* Garante que não estique nem encolha */
    font-weight: bold;
    white-space: nowrap;
    margin-right: 0;             /* Sem margem extra para alinhar matematicamente */
    overflow: visible !important; /* Garante que não apareça (...) */
}

#reservas .form-container .container select {
    flex: 0 0 135px !important;  /* TRAVADO: Largura fixa de 135px */
    width: 135px !important;
    min-width: 135px !important;
    max-width: 135px !important;
}

/* 4. COMPORTAMENTO NO CELULAR (FLEXÍVEL) 
   Só ativa se a tela for menor que 600px */

@media (max-width: 600px) {
    
    #reservas .form-container {
        width: 98% !important;
        margin: 0 auto !important;
        padding-left: 5px !important;
        padding-right: 5px !important;
    }

    /* Label no celular: Solta a trava de 190px e deixa ocupar o espaço livre */
    #reservas .form-container .container label {
        flex: 1 !important;        /* Ocupa o espaço que sobrar */
        width: auto !important;    /* Largura automática */
        margin-right: 5px !important;
        font-size: 18px !important; /* Leve ajuste de segurança se precisar */
    }

    /* Campo no celular: Trava em 80px para caber na linha */
    #reservas .form-container .container select {
        flex: 0 0 80px !important; /* TRAVADO EM 80px */
        width: 80px !important;
        min-width: 80px !important;
        max-width: 80px !important;
    }
}

/* --- FIM DE CORREÇÃO FINAL E SEGURA (V5) --- */


/* --- AJUSTE MODAL HORÁRIO PADRÃO --- */

/* Faz os botões do rodapé ocuparem 50% cada um */
.modal-buttons button {
    flex: 1;      /* Cresce para ocupar espaço igual */
    width: 100%;  /* Garante que o botão use o espaço disponível */
    margin: 0 5px; /* Um pequeno respiro entre eles */
}
/* Remove a margem do primeiro e último para alinhar perfeitamente */
.modal-buttons button:first-child { margin-left: 0; }
.modal-buttons button:last-child { margin-right: 0; }

/* --- FIM DE AJUSTE MODAL HORÁRIO PADRÃO --- */



/* --- Estilos Padrão (Desktop e Celular Deitado) --- */
.texto-mobile {
    display: none; /* Esconde "Abre/Fecha" normalmente */
}

/* --- Regras APENAS para Celular Vertical (Telas até 600px) --- */
@media (max-width: 600px) {

    /* 1. Troca os textos do cabeçalho */
    .texto-desktop { display: none; }
    .texto-mobile { display: inline; }

    /* 2. Ajustes de Container para ganhar espaço */
    .modal-body { padding: 5px !important; }
    .modal-content { width: 98% !important; padding: 10px 5px !important; }
    
    /* 3. Tabela Rígida (Fixed Layout) */
    .tabela-config-horarios {
        width: 100% !important;
        table-layout: fixed; /* Obriga as colunas a terem tamanho exato */
        border-collapse: collapse;
    }

    /* 4. Largura das Colunas (Soma = 100%) */
    /* Dia (Aumentado para caber fonte maior) */
    .tabela-config-horarios th:nth-child(1), 
    .tabela-config-horarios td:first-child { 
        width: 22% !important; 
    }
    /* Status */
    .tabela-config-horarios th:nth-child(2), 
    .tabela-config-horarios td:nth-child(2) { 
        width: 26% !important; 
    }
    /* Abre */
    .tabela-config-horarios th:nth-child(3), 
    .tabela-config-horarios td:nth-child(3) { 
        width: 26% !important; 
    }
    /* Fecha */
    .tabela-config-horarios th:nth-child(4), 
    .tabela-config-horarios td:nth-child(4) { 
        width: 26% !important; 
    }

    /* 5. Estilo das Células */
    .tabela-config-horarios th, 
    .tabela-config-horarios td {
        padding: 2px 1px !important; /* Quase sem espaço entre colunas */
        vertical-align: middle !important;
        text-align: center;
    }

    /* 6. CORREÇÃO DA FONTE DO DIA */
    .tabela-config-horarios td:first-child {
        font-size: 14px !important; /* Fonte maior conforme pedido */
        font-weight: bold;
        text-align: left;
        padding-left: 2px !important;
        white-space: nowrap;
    }

    /* 7. SOLUÇÃO DOS CAMPOS QUE ESTOURAVAM (Inputs e Selects) */
    .tabela-config-horarios select,
    .tabela-config-horarios input[type="time"] {
        width: 100% !important;      /* Ignora o width:100px/85px do PC */
        min-width: 0 !important;     /* Remove travas mínimas */
        max-width: 100% !important;
        
        height: 34px !important;     /* Altura padronizada */
        padding: 0 !important;       /* Remove bordas internas */
        margin: 0 !important;
        
        font-size: 13px !important;  /* Fonte legível e igual para todos */
        text-align: center;
        border-radius: 4px;
        box-sizing: border-box !important; /* Garante que borda não aumente tamanho */
    }

    /* Ajuste específico para o Select (Status) centralizar texto */
    .tabela-config-horarios select {
        text-align-last: center;
        padding-left: 0 !important;
    }
}
/* ---  FIM DE REGRAS APENAS PARA CELULAR VERTICAL (Telas até 600px) --- */


button:disabled {
    background-color: #cccccc !important;
    color: #666666 !important;
    cursor: not-allowed !important;
    box-shadow: none !important;
    opacity: 1 !important; /* Remove a transparência para ficar cinza sólido */
}


/* --- AJUSTES MOBILE: HORÁRIOS ESPECIAIS (Telas até 600px) --- */
@media (max-width: 600px) {
    
    /* 1. REGRA GERAL: Permite quebra de linha (útil para as Datas) */
    #modalHorarioEspecial .container {
        flex-wrap: wrap;
        gap: 5px !important;
    }

    /* --- CORREÇÃO: FORÇA O NOME A FICAR NA MESMA LINHA --- */
    #formPeriodoEspecial > .container:nth-child(1) {
        flex-wrap: nowrap !important;
    }

    /* Label do Nome */
    #modalHorarioEspecial label[style*="width: 140px"] {
        width: auto !important; 
        min-width: fit-content !important; 
        white-space: nowrap; 
        margin-right: 5px !important;
        margin-bottom: 0 !important;
    }
    
    /* Input do Nome */
    #nomePeriodo {
        flex: 1 !important; 
        width: auto !important;
        min-width: 0 !important; 
    }

    /* --- CORREÇÃO DA LINHA DE VIGÊNCIA (Força linha única) --- */
    
    /* 1. Seleciona a linha da Vigência (o 2º bloco do formulário) */
    #formPeriodoEspecial > .container:nth-child(2) {
        flex-wrap: nowrap !important;   /* OBRIGATÓRIO: Proíbe quebrar linha */
        align-items: center !important;
        gap: 2px !important;            /* Cola os itens uns nos outros */
    }

    /* 2. Ajusta o Label "Vigência:" */
    #formPeriodoEspecial > .container:nth-child(2) > label {
        width: auto !important;
        flex: 0 0 auto !important;      /* Ocupa só o espaço do texto */
        margin-right: 2px !important;
        font-size: 17px !important;
    }

    /* 3. Ajusta o container interno das datas */
    #formPeriodoEspecial > .container:nth-child(2) > div {
        display: flex !important;
        flex: 1 !important;             /* Ocupa todo o resto da linha */
        width: 100% !important;
        align-items: center !important;
        gap: 1px !important;
    }

    /* 4. O SEGREDO: Inputs de Data flexíveis */
    #dataInicioPeriodo, #dataFimPeriodo {
        flex: 1 !important;             /* Divide o espaço igualmente */
        width: auto !important;         /* Solta a largura fixa */
        min-width: 0 !important;        /* Permite encolher se precisar */
        max-width: 100% !important;
        
        /* Ajuste visual para caber "26/12/2025" */
        font-size: 15px !important;     /* Fonte menor */
        padding: 0 !important;          /* Sem borda interna */
        text-align: center;             /* Centralizado */
        height: 30px !important;
    }

    /* Texto "até" */
    #formPeriodoEspecial span {
        font-size: 11px !important; 
        margin: 0 1px !important;
    }

    /* Checkbox */
    #modalHorarioEspecial input[type="checkbox"] { margin: 0 !important; }
    .dias-semana-label { margin-bottom: 0 !important; padding-bottom: 0 !important; }
	#formPeriodoEspecial .dias-semana-label span {
		font-size: 14px !important; /* Ajuste aqui o tamanho que preferir */
	}

    /* 2. PAINEL AMARELO (Layout Compacto) */
    .painel-regra-mestra {
        padding: 8px !important;
        margin-bottom: 10px !important;
        margin-top: 2px !important;
    }

    .painel-regra-mestra .container {
        display: flex !important;
        flex-direction: row !important; 
        flex-wrap: wrap !important;
        justify-content: space-between !important;
        align-items: center !important;
        gap: 5px !important;
    }
    
    /* Select (Aberto/Fechado) */
    #regraMestraStatus {
        flex: 1 !important;
        min-width: 80px !important;
        max-width: 110px !important;
        margin: 0 !important;
        height: 30px !important;
    }

    /* Container dos horários */
    .painel-regra-mestra div[style*="display: flex"] {
        flex: 2 !important;
        justify-content: flex-end !important;
        width: auto !important;
        gap: 2px !important;
    }

    /* Inputs de Horário maiores */
    #regraMestraInicio, #regraMestraFim {
        width: 85px !important;
        padding: 0 !important;
        text-align: center;
        height: 30px !important;
        font-size: 14px !important;
    }

    /* 3. BOTÃO CENTRALIZADO */
    #btnGerarDias {
        flex-basis: 100% !important;
        width: 96% !important;
        margin: 10px auto 0 auto !important;
        padding: 8px !important;
        height: auto !important;
        display: block !important;
    }

    /* 4. LISTA DE DIAS (Ajuste Fino V9 - Equilibrado sem buracos) */
    .linha-dia-especial {
        display: flex !important;
        flex-direction: row !important;
        flex-wrap: nowrap !important;   /* Linha única */
        align-items: center !important;
        justify-content: space-between !important; /* Distribui o espaço suavemente */
        padding: 8px 0px !important;
        gap: 2px !important;
        border-bottom: 1px solid #eee !important;
    }

    /* DATA: Fonte 15px, SEM esticar (buraco removido) */
    .linha-dia-especial .dia-label {
        width: auto !important;
        flex: 0 0 auto !important;      /* CORREÇÃO: Não cresce infinitamente (tira o buraco) */
        margin-bottom: 0 !important;
        font-weight: bold;
        color: #007bff;
        font-size: 15px !important;     /* Fonte Grande solicitada */
        white-space: nowrap !important;
        overflow: visible !important;   /* Garante que o (Seg) apareça */
        padding-left: 2px !important;
        margin-right: 5px !important;   /* Pequeno respiro entre data e status */
    }

    /* VISIBILIDADE DAS DATAS */
    .linha-dia-especial .view-desktop { display: none !important; }
    .linha-dia-especial .view-mobile { display: inline-block !important; }
    .linha-dia-especial .separador-hora { display: none !important; }
    .linha-dia-especial span:not(.dia-label):not(.view-mobile) { display: none; }

    /* SELECT (Status): Meio termo (66px) */
    .linha-dia-especial select.status-dia {
        width: 66px !important;         /* Ajuste fino */
        min-width: 66px !important;
        height: 32px !important;
        padding: 0 0 0 1px !important;
        font-size: 12px !important;
        margin: 0 !important;
    }

    /* INPUTS (Horários): Meio termo (46px) */
    .linha-dia-especial input.inicio-dia,
    .linha-dia-especial input.fim-dia {
        width: 46px !important;         /* Ajuste fino */
        min-width: 46px !important;
        height: 32px !important;
        padding: 0 !important;
        text-align: center;
        font-size: 13px !important;
        margin: 0 !important;
        border-radius: 4px;
    }
}

/* ---  FIM DE AJUSTES MOBILE: HORÁRIOS ESPECIAIS (Telas até 600px) --- */


/* --- ESTILOS DO MODAL DE AULAS (BLINDADO) --- */

/* 1. Botões de Quadra (Estilo App Principal - Pílula e Tela Cheia) */
.quadras-tabs-container {
    display: flex;
    gap: 10px;
    margin-bottom: -10px;
    justify-content: space-between;
    width: 100%;
}

.quadra-tab {
    background-color: #f1f1f1;
    border: 1px solid #ddd;
    border-radius: 50px; 
    padding: 10px 5px;
    cursor: pointer;
    font-weight: bold;
    color: #555;
    flex: 1; 
    max-width: none; 
    text-align: center;
    line-height: 1.3;
    font-size: 16px;
    transition: all 0.2s;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

.quadra-tab.active {
    background-color: #228B22; 
    color: white;
    border-color: #1A6418;
    box-shadow: 0 2px 5px rgba(0,0,0,0.2);
}

.quadra-tab .mobile-text { display: none; }
.quadra-tab .desktop-text { display: inline; }

@media (max-width: 600px) {
    .quadras-tabs-container { gap: 5px; }
    .quadra-tab { 
        padding: 8px 2px; 
        font-size: 0.85em; 
        border-radius: 50px; 
    }
    .quadra-tab .desktop-text { display: none; }
    .quadra-tab .mobile-text { display: block; }
}

/* 2. Painel de Controle (Compacto e Alinhado) */
.painel-controle-aulas {
    background: #f8f9fa !important;
    padding: 10px !important;
    border: 1px solid #eee !important;
    border-radius: 8px !important;
    margin-bottom: 10px !important;
    display: block !important; /* Garante bloco padrão */
}

/* Container Flexível (A Linha Mestra) */
.painel-controle-aulas .linha-unica-flex {
    display: flex !important;
    flex-direction: row !important; /* Força horizontal */
    align-items: center !important;       
    justify-content: flex-start !important; 
    flex-wrap: nowrap !important;         
    gap: 20px !important;                 
    width: 100% !important;
    margin: 0 !important;
    padding: 0 !important;
}

/* GRUPO 1: Checkbox */
.painel-controle-aulas .label-ativar {
    display: flex !important;
    align-items: center !important;
    cursor: pointer !important;
    white-space: nowrap !important;
    flex-shrink: 0 !important; 
    margin: 0 !important;
    width: auto !important;
}
.painel-controle-aulas .label-ativar input {
    width: 18px !important;
    height: 18px !important;
    margin: 0 5px 0 0 !important;
    cursor: pointer !important;
    accent-color: #2e7d32 !important;
    display: inline-block !important;
}
.painel-controle-aulas .label-ativar span {
    font-weight: bold !important;
    color: #2e7d32 !important;
    font-size: 15px !important;
    display: inline-block !important;
}

/* GRUPO 2: Professor (Compacto e Grudado) */
.painel-controle-aulas .grupo-professor-compacto {
    display: flex !important;
    align-items: center !important;
    gap: 5px !important;          
    flex-shrink: 0 !important;    
    width: auto !important;
    margin: 0 !important;
}
.painel-controle-aulas .grupo-professor-compacto label {
    font-weight: bold !important;
    margin: 0 !important;
    font-size: 15px !important;
    white-space: nowrap !important;
    width: auto !important; 
    min-width: 0 !important; /* Remove qualquer largura mínima herdada */
    display: inline-block !important;
}

/* Note que mudei 'input' para 'select' aqui */
.painel-controle-aulas .grupo-professor-compacto select {
    width: 160px !important; 
    min-width: 160px !important;
    max-width: 160px !important;
    padding: 2px 5px !important;
    border: 1px solid #ccc !important;
    border-radius: 4px !important;
    height: 28px !important;      
    font-size: 14px !important;
    margin: 0 !important;
    display: inline-block !important;
    flex: none !important;
    background-color: white; /* Garante fundo branco */
}

/* GRUPO 3: Botões (Empurrados para a direita) */
.painel-controle-aulas .grupo-botoes {
    display: flex !important;
    gap: 5px !important;
    flex-shrink: 0 !important;
    margin-left: auto !important; 
    width: auto !important;
}

/* Botões Mini */
.painel-controle-aulas .btn-mini {
    padding: 0 10px !important;
    height: 28px !important;      
    line-height: 26px !important; 
    background: #007bff !important;
    color: white !important;
    border: none !important;
    border-radius: 4px !important;
    cursor: pointer !important;
    font-size: 13px !important;
    white-space: nowrap !important;
    width: auto !important;
    min-width: 0 !important;
    margin: 0 !important;
    display: inline-block !important;
}
.painel-controle-aulas .btn-mini.outline {
    background: transparent !important;
    border: 1px solid #999 !important;
    color: #555 !important;
    line-height: 26px !important; 
}
.painel-controle-aulas .btn-mini:hover { opacity: 0.9; }


/* --- TÍTULO DA QUADRA (MODO COMPUTADOR / NORMAL) --- */
#tituloAulaQuadra {
    /* Centraliza totalmente (Vertical e Horizontal) */
    display: flex;
    align-items: center;     
    justify-content: center; 

    /* Altura definida para criar o espaço onde ele vai centralizar */
    height: 15px;            
    width: 100%;

    /* Estilo do Texto */
    font-weight: bold;
    font-size: 18px;
    color: #333;

    /* Sem margens extras, a altura (height) cuida do espaço */
    margin: 0; 
    padding: 0;
}

/* Ajuste Celular */
/* ============================================================ */
/* === AJUSTES EXCLUSIVOS PARA CELULAR (Max-Width 600px) === */
/* ============================================================ */
@media (max-width: 600px) {

    /* --- CORREÇÃO DO TÍTULO NO CELULAR (MODO NORMAL) --- */
    #tituloAulaQuadra {
        /* Aumentamos a altura (no PC é 15px, aqui colocamos 40px para caber o texto) */
        height: 20px !important;       
        
        /* Adicionamos margem para dar o "espaço em branco" que você quer */
        margin-top: 5px !important;   
        margin-bottom: 5px !important; 
        
        /* Garante que o texto fique bem no meio dessa altura de 40px */
        display: flex !important;
        align-items: center !important;
        justify-content: center !important;
        
        /* Garante tamanho da fonte */
        font-size: 18px !important;
    } 

    /* 0. Reduz o espaço entre os botões de quadra e o painel cinza */
    .quadras-tabs-container {
        margin-bottom: -10px !important; /* Era 15px, reduzimos para 5px */
    }
    
    /* 1. Botões de Quadra: Texto quebrado para caber */
    .quadra-tab { 
        padding: 8px 2px; 
        font-size: 13px; 
        height: auto;
    }
    .quadra-tab .desktop-text { display: none; }
    .quadra-tab .mobile-text { display: block; line-height: 1.2; }

    /* 2. PAINEL DE CONTROLE (Layout 2 Linhas) */
    .painel-controle-aulas .linha-unica-flex {
        flex-wrap: wrap !important; /* Permite quebrar para a linha 2 */
        gap: 5px !important; 
        align-items: center !important;
        justify-content: space-between !important; /* Separa Checkbox (esq) e Professor (dir) */
    }

    /* ITEM 1: Checkbox "Ativar Aulas" (Fica na esquerda da linha 1) */
    .painel-controle-aulas .label-ativar {
        flex: 0 0 auto !important; /* Ocupa só o espaço do texto */
        margin: 0 !important;
    }
    /* Ajuste leve de fonte para garantir que caiba */
    .painel-controle-aulas .label-ativar span {
        font-size: 14px !important;
    }

    /* ITEM 2: Grupo Professor (Fica na direita da linha 1) */
    .painel-controle-aulas .grupo-professor-compacto {
        flex: 1 !important; /* Ocupa o resto da linha */
        justify-content: flex-end !important; /* Empurra o input para a DIREITA */
        gap: 5px !important;
        width: auto !important;
    }
    
    /* Label "Professor:" */
    .painel-controle-aulas .grupo-professor-compacto label {
        font-size: 14px !important;
    }

    /* Input do Professor (Pequeno para caber na linha) */
    /* Input e Select do Professor (Pequeno para caber na linha) */
    .painel-controle-aulas .grupo-professor-compacto input,
    .painel-controle-aulas .grupo-professor-compacto select {  /* ADICIONADO O SELECT AQUI */
        width: 120px !important;    /* Reduzi levemente para garantir que caiba em telas pequenas */
        min-width: 0 !important;
        flex: 0 0 120px !important; /* Trava o tamanho para não estourar a linha */
        height: 30px !important;    /* Altura para alinhar com o checkbox */
        font-size: 13px !important;
        padding: 0 2px !important; 
    }

    /* ITEM 3: Botões (Vão para a linha 2, alinhados à direita) */
    .painel-controle-aulas .grupo-botoes {
        flex: 0 0 100% !important; /* Força ocupar uma nova linha inteira (100% largura) */
        justify-content: flex-end !important; /* Alinha os botões à DIREITA */
        margin: 5px 0 0 0 !important; /* Um pouco de espaço acima */
        width: 100% !important;
    }

    /* 3. Tabela: Rolagem Horizontal */
    .tabela-horarios-scroll {
        overflow-x: auto !important; 
        width: 100% !important;
        display: block !important;
        -webkit-overflow-scrolling: touch; 
    }
    /* 1. Destrave a Tabela (Essencial para as células encolherem) */
    .tabela-aulas {
        min-width: 100% !important; /* Libera para ficar menor que 600px */
        width: 100% !important;     /* Tenta ocupar a tela */
		margin-top: 0px !important;
    }

    /* Ajuste Agressivo de Altura */
    .tabela-aulas td, 
    .tabela-aulas th {
        height: 33px !important;       /* Força a altura exata que você quer */
		padding: 0px !important;       /* Remove qualquer gordura interna */
        line-height: 1.0 !important;   /* Cola o texto no teto/chão se precisar */
        vertical-align: middle !important; /* Centraliza o texto verticalmente */
        
        /* Garante que nada estique a célula */
        box-sizing: border-box !important;
    }

    /* Ajuste específico para as COLUNAS LATERAIS (Horários) */
    /* Adicionei th:first-child e th:last-child para funcionar com table-layout: fixed */
    .tabela-aulas th:first-child, 
    .tabela-aulas td:first-child,
    .tabela-aulas th:last-child, 
    .tabela-aulas td:last-child {
        width: 85px !important;      /* Largura que você quer */
        min-width:85px !important;  /* Garante que não encolha */
        max-width: 85px !important;  /* Trava para não passar disso */
        
        font-size: 13px !important;  
        white-space: nowrap !important;
    }
	/* 4. Ajuste dos DIAS (Seg a Dom) - O "Miolo" da tabela */
    .tabela-aulas th:not(:first-child):not(:last-child),
    .tabela-aulas td:not(:first-child):not(:last-child) {
        width: 60px !important;      /* AJUSTE AQUI A LARGURA DOS DIAS */
        min-width: 60px !important;  /* Mantenha igual ao width */
        max-width:60px !important;  /* Trava para ficar uniforme */
    }
	
}
/* === FIM DE AJUSTES EXCLUSIVOS PARA CELULAR (Max-Width 600px) === */

/* 3. Tabela Visual */
.tabela-aulas {
    width: 100%;
    border-collapse: collapse; 
    margin-top: 10px;
    background-color: white;
}

.tabela-aulas th, 
.tabela-aulas td {
    border: 1px solid #ddd; 
    padding: 8px 4px;       
    text-align: center;
    vertical-align: middle;
    font-size: 14px;        
}

.tabela-aulas th {
    background-color: #f2f2f2;
    font-weight: bold;
    color: #333;
}

.tabela-aulas td:first-child,
.tabela-aulas td:last-child { 
    font-weight: normal;
    background-color: white;
    width: 110px; 
    white-space: nowrap;
    border-left: 1px solid #ddd;
    border-right: 1px solid #ddd;
}

.aula-cell-livre {
    background-color: #fff;
    cursor: pointer;
}
.aula-cell-livre:hover {
    background-color: #f9f9f9;
}

.aula-cell-marcada { 
    background-color: lightcoral !important; 
    color: black; 
    font-weight: normal;
    cursor: pointer;
}

.aula-cell-bloqueada {
    background-color: #f2f2f2 !important; 
    cursor: not-allowed !important;
    pointer-events: none;
}
/* --- FIM DE ESTILOS DO MODAL DE AULAS --- */


/* --- MODO TELA CHEIA (Maximizar) --- */
.modal-content.maximizado {
    width: 100vw !important;       /* Largura total da viewport */
    height: 100vh !important;      /* Altura total da viewport */
    max-width: none !important;    /* Remove limites */
    max-height: none !important;
    top: 0 !important;
    left: 0 !important;
    margin: 0 !important;
    border-radius: 0 !important;
    padding: 10px !important;
    
    /* Transforma em Flexbox vertical para a tabela crescer */
    display: flex !important;
    flex-direction: column !important;
}

/* Oculta o que não é necessário */
.modal-content.maximizado .cabecalho-modal-aulas, /* Vamos adicionar essa classe no H2 */
.modal-content.maximizado .painel-controle-aulas,
.modal-content.maximizado .modal-buttons {
    display: none !important;
}

/* Faz a tabela ocupar todo o espaço restante */
.modal-content.maximizado .tabela-horarios-scroll {
    flex: 1 !important;            /* Cresce para preencher o vazio */
    height: auto !important;       /* Reseta altura fixa se houver */
    overflow-y: auto !important;   /* Garante rolagem se precisar */
}

/* --- CLASSE PARA BLOQUEAR SELEÇÃO VISUAL --- */
.sem-selecao {
    -webkit-user-select: none; /* Safari */
    -moz-user-select: none;    /* Firefox */
    -ms-user-select: none;     /* IE10+/Edge */
    user-select: none;         /* Padrão */
}

/* ---  FIM DE MODO TELA CHEIA (Maximizar) --- */



/* ================================================================= */
/* ===  AJUSTE FINAL: TELA CHEIA MOBILE (Vertical) - DEFINITIVO  === */
/* ================================================================= */

@media (max-width: 600px) {

    /* 1. CONTAINER GERAL (Sem cores, fundo branco) */
    .modal-content.maximizado {
        width: 100vw !important;
        height: 100vh !important;
        max-width: none !important;
        max-height: none !important;
        top: 0 !important; left: 0 !important;
        margin: 0 !important; padding: 5px !important;
        border-radius: 0 !important;
        display: flex !important;
        flex-direction: column !important;
        background-color: white !important;
        z-index: 9999 !important;
        overflow: hidden !important; /* Evita rolagens duplas */
    }

    /* 2. ESCONDER O DESNECESSÁRIO */
    .modal-content.maximizado .cabecalho-modal-aulas, 
    .modal-content.maximizado .painel-controle-aulas,
    .modal-content.maximizado .modal-buttons {
        display: none !important;
    }

    /* 3. BOTÕES SUPERIORES (A Caixa Vermelha) - VERSÃO FORÇA BRUTA */
    .modal-content.maximizado .quadras-tabs-container {
        /* Trava o comportamento Flex */
        flex: 0 0 auto !important; 
        
        /* O SEGREDO: Força uma altura máxima física */
        max-height: 40px !important;    /* Ajuste aqui se cortar os botões */
        height: 55px !important;        /* Força a altura exata */
        overflow: hidden !important;    /* Corta qualquer sobra invisível */
        
        /* Posicionamento */
        margin-top: 35px !important;
        margin-bottom: 0px !important;  
        padding: 0 !important;
        
        border: none !important;
        width: 100% !important;
        display: flex !important;       
        align-items: flex-end !important; /* Alinha os botões na parte de baixo da caixa */
    }

    /* ADICIONAL DE SEGURANÇA: Garante que os botões dentro não tenham margem */
    .modal-content.maximizado .quadra-tab {
        margin-bottom: 0 !important;
        height: 100% !important;        /* Ocupa a altura da caixa pai */
        display: flex;
        align-items: center;
        justify-content: center;
    }

    /* 4. TÍTULO "QUADRA X" (O Ponto de Equilíbrio: 28px) */
    .modal-content.maximizado #tituloAulaQuadra {
        display: flex !important;
        align-items: center !important;     /* Centro Vertical Perfeito */
        justify-content: center !important; /* Centro Horizontal Perfeito */
        
        width: 100% !important;
        
        /* 28px: O tamanho ideal (nem 20px esmagado, nem 35px gordo) */
        height: 28px !important;            
        min-height: 28px !important;
        
        margin: 0 !important;               /* Zero margem externa */
        padding: 0 !important;
        
        font-size: 16px !important;
        font-weight: bold !important;
        color: #333 !important;
        background: transparent !important;
        flex-shrink: 0 !important;
    }

    /* 5. TABELA DE HORÁRIOS */
    .modal-content.maximizado .tabela-horarios-scroll {
        margin-top: 0 !important;       /* Cola no título */
        padding-top: 0 !important;
        border-top: 1px solid #eee !important;
        flex: 1 !important;             /* Ocupa o resto da tela */
        height: auto !important;
        overflow-y: auto !important;
    }
    
    .modal-content.maximizado .tabela-aulas {
        margin-top: 0 !important;
    }
}
/* ================================================================= */



/* --- ESTILOS DO MODO FOCO (TELA CHEIA - HORÁRIOS ESPECIAIS) --- */

/* 1. Transforma o Modal em Tela Cheia e usa Flexbox */
#modalHorarioEspecial.modo-foco .modal-content {
    width: 100vw !important;
    height: 100vh !important;
    max-width: none !important;
    max-height: none !important;
    
    top: 0 !important;
    left: 0 !important;
    margin: 0 !important;
    
    border-radius: 0 !important;
    padding: 15px 25px !important;
    box-sizing: border-box !important;
    
    /* Organiza o conteúdo verticalmente */
    display: flex !important;
    flex-direction: column !important;
}

/* 2. Esconde o painel superior (Nome, Datas, Regra Mestra) */
#modalHorarioEspecial.modo-foco #areaSuperiorEspecial {
    display: none !important;
}

/* 3. Faz a lista de dias esticar para ocupar todo o espaço */
#modalHorarioEspecial.modo-foco .lista-dias-scroll {
    flex-grow: 1 !important;        /* Ocupa todo o espaço vazio */
    max-height: none !important;    /* Remove a trava de 400px */
    height: auto !important;        /* Altura automática */
    overflow-y: auto !important;    /* Barra de rolagem aparece aqui */
    margin-bottom: 15px !important; /* Separa dos botões do rodapé */
}

/* 4. Fixa os botões no rodapé sem serem esmagados */
#modalHorarioEspecial.modo-foco .modal-buttons {
    margin-top: 0 !important;
    flex-shrink: 0 !important;
}
/* --- FIM DE ESTILOS DO MODO FOCO (TELA CHEIA - HORÁRIOS ESPECIAIS) --- *


/* --- CORREÇÃO MOBILE: JANELA HORÁRIOS ESPECIAIS (VERTICAL) --- */
@media (max-width: 600px) {
    
    /* 1. Solta a janela do centro e cola no topo */
    #modalHorarioEspecial.modal-overlay {
        align-items: flex-start !important; 
        padding-top: 10px !important;       
        overflow: hidden !important;       
    }

    /* 2. Ajusta o tamanho da caixa branca */
    #modalHorarioEspecial .modal-content {
        width: 96% !important;        
        height: 88vh !important;      
        max-height: 88vh !important;  
        padding: 8px 5px 5px 5px !important; 
        border-radius: 8px !important;
        margin: 0 auto !important;    
    }

    /* 3. Título Principal */
    #modalHorarioEspecial .modal-content > div:first-child {
        min-height: 24px !important;
        margin-bottom: 2px !important;
        margin-top: 0 !important;
    }
    #modalHorarioEspecial h2 {
        font-size: 1.3rem !important; 
        margin: 0 !important;
        line-height: 1 !important;
    }

    /* 4. REMOVE ESPAÇOS DO PAINEL SUPERIOR */
    #areaSuperiorEspecial {
        margin-bottom: 0 !important;
    }
    #areaSuperiorEspecial .painel-regra-mestra {
        margin-bottom: 2px !important;
    }

    /* 5. Container "Ajuste Fino" */
    #areaSuperiorEspecial + div {
        height: 40px !important;      
        margin: 0 !important;         
        padding-bottom: 0 !important;
        min-height: 0 !important;
        display: flex !important;     
        align-items: center !important; 
    }
    
    /* 6. Texto "Ajuste Fino" */
    #areaSuperiorEspecial + div h3 {
        font-size: 1.0rem !important;
        line-height: 1 !important;
    }

    

    /* 8. Botões do rodapé */
    #modalHorarioEspecial .modal-buttons {
        padding-bottom: 0 !important;
        margin-bottom: 0 !important;
    }

    /* --- AJUSTE DO PAINEL AMARELO (Botão Centralizado) --- */
    .painel-regra-mestra .container {
        gap: 2px !important;
        justify-content: center !important; 
    }
    
    #btnGerarDias {
        width: auto !important;         
        min-width: 200px !important;    
        height: 30px !important;        
        margin-top: 4px !important;
        margin-left: auto !important;
        margin-right: auto !important;
        padding: 0 15px !important;
        font-size: 0.9rem !important; 
    }

    /* --- CORREÇÃO FINAL DAS LINHAS --- */
    #containerListaDiasEspeciais {
        gap: 0 !important; 
        background-color: #fff !important;
    }

    .linha-dia-especial {
        display: flex !important;
        flex-wrap: nowrap !important;
        align-items: center !important;
        justify-content: space-between !important; 
        gap: 2px !important;
        padding: 8px 2px !important;
        border-bottom: 1px solid #eee !important; 
        background-color: #fff !important; /* Fundo branco padrão */
    }

    /* CORREÇÃO DA COR (FECHADO): Sobrepõe o branco quando necessário */
    .linha-dia-especial.fechado {
        background-color: #ffebee !important; /* Rosa claro forte */
    }

    /* A. DATA */
    .linha-dia-especial .dia-label {
        width: 95px !important;       
        min-width: 95px !important;
        font-size: 0.80rem !important; 
        white-space: nowrap !important;
        overflow: hidden !important;
    }

    /* B. SELECT (Aberto/Fechado) */
    .linha-dia-especial select {
        width: 90px !important;       
        min-width: 90px !important;
        padding: 0 !important;
        text-align: center !important;
        text-align-last: center !important;
        font-size: 0.85rem !important;
        height: 30px !important;
    }

    /* C. INPUTS (Hora) */
    .linha-dia-especial input[type="time"] {
        width: 68px !important;       
        min-width: 68px !important;
        padding: 0 !important;
        text-align: center !important;
        font-size: 0.85rem !important;
        height: 30px !important;
    }
}
/* --- FIM DE CORREÇÃO MOBILE: JANELA HORÁRIOS ESPECIAIS --- */


/* --- CORREÇÃO EXTRA: CELULAR NA HORIZONTAL (PAISAGEM) --- */
@media (max-height: 500px) {
    
    /* 1. Fundo ocupa tudo */
    #modalHorarioEspecial.modal-overlay {
        padding: 0 !important;
        align-items: flex-start !important;
        height: 100% !important;
    }

    /* 2. Janela Principal */
    #modalHorarioEspecial .modal-content {
        width: 100vw !important;
        height: 100dvh !important;
        max-height: none !important;
        border-radius: 0 !important;
        margin: 0 !important;
        
        /* AJUSTE: Aumentei o topo para 8px (estava 2px) para dar respiro */
        padding: 8px 5px 5px 5px !important;
        
        display: flex !important;
        flex-direction: column !important;
        overflow: hidden !important;
    }

    /* 3. Container do Título */
    #modalHorarioEspecial .modal-content > div:first-child {
        min-height: 24px !important;   /* Um pouco maior */
        margin-bottom: 5px !important; /* Aumentei para 5px (estava 2px) */
        margin-top: 0 !important;
    }

    /* 4. O Título em si */
    #modalHorarioEspecial h2 {
        font-size: 1.2rem !important; /* Fonte legível */
        margin: 0 !important;
        line-height: 1 !important;
    }
    
    /* 5. Scroll Interno */
    #corpoModalScroll {
        flex: 1 1 auto !important;
        overflow-y: auto !important;
        min-height: 0 !important;
        display: block !important;
    }

    /* 6. Rodapé */
    #modalHorarioEspecial .modal-buttons {
        flex-shrink: 0 !important;
        padding-top: 5px !important;
        padding-bottom: 2px !important;
    }
}
/* --- FIM DE CORREÇÃO EXTRA: CELULAR NA HORIZONTAL (PAISAGEM) --- */


/* --- AJUSTE FINO: MODO FOCO NO CELULAR (VERTICAL) --- */
@media (max-width: 600px) {
    
    /* 1. Remove gorduras laterais da janela maximizada */
    #modalHorarioEspecial.modo-foco .modal-content {
        padding-left: 5px !important;
        padding-right: 5px !important;
        width: 100% !important; /* Garante uso total */
    }

    /* 2. Ajusta o container da lista para colar nas bordas */
    #modalHorarioEspecial.modo-foco .lista-dias-scroll {
        border: none !important; /* Remove borda cinza se houver */
        padding: 0 !important;
    }

    /* 3. Otimiza a linha do dia (Data + Inputs) para ocupar tudo */
    #modalHorarioEspecial.modo-foco .linha-dia-especial {
        justify-content: space-between !important; /* Espalha os itens */
        padding-left: 2px !important;
        padding-right: 2px !important;
        gap: 2px !important; /* Reduz espaço entre elementos */
    }

    /* 4. Garante que o Select (Aberto/Fechado) tenha prioridade de espaço */
    #modalHorarioEspecial.modo-foco .linha-dia-especial select.status-dia {
        min-width: 80px !important; /* Força largura para caber "Fechado" */
        flex-shrink: 0 !important;  /* Impede que ele seja esmagado */
    }

    /* 5. Ajusta a Data para não roubar espaço demais */
    #modalHorarioEspecial.modo-foco .linha-dia-especial .dia-label {
        font-size: 14px !important; /* Leve redução se necessário */
        margin-right: 2px !important;
    }
}
/* --- FIM DE AJUSTE FINO: MODO FOCO NO CELULAR (VERTICAL) --- */


/* --- BOTÃO EXPANDIR (SVG) --- */
.btn-expandir {
    background: none;
    border: none;
    cursor: pointer;
    padding: 0 5px; /* Reduzi um pouco a lateral */
    margin-left: auto; 
    display: none; 
    align-items: center;
    justify-content: center;
    
    /* Aumentei a área de clique para ficar confortável com o ícone maior */
    height: 34px; 
    width: 44px; 
    
    color: #555; 
    transition: transform 0.2s;
}

.btn-expandir:active {
    transform: scale(0.9);
}

.btn-expandir svg {
    width: 28px;  /* Aumentado de 24px para 28px */
    height: 28px; /* Aumentado de 24px para 28px */
    fill: currentColor;
    vertical-align: middle;
}
/* Remove o fundo verde ao passar o mouse ou clicar no celular */
.btn-expandir:hover, 
.btn-expandir:focus, 
.btn-expandir:active {
    background: transparent !important;      /* Força fundo transparente */
    background-color: transparent !important; 
    color: #555 !important;                  /* Mantém a cor cinza do ícone */
    box-shadow: none !important;             /* Remove sombras se houver */
    outline: none !important;                /* Remove borda de seleção */
    -webkit-tap-highlight-color: transparent; /* Remove o flash cinza do toque no Android/iOS */
}
/* --- FIM DE  BOTÃO EXPANDIR (SVG) --- */



/* --- AJUSTE FINO DO BOTÃO NO CELULAR (VERTICAL) --- */
@media (max-width: 600px) {

    /* 1. Garante que o ícone fique grande e visível */
    .btn-expandir svg {
        width: 28px !important;
        height: 28px !important;
    }

    /* 2. Área de toque maior e alinhamento rígido */
    .btn-expandir {
        width: 44px !important;       /* Largura fixa para não empurrar o texto */
        height: 40px !important;      /* Altura igual à da linha do título */
        padding: 0 !important;        /* Remove bordas internas */
        margin-left: auto !important; /* Joga para a direita */
        display: flex !important;     /* Centraliza o SVG dentro do botão */
        align-items: center !important;
        justify-content: center !important;
    }

    /* 3. Ajuste do texto "Ajuste Fino" para não brigar por espaço */
    #areaSuperiorEspecial + div h3 {
        font-size: 16px !important;   /* Tamanho legível */
        line-height: 40px !important; /* Centraliza verticalmente com o botão */
        margin: 0 !important;
        white-space: nowrap;          /* Impede que o texto quebre linha */
    }
    
    /* 4. Trava a altura da linha inteira */
    #areaSuperiorEspecial + div {
        height: 40px !important;
        min-height: 40px !important;
        padding-right: 0 !important;  /* Aproveita até o último pixel da direita */
    }
}
/* --- FIM DE AJUSTE FINO DO BOTÃO NO CELULAR (VERTICAL) --- */ 



/* Adicione isso junto com os outros botões no CSS */ 
.btn-lapis {
    background: none !important; /* Garante fundo transparente */
    border: none !important;
    padding: 0 !important;
    margin-left: 8px !important; /* Mesmo espaçamento do botão anterior */
    cursor: pointer;
    font-size: 17px; /* Tamanho compatível com o layout */
    line-height: 1;
    width: auto !important; /* Não deixa esticar */
    color: #FFA500; /* Cor laranja (opcional) ou remova para cor padrão */
}
.btn-lapis:hover {
    transform: scale(1.1); /* Efeito suave ao passar o mouse */
}
/* Estilo específico para o Lápis Desabilitado (Admin) */
/* Estilo para deixar o Lápis Cinza/Apagado quando bloqueado */
.btn-lapis:disabled {
    background: transparent !important;     /* Sem fundo cinza */
    border: none !important;                /* Sem borda */
    cursor: not-allowed !important;         /* Mouse de bloqueado */
    
    /* O SEGREDO DO CINZA PARA EMOJIS: */
    filter: grayscale(100%) !important;     /* Remove o laranja do emoji */
    opacity: 0.3 !important;                /* Deixa ele bem clarinho (parecendo cinza) */
    
    transform: none !important;             /* Remove efeito de zoom */
}

/* fim de Adicione isso junto com os outros botões no CSS */



/* Classes para Perfil e Permissões que faltavam */
.select-padrao {
    flex: 1;
    height: 30px !important;
    padding: 0 5px;
    box-sizing: border-box;
}

.btn-extra {
    background: none !important;
    border: none !important;
    cursor: pointer;
    padding: 0 !important;
    margin: 0 0 0 5px !important; /* Pequena margem a esquerda */
    display: flex;
    align-items: center;
    justify-content: center;
    width: 30px !important; 
    height: 30px !important;
    font-size: 17px !important;
    line-height: 1 !important;
}

.container-fixo {
    margin-top: 0 !important;
}
/* --- ESTILO PARA O CAMPO DE PERMISSÕES DO ADMIN (SEM SETA) --- */
#permissoesSelect:disabled {
    appearance: none;           /* Padrão moderno: remove a seta */
    -webkit-appearance: none;   /* Chrome/Safari: remove a seta */
    -moz-appearance: none;      /* Firefox: remove a seta */
    
    background-image: none !important; /* Garante que nenhuma imagem de seta sobre */
    background-color: transparent !important; /* Fundo transparente para parecer texto puro */
    border: none !important;    /* Opcional: remove a borda se quiser parecer texto solto */
    
    color: #333 !important;     /* Mantém o texto preto forte (não deixa cinza) */
    opacity: 1 !important;      /* Garante visibilidade total */
    cursor: default;            /* Mouse padrão (seta) em vez de mãozinha */
    
    text-align: left;           /* Ou center, como preferir */
    padding-left: 0;            /* Remove recuo se tirar a borda */
    font-weight: bold;
}
/* fim de Classes para Perfil e Permissões que faltavam */


/* 1. Botão ADICIONAR (+): Forçamos ele a ficar maior */
button.add-button {
    font-size: 30px !important;   /* Tamanho do ícone + */
    width: 32px !important;       /* Largura da área de clique */
    height: 32px !important;      /* Altura da área de clique */
    
    /* Centralização garantida */
    display: inline-flex !important;
    align-items: center !important;
    justify-content: center !important;
    
    /* Opcional: Um ajuste fino se o + parecer "alto" demais */
    padding-bottom: 3px !important; 
}
/* fim de 1. Botão ADICIONAR (+): Forçamos ele a ficar maior */



/* --- LAYOUT INTELIGENTE (VERSÃO "AUTO") --- */

/* 1. TÍTULO "PERMISSÕES:" */
.titulo-smart {
    font-size: 1.5rem;
    font-weight: bold;
    color: #333;
    white-space: nowrap;
    flex: 0 0 auto;
}

/* 2. GRUPO [NOME + LIXEIRA] */
.grupo-nome-lixo-smart {
    display: flex;
    align-items: center;
    justify-content: space-between;
    
    /* AQUI ESTÁ A CORREÇÃO DEFINITIVA: */
    /* 'auto': O navegador calcula o tamanho real do texto. */
    /* Se (Título + Texto) > Largura da Tela --> ELE QUEBRA LINHA */
    /* Se (Título + Texto) < Largura da Tela --> ELE MANTÉM NA LINHA */
    flex: 1 1 auto;     
    
    /* Tamanho mínimo de segurança para não esmagar a lixeira e o "Operador" */
    min-width: 120px;   
}

/* O resto continua igual... */
.header-flex-smart {
    display: flex;
    flex-wrap: wrap;       
    align-items: center;    
    justify-content: center; /* Centraliza se cair pra linha de baixo */
    width: 100%;
    border-bottom: 1px solid #eee;
    padding-bottom: 10px;
    margin-bottom: 15px;
    box-sizing: border-box;
    gap: 5px;
}

/* NOME DO PERFIL */
#textoNomePerfil {
    font-size: 1.5rem;
    font-weight: bold;
    color: #333;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis; 
    margin-right: 10px;
    text-align: left;
    flex: 1;                 
}

/* LIXEIRA */
.btn-lixo-smart {
    background: none;
    border: none;
    cursor: pointer;
    font-size: 22px; 
    line-height: 1;
    padding: 0;
    margin: 0;
    width: 30px; 
    height: 30px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: #dc3545; 
    flex-shrink: 0;
}
/* --- fim de LAYOUT INTELIGENTE (VERSÃO "AUTO") --- */


/* --- AJUSTE HÍBRIDO PERMISSÕES V3 (ALINHAMENTO CORRIGIDO) --- */
@media (max-width: 600px) {
    
    /* 1. O Container: Garante base sólida */
    label[for="permissoesSelect"] + .input-group {
        position: relative !important;
        display: flex !important;       
        align-items: center !important;
        width: 100% !important;
        box-sizing: border-box !important;
    }

    /* === CENÁRIO 1: NORMAL (DROPDOWN ATIVO) === */
    /* Deve ficar IDÊNTICO ao campo de Perfil */
    
    #permissoesSelect:not(:disabled) {
        flex: 1 !important;             /* Cresce para ocupar espaço */
        width: 100% !important;         /* Garante largura total disponível */
        height: 30px !important;
        
        /* CORREÇÃO DO ALINHAMENTO ESQUERDA: */
        margin: 0 !important;           
        padding: 5px !important;        /* Padding padrão dos outros inputs */
        box-sizing: border-box !important;
    }

    /* Botão Lápis no fluxo normal (ao lado) */
    #permissoesSelect:not(:disabled) + #btnEditarPermissoes {
        position: static !important;    
        margin-left: 5px !important;    
        background: none !important;
        width: 30px !important;         /* Tamanho fixo para não dançar */
        height: 30px !important;
        display: flex !important;
        align-items: center !important;
        justify-content: center !important;
    }


    /* === CENÁRIO 2: ADMIN (TEXTO LONGO "⚡ACESSO TOTAL") === */
    /* Modo invasão: Texto estica, lápis flutua */
    
    #permissoesSelect:disabled {
        width: 100% !important;         
        flex: none !important;          
        height: 30px !important;
        
        /* Espaço na direita para o lápis flutuante */
        padding: 5px 30px 5px 5px !important; 
        
        /* CORREÇÃO DO ALINHAMENTO ESQUERDA: */
        margin: 0 !important;
        box-sizing: border-box !important;
        
        /* Visual do texto travado */
        opacity: 1 !important;
        color: #333 !important;
        -webkit-text-fill-color: #333 !important;
        font-weight: bold !important;
    }

    /* Botão Lápis Fantasma (Flutuante) */
    #permissoesSelect:disabled + #btnEditarPermissoes {
        position: absolute !important;  
        right: 0 !important;            
        top: 0 !important;
        width: 30px !important;
        height: 30px !important;
        display: flex !important;
        align-items: center !important;
        justify-content: center !important;
        background: transparent !important;
        z-index: 10 !important;
        margin: 0 !important;
    }
}
/* --- fim de AJUSTE HÍBRIDO PERMISSÕES V3 (ALINHAMENTO CORRIGIDO) --- */



/* --- AUMENTAR APENAS PERFIL E PERMISSÕES NA DIREITA (MOBILE) --- */
@media (max-width: 600px) {
    
    /* Selecionamos especificamente os grupos ao lado dos rótulos "Perfil" e "Permissões" */
    
    label[for="perfilSelect"] + .input-group,
    label[for="permissoesSelect"] + .input-group {
        
        /* O TRUQUE: Margem negativa na direita */
        /* Isso faz o campo "avançar" sobre o espaço vazio da borda */
        margin-right: -12px !important; 
        
        /* Força o recálculo da largura para aproveitar esse espaço extra */
        width: auto !important;
        flex: 1 !important;
    }
}
/* --- fim de AUMENTAR APENAS PERFIL E PERMISSÕES NA DIREITA (MOBILE) --- */


/* --- LAYOUT ULTRA-COMPACTO FINAL (FONTE AJUSTADA) --- */
@media (max-height: 500px) {

    /* 1. Ocultar instrução e linha divisória */
    .texto-instrucao, 
    .lista-permissoes hr {
        display: none !important;
    }

    /* 2. Cabeçalho: Zero espaço embaixo */
    .header-flex-smart {
        border-bottom: none !important;
        margin-bottom: 0 !important;
        padding-bottom: 0 !important;
        min-height: auto !important;
    }

    /* 3. Lista: Zero espaço em cima */
    .lista-permissoes {
        gap: 0 !important;
        margin-top: 0 !important;
    }

    /* 4. O PAINEL AZUL (Acesso Total): Fonte menor e colado no topo */
    .lista-permissoes > label:first-child {
        margin-top: -2px !important;
        margin-bottom: 3px !important;
        padding: 2px 5px !important;    /* Padding reduzido */
        min-height: 26px !important;    /* Altura reduzida */
        
        /* AQUI ESTÁ O AJUSTE DA FONTE: */
        font-size: 13px !important; 
    }

    /* 5. Os Outros Itens (Filhos) */
    .lista-permissoes label:not(:first-child) {
        padding: 0 !important;
        margin: 0 !important;
        min-height: 22px !important;
        font-size: 13px !important;
        display: flex !important;
        align-items: center !important;
    }
    
    .lista-permissoes input[type="checkbox"] {
        margin: 0 5px 0 0 !important;
        transform: scale(0.9);
    }

    /* 6. A Caixa do Modal */
    #modalPermissoes .modal-content {
        padding: 2px 5px !important;
        top: 0 !important;
        width: 98% !important;
        max-height: 100vh !important;
        border-radius: 4px !important;  
    }

    /* 7. Botões */
    #modalPermissoes .modal-buttons {
        margin-top: 2px !important;
        padding-top: 2px !important;
    }
    #modalPermissoes .modal-buttons button {
        height: 28px !important;
        line-height: 1 !important;
        font-size: 14px !important;
        padding: 0 10px !important;
    }
}
/* --- FIM DE LAYOUT ULTRA-COMPACTO FINAL (FONTE AJUSTADA) --- */



/* --- ESTILO RETRÔ: BORDA PRETA E FUNDO BRANCO (SEM CINZA/LARANJA) --- */
select:focus,
input:focus,
button:focus,
textarea:focus {
    /* 1. Remove o brilho laranja/azul do navegador */
    outline: none !important;
    box-shadow: none !important;
    
    /* 2. Força a borda a ficar PRETA (igual à versão antiga) */
    border-color: #000000 !important;
    
    /* 3. O PULO DO GATO: Força o fundo a ficar BRANCO ABSOLUTO */
    /* Isso impede que o campo fique cinza ao clicar */
    background-color: #ffffff !important;
    color: #000000 !important;
}

/* 4. Remove a "sombra de toque" (aquele flash cinza rápido do Android) */
* {
    -webkit-tap-highlight-color: transparent !important;
}
/* --- FIM DE ESTILO RETRÔ: BORDA PRETA E FUNDO BRANCO (SEM CINZA/LARANJA) --- --- */


/* --- CORREÇÃO DA LIXEIRA (REMOVER FUNDO VERDE) --- */
.btn-lixo-smart:hover {
    background-color: transparent !important; /* Força transparência */
    background: none !important;              /* Garante que não tenha imagem de fundo */
    transform: scale(1.1);                    /* Opcional: Um leve zoom para dar feedback */
}
/* --- fim de CORREÇÃO DA LIXEIRA (REMOVER FUNDO VERDE) --- */


/* --- NOTIFICAÇÕES (TOASTS) --- */
.toast-container {
    position: fixed;
    top: 20px;
    right: 20px;
    z-index: 99999;
    display: flex;
    flex-direction: column;
    gap: 10px;
    pointer-events: none; /* Deixa clicar através do container vazio */
}

.toast {
    min-width: 280px;
    padding: 15px 20px;
    border-radius: 8px;
    color: white;
    font-weight: 500;
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    animation: slideInRight 0.3s ease-out forwards;
    pointer-events: auto; /* Reativa cliques no toast */
    display: flex;
    align-items: center;
    font-size: 15px;
    line-height: 1.4;
}

.toast.success { background-color: #2e7d32; border-left: 5px solid #1b5e20; }
.toast.error { background-color: #d32f2f; border-left: 5px solid #b71c1c; }
.toast.warning { background-color: #ffa000; color: #333; border-left: 5px solid #ff6f00; }

@keyframes slideInRight {
    from { transform: translateX(100%); opacity: 0; }
    to { transform: translateX(0); opacity: 1; }
}
@keyframes fadeOutUp {
    to { opacity: 0; transform: translateY(-20px); }
}

@media (max-width: 600px) {
    .toast-container { right: 10px; left: 10px; top: 10px; }
    .toast { width: 100%; box-sizing: border-box; }
}

/* --- MODAL DE CONFIRMAÇÃO GLOBAL --- */
#modalConfirmacaoGlobal .modal-content {
    text-align: center;
    max-width: 350px;
}
#modalConfirmacaoGlobal h3 {
    margin-top: 0;
    color: #333;
}
#modalConfirmacaoGlobal p {
    font-size: 16px;
    color: #555;
    margin: 20px 0;
}
/* --- fim de NOTIFICAÇÕES (TOASTS) --- */


/* --- CORREÇÃO: BOTÃO "NÃO" VISÍVEL --- */
#btnCancelarConf, 
#btnCancelarInput {
    background-color: #6c757d !important; /* Cinza Escuro Sólido */
    color: white !important;               /* Texto Branco */
    border: none !important;               /* Sem borda */
    box-shadow: 0 2px 5px rgba(0,0,0,0.2) !important; /* Sombra leve para destacar do fundo */
}

/* Efeito ao passar o mouse */
#btnCancelarConf:hover, 
#btnCancelarInput:hover {
    background-color: #5a6268 !important; /* Cinza um pouco mais escuro */
    transform: scale(1.05);               /* Leve zoom */
}
/* --- fim de CORREÇÃO: BOTÃO "NÃO" VISÍVEL --- */


/* ============================================================ */
/* === MODO ESCURO (DARK MODE) E BOTÃO DE TEMA - CORRIGIDO === */
/* ============================================================ */

/* 1. Botão Flutuante (Estado Padrão / Modo Claro) */
/* Fundo ESCURO para contrastar com a página branca */
#theme-toggle-button {
    position: fixed;
    bottom: 45px;
    right: 5px;
    
    /* --- ALTERE AQUI PARA DIMINUIR --- */
    width: 40px;        /* Era 50px */
    height: 40px;       /* Era 50px (Mantenha igual à largura para ser redondo) */
    font-size: 20px;    /* Era 24px (Diminua o ícone proporcionalmente) */
    /* -------------------------------- */
    
    border-radius: 50%;
    
    /* ... mantenha o restante das cores igual ... */
    background-color: #333 !important; 
    color: white !important;
    border: none;
    cursor: pointer;
    z-index: 10001;
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: 0 2px 10px rgba(0,0,0,0.3);
    transition: transform 0.3s ease, background-color 0.3s;
}
#theme-toggle-button:hover { transform: scale(1.1); }

/* 2. Ajuste do botão quando o MODO ESCURO está ativo */
/* Fundo CLARO para contrastar com a página preta */
body.dark-mode #theme-toggle-button {
    background-color: #f1f1f1 !important;
    color: #333 !important;
    box-shadow: 0 2px 10px rgba(255,255,255,0.2); 
}

/* 3. A REGRA PRINCIPAL: Fundo do Site */
body.dark-mode {
    background-color: #121212 !important; /* Fundo Preto */
    color: #e0e0e0 !important;            /* Texto Claro */
}

/* 4. Correção do Rodapé (Botão Salvar) */
body.dark-mode .botao-salvar {
    background-color: #1e1e1e !important; 
    border-top: 1px solid #444 !important; 
    box-shadow: 0 -2px 10px rgba(0,0,0,0.5) !important; 
}

/* 5. Containers e Cartões */
body.dark-mode .form-container,
body.dark-mode .modal-content,
body.dark-mode .modal-content-reserva,
body.dark-mode .tabela-horarios-scroll, 
body.dark-mode .lista-dias-scroll,
body.dark-mode #containerListaDiasEspeciais {
    background-color: #1e1e1e !important;
    color: #e0e0e0 !important;
    border-color: #444 !important;
    box-shadow: 0 4px 12px rgba(0,0,0,0.5) !important;
}

/* 6. Inputs e Selects */
body.dark-mode input,
body.dark-mode select,
body.dark-mode textarea {
    background-color: #2d2d2d !important;
    color: #fff !important;
    border: 1px solid #555 !important;
}

/* Correção do Foco no Modo Escuro (Substitui o fundo branco forçado) */
body.dark-mode select:focus,
body.dark-mode input:focus,
body.dark-mode textarea:focus {
    background-color: #333 !important; /* Fundo cinza escuro */
    border-color: #fff !important;     /* Borda branca */
    color: #fff !important;
}

/* 7. Tabelas */
body.dark-mode .tabela-config-horarios th {
    background-color: #2c2c2c !important;
    color: #ccc !important;
    border-bottom: 1px solid #444;
}
body.dark-mode .tabela-config-horarios td {
    border-bottom: 1px solid #444;
    color: #ddd;
}

/* 8. Abas (Tabs) */
body.dark-mode .tab {
    color: #aaa;
}
body.dark-mode .tab:hover {
    color: #fff;
}
body.dark-mode .tab.active {
    color: #4dabf7; /* Azul claro */
    border-bottom-color: #4dabf7;
}

/* 9. Textos e Títulos */
body.dark-mode h2, body.dark-mode h3, body.dark-mode label {
    color: #e0e0e0 !important;
}
body.dark-mode .title-container span {
    color: #fff;
}

/* 10. Linhas Especiais e Detalhes */
body.dark-mode .linha-dia-especial {
    background-color: #1e1e1e !important;
    border-bottom: 1px solid #444 !important;
}
body.dark-mode .linha-dia-especial:hover {
    background-color: #2a2a2a !important;
}
body.dark-mode .linha-dia-especial .dia-label {
    color: #4dabf7 !important;
}

/* 11. Painéis de Destaque (Amarelo/Azul) */
body.dark-mode .painel-regra-mestra {
    background-color: #332b00 !important; /* Amarelo muito escuro */
    border-color: #665c00 !important;
}
body.dark-mode .painel-destaque {
    background-color: #0d2b42 !important; /* Azul muito escuro */
    border-color: #1a4f75 !important;
}
body.dark-mode .painel-destaque label {
    color: #ccc !important;
}

/* 12. Botões Desabilitados */
body.dark-mode button:disabled {
    background-color: #444 !important;
    color: #888 !important;
}

/* 13. Modal de Permissões */
body.dark-mode .header-flex-smart {
    border-bottom-color: #444;
}
body.dark-mode #textoNomePerfil {
    color: #fff;
}
body.dark-mode .btn-lapis {
    filter: brightness(1.2); /* Deixa o emoji mais brilhante */
}

/* 14. Modal Aulas */
body.dark-mode .quadra-tab {
    background-color: #333;
    border-color: #555;
    color: #ccc;
}
body.dark-mode .quadra-tab.active {
    background-color: #2e7d32; /* Verde escuro */
    color: white;
    border-color: #1b5e20;
}
body.dark-mode .painel-controle-aulas {
    background-color: #252525 !important;
    border-color: #444 !important;
}
body.dark-mode #tituloAulaQuadra {
    color: #fff;
}
body.dark-mode .tabela-aulas th {
    background-color: #2c2c2c;
    color: #ddd;
    border-color: #444;
}
body.dark-mode .tabela-aulas td {
    border-color: #444;
    color: #ddd;
}
body.dark-mode .tabela-aulas td:first-child,
body.dark-mode .tabela-aulas td:last-child {
    background-color: #1e1e1e;
}
body.dark-mode .aula-cell-livre {
    background-color: #1e1e1e;
}
body.dark-mode .aula-cell-livre:hover {
    background-color: #333;
}
body.dark-mode .aula-cell-bloqueada {
    background-color: #333 !important;
}
/* --- CORREÇÃO: "ACESSO TOTAL" VISÍVEL NO MODO ESCURO --- */
body.dark-mode #permissoesSelect:disabled {
    color: #ffffff !important;                   /* Texto Branco */
    -webkit-text-fill-color: #ffffff !important; /* Garante branco no Chrome/Safari mobile */
    opacity: 1 !important;                       /* Remove transparência de desabilitado */
    font-weight: bold !important;
}


/* ============================================================ */
/* === FIM DE MODO ESCURO (DARK MODE) E BOTÃO DE TEMA === */
/* ============================================================ */



/* ============================================================ */
/* === BOTÃO SALVAR (RODAPÉ) - POSIÇÃO FIXA E VISUAL MODERNO === */
/* ============================================================ */

/* 1. O CONTAINER (A faixa branca/preta) */
/* Mantemos a posição fixa no rodapé, sem inventar moda */
.botao-salvar {
    position: fixed !important;
    bottom: 0 !important;
    left: 0 !important;
    width: 100% !important;
    
    display: flex !important;
    justify-content: center !important; /* Centraliza o botão na faixa */
    align-items: center !important;
    
    padding: 10px 0 !important; /* Espaço para o botão respirar */
    background: white;          /* Cor base (o Dark Mode cuida do resto) */
    
    box-shadow: 0 -2px 5px rgba(0, 0, 0, 0.1) !important;
    z-index: 1000 !important;
    
    margin: 0 !important; /* Garante que não suba nem desça */
}

/* 2. O BOTÃO EM SI (Onde acontece a mágica) */
/* Aqui aumentamos a largura e deixamos bonito */
.botao-salvar button {
    /* TAMANHO: Ocupa quase toda a largura (efeito esquerda-direita) */
    width: 96% !important;
    max-width: 800px !important; /* Trava no PC para não ficar infinito */
    height: 40px !important;     /* Altura confortável */
    
    /* VISUAL MODERNO */
    background-color: #28a745 !important; /* Verde vivo */
    color: white !important;
    font-size: 16px !important;
    font-weight: normal !important;
    text-transform: none !important; 
    letter-spacing: normal !important;
    
    border: none !important;
    border-radius: 8px !important; /* Cantos arredondados */
    box-shadow: 0 4px 6px rgba(0,0,0,0.1) !important;
    
    cursor: pointer !important;
    transition: transform 0.1s, background-color 0.2s !important;
    
    /* Remove margens antigas do botão */
    margin: 0 !important; 
    display: block !important;
}

/* Efeito de Clique */
.botao-salvar button:active {
    transform: scale(0.98) !important;
    box-shadow: 0 2px 3px rgba(0,0,0,0.1) !important;
}
/* ============================================================ */
/* === fim de BOTÃO SALVAR (RODAPÉ) - POSIÇÃO FIXA E VISUAL MODERNO === */
/* ============================================================ */



/* ============================================================ */
/* === CORREÇÃO SUPREMA: CORES ON/OFF (INÍCIO E CLIQUE) === */
/* ============================================================ */

/* --- 1. SISTEMA (Fundo Colorido) --- */
/* Aplica ao estado normal E ao foco/clique */
#sistema.on, 
#sistema.on:focus { 
    background-color: green !important; 
    color: white !important; 
    border-color: green !important;
}

#sistema.off, 
#sistema.off:focus { 
    background-color: red !important; 
    color: white !important; 
    border-color: red !important;
}

/* --- 2. OUTROS CAMPOS (Texto Colorido) --- */
/* Lista completa de classes ON (Verde) */
.confirmacao-on, .confirmacao-on:focus,
.edicao-on, .edicao-on:focus,
.quebra-on, .quebra-on:focus,
.piramide-on, .piramide-on:focus,
.duplas-on, .duplas-on:focus,
.ranking-on, .ranking-on:focus {
    color: green !important; 
    font-weight: bold !important;
    background-color: white !important; /* Garante fundo branco no modo claro */
}

/* Lista completa de classes OFF (Vermelho) */
.confirmacao-off, .confirmacao-off:focus,
.edicao-off, .edicao-off:focus,
.quebra-off, .quebra-off:focus,
.piramide-off, .piramide-off:focus,
.duplas-off, .duplas-off:focus,
.ranking-off, .ranking-off:focus {
    color: red !important;
    font-weight: bold !important;
    background-color: white !important; /* Garante fundo branco no modo claro */
}

/* --- 3. AJUSTES ESPECÍFICOS PARA MODO ESCURO --- */
/* Aqui trocamos as cores para versões que funcionam no fundo preto */

/* Sistema no Escuro */
body.dark-mode #sistema.on, 
body.dark-mode #sistema.on:focus { 
    background-color: #2E7D32 !important; 
    border-color: #1b5e20 !important;
}
body.dark-mode #sistema.off, 
body.dark-mode #sistema.off:focus { 
    background-color: #c62828 !important; 
    border-color: #b71c1c !important;
}

/* Outros Campos no Escuro (Texto Neon + Fundo Cinza) */
body.dark-mode .confirmacao-on, body.dark-mode .confirmacao-on:focus,
body.dark-mode .edicao-on, body.dark-mode .edicao-on:focus,
body.dark-mode .quebra-on, body.dark-mode .quebra-on:focus,
body.dark-mode .piramide-on, body.dark-mode .piramide-on:focus,
body.dark-mode .duplas-on, body.dark-mode .duplas-on:focus,
body.dark-mode .ranking-on, body.dark-mode .ranking-on:focus {
    color: #69f0ae !important;            /* Verde Neon */
    background-color: #2d2d2d !important; /* Fundo do tema escuro */
}

body.dark-mode .confirmacao-off, body.dark-mode .confirmacao-off:focus,
body.dark-mode .edicao-off, body.dark-mode .edicao-off:focus,
body.dark-mode .quebra-off, body.dark-mode .quebra-off:focus,
body.dark-mode .piramide-off, body.dark-mode .piramide-off:focus,
body.dark-mode .duplas-off, body.dark-mode .duplas-off:focus,
body.dark-mode .ranking-off, body.dark-mode .ranking-off:focus {
    color: #ff5252 !important;            /* Vermelho Neon */
    background-color: #2d2d2d !important; /* Fundo do tema escuro */
}
/* ============================================================ */
/* === FIM DE CORREÇÃO SUPREMA: CORES ON/OFF (INÍCIO E CLIQUE) === */
/* ============================================================ */



/* --- BOTÃO DE COR INTELIGENTE (ESTILO CÍRCULO) --- */
.botao-cor-custom {
    width: 24px;             /* Um pouco menor */
    height: 24px;
    border-radius: 50%;      /* Círculo perfeito */
    border: 2px solid #ffffff; /* Borda branca interna para destaque */
    outline: 1px solid #ccc;   /* Borda fina externa */
    cursor: pointer;
    background-color: #007bff;
    box-shadow: 0 2px 4px rgba(0,0,0,0.2);
    transition: transform 0.1s;
    flex-shrink: 0;          /* Impede que o botão amasse */
}
.botao-cor-custom:active { transform: scale(0.90); }

/* --- MODAL DA GRADE DE CORES (SÓ PARA PC) --- */ 
#modalSeletorPC .modal-content {
    max-width: 320px;
    text-align: center;
}
.grid-cores-pc {
    display: grid;
    grid-template-columns: repeat(5, 1fr); /* 5 por linha */
    gap: 15px;
    justify-items: center;
    margin-top: 15px;
}
.dot-pc {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    cursor: pointer;
    border: 2px solid transparent;
    box-shadow: 0 2px 5px rgba(0,0,0,0.2);
    transition: transform 0.2s;
}
.dot-pc:hover { transform: scale(1.15); border-color: #333; }

/* --- FIM DE BOTÃO DE COR INTELIGENTE --- */



/* --- FIXAR BOTÕES NO RODAPÉ (GRADE DE AULAS) --- */

/* 1. Transforma a janela em uma coluna flexível */
#modalHorarioAulas .modal-content {
    display: flex !important;
    flex-direction: column !important;
    max-height: 90vh !important; /* Garante que cabe na tela sem estourar */
    overflow: hidden !important; /* Remove a barra de rolagem da janela inteira */
    padding-bottom: 10px !important; /* Espaço extra no fundo */
}

/* 2. Faz a Tabela ocupar todo o espaço do meio e rolar sozinha */
#modalHorarioAulas .tabela-horarios-scroll {
    flex: 1 !important;          /* Cresce para ocupar o vazio */
    overflow-y: auto !important; /* Cria rolagem APENAS aqui dentro */
    max-height: none !important; /* Remove limites antigos */
    min-height: 0 !important;    /* Correção técnica para Flexbox */
    border-bottom: 1px solid #eee; /* Linha sutil separando dos botões */
}

/* 3. Fixa os Botões no fundo */
#modalHorarioAulas .modal-buttons {
    flex-shrink: 0 !important;   /* Impede que os botões sejam esmagados */
    margin-top: 10px !important; 
    padding-top: 5px !important;
    background-color: white !important; /* Fundo sólido para garantir leitura */
    z-index: 10;
}
/* --- FIIM DE FIXAR BOTÕES NO RODAPÉ (GRADE DE AULAS) --- */


/* --- CORREÇÃO TELA CHEIA (PC) - GRADE DE AULAS --- */

/* 1. O MODAL: Ocupa tudo e zera espaços */
#modalHorarioAulas .modal-content.maximizado {
    width: 100vw !important;
    height: 100vh !important;
    max-width: none !important;
    max-height: none !important;
    
    top: 0 !important;
    left: 0 !important;
    margin: 0 !important;
    border: none !important;
    border-radius: 0 !important;
    
    padding: 0 !important; 
    padding-bottom: 0 !important;
    
    background-color: #fff !important;
    
    display: flex !important;
    flex-direction: column !important;
    z-index: 2147483647 !important;
}

/* 2. O TÍTULO: Branco, Sem Linha e Colado em Cima */
#modalHorarioAulas .modal-content.maximizado #tituloAulaQuadra {
    flex: 0 0 auto !important;
    margin: 0 !important;        
    padding: 5px 0 10px 0 !important; 
    text-align: center;
    
    background-color: #fff !important; 
    color: #333 !important;
    font-size: 18px !important;
    font-weight: bold !important;
    
    /* AQUI ESTÁ A MUDANÇA: SEM BORDA NENHUMA */
    border: none !important; 
    border-bottom: none !important;
}

/* 3. A ÁREA DE ROLAGEM: Ocupa o resto */
#modalHorarioAulas .modal-content.maximizado .tabela-horarios-scroll {
    flex: 1 1 auto !important;
    height: auto !important;
    max-height: none !important;
    overflow-y: auto !important;
    
    margin: 0 !important;
    padding: 0 !important;
    border: none !important;
    background-color: #fff !important;
}

/* 4. A TABELA */
#modalHorarioAulas .modal-content.maximizado .tabela-aulas {
    width: 100% !important;
    margin-bottom: 0 !important;
    border-bottom: none !important;
}

/* 5. CABEÇALHO DAS ABAS (Mantido o ajuste anterior) */
#modalHorarioAulas .modal-content.maximizado .quadras-tabs-container {
    flex: 0 0 auto !important;
    width: 100%;
    
    /* Padding inferior zerado para colar no título */
    padding: 5px 5px 0 5px !important; 
    
    /* Fundo branco para se fundir com o título */
    background-color: #fff !important; 
    
    margin-bottom: 0 !important;
    border: none !important;
}

/* 6. ESCONDER ITENS DESNECESSÁRIOS */
.modal-content.maximizado .painel-controle-aulas,
.modal-content.maximizado .modal-buttons,
.modal-content.maximizado .cabecalho-modal-aulas,
.modal-content.maximizado .modal-footer {
    display: none !important;
}

/* --- FIM DE CORREÇÃO TELA CHEIA (PC) - GRADE DE AULAS --- */


/* --- CORREÇÃO: FUNDO DOS BOTÕES GRADE DE AULAS (MODO ESCURO) --- */
body.dark-mode #modalHorarioAulas .modal-buttons {
    background-color: #1e1e1e !important; /* Mesma cor de fundo do modal escuro */
    border-top: 1px solid #333 !important; /* Uma linha sutil para acabamento */
}
/* --- FIM DE CORREÇÃO: FUNDO DOS BOTÕES GRADE DE AULAS (MODO ESCURO) --- */

</style>

</head>
<body>

<div id="loading">Carregando... Aguarde.</div>

<div id="content">
    <div class="form-container">
        <div class="title-container">
           <span>Configurações</span>
        </div>
        <hr class="hr-line">

        <div class="container">
            <label for="sistema">Sistema:</label>
            <select id="sistema" onchange="atualizarEstadoSistema()">
                <option value="ON">ON</option>
                <option value="OFF">OFF</option>
            </select>
            <input type="text" id="usuariosOnline" placeholder="000" readonly maxlength="3" style="width: 40px; height: 15px; text-align: center;" title="Número de usuários online (3 dígitos)">
            <script>
				document.getElementById('usuariosOnline').addEventListener('mousedown', function(event) {
					event.preventDefault();
					this.blur();
					window.getSelection().removeAllRanges();
				});
			</script>
		</div>
		
		<div class="container container-fixo">
            <label for="perfilSelect">Perfil:</label>
            <div class="input-group">
                <select id="perfilSelect" class="select-padrao">
                    <option value="Admin">Admin</option>
                    <option value="Visitante">Visitante</option>
                </select>
                <button type="button" class="btn-extra add-button" onclick="abrirModalAdicionarPerfil()" title="Adicionar Perfil">+</button>
            </div>
        </div>
        
        <div class="container container-fixo">
            <label for="permissoesSelect">Permissões:</label>
            <div class="input-group">
                <select id="permissoesSelect" class="select-padrao">
                    <option selected>Acesso Total</option>
                </select>
                
                <button id="btnEditarPermissoes" type="button" class="btn-extra btn-lapis" onclick="abrirModalPermissoes()" title="Editar Permissões">✏️</button>
            </div>
        </div>

        <div class="container quadra-container">
            <label for="estadoQuadra1">Quadra 1 - Coberta:</label>
            <select id="estadoQuadra1" class="no-select" onfocus="this.oldValue = this.value;" onchange="handleEstadoQuadraChange(this, 1)" ondblclick="handleEstadoQuadraChange(this, 1)">
                <option value="liberada">Liberada</option><option value="interditada">Interditada</option><option value="bloqueada">Bloqueada</option>
            </select>
        </div>
        <div class="container quadra-container">
            <label for="estadoQuadra2">Quadra 2 - Aberta:</label>
            <select id="estadoQuadra2" class="no-select" onfocus="this.oldValue = this.value;" onchange="handleEstadoQuadraChange(this, 2)" ondblclick="handleEstadoQuadraChange(this, 2)">
                <option value="liberada">Liberada</option><option value="interditada">Interditada</option><option value="bloqueada">Bloqueada</option>
            </select>
        </div>
        <div class="container quadra-container">
            <label for="estadoQuadra3">Quadra 3 - Coberta:</label>
            <select id="estadoQuadra3" class="no-select" onfocus="this.oldValue = this.value;" onchange="handleEstadoQuadraChange(this, 3)" ondblclick="handleEstadoQuadraChange(this, 3)">
                <option value="liberada">Liberada</option><option value="interditada">Interditada</option><option value="bloqueada">Bloqueada</option>
            </select>
        </div>
    </div>

    <div id="main-content">
        <div class="tabs">
            <div class="tab active" onclick="showTab('reservas')">Reservas</div>
            <div class="tab" onclick="showTab('duplas')">Duplas</div>
			<div class="tab" onclick="showTab('convidados')">Convidados</div>
            <div class="tab" onclick="showTab('piramide')">Pirâmide</div>
        </div>
		
		
        <div id="reservas" class="tab-content tab-content-active">
			<div class="form-container">
				
				<div class="container">
					<label for="tipoConfiguracaoHorario">Gerenciador Horários:</label>
					
					<select id="tipoConfiguracaoHorario" onchange="abrirGerenciadorHorarios(this.value)">
						<option value="" disabled selected hidden>Config</option>
						<option value="padrao">Padrão</option>
						<option value="especial">Especiais</option>
						<option value="aulas">Aulas</option>
					</select>
				</div>

				<div class="container">
					<label for="diasParaAgendar">Dias para Agendar:</label>
					<select id="diasParaAgendar">
						<option value="0">0</option><option value="1">1</option><option value="2">2</option><option value="3">3</option><option value="4">4</option>
					</select>
				</div> 
				
				<div class="container">
					<label for="reservasPorConfirmacao" class="label-help" title="ON: Reservas com múltiplos sócios exigem que cada um confirme sua presença.&#10;──────────&#10;OFF: Todas as reservas são confirmadas instantaneamente.">Confirmação Reservas:</label>
					<select id="reservasPorConfirmacao" onchange="atualizarEstadoConfirmacao()">
						<option value="ON">ON</option><option value="OFF">OFF</option>
					</select>
				</div>

				<div class="container">
					<label for="horasParaExpirar" class="label-help" title="Define o tempo máximo que os jogadores têm para aceitar ou recusar um convite.&#10;──────────&#10;Se o prazo expirar, a reserva é cancelada automaticamente.">Prazo para Confirmação:</label>
					<select id="horasParaExpirar">
						<option value="1">1 hora</option><option value="2">2 horas</option><option value="3">3 horas</option><option value="4">4 horas</option><option value="6">6 horas</option><option value="12">12 horas</option> 
					</select>
				</div>

				<div class="container">
					<label for="edicaoOrganizador" class="label-help" title="ON: Permite que o organizador de uma reserva pendente possa adicionar ou remover jogadores.&#10;──────────&#10;OFF: O organizador pode apenas excluir a reserva.">Edição pelo Organizador:</label>
					<select id="edicaoOrganizador" onchange="atualizarEstadoEdicaoOrganizador()">
						<option value="ON">ON</option><option value="OFF">OFF</option>
					</select>
				</div>

				<div class="container">
					<label for="otimizacaoHorarios" class="label-help" title="ON: O sistema ativa a otimização para dias curtos (4h ou menos), bloqueando horários quebrados para maximizar o uso da quadra. Dê duplo clique para escolher as quadras.&#10;──────────&#10;OFF: A otimização é desligada e os horários ficam livres.">Otimização de Horários:</label>
					<select id="otimizacaoHorarios" onchange="mudarOtimizacao()" ondblclick="if(this.value === 'ON') { abrirModalQuebraHorario(); }">
						<option value="ON">ON</option><option value="OFF">OFF</option>
					</select>
				</div>
			</div>
		</div>


        <div id="convidados" class="tab-content">
            <div class="container convidados-quadras">
                <label style="font-weight: bold;">Quadras:</label>
                <div class="convidados-options">
                    <label style="font-weight: normal;"><input type="checkbox" id="convidadosQuadra1" style="margin-top: 5px;"> Quadra 1 - Coberta</label>
                    <label style="font-weight: normal;"><input type="checkbox" id="convidadosQuadra2" style="margin-right: 5px;"> Quadra 2 - Aberta</label>
                    <label style="font-weight: normal;"><input type="checkbox" id="convidadosQuadra3" style="margin-right: 5px;"> Quadra 3 - Coberta</label>
                </div>
            </div>
            <div class="container convidados-dias">
                <label style="font-weight: bold;">Dias:</label>
                <div class="convidados-options">
                    <label style="font-weight: normal;"><input type="checkbox" id="convidadosSemana" style="margin-right: 5px;"> Durante a Semana</label>
                    <label style="font-weight: normal;"><input type="checkbox" id="convidadosFimDeSemana" style="margin-right: 5px;"> Fim de Semana</label>
                </div>
            </div>
        </div>

        <div id="piramide" class="tab-content">
            <div class="container piramide-ativa-container">
				<label for="piramideAtiva">Ativa:</label>
				<select id="piramideAtiva" onchange="handlePiramideChange()">
					<option value="ON">ON</option><option value="OFF">OFF</option>
				</select>
				<span id="piramideInicio" style="display: none; font-weight: bold; margin-left: 10px;"></span>
				<span id="piramideSeparador" style="display: none; margin: 0 5px;">à</span>
				<span id="piramideFim" style="display: none; font-weight: bold;"></span>
			</div>

            <div class="container piramide-botoes-container">
                <button class="piramide-botao" onclick="mostrarQuadra('quadra1')">Quadra - 1</button>
                <button class="piramide-botao" onclick="mostrarQuadra('quadra2')">Quadra - 2</button>
                <button class="piramide-botao" onclick="mostrarQuadra('quadra3')">Quadra - 3</button>
            </div>

            <div id="piramideQuadra1Container" class="piramide-quadra-container">
                <div class="container piramide-quadras">
                    <div class="piramde-options centraliza-checkbox"><input type="checkbox" id="piramideQuadra1"><span>Quadra 1 - Coberta</span></div>
                </div>
                <div class="container piramide-dias">
                    <label class="dias-label" style="font-weight: bold;" id="PiramideDiasQuadra1">Dias:</label>
                    <div class="piramde-options">
                        <label style="font-weight: normal;"><input type="checkbox" id="1-piramideSemana" style="margin-right: 5px;"> Dias de Semana</label>
                        <label style="font-weight: normal; color: red;"><input type="checkbox" id="1-piramideExceto17_19" style="margin-right: 5px;"> Exceto 17:00 - 19:00</label>
                        <label style="font-weight: normal;"><input type="checkbox" id="1-piramideSabado" style="margin-right: 5px;"> Sábado</label>
                        <label style="font-weight: normal; color: red;"><input type="checkbox" id="1-piramideExceto7_12" style="margin-right: 5px;"> Exceto 07:00 - 12:00</label>
                        <label style="font-weight: normal;"><input type="checkbox" id="1-piramideDomingo" style="margin-right: 5px;"> Domingo</label>
                        <label style="font-weight: normal; color: red;"><input type="checkbox" id="1-piramideExceto8_12" style="margin-right: 5px;"> Exceto 08:00 - 12:00</label>
                    </div>
                </div>
            </div>
            <div id="piramideQuadra2Container" class="piramide-quadra-container" style="display: none;">
                <div class="container piramide-quadras"><div class="piramde-options centraliza-checkbox"><input type="checkbox" id="piramideQuadra2"><span>Quadra 2 - Aberta</span></div></div>
                <div class="container piramide-dias"><label class="dias-label" style="font-weight: bold;" id="PiramideDiasQuadra2">Dias:</label><div class="piramde-options"><label style="font-weight: normal;"><input type="checkbox" id="2-piramideSemana" style="margin-right: 5px;"> Dias de Semana</label><label style="font-weight: normal; color: red;"><input type="checkbox" id="2-piramideExceto17_19" style="margin-right: 5px;"> Exceto 17:00 - 19:00</label><label style="font-weight: normal;"><input type="checkbox" id="2-piramideSabado" style="margin-right: 5px;"> Sábado</label><label style="font-weight: normal; color: red;"><input type="checkbox" id="2-piramideExceto7_12" style="margin-right: 5px;"> Exceto 07:00 - 12:00</label><label style="font-weight: normal;"><input type="checkbox" id="2-piramideDomingo" style="margin-right: 5px;"> Domingo</label><label style="font-weight: normal; color: red;"><input type="checkbox" id="2-piramideExceto8_12" style="margin-right: 5px;"> Exceto 08:00 - 12:00</label></div></div>
            </div>
            <div id="piramideQuadra3Container" class="piramide-quadra-container" style="display: none;">
                <div class="container piramide-quadras"><div class="piramde-options centraliza-checkbox"><input type="checkbox" id="piramideQuadra3"><span>Quadra 3 - Coberta</span></div></div>
                <div class="container piramide-dias"><label class="dias-label" style="font-weight: bold;" id="PiramideDiasQuadra3">Dias:</label><div class="piramde-options"><label style="font-weight: normal;"><input type="checkbox" id="3-piramideSemana" style="margin-right: 5px;"> Dias de Semana</label><label style="font-weight: normal; color: red;"><input type="checkbox" id="3-piramideExceto17_19" style="margin-right: 5px;"> Exceto 17:00 - 19:00</label><label style="font-weight: normal;"><input type="checkbox" id="3-piramideSabado" style="margin-right: 5px;"> Sábado</label><label style="font-weight: normal; color: red;"><input type="checkbox" id="3-piramideExceto7_12" style="margin-right: 5px;"> Exceto 07:00 - 12:00</label><label style="font-weight: normal;"><input type="checkbox" id="3-piramideDomingo" style="margin-right: 5px;"> Domingo</label><label style="font-weight: normal; color: red;"><input type="checkbox" id="3-piramideExceto8_12" style="margin-right: 5px;"> Exceto 08:00 - 12:00</label></div></div>
            </div>
        </div>
		
		<div id="duplas" class="tab-content">
            <div class="container duplas-ativa-container">
                <label for="duplasAtiva">Ativa:</label><select id="duplasAtiva" onchange="atualizarEstadoDuplas()"><option value="ON">ON</option><option value="OFF">OFF</option></select>
                <label id="labelDuplasRanking" for="duplasRanking" style="margin-left: 15px;" title="Com o Ranking em OFF, dê um triplo clique aqui para zerar os dados do ranking.">Ranking:</label><select id="duplasRanking" onchange="atualizarEstadoDuplasRanking()"><option value="ON">ON</option><option value="OFF">OFF</option></select>
            </div>
            <div class="container duplas-botoes-container">
                <button class="duplas-botao" onclick="mostrarDuplasQuadra('quadra1')">Quadra - 1</button>
                <button class="duplas-botao" onclick="mostrarDuplasQuadra('quadra2')">Quadra - 2</button>
                <button class="duplas-botao" onclick="mostrarDuplasQuadra('quadra3')">Quadra - 3</button>
            </div>
            <div id="duplasQuadra1Container" class="duplas-container">
                <div class="centraliza-checkbox"><input type="checkbox" id="duplasQuadra1Ativa"><span>Quadra 1 - Coberta</span></div>
                <div class="container"><label class="dias-label" style="font-weight: bold;" id="DuplasDiasQuadra1">Dias:</label><div class="duplas-options"><div class="duplas-day-container"><div style="display: flex; align-items: center;"> <input type="checkbox" id="1-duplasSemana"><span class="dias-semana-label-clickable" style="margin-left: 5px; user-select: none;">Dias de Semana</span></div><div class="duplas-time-wrapper"><input type="text" id="1-duplasSemanaInicio" class="horario-input" placeholder="HH:MM"> : <input type="text" id="1-duplasSemanaFim" class="horario-input" placeholder="HH:MM"></div></div><div class="duplas-day-container"><label><input type="checkbox" id="1-duplasSabado"> Sábado</label><div class="duplas-time-wrapper"><input type="text" id="1-duplasSabadoInicio" class="horario-input" placeholder="HH:MM"> : <input type="text" id="1-duplasSabadoFim" class="horario-input" placeholder="HH:MM"></div></div><div class="duplas-day-container"><label><input type="checkbox" id="1-duplasDomingo"> Domingo</label><div class="duplas-time-wrapper"><input type="text" id="1-duplasDomingoInicio" class="horario-input" placeholder="HH:MM"> : <input type="text" id="1-duplasDomingoFim" class="horario-input" placeholder="HH:MM"></div></div></div></div>
            </div>
            <div id="duplasQuadra2Container" class="duplas-container" style="display: none;">
                 <div class="centraliza-checkbox"><input type="checkbox" id="duplasQuadra2Ativa"><span>Quadra 2 - Aberta</span></div>
                <div class="container"><label class="dias-label" style="font-weight: bold;" id="DuplasDiasQuadra2">Dias:</label><div class="duplas-options"><div class="duplas-day-container"><div style="display: flex; align-items: center;"> <input type="checkbox" id="2-duplasSemana"><span class="dias-semana-label-clickable" style="margin-left: 5px; user-select: none;">Dias de Semana</span></div><div class="duplas-time-wrapper"><input type="text" id="2-duplasSemanaInicio" class="horario-input" placeholder="HH:MM"> : <input type="text" id="2-duplasSemanaFim" class="horario-input" placeholder="HH:MM"></div></div><div class="duplas-day-container"><label><input type="checkbox" id="2-duplasSabado"> Sábado</label><div class="duplas-time-wrapper"><input type="text" id="2-duplasSabadoInicio" class="horario-input" placeholder="HH:MM"> : <input type="text" id="2-duplasSabadoFim" class="horario-input" placeholder="HH:MM"></div></div><div class="duplas-day-container"><label><input type="checkbox" id="2-duplasDomingo"> Domingo</label><div class="duplas-time-wrapper"><input type="text" id="2-duplasDomingoInicio" class="horario-input" placeholder="HH:MM"> : <input type="text" id="2-duplasDomingoFim" class="horario-input" placeholder="HH:MM"></div></div></div></div>
            </div>
            <div id="duplasQuadra3Container" class="duplas-container" style="display: none;">
                 <div class="centraliza-checkbox"><input type="checkbox" id="duplasQuadra3Ativa"><span>Quadra 3 - Coberta</span></div>
                <div class="container"><label class="dias-label" style="font-weight: bold;" id="DuplasDiasQuadra3">Dias:</label><div class="duplas-options"><div class="duplas-day-container"><div style="display: flex; align-items: center;"> <input type="checkbox" id="3-duplasSemana"><span class="dias-semana-label-clickable" style="margin-left: 5px; user-select: none;">Dias de Semana</span></div><div class="duplas-time-wrapper"><input type="text" id="3-duplasSemanaInicio" class="horario-input" placeholder="HH:MM"> : <input type="text" id="3-duplasSemanaFim" class="horario-input" placeholder="HH:MM"></div></div><div class="duplas-day-container"><label><input type="checkbox" id="3-duplasSabado"> Sábado</label><div class="duplas-time-wrapper"><input type="text" id="3-duplasSabadoInicio" class="horario-input" placeholder="HH:MM"> : <input type="text" id="3-duplasSabadoFim" class="horario-input" placeholder="HH:MM"></div></div><div class="duplas-day-container"><label><input type="checkbox" id="3-duplasDomingo"> Domingo</label><div class="duplas-time-wrapper"><input type="text" id="3-duplasDomingoInicio" class="horario-input" placeholder="HH:MM"> : <input type="text" id="3-duplasDomingoFim" class="horario-input" placeholder="HH:MM"></div></div></div></div>
            </div>
        </div>
    </div>  
	
    <div class="container botao-salvar">
        <button onclick="salvarConfiguracoes()" id="button-piramide">Salvar Configurações</button> 
    </div>
</div>

<div id="modalDatasEspeciais" class="modal-overlay"><div class="modal-content"><h2 id="modalTitulo">Exceções</h2><div class="container"><label>Desc:</label><input id="excecaoDescricao"></div><div class="container"><label>Data:</label><input id="excecaoData" oninput="formatarDataInput(event)"></div><div class="container"><label>Horário:</label><input type="time" id="excecaoInicio"><input type="time" id="excecaoFim"></div><div class="modal-buttons"><button class="btn-fechar" onclick="fecharModalExcecao()">Fechar</button><button class="btn-adicionar" onclick="adicionarExcecao()">Add</button></div><div id="listaExcecoes"></div></div></div>
<div id="modalBloqueioQuadra" class="modal-overlay"><div class="modal-content"><h2 id="modalBloqueioTitulo">Bloqueio</h2><div class="container"><label>Desc:</label><input id="bloqueioDescricao"></div><div class="container"><label>Data:</label><input id="bloqueioData" oninput="formatarDataInput(event)"></div><div class="container"><label>Horário:</label><input type="time" id="bloqueioInicio"><input type="time" id="bloqueioFim"></div><div class="modal-buttons"><button class="btn-fechar" onclick="fecharModalBloqueio()">Fechar</button><button class="btn-adicionar" onclick="adicionarBloqueio()">Add</button></div><div id="listaBloqueios"></div></div></div>
<div id="modalDiasSemanaDuplas" class="modal-overlay"><div class="modal-content"><h2 id="modalDiasSemanaTitulo">Dias Semana</h2><div id="diasSemanaCheckboxContainer"><label><input type="checkbox" id="duplas-segunda">Seg</label><label><input type="checkbox" id="duplas-terca">Ter</label><label><input type="checkbox" id="duplas-quarta">Qua</label><label><input type="checkbox" id="duplas-quinta">Qui</label><label><input type="checkbox" id="duplas-sexta">Sex</label></div><div class="modal-buttons"><button class="btn-fechar" onclick="fecharModalDiasSemana()">Fechar</button><button class="btn-adicionar" onclick="salvarModalDiasSemana()">Salvar</button></div></div></div>
<div id="modalQuebraHorarioQuadras" class="modal-overlay">
    <div class="modal-content">
        <h2 id="modalQuebraHorarioTitulo" style="margin-bottom: 20px;">Otimização de Horários</h2>
        
        <div style="display: flex; flex-direction: column; gap: 15px; align-items: flex-start; margin-left: 20px;">
            <label style="font-weight: normal; cursor: pointer; font-size: 16px;">
                <input type="checkbox" id="quebraHorarioQuadra1" style="margin-right: 8px;"> Quadra 1 - Coberta
            </label>
            <label style="font-weight: normal; cursor: pointer; font-size: 16px;">
                <input type="checkbox" id="quebraHorarioQuadra2" style="margin-right: 8px;"> Quadra 2 - Aberta
            </label>
            <label style="font-weight: normal; cursor: pointer; font-size: 16px;">
                <input type="checkbox" id="quebraHorarioQuadra3" style="margin-right: 8px;"> Quadra 3 - Coberta
            </label>
        </div>

        <div class="modal-buttons" style="margin-top: 25px;">
            <button class="btn-fechar" onclick="fecharModalQuebraHorario()">Fechar</button>
            <button class="btn-adicionar" onclick="salvarModalQuebraHorario()">Confirmar</button>
        </div>
    </div>
</div>
</div>



<div id="modalHorarioPadrao" class="modal-overlay">
    <div class="modal-content" style="max-width: 800px; width: 90%;"> 
        
        <h2>Horários Padrão</h2>
        
        <div class="tabela-horarios-scroll" style="max-height: none; overflow: visible;">
            <table class="tabela-config-horarios">
                <thead>
					<tr>
						<th>Dia</th>
						<th>Status</th>
						<th class="col-horario">
							<span class="texto-desktop">Abertura</span>
							<span class="texto-mobile">Abre</span>
						</th>
						<th class="col-horario">
							<span class="texto-desktop">Fechamento</span>
							<span class="texto-mobile">Fecha</span>
						</th>
					</tr>
				</thead>
                <tbody id="tbodyHorarioPadrao"></tbody> 
            </table>
        </div>

        <div class="container modal-buttons">
            <button class="btn-fechar" onclick="fecharModalHorario('padrao')">Fechar</button>
            <button class="btn-adicionar" onclick="salvarHorarioPadrao()">Salvar</button>
        </div>
    </div>
</div>



<div id="modalHorarioEspecial" class="modal-overlay">
    <div class="modal-content" style="max-width: 700px; padding: 15px; display: flex; flex-direction: column; max-height: 95vh; overflow: hidden;">
        
        <div style="
            border: none;             
            margin: 0 0 10px 0;       
            padding: 0;               
            display: flex;            
            align-items: center;      
            justify-content: center;  
            min-height: 25px;
            flex-shrink: 0; /* Não deixa esmagar */
        ">
            <h2 style="margin: 0; padding: 0; font-size: 1.5rem; line-height: 1;">Horários Especiais</h2>
        </div>

        <div id="corpoModalScroll" style="overflow-y: auto; flex: 1; padding-right: 5px; display: flex; flex-direction: column;">

            <div id="areaSuperiorEspecial">
                <div class="painel-destaque" style="background: #e3f2fd; padding: 15px; border-radius: 8px; margin-bottom: 10px; border: 1px solid #bbdefb;">
                    <div class="container" style="margin: 0; display: flex; align-items: center;">
                        <label for="selectPeriodoEspecial" style="width: auto; margin-right: 10px; font-size: 1rem;">Gerenciar Período:</label>
                        <select id="selectPeriodoEspecial" onchange="carregarPeriodoEspecial(this.value)" style="font-weight: bold; padding: 8px;">
                            <option value="novo">+ Criar Novo Período...</option>
                        </select>
                    </div>
                </div>
                
                <div id="formPeriodoEspecial">
                    <div class="container" style="margin-bottom: 5px;">
                        <label style="width: 140px;">Nome do Período:</label>
                        <input type="text" id="nomePeriodo" placeholder="Ex: Recesso Fim de Ano" style="height: 30px; padding: 4px 8px;">
                    </div>
                    <div class="container" style="margin-bottom: 5px;">
                        <label>Vigência:</label>
                        <div style="display: flex; gap: 10px; flex: 1; align-items: center;">
                            <input type="date" id="dataInicioPeriodo" style="height: 30px; padding: 4px 8px;"><span style="font-weight: bold;">até</span><input type="date" id="dataFimPeriodo" style="height: 30px; padding: 4px 8px;">
                        </div>
                    </div>
                    <div class="container" style="justify-content: flex-start; margin: 2px 0; padding: 0; align-items: center; min-height: 30px;">
                        <label class="dias-semana-label" style="width: auto !important; max-width: none !important; cursor: pointer; display: flex !important; align-items: center !important; justify-content: flex-start !important; margin: 0; gap: 5px;">
    
							<input type="checkbox" id="periodoAtivo" checked onchange="atualizarCorPeriodoAtivo()" style="width: 20px; height: 20px; margin: 0; flex-shrink: 0;">
							
							<span id="textoPeriodoAtivo" style="font-weight: bold; line-height: 1;">Ativar este período especial</span>
						</label>
                    </div>
                    
                    <div class="painel-regra-mestra" style="background: #fff3cd; padding: 5px 10px; border: 1px solid #ffeeba; border-radius: 8px;">
                        <p style="margin: 0 0 2px 0; font-weight: bold; color: #856404; font-size: 0.95em;">⚡ Preenchimento Rápido:</p>
                        
                        <div class="container" style="margin: 0; flex-wrap: wrap; gap: 5px; align-items: center;">
                            <select id="regraMestraStatus" style="max-width: 100px;"><option value="aberto">Aberto</option><option value="fechado">Fechado</option></select>
                            
                            <div style="display: flex; align-items: center; gap: 5px;">
                                <input type="time" id="regraMestraInicio" value="08:00"><span>às</span><input type="time" id="regraMestraFim" value="17:00">
                            </div>
                            
                            <button id="btnGerarDias" class="btn-adicionar" onclick="gerarListaDias()" style="margin-left: auto; width: auto; font-size: 0.9em; background-color: #ffc107; color: #000;">Gerar / Atualizar Dias</button>
                        </div>
                    </div>
                </div>
            </div>
            <div style="display: flex; width: 100%; align-items: center; justify-content: space-between; margin: 5px 0 5px 0; padding-bottom: 5px; box-sizing: border-box; height: 40px; flex-shrink: 0;">
                <h3 style="font-size: 1.1em; margin: 0; color: #333;">Ajuste Fino (Dia a Dia):</h3>
                
                <button id="btnTelaCheiaEspecial" class="btn-expandir" onclick="alternarTelaCheiaEspecial()" title="Expandir / Minimizar">
					<svg viewBox="0 0 24 24" id="icon-fullscreen">
						<path d="M7 14H5v5h5v-2H7v-3zm-2-4h2V7h3V5H5v5zm12 7h-3v2h5v-5h-2v3zM14 5v2h3v3h2V5h-5z"/>
					</svg>
				</button>
            </div>

            <div class="lista-dias-scroll" id="containerListaDiasEspeciais">
                <p style="text-align: center; color: #999; margin-top: 30px; font-style: italic;">Defina as datas acima e clique em <b>"Gerar / Atualizar Dias"</b>.</p>
            </div>
        
        </div> <div class="container modal-buttons" style="margin-top: 10px; border-top: 1px solid #eee; padding-top: 10px; flex-shrink: 0;">
            <button id="btnExcluirPeriodo" class="btn-remover" onclick="excluirPeriodoSelecionado()" style="background-color: #dc3545; color: white; display: none;">Excluir</button>
            
            <button class="btn-fechar" onclick="fecharModalHorario('especial')" style="background-color: #6c757d;">Cancelar</button>
            
            <button id="btnSalvarEspecial" class="btn-adicionar" onclick="salvarPeriodoEspecial()" disabled style="background-color: #cccccc; color: white; cursor: not-allowed;">Salvar</button>
        </div>
    </div>
</div>




<div id="modalHorarioAulas" class="modal-overlay">
	<div class="modal-content" style="max-width: 900px; width: 95%; padding-top: 5px;">
        
        <div class="cabecalho-modal-aulas" style="text-align: center; border-bottom: 1px solid #eee; padding-bottom: 5px; margin-bottom: 5px;">
			<h2 style="margin: 0; border: none; padding: 0;">Grade de Aulas</h2>
		</div>

        <div class="quadras-tabs-container">
            <button class="quadra-tab active" id="btn-aula-q1" onclick="selecionarQuadraAula('Quadra1')">
                <span class="desktop-text">Quadra 1 - Coberta</span>
                <span class="mobile-text">Quadra 1<br>Coberta</span>
            </button>
            <button class="quadra-tab" id="btn-aula-q2" onclick="selecionarQuadraAula('Quadra2')">
                <span class="desktop-text">Quadra 2 - Aberta</span>
                <span class="mobile-text">Quadra 2<br>Aberta</span>
            </button>
            <button class="quadra-tab" id="btn-aula-q3" onclick="selecionarQuadraAula('Quadra3')">
                <span class="desktop-text">Quadra 3 - Coberta</span>
                <span class="mobile-text">Quadra 3<br>Coberta</span>
            </button>
        </div>

        <div class="painel-controle-aulas">
			<div class="linha-unica-flex">
				
				<label class="label-ativar">
					<input type="checkbox" id="aula-ativo">
					<span>Ativar Aulas</span>
				</label>
				
				<div class="grupo-professor-compacto"> 
					<label>Professor:</label>
					<select id="aula-professor">
						<option value="">Selecione...</option>
					</select>
				</div>
				
				<div class="grupo-botoes">
					<button class="btn-mini" onclick="acaoAula('selecionar')">Selecionar Tudo</button>
					<button class="btn-mini outline" onclick="acaoAula('limpar')">Limpar Tudo</button>
				</div>

			</div>
		</div>
		
		<div id="tituloAulaQuadra">
			Quadra 1 - Coberta
		</div>
		
		<div class="tabela-horarios-scroll" style="max-height: none; overflow: visible; border: none;">
			<table class="tabela-config-horarios tabela-aulas">
                <thead>
                    <tr>
                        <th 
                            onclick="tratarCliqueHorario(event)"
                            class="sem-selecao"
                            title="Dê dois cliques para Tela Cheia" 
                            style="cursor: pointer;">
                            Horário
                        </th>
                        
                        <th>Seg</th>
                        <th>Ter</th>
                        <th>Qua</th>
                        <th>Qui</th>
                        <th>Sex</th>
                        <th>Sáb</th>
                        <th>Dom</th>
                        
                        <th 
                            onclick="tratarCliqueHorario(event)"
                            class="sem-selecao"
                            title="Dê dois cliques para Tela Cheia" 
                            style="cursor: pointer;">
                            Horário
                        </th>
                    </tr>
                </thead>
                <tbody id="tbodyAulas">
                    <tr><td colspan="8" style="padding: 20px;">Carregando...</td></tr>
                </tbody>
            </table>
        </div>

        <div class="container modal-buttons" style="margin-top: 15px;">
            <button class="btn-fechar" onclick="fecharModalHorario('aulas')">Fechar</button>
            <button class="btn-adicionar" onclick="salvarConfiguracaoAulas()">Salvar</button>
        </div>
    </div>
</div>

<div id="modalNovoPerfil" class="modal-overlay"> 
    <div class="modal-content">
        <h2>Criar Novo Perfil</h2>
        
        <div style="display: flex; align-items: center; justify-content: space-between; gap: 10px; width: 100%; margin-bottom: 20px;">
            
            <div style="display: flex; align-items: center; gap: 5px; flex: 1; min-width: 0;">
                <label style="width: auto !important; min-width: 0 !important; margin: 0; font-weight: bold; font-size: 14px;">Nome:</label>
                <input type="text" id="nomeNovoPerfil" placeholder="Ex: Professor" style="flex: 1; min-width: 50px; padding: 6px; border: 1px solid #ccc; border-radius: 4px;">
            </div>

            <div style="display: flex; align-items: center; gap: 5px; flex: 0 0 auto;">
                <label style="width: auto !important; min-width: 0 !important; margin: 0; font-weight: bold; font-size: 14px;">Abrev:</label>
                <input type="text" id="abreviacaoNovoPerfil" placeholder="Ex:Prof" maxlength="8" style="width: 75px !important; text-align: center; padding: 6px 2px; border: 1px solid #ccc; border-radius: 4px; font-size: 14px;">
            </div>
            
            <div id="btnVisualCorNovo" class="botao-cor-custom" onclick="abrirSeletorInteligente('novo')" title="Escolher cor" style="margin: 0; flex-shrink: 0;"></div>
            
            <input type="hidden" id="corNovoPerfil" value="#007bff">
            <input type="color" id="nativeCorNovo" style="visibility:hidden; position:absolute; left:-9999px;" onchange="atualizarCorInteligente('novo', this.value)">

        </div>

        <div class="modal-buttons">
            <button class="btn-fechar" onclick="fecharModalNovoPerfil()">Cancelar</button>
            <button class="btn-adicionar" onclick="salvarNovoPerfilBanco()">Criar</button>
        </div>
    </div>
</div>



<div id="modalPermissoes" class="modal-overlay">
    <div class="modal-content" style="max-width: 450px;">
        <div class="header-flex-smart">
            
            <span class="titulo-smart">Permissões:</span>
            
            <div class="grupo-nome-lixo-smart">
				<span id="textoNomePerfil">Carregando...</span>
				
				<div id="btnVisualCorEdicao" class="botao-cor-custom" onclick="abrirSeletorInteligente('edicao')" style="width: 30px; height: 30px; margin-right: 10px;"></div>

				<input type="hidden" id="corPerfilEdicao">

				<input type="color" id="nativeCorEdicao" style="visibility:hidden; position:absolute; left:-9999px;" onchange="atualizarCorInteligente('edicao', this.value)">
				
				<button id="btnExcluirPerfil" onclick="excluirPerfilAtual()" class="btn-lixo-smart" title="Excluir" style="display: none;">
					🗑️
				</button>
			</div>
            
        </div>
        
        <div style="text-align: left; margin: 10px 0;">
		    <p class="texto-instrucao" style="font-size: 14px; color: #666; margin-bottom: 15px;">Marque o que este perfil pode fazer:</p>
 
            
            <div class="lista-permissoes" style="display: flex; flex-direction: column; gap: 12px;">
                
                <label style="font-weight: normal; cursor: pointer; display: flex; align-items: center; background: #e3f2fd; padding: 8px; border-radius: 4px; border: 1px solid #bbdefb; width: 100%; box-sizing: border-box;">
                    <input type="checkbox" id="perm_super_admin" onchange="gerenciarPermissoesInterativas('MASTER')" style="width: auto; margin-right: 10px; transform: scale(1.2);"> 
                    ⚡ <strong>Acesso Total (Super Admin)</strong>
                </label>
                
                <hr style="width: 100%; border-top: 1px dashed #ccc; margin: 5px 0;">
                
                <label style="font-weight: normal; cursor: pointer; display: flex; align-items: center;">
                    <input type="checkbox" id="perm_acesso_config" onchange="gerenciarPermissoesInterativas('CHILD')" style="width: auto; margin-right: 10px;"> 
                    Acessar Configurações (Esta tela)
                </label>
                
                <label style="font-weight: normal; cursor: pointer; display: flex; align-items: center;">
                    <input type="checkbox" id="perm_gestao_jogadores" onchange="gerenciarPermissoesInterativas('CHILD')" style="width: auto; margin-right: 10px;"> 
                    Gestão de Jogadores (Cadastro)
                </label>

                <label style="font-weight: normal; cursor: pointer; display: flex; align-items: center;">
                    <input type="checkbox" id="perm_gerir_reservas" onchange="gerenciarPermissoesInterativas('CHILD')" style="width: auto; margin-right: 10px;"> 
                    Gerenciar Reservas (Editar/Cancelar terceiros)
                </label>
                
                <label style="font-weight: normal; cursor: pointer; display: flex; align-items: center;">
                    <input type="checkbox" id="perm_controle_quadras" onchange="gerenciarPermissoesInterativas('CHILD')" style="width: auto; margin-right: 10px;"> 
                    Controle de Quadras (Bloqueios)
                </label>

                <label style="font-weight: normal; cursor: pointer; display: flex; align-items: center;">
                    <input type="checkbox" id="perm_gestor_aulas" onchange="gerenciarPermissoesInterativas('CHILD')" style="width: auto; margin-right: 10px;"> 
                    Gestor de Aulas (Grade/Professor)
                </label>

                <label style="font-weight: normal; cursor: pointer; display: flex; align-items: center;">
                    <input type="checkbox" id="perm_gestor_torneios" onchange="gerenciarPermissoesInterativas('CHILD')" style="width: auto; margin-right: 10px;"> 
                    Gestor de Torneios (Ranking/Pirâmide)
                </label>

            </div>
        </div>

        <div class="modal-buttons">
            <button class="btn-fechar" onclick="fecharModalPermissoes()">Cancelar</button>
            <button class="btn-adicionar" onclick="salvarPermissoesBanco()">Salvar Alterações</button>
        </div>
    </div>
</div>


<button id="theme-toggle-button" onclick="toggleTheme()" title="Alternar Tema">🌙</button>

<div id="toastContainer" class="toast-container"></div>

<div id="modalConfirmacaoGlobal" class="modal-overlay" style="z-index: 10000;">
    <div class="modal-content">
        <h3 id="tituloConf">Confirmação</h3>
        <p id="textoConf">Tem certeza que deseja realizar esta ação?</p>
        
        <div class="modal-buttons" style="justify-content: center; gap: 15px;">
            <button class="btn-fechar" id="btnCancelarConf" style="background-color: #6c757d; width: 100px;">Não</button>
            <button class="btn-adicionar" id="btnConfirmarConf" style="width: 100px;">Sim</button>
        </div>
    </div>
</div>

<div id="modalInputGlobal" class="modal-overlay" style="z-index: 10001;">
    <div class="modal-content">
        <h3 id="tituloInput">Entrada de Dados</h3>
        <p id="textoInput">Por favor, digite abaixo:</p>
        
        <input type="text" id="campoInputGlobal" class="select-padrao" style="width: 100%; margin: 10px 0; border: 1px solid #ccc; padding: 8px;">
        
        <div class="modal-buttons" style="justify-content: center; gap: 15px;">
            <button class="btn-fechar" id="btnCancelarInput" style="background-color: #6c757d; width: 100px;">Cancelar</button>
            <button class="btn-adicionar" id="btnConfirmarInput" style="width: 100px;">OK</button>
        </div>
    </div>
</div>


<div id="modalSeletorPC" class="modal-overlay" style="z-index: 10002;">
    <div class="modal-content">
        <h3>Escolha uma Cor</h3>
        <div id="gridCoresPC" class="grid-cores-pc">
            </div>
        <div class="modal-buttons" style="justify-content: center; margin-top: 20px;">
            <button class="btn-fechar" onclick="document.getElementById('modalSeletorPC').style.display='none'">Cancelar</button>
        </div>
    </div>
</div>

<script>
    const firebaseConfig = {
        apiKey: "YOUR_API_KEY",
        authDomain: "agenda-5ce95.firebaseapp.com",
        databaseURL: "https://agenda-5ce95-default-rtdb.firebaseio.com/",
        projectId: "agenda-5ce95",
        storageBucket: "agenda-5ce95.appspot.com",
        messagingSenderId: "852007565195",
        appId: "1:852007565195:web:d7bd789d140858f53f618e"
    };
    const app = firebase.initializeApp(firebaseConfig); 
    const db = firebase.database();

    // VARIÁVEIS GLOBAIS
    let bloqueiosQuadra = {};
    let excecoesDuplas = {}; 
    let diasSemanaDuplasConfig = {};
    let quebraHorarioQuadrasConfig = {};
    let listaUsuariosOnline = [];
    let quadraAtualParaDiasSemana = null;
    let quadraAtualParaExcecao = null;
    let quadraAtualParaBloqueio = null;
    let vlimparExcecoesAntigas = false;
    let vlimparBloqueiosAntigos = false;
    let carregamentoInicialConcluido = false;
    let listaJogadoresDisponiveis = [];
    let listaJogadoresParaArbitro = [];

    // NOVAS GLOBAIS DE HORÁRIO
    let horariosGlobal = { Padrao: {}, Especiais: {} };
    let periodoEmEdicaoID = null;
		
	// --- VARIÁVEIS DO GERENCIADOR DE AULAS ---
	let configAulasGlobal = { Quadra1: {}, Quadra2: {}, Quadra3: {} };
	let quadraAulaAtual = 'Quadra1';
	
	let perfilEmEdicaoAtual = null; // Guarda quem está sendo editado agora


// ==========================================================
    // === LÓGICA DE PERFIS E PERMISSÕES (Passo 2) ===
    // ==========================================================
    
    let perfisGlobal = {}; // Variável para guardar os perfis na memória do navegador
	
	// --- LÓGICA DO SELETOR DE CORES HÍBRIDO ---
	const CORES_DISPONIVEIS = [
		'#dc3545', '#007bff', '#28a745', '#ffc107', '#fd7e14', 
		'#6f42c1', '#e83e8c', '#17a2b8', '#343a40', '#6c757d'
	];
	let modoCorAtual = ''; // 'novo' ou 'edicao'

    // 1. OUVINTE DO BANCO (Funciona em Tempo Real)
    // Sempre que algo mudar em 'sistemas/config/Perfis', este código roda sozinho.
    db.ref('sistemas/config/Perfis').on('value', snapshot => {
        perfisGlobal = snapshot.val() || {};
        
        // Se for a primeira vez e não tiver nada, cria o Admin automaticamente
        if (Object.keys(perfisGlobal).length === 0) {
            criarPerfilPadraoAdmin();
        }
        
        atualizarDropdownPerfis();
    });

    function criarPerfilPadraoAdmin() {
        db.ref('sistemas/config/Perfis/Admin').set({
            descricao: "Super Usuário Padrão",
            permissoes: { super_admin: true }
        });
    }



 // --- FUNÇÃO AUXILIAR BLINDADA: Pinta a caixinha com !important ---
    function atualizarCorDoCampo(select) {
        if (!select || select.selectedIndex < 0) return;
        
        const selectedOption = select.options[select.selectedIndex];
        
        // Se a opção tem uma cor salva (data-cor)
        if (selectedOption && selectedOption.getAttribute('data-cor')) {
            const cor = selectedOption.getAttribute('data-cor');
            
            // O segredo: 'important' impede que o navegador resete a cor ao clicar fora
            select.style.setProperty('background-color', cor, 'important');
            select.style.setProperty('color', '#ffffff', 'important');
            
            select.style.fontWeight = 'bold';
            select.style.border = '1px solid ' + cor;
        } else {
            // Volta ao padrão
            select.style.removeProperty('background-color');
            select.style.removeProperty('color');
            select.style.backgroundColor = '#ffffff';
            select.style.color = '#333';
            select.style.fontWeight = 'normal';
            select.style.border = '1px solid #ced4da';
        }
    }

    // Manipulador de eventos unificado
    function handleSelectEvent(e) {
        atualizarCorDoCampo(e.target);
        // Se for mudança de valor, atualiza o resumo
        if (e.type === 'change') {
            atualizarResumoVisual();
        }
    }

    // 2. PREENCHE O DROPDOWN (Menu de Perfis) - VERSÃO FINAL
    function atualizarDropdownPerfis() {
        const select = document.getElementById('perfilSelect');
        if (!select) return;

        const valorAtual = select.value; 
        select.innerHTML = ''; 
        
        // Cores Padrão
        const coresPadrao = {
            'Admin':     '#dc3545', // Vermelho
            'Professor': '#198754', // Verde
            'Arbitro':   '#fd7e14', // Laranja
            'Operador':  '#007bff', // Azul
            'Socio':     '#6c757d', // Cinza
            'Visitante': '#6c757d'  // Cinza
        };

        Object.keys(perfisGlobal).forEach(nomePerfil => {
            const dados = perfisGlobal[nomePerfil]; 
            const option = document.createElement('option');
            option.value = nomePerfil;
            option.textContent = nomePerfil;

            const corFinal = (dados && dados.cor) ? dados.cor : coresPadrao[nomePerfil];

            if (corFinal) {
                option.style.backgroundColor = corFinal;
                option.style.color = '#ffffff';
                option.style.fontWeight = 'bold';
                option.setAttribute('data-cor', corFinal); 
            }

            select.appendChild(option);
        });

        if (perfisGlobal[valorAtual]) {
            select.value = valorAtual;
        } else if (select.options.length > 0) {
            select.selectedIndex = 0;
        }
        
        // 1. Pinta imediatamente
        atualizarCorDoCampo(select);

        // 2. Remove listeners antigos para não acumular
        select.removeEventListener('change', handleSelectEvent);
        select.removeEventListener('blur', handleSelectEvent); // Novo: vigia quando clica fora
        
        // 3. Adiciona listeners para MUDANÇA e PERDA DE FOCO
        select.addEventListener('change', handleSelectEvent);
        select.addEventListener('blur', handleSelectEvent);

        atualizarResumoVisual();
    }
	
	
	
	
    // Manipulador separado para o evento de mudança
    function handleSelectChange(e) {
        atualizarCorDoCampo(e.target);
        // Se houver lógica original de mostrar detalhes no onchange do HTML, ela roda normalmente.
        // Se for necessário chamar explicitamente aqui: mostrarDetalhesPerfil();
    }



// 3. ATUALIZA O VISUAL DO CAMPO "PERMISSÕES" (Lista Apenas Leitura)
    function atualizarResumoVisual() {
        const perfilSelecionado = document.getElementById('perfilSelect').value;
        const dados = perfisGlobal[perfilSelecionado] || {};
        const perms = dados.permissoes || {};
        
        const selectResumo = document.getElementById('permissoesSelect');
        const btnLapis = document.getElementById('btnEditarPermissoes');
        
        // --- 1. REGRA DO LÁPIS ---
        if (perfilSelecionado === 'Admin') {
            if (btnLapis) {
                btnLapis.disabled = true; 
                btnLapis.title = "O perfil Admin possui acesso total irrestrito.";
            }
        } else {
            if (btnLapis) {
                btnLapis.disabled = false; 
                btnLapis.title = "Editar Permissões";
            }
        }

        // --- 2. REGRA DO CAMPO VISUAL ---
        const temAcessoTotal = (perfilSelecionado === 'Admin' || perms.super_admin === true);

        if (temAcessoTotal) {
            if (selectResumo) selectResumo.disabled = true; 
        } else {
            if (selectResumo) selectResumo.disabled = false; 
        }
        
        // --- 3. PREENCHER O CONTEÚDO ---
        selectResumo.innerHTML = ''; 
        
        // CENÁRIO A: ACESSO TOTAL
        if (temAcessoTotal) {
            const opt = document.createElement('option');
            opt.text = "⚡Acesso Total";
            opt.style.fontWeight = "bold";
            selectResumo.add(opt);
            return;
        }

        // CENÁRIO B: COLETAR PERMISSÕES
        const nomesCurtos = {
            acesso_config: "Configurações",
            gestao_jogadores: "Cadastro",
            gerir_reservas: "Reservas",
            controle_quadras: "Quadras",
            gestor_aulas: "Aulas",
            gestor_torneios: "Torneios"
        };

        let listaPermissoes = [];
        Object.keys(nomesCurtos).forEach(chave => {
            if (perms[chave] === true) {
                listaPermissoes.push(nomesCurtos[chave]);
            }
        });

        // CENÁRIO C: SEM ACESSO
        if (listaPermissoes.length === 0) {
            const opt = document.createElement('option');
            opt.text = "Sem Acesso";
            selectResumo.add(opt);
        } 
        // CENÁRIO D: PARCIAIS (LEITURA APENAS)
        else {
            // 1. CAPA (Parciais...)
            const optCapa = document.createElement('option');
            optCapa.text = "Parciais...";
            optCapa.value = "";
            optCapa.disabled = true; 
            optCapa.selected = true; 
            optCapa.hidden = true;   // Some ao abrir
            optCapa.style.fontStyle = "italic"; 
            selectResumo.add(optCapa);

            // 2. ITENS DA LISTA (Bloqueados para clique)
            listaPermissoes.forEach(nome => {
                const opt = document.createElement('option');
                opt.text = nome; // Ex: "Cadastro"
                
                // O TRUQUE: Desabilita o item para não ser selecionável
                opt.disabled = true; 
                
                // Tenta manter a cor escura para leitura (alguns browsers ignoram e deixam cinza)
                opt.style.color = "#000"; 
                opt.style.fontWeight = "bold";

                selectResumo.add(opt);
            });
        }
}	
	
	
	
    // Quando o usuário muda o perfil no dropdown, atualiza o resumo
    // Verifique se o elemento 'perfilSelect' existe antes de adicionar o evento
    const elPerfilSelect = document.getElementById('perfilSelect');
    if(elPerfilSelect) {
        elPerfilSelect.addEventListener('change', atualizarResumoVisual);
    }


    // --- FUNÇÕES DO MODAL "CRIAR NOVO PERFIL" (Botão +) ---

// SUBSTITUA A FUNÇÃO abrirModalAdicionarPerfil POR ESTA:
function abrirModalAdicionarPerfil() {
    // 1. Limpa os campos de texto
    document.getElementById('nomeNovoPerfil').value = '';
    document.getElementById('abreviacaoNovoPerfil').value = '';

    // 2. Define a cor inicial como Azul (#007bff)
    // Chama nossa função inteligente que já pinta o botão visual e atualiza os inputs escondidos
    atualizarCorInteligente('novo', '#007bff');
    
    // 3. Mostra o modal
    document.getElementById('modalNovoPerfil').style.display = 'flex';
    
    // 4. Foca no input de nome
    setTimeout(() => document.getElementById('nomeNovoPerfil').focus(), 100);
}

    function fecharModalNovoPerfil() {
        document.getElementById('modalNovoPerfil').style.display = 'none';
    }

// SUBSTITUA A FUNÇÃO salvarNovoPerfilBanco POR ESTA:
// ================================================================= 
// === FUNÇÃO ATUALIZADA: VALIDAÇÃO DE CAMPOS OBRIGATÓRIOS       === 
// ================================================================= 
function salvarNovoPerfilBanco() {
    // 1. Pega os valores brutos dos campos
    const inputNome = document.getElementById('nomeNovoPerfil').value;
    const inputAbrev = document.getElementById('abreviacaoNovoPerfil').value;
    const cor = document.getElementById('corNovoPerfil').value;

    // 2. APLICA A FORMATAÇÃO (Aqui está a mágica)
    // Transforma "joão silva" em "João Silva"
    const nome = formatarTexto(inputNome);
    const abreviacao = formatarTexto(inputAbrev);

    // 3. VALIDAÇÃO DO NOME (Obrigatório)
    if (!nome) {
        document.getElementById('nomeNovoPerfil').focus();
        return mostrarNotificacao("Por favor, digite um Nome para o perfil.", 'warning');
    }

    // 4. VALIDAÇÃO DA ABREVIAÇÃO (Obrigatório)
    if (!abreviacao) {
        document.getElementById('abreviacaoNovoPerfil').focus();
        return mostrarNotificacao("A Abreviação é obrigatória (Ex: Prof, Jog).", 'warning');
    }

    // 5. Verifica se já existe um perfil com esse nome exato
    if (perfisGlobal[nome]) {
        return mostrarNotificacao("Já existe um perfil com este nome.", 'error');
    }

    // 6. Salva no Banco de Dados
    db.ref(`sistemas/config/Perfis/${nome}`).set({
        descricao: "Criado via Configurações",
        abreviacao: abreviacao, // Agora salva formatado
        cor: cor,
        permissoes: { acesso_config: false } 
    }).then(() => {
        mostrarNotificacao(`Perfil "${nome}" criado com sucesso!`, 'success');
        fecharModalNovoPerfil();
    }).catch(error => {
        console.error(error);
        mostrarNotificacao("Erro ao criar perfil.", 'error');
    });
}



    // --- FUNÇÕES DO MODAL "EDITAR PERMISSÕES" (Botão Lápis ✏️) ---

function abrirModalPermissoes() {
    const perfil = document.getElementById('perfilSelect').value;
    if (!perfil) return mostrarNotificacao("Nenhum perfil selecionado.", 'warning');

    // 1. Guarda o perfil atual para saber quem editar
    perfilEmEdicaoAtual = perfil;

    // 2. Carrega os dados do perfil
    const dadosPerfil = perfisGlobal[perfil] || {};
    const corAtual = dadosPerfil.cor || '#000000'; // Usa preto se não tiver cor salva

    // 3. ATUALIZA O BOTÃO CAMALEÃO (Pinta o visual e prepara os inputs)
    atualizarCorInteligente('edicao', corAtual);

    // 4. Atualiza o título e mostra o modal
    document.getElementById('textoNomePerfil').innerText = perfil;
    document.getElementById('modalPermissoes').style.display = 'flex';

    // 5. Verifica se é Admin (para esconder o botão de excluir)
    if (perfil === 'Admin') {
        document.getElementById('btnExcluirPerfil').style.display = 'none';
    } else {
        document.getElementById('btnExcluirPerfil').style.display = 'inline-block';
    }

    // 6. Preenche os Checkboxes existentes (mantendo sua lógica original)
    const perms = dadosPerfil.permissoes || {};
    const mapa = {
        'perm_super_admin': 'super_admin',
        'perm_acesso_config': 'acesso_config',
        'perm_gestao_jogadores': 'gestao_jogadores',
        'perm_gerir_reservas': 'gerir_reservas',
        'perm_controle_quadras': 'controle_quadras',
        'perm_gestor_aulas': 'gestor_aulas',
        'perm_gestor_torneios': 'gestor_torneios',
        'perm_acesso_financeiro': 'acesso_financeiro'
    };

    for (const [idElemento, chaveBanco] of Object.entries(mapa)) {
        const el = document.getElementById(idElemento);
        if (el) {
            el.checked = (perms[chaveBanco] === true);
        }
    }
    
    // 7. Inicializa a interatividade (bloqueio de filhos se super admin estiver marcado)
    if (typeof gerenciarPermissoesInterativas === 'function') {
        gerenciarPermissoesInterativas('INIT');
    }
}




	


function excluirPerfilAtual() {
    if (!perfilEmEdicaoAtual) return;

    // Confirmação de segurança
    if (!confirm(`Tem certeza que deseja excluir o perfil "${perfilEmEdicaoAtual}"?\n\nISSO REMOVERÁ ESTE PERFIL DE TODOS OS JOGADORES QUE O POSSUEM.`)) {
        return;
    }

    const perfilParaApagar = perfilEmEdicaoAtual;

    mostrarNotificacao("Iniciando varredura e exclusão...", "info");

    // 1. PRIMEIRO: Remove a definição do perfil (Configurações)
    const p1 = db.ref(`sistemas/config/Perfis/${perfilParaApagar}`).remove();

    // 2. SEGUNDO: Varre todos os jogadores para remover esse perfil (Cadastro)
    const p2 = db.ref('sistemas/cadastro/jogadores').once('value').then(snapshot => {
        const updates = {};
        let count = 0;

        snapshot.forEach(childSnapshot => {
            const keyJogador = childSnapshot.key;
            const dadosJogador = childSnapshot.val();

            // Verifica se o jogador tem esse perfil
            if (dadosJogador.perfis && dadosJogador.perfis[perfilParaApagar]) {
                // Cria o comando para apagar APENAS essa chave específica
                updates[`sistemas/cadastro/jogadores/${keyJogador}/perfis/${perfilParaApagar}`] = null;
                count++;
            }
        });

        // Se encontrou jogadores com esse perfil, manda o update em lote
        if (count > 0) {
            console.log(`Removendo perfil de ${count} jogadores...`);
            return db.ref().update(updates);
        } else {
            return Promise.resolve();
        }
    });

    // Quando as duas tarefas terminarem
    Promise.all([p1, p2])
        .then(() => {
            mostrarNotificacao(`Perfil "${perfilParaApagar}" excluído e removido de todos os jogadores!`, "success");
            fecharModalPermissoes();
        })
        .catch(erro => {
            console.error(erro);
            mostrarNotificacao("Erro ao excluir perfil.", "error");
        });
}


    function fecharModalPermissoes() {
        document.getElementById('modalPermissoes').style.display = 'none';
    }



function salvarPermissoesBanco() {
    const perfil = document.getElementById('perfilSelect').value;
    
    // 1. Pega a cor que está no input oculto (escolhida visualmente)
    const novaCor = document.getElementById('corPerfilEdicao').value;

    let isSuperAdmin = document.getElementById('perm_super_admin').checked;
    if (perfil === 'Admin') isSuperAdmin = true;

    const novasPermissoes = {
        super_admin: isSuperAdmin,
        acesso_config: document.getElementById('perm_acesso_config').checked,
        gestao_jogadores: document.getElementById('perm_gestao_jogadores').checked,
        gerir_reservas: document.getElementById('perm_gerir_reservas').checked,
        controle_quadras: document.getElementById('perm_controle_quadras').checked,
        gestor_aulas: document.getElementById('perm_gestor_aulas').checked,
        gestor_torneios: document.getElementById('perm_gestor_torneios').checked
    };

    // 2. Faz o update COMPLETO (Permissões + Cor)
    db.ref(`sistemas/config/Perfis/${perfil}`).update({
        permissoes: novasPermissoes,
        cor: novaCor
    })
    .then(() => {
        mostrarNotificacao(`Alterações de ${perfil} salvas!`, 'success');
        fecharModalPermissoes();
        atualizarResumoVisual();
    })
    .catch(erro => mostrarNotificacao("Erro ao salvar: " + erro.message, 'error'));
}



    window.onload = function() {
        document.getElementById('loading').style.display = 'block';
        document.getElementById('content').style.display = 'none';
        carregarConfiguracoes().then(() => {
            document.getElementById('loading').style.display = 'none';
            document.getElementById('content').style.display = 'block';
            atualizarEstadoSistema(); 
			// --- ADICIONE AQUI ---
			carregarListaProfessores(); 
			// ---------------------
        }).catch(console.error);
    };

    function carregarConfiguracoes() {
        return new Promise((resolve, reject) => {
            db.ref("sistemas/config").once("value").then(snapshot => {
                const data = snapshot.val();
                if(data) aplicarDadosConfig(data);
                resolve();
            }).catch(reject);

            db.ref("sistemas/config").on("value", snapshot => {
                const data = snapshot.val();
                if(data) aplicarDadosConfig(data);
            });
            
            // Listener de horários (SUBSTITUA POR ESTE BLOCO ATUALIZADO)
            db.ref("sistemas/config/Horarios").on("value", snapshot => {
                const data = snapshot.val() || { Padrao: {}, Especiais: {}, Aulas: {} }; 
                
                // 1. Atualiza a memória global
                horariosGlobal = data;

                // 2. Sincroniza a memória específica das aulas
                if (data.Aulas) {
                    configAulasGlobal = data.Aulas;
                } else {
                    configAulasGlobal = { Quadra1: {}, Quadra2: {}, Quadra3: {} };
                }

                // 3. O PULO DO GATO (ATUALIZAÇÃO EM TEMPO REAL):
                // Verifica se a janela de Aulas está aberta neste momento.
                const modalAulas = document.getElementById('modalHorarioAulas');
                
                if (modalAulas && modalAulas.style.display === 'flex') {
                    // Se estiver aberta, força o redesenho da tela!
                    // O parâmetro 'true' é CRUCIAL aqui: ele diz "apenas carregue, não salve o que está na tela agora"
                    // Isso impede que o celular (que tem dados velhos) sobrescreva os dados novos que acabaram de chegar do PC.
                    if (typeof selecionarQuadraAula === "function") {
                        selecionarQuadraAula(quadraAulaAtual, true);
                    }
                }
            });
        });
    }

    function aplicarDadosConfig(data) {
        document.getElementById('sistema').value = data.Abrir ? 'ON' : 'OFF';
        
        document.getElementById('diasParaAgendar').value = (6 - (data.DiasParaLimpar || 6)).toString();
        document.getElementById('reservasPorConfirmacao').value = data.ReservasPorConfirmacao ? 'ON' : 'OFF';
        document.getElementById('horasParaExpirar').value = data.horasParaExpirar || '2';
        document.getElementById('edicaoOrganizador').value = data.OrganizadorEdicao ? 'ON' : 'OFF';
		
		
        // 1. Lê a nova chave 'OtimizacaoHorarios' (ou cria padrão desligado)
        const configOtimizacao = data.OtimizacaoHorarios || { ativa: false, quadras: {} };
        
        // 2. Aplica o valor ao select
        document.getElementById('otimizacaoHorarios').value = configOtimizacao.ativa ? 'ON' : 'OFF';
        
        // 3. Carrega as quadras na variável global
        quebraHorarioQuadrasConfig = configOtimizacao.quadras || {};
        
        // 4. Chama a função visual com o NOVO NOME
        atualizarVisualOtimizacao();
		
		
        atualizarEstadoConfirmacao();
        atualizarEstadoEdicaoOrganizador();
        
        bloqueiosQuadra = data.Quadras?.Bloqueios || {};
        document.getElementById('estadoQuadra1').value = data.Quadras?.Quadra1 || "liberada";
        document.getElementById('estadoQuadra2').value = data.Quadras?.Quadra2 || "liberada";
        document.getElementById('estadoQuadra3').value = data.Quadras?.Quadra3 || "liberada";
        

        // Convidados
        const conv = data.Convidados || {};
        document.getElementById('convidadosQuadra1').checked = conv.Quadra1 || false;
        document.getElementById('convidadosQuadra2').checked = conv.Quadra2 || false;
        document.getElementById('convidadosQuadra3').checked = conv.Quadra3 || false;
        document.getElementById('convidadosSemana').checked = conv.DiasDeSemana || false;
        document.getElementById('convidadosFimDeSemana').checked = conv.FimDeSemana || false;

        // Piramide
        const pir = data.Piramide || {};
        document.getElementById('piramideAtiva').value = pir.ativa ? 'ON' : 'OFF';
        window.piramideInicioData = pir.inicio || "";
        window.piramideFimData = pir.fim || "";
        
        const q1P = pir["Quadra-1"] || {};
        document.getElementById('piramideQuadra1').checked = q1P["Quadra-1-ativa"] || false;
        document.getElementById('1-piramideSemana').checked = q1P["1-DiasDeSemana"] || false;
        document.getElementById('1-piramideExceto17_19').checked = q1P["1-DiasDeSemana-exceto-17-19"] || false;
        document.getElementById('1-piramideSabado').checked = q1P["1-Sabado"] || false;
        document.getElementById('1-piramideExceto7_12').checked = q1P["1-Sabado-exceto-7-12"] || false;
        document.getElementById('1-piramideDomingo').checked = q1P["1-Domingo"] || false;
        document.getElementById('1-piramideExceto8_12').checked = q1P["1-Domingo-exceto-8-12"] || false;
        
        const q2P = pir["Quadra-2"] || {};
        document.getElementById('piramideQuadra2').checked = q2P["Quadra-2-ativa"] || false;
        document.getElementById('2-piramideSemana').checked = q2P["2-DiasDeSemana"] || false;
        document.getElementById('2-piramideExceto17_19').checked = q2P["2-DiasDeSemana-exceto-17-19"] || false;
        document.getElementById('2-piramideSabado').checked = q2P["2-Sabado"] || false;
        document.getElementById('2-piramideExceto7_12').checked = q2P["2-Sabado-exceto-7-12"] || false;
        document.getElementById('2-piramideDomingo').checked = q2P["2-Domingo"] || false;
        document.getElementById('2-piramideExceto8_12').checked = q2P["2-Domingo-exceto-8-12"] || false;

        const q3P = pir["Quadra-3"] || {};
        document.getElementById('piramideQuadra3').checked = q3P["Quadra-3-ativa"] || false;
        document.getElementById('3-piramideSemana').checked = q3P["3-DiasDeSemana"] || false;
        document.getElementById('3-piramideExceto17_19').checked = q3P["3-DiasDeSemana-exceto-17-19"] || false;
        document.getElementById('3-piramideSabado').checked = q3P["3-Sabado"] || false;
        document.getElementById('3-piramideExceto7_12').checked = q3P["3-Sabado-exceto-7-12"] || false;
        document.getElementById('3-piramideDomingo').checked = q3P["3-Domingo"] || false;
        document.getElementById('3-piramideExceto8_12').checked = q3P["3-Domingo-exceto-8-12"] || false;

        atualizarEstadoPiramide();
        atualizarCamposPiramideQuadra1();
        atualizarCamposPiramideQuadra2();
        atualizarCamposPiramideQuadra3();

        // Duplas
        const dup = data.Duplas || {};
        excecoesDuplas = dup.DatasEspeciais || {};
        document.getElementById('duplasAtiva').value = dup.ativa ? 'ON' : 'OFF';
        document.getElementById('duplasRanking').value = dup.Ranking ? 'ON' : 'OFF';
        atualizarEstadoDuplasRanking();

        for (let i = 1; i <= 3; i++) {
            const k = `Quadra-${i}`;
            const qD = dup[k] || {};
            if (dup[k] && dup[k].DiasDeSemanaConfig) diasSemanaDuplasConfig[k] = dup[k].DiasDeSemanaConfig;
            else diasSemanaDuplasConfig[k] = { segunda: true, terca: true, quarta: true, quinta: true, sexta: true };
            
            document.getElementById(`duplasQuadra${i}Ativa`).checked = qD[`Quadra-${i}-ativa`] || false;
            document.getElementById(`${i}-duplasSemana`).checked = qD[`${i}-DiasDeSemana`] || false;
            document.getElementById(`${i}-duplasSemanaInicio`).value = qD[`${i}-DiasDeSemana-Inicio`] || '';
            document.getElementById(`${i}-duplasSemanaFim`).value = qD[`${i}-DiasDeSemana-Fim`] || '';
            document.getElementById(`${i}-duplasSabado`).checked = qD[`${i}-Sabado`] || false;
            document.getElementById(`${i}-duplasSabadoInicio`).value = qD[`${i}-Sabado-Inicio`] || '';
            document.getElementById(`${i}-duplasSabadoFim`).value = qD[`${i}-Sabado-Fim`] || '';
            document.getElementById(`${i}-duplasDomingo`).checked = qD[`${i}-Domingo`] || false;
            document.getElementById(`${i}-duplasDomingoInicio`).value = qD[`${i}-Domingo-Inicio`] || '';
            document.getElementById(`${i}-duplasDomingoFim`).value = qD[`${i}-Domingo-Fim`] || '';
        }
        
        atualizarEstadoDuplas();
        for(let i=1;i<=3;i++) atualizarCamposDaQuadraDuplas(i);
    }

    function salvarConfiguracoes() {
        const updates = {
            Abrir: document.getElementById('sistema').value === 'ON',
            DiasParaLimpar: 6 - parseInt(document.getElementById('diasParaAgendar').value),
            ReservasPorConfirmacao: document.getElementById('reservasPorConfirmacao').value === 'ON',
            horasParaExpirar: parseInt(document.getElementById('horasParaExpirar').value),
            OrganizadorEdicao: document.getElementById('edicaoOrganizador').value === 'ON',
            OtimizacaoHorarios: {
                ativa: document.getElementById('otimizacaoHorarios').value === 'ON',
                quadras: quebraHorarioQuadrasConfig
            },
            Quadras: {
                Quadra1: document.getElementById('estadoQuadra1').value,
                Quadra2: document.getElementById('estadoQuadra2').value,
                Quadra3: document.getElementById('estadoQuadra3').value,
                Bloqueios: bloqueiosQuadra
            },
            Convidados: {
                DiasDeSemana: document.getElementById('convidadosSemana').checked,
                FimDeSemana: document.getElementById('convidadosFimDeSemana').checked,
                Quadra1: document.getElementById('convidadosQuadra1').checked,
                Quadra2: document.getElementById('convidadosQuadra2').checked,
                Quadra3: document.getElementById('convidadosQuadra3').checked
            },
            Piramide: {
                ativa: document.getElementById('piramideAtiva').value === 'ON',
                inicio: window.piramideInicioData || "",
                fim: window.piramideFimData || "",
                "Quadra-1": {
                    "Quadra-1-ativa": document.getElementById('piramideQuadra1').checked,
                    "1-DiasDeSemana": document.getElementById('1-piramideSemana').checked,
                    "1-DiasDeSemana-exceto-17-19": document.getElementById('1-piramideExceto17_19').checked,
                    "1-Sabado": document.getElementById('1-piramideSabado').checked,
                    "1-Sabado-exceto-7-12": document.getElementById('1-piramideExceto7_12').checked,
                    "1-Domingo": document.getElementById('1-piramideDomingo').checked,
                    "1-Domingo-exceto-8-12": document.getElementById('1-piramideExceto8_12').checked
                },
                "Quadra-2": {
                    "Quadra-2-ativa": document.getElementById('piramideQuadra2').checked,
                    "2-DiasDeSemana": document.getElementById('2-piramideSemana').checked,
                    "2-DiasDeSemana-exceto-17-19": document.getElementById('2-piramideExceto17_19').checked,
                    "2-Sabado": document.getElementById('2-piramideSabado').checked,
                    "2-Sabado-exceto-7-12": document.getElementById('2-piramideExceto7_12').checked,
                    "2-Domingo": document.getElementById('2-piramideDomingo').checked,
                    "2-Domingo-exceto-8-12": document.getElementById('2-piramideExceto8_12').checked
                },
                "Quadra-3": {
                    "Quadra-3-ativa": document.getElementById('piramideQuadra3').checked,
                    "3-DiasDeSemana": document.getElementById('3-piramideSemana').checked,
                    "3-DiasDeSemana-exceto-17-19": document.getElementById('3-piramideExceto17_19').checked,
                    "3-Sabado": document.getElementById('3-piramideSabado').checked,
                    "3-Sabado-exceto-7-12": document.getElementById('3-piramideExceto7_12').checked,
                    "3-Domingo": document.getElementById('3-piramideDomingo').checked,
                    "3-Domingo-exceto-8-12": document.getElementById('3-piramideExceto8_12').checked  
                }
            },
            Duplas: {
                ativa: document.getElementById('duplasAtiva').value === 'ON',
                Ranking: document.getElementById('duplasRanking').value === 'ON',
                "Quadra-1": {
                    "Quadra-1-ativa": document.getElementById('duplasQuadra1Ativa').checked,
                    "1-DiasDeSemana": document.getElementById('1-duplasSemana').checked,
                    "1-DiasDeSemana-Inicio": document.getElementById('1-duplasSemanaInicio').value,
                    "1-DiasDeSemana-Fim": document.getElementById('1-duplasSemanaFim').value,
                    "1-Sabado": document.getElementById('1-duplasSabado').checked,
                    "1-Sabado-Inicio": document.getElementById('1-duplasSabadoInicio').value,
                    "1-Sabado-Fim": document.getElementById('1-duplasSabadoFim').value,
                    "1-Domingo": document.getElementById('1-duplasDomingo').checked,
                    "1-Domingo-Inicio": document.getElementById('1-duplasDomingoInicio').value,
                    "1-Domingo-Fim": document.getElementById('1-duplasDomingoFim').value,
                    ...(document.getElementById('1-duplasSemana').checked && { "DiasDeSemanaConfig": diasSemanaDuplasConfig['Quadra-1'] || { segunda: true, terca: true, quarta: true, quinta: true, sexta: true } }) 
                },
                "Quadra-2": {
                    "Quadra-2-ativa": document.getElementById('duplasQuadra2Ativa').checked,
                    "2-DiasDeSemana": document.getElementById('2-duplasSemana').checked,
                    "2-DiasDeSemana-Inicio": document.getElementById('2-duplasSemanaInicio').value,
                    "2-DiasDeSemana-Fim": document.getElementById('2-duplasSemanaFim').value,
                    "2-Sabado": document.getElementById('2-duplasSabado').checked,
                    "2-Sabado-Inicio": document.getElementById('2-duplasSabadoInicio').value,
                    "2-Sabado-Fim": document.getElementById('2-duplasSabadoFim').value,
                    "2-Domingo": document.getElementById('2-duplasDomingo').checked,
                    "2-Domingo-Inicio": document.getElementById('2-duplasDomingoInicio').value,
                    "2-Domingo-Fim": document.getElementById('2-duplasDomingoFim').value,
                    ...(document.getElementById('2-duplasSemana').checked && { "DiasDeSemanaConfig": diasSemanaDuplasConfig['Quadra-2'] || { segunda: true, terca: true, quarta: true, quinta: true, sexta: true } }) 
                },
                "Quadra-3": {
                    "Quadra-3-ativa": document.getElementById('duplasQuadra3Ativa').checked,
                    "3-DiasDeSemana": document.getElementById('3-duplasSemana').checked,
                    "3-DiasDeSemana-Inicio": document.getElementById('3-duplasSemanaInicio').value,
                    "3-DiasDeSemana-Fim": document.getElementById('3-duplasSemanaFim').value,
                    "3-Sabado": document.getElementById('3-duplasSabado').checked,
                    "3-Sabado-Inicio": document.getElementById('3-duplasSabadoInicio').value,
                    "3-Sabado-Fim": document.getElementById('3-duplasSabadoFim').value,
                    "3-Domingo": document.getElementById('3-duplasDomingo').checked,
                    "3-Domingo-Inicio": document.getElementById('3-duplasDomingoInicio').value,
                    "3-Domingo-Fim": document.getElementById('3-duplasDomingoFim').value,
                    ...(document.getElementById('3-duplasSemana').checked && { "DiasDeSemanaConfig": diasSemanaDuplasConfig['Quadra-3'] || { segunda: true, terca: true, quarta: true, quinta: true, sexta: true } }) 
                },
                DatasEspeciais: excecoesDuplas 
            }
        };

        db.ref("sistemas/config").update(updates)
            .then(() => mostrarNotificacao("Configurações salvas com sucesso!", 'success'))
			.catch(error => { console.error(error); mostrarNotificacao("Erro ao salvar.", 'error'); });
    }

    // --- FUNÇÕES DE HORÁRIO ---
function abrirGerenciadorHorarios(tipo) {
        const select = document.getElementById('tipoConfiguracaoHorario');
        
        if (tipo === 'padrao') {
            renderizarTabelaPadrao();
            document.getElementById('modalHorarioPadrao').style.display = 'flex';
        } 
        else if (tipo === 'especial') {
            // === RESET COMPLETO DA TELA ESPECIAL ===
            
            // 1. Limpa variáveis de controle
            periodoEmEdicaoID = null;

            // 2. Reseta o Dropdown Principal
            atualizarDropdownPeriodos();
            document.getElementById('selectPeriodoEspecial').value = ""; 

            // 3. Limpa todos os Inputs de texto e datas
            document.getElementById('nomePeriodo').value = '';
            document.getElementById('dataInicioPeriodo').value = '';
            document.getElementById('dataFimPeriodo').value = '';
            
            // 4. Reseta os Inputs de Horário do Painel Amarelo para o padrão
            document.getElementById('regraMestraInicio').value = '08:00';
            document.getElementById('regraMestraFim').value = '17:00';
            
            // 5. Limpa a Lista de Dias (Remove os dias gerados anteriormente)
            const containerDias = document.getElementById('containerListaDiasEspeciais');
            containerDias.innerHTML = '<p style="text-align: center; color: #999; margin-top: 30px; font-style: italic;">Defina as datas acima e clique em <b>"Gerar / Atualizar Dias"</b>.</p>';
            
            // 6. Reseta o botão de Tela Cheia (Esconde e volta ao normal se estiver expandido)
            atualizarVisibilidadeBotaoExpandir();
            const modalEspecial = document.getElementById('modalHorarioEspecial');
            if(modalEspecial.classList.contains('modo-foco')) {
                alternarTelaCheiaEspecial(); // Sai do modo tela cheia se estiver nele
            }

            // 7. Trava o formulário (Estado Inicial: Cinza e Bloqueado)
            alternarEstadoFormulario(false);

            // 8. Finalmente, abre a janela
            modalEspecial.style.display = 'flex';
        }
        else if (tipo === 'aulas') {
            // Carrega os dados do banco para a memória local
            if (horariosGlobal && horariosGlobal.Aulas) {
                configAulasGlobal = horariosGlobal.Aulas;
            }
            ['Quadra1', 'Quadra2', 'Quadra3'].forEach(q => {
                if (!configAulasGlobal[q]) configAulasGlobal[q] = { Ativo: false, Professor: '', Grade: {} };
            });
			
			
            document.getElementById('modalHorarioAulas').style.display = 'flex';
            selecionarQuadraAula('Quadra1', true);
        }
        
        select.value = ""; // Reseta o dropdown principal da página
    }



// 2. Função de Estado do Formulário (Lógica centralizada)
function alternarEstadoFormulario(ativo, modoCriacao = false) {
    const divForm = document.getElementById('formPeriodoEspecial');
    const btnSalvar = document.getElementById('btnSalvarEspecial'); 
    const btnExcluir = document.getElementById('btnExcluirPeriodo');
    const btnGerar = document.getElementById('btnGerarDias'); 

    // 1. Bloqueia/Desbloqueia campos internos
    const elementos = divForm.querySelectorAll('input, select');
    elementos.forEach(el => el.disabled = !ativo);

    // 2. Visual do Formulário
    divForm.style.opacity = ativo ? '1' : '0.4';
    divForm.style.pointerEvents = ativo ? 'auto' : 'none';

    // 3. Lógica do Botão GERAR / ATUALIZAR DIAS (Melhoria Visual)
    if (btnGerar) {
        btnGerar.disabled = !ativo;
        if (ativo) {
            // ATIVO: Amarelo, com borda escura e sombra (Visual de Botão)
            btnGerar.style.backgroundColor = '#ffc107'; 
            btnGerar.style.color = '#000000';
            btnGerar.style.cursor = 'pointer';
            btnGerar.style.border = '1px solid #d39e00'; // Borda definida
            btnGerar.style.boxShadow = '0 2px 4px rgba(0,0,0,0.2)'; // Sombra 3D
            btnGerar.style.borderRadius = '4px'; // Cantos arredondados
        } else {
            // TRAVADO: Cinza e chapado (sem sombra)
            btnGerar.style.backgroundColor = '#cccccc';
            btnGerar.style.color = '#666666';
            btnGerar.style.cursor = 'not-allowed';
            btnGerar.style.border = '1px solid #999999';
            btnGerar.style.boxShadow = 'none'; // Remove a profundidade
        }
    }

    // 4. Lógica do Botão EXCLUIR
    if (btnExcluir) {
        btnExcluir.style.display = 'block'; 
        const deveDesabilitar = (!ativo || modoCriacao);
        btnExcluir.disabled = deveDesabilitar;
        
        if (deveDesabilitar) {
            btnExcluir.style.backgroundColor = '#cccccc';
            btnExcluir.style.cursor = 'not-allowed';
        } else {
            btnExcluir.style.backgroundColor = '#dc3545';
            btnExcluir.style.cursor = 'pointer';
        }
    }

    // 5. Lógica do Botão SALVAR
    if (btnSalvar && !ativo) {
        btnSalvar.disabled = true;
        btnSalvar.style.backgroundColor = '#cccccc';
        btnSalvar.style.cursor = 'not-allowed';
    }
}




// Função 1: Acorda o botão (Fica Verde) quando você mexe na tela
    function monitorarAlteracoesParaSalvar() {
        // CORREÇÃO: Agora olhamos para os dois containers (Formulário Superior e Lista de Dias)
        // Isso garante que alterações na lista ativem o botão, independente do modo de tela
        const containers = [
            document.getElementById('formPeriodoEspecial'),
            document.getElementById('containerListaDiasEspeciais')
        ];
        
        const btnSalvar = document.getElementById('btnSalvarEspecial');
        
        const habilitar = () => {
            if (btnSalvar) {
                btnSalvar.disabled = false;
                btnSalvar.style.backgroundColor = '#28a745'; // FICA VERDE
                btnSalvar.style.cursor = 'pointer'; 
            }
        };

        // Adiciona os vigias em ambos os lugares
        containers.forEach(div => {
            if (div) {
                // Monitora inputs e selects
                const inputs = div.querySelectorAll('input, select');
                inputs.forEach(input => {
                    // Removemos ouvintes antigos para não duplicar e adicionamos os novos
                    input.removeEventListener('input', habilitar);
                    input.removeEventListener('change', habilitar);
                    input.addEventListener('input', habilitar);
                    input.addEventListener('change', habilitar);
                });
            }
        });
    }
	
	

// Função 2: Carrega a tela e RESETA o botão para Cinza
function carregarPeriodoEspecial(id) {
    if (!id) return;

    const isNovo = (id === 'novo');
    
    // Configura o formulário (Habilita campos se for novo ou edição)
    alternarEstadoFormulario(true, isNovo);

    periodoEmEdicaoID = isNovo ? null : id;
    const containerDias = document.getElementById('containerListaDiasEspeciais');

    if (isNovo) {
        // Modo NOVO: Limpa tudo para começar do zero
        document.getElementById('nomePeriodo').value = '';
        document.getElementById('dataInicioPeriodo').value = '';
        document.getElementById('dataFimPeriodo').value = '';
        document.getElementById('periodoAtivo').checked = true;
        
        // Reseta os horários do painel amarelo
        document.getElementById('regraMestraInicio').value = '08:00';
        document.getElementById('regraMestraFim').value = '17:00';
        
        // Limpa a lista de dias
        containerDias.innerHTML = '<p style="text-align: center; color: #999; margin-top: 30px;">Defina as datas e clique em <b>"Gerar / Atualizar Dias"</b>.</p>';
        
        atualizarVisibilidadeBotaoExpandir();
        
        // Foca no campo de nome
		setTimeout(() => document.getElementById('nomePeriodo').focus(), 100);
    } else {
        // Modo EDIÇÃO: Carrega os dados salvos
        const p = horariosGlobal.Especiais[id];
        document.getElementById('nomePeriodo').value = p.titulo;
        document.getElementById('dataInicioPeriodo').value = p.inicio;
        document.getElementById('dataFimPeriodo').value = p.fim;
        document.getElementById('periodoAtivo').checked = p.ativo;
        
        renderizarListaDias(p.dias);
    }

    // RESET FINAL: Garante que o botão Salvar comece CINZA (desabilitado)
    // pois acabamos de carregar e o usuário ainda não mexeu em nada.
    const btnSalvar = document.getElementById('btnSalvarEspecial');
    if (btnSalvar) {
        btnSalvar.disabled = true;
        btnSalvar.style.backgroundColor = '#cccccc'; 
        btnSalvar.style.cursor = 'not-allowed';
    }

    // --- ATUALIZA A COR DO TEXTO (Verde/Vermelho) ---
    atualizarCorPeriodoAtivo();

    // Inicia o monitoramento: Qualquer alteração a partir de agora acenderá o botão Salvar
    monitorarAlteracoesParaSalvar();
}



function fecharModalHorario(tipo) {
    if (tipo === 'padrao') document.getElementById('modalHorarioPadrao').style.display = 'none';
    else if (tipo === 'especial') document.getElementById('modalHorarioEspecial').style.display = 'none';
    else if (tipo === 'aulas') document.getElementById('modalHorarioAulas').style.display = 'none';
}


function renderizarTabelaPadrao() {
    const tbody = document.getElementById('tbodyHorarioPadrao');
    tbody.innerHTML = '';
    const diasSemana = ['Segunda', 'Terça', 'Quarta', 'Quinta', 'Sexta', 'Sábado', 'Domingo'];
    const padraoDB = horariosGlobal.Padrao || {};

    for (let i = 1; i <= 7; i++) {
        let defAbertura = '06:00';
        let defFechamento = '23:00';
        let defStatus = 'aberto';

        if (i === 6) { // Sábado
            defAbertura = '07:00';
            defFechamento = '21:00';
        }
        if (i === 7) { // Domingo
            defAbertura = '08:00';
            defFechamento = '17:00';
        }

        const configDia = padraoDB[i] || { status: defStatus, abertura: defAbertura, fechamento: defFechamento };
        
        // Verifica se está fechado para aplicar a cor
        const isFechado = configDia.status === 'fechado';
        const classeLinha = isFechado ? 'fechado-padrao' : '';

        const tr = document.createElement('tr');
        // Adicionamos um ID na linha (TR) para acharmos ela fácil depois
        tr.id = `tr_padrao_${i}`;
        tr.className = classeLinha;

        tr.innerHTML = `
            <td>${diasSemana[i-1]}</td>
            <td>
                <select id="padrao_status_${i}" onchange="toggleInputsPadrao(${i})" style="width: 100px;">
                    <option value="aberto" ${!isFechado ? 'selected' : ''}>Aberto</option>
                    <option value="fechado" ${isFechado ? 'selected' : ''}>Fechado</option>
                </select>
            </td>
            <td><input type="time" id="padrao_inicio_${i}" value="${configDia.abertura}" ${isFechado ? 'disabled' : ''}></td>
            <td><input type="time" id="padrao_fim_${i}" value="${configDia.fechamento}" ${isFechado ? 'disabled' : ''}></td>
        `;
        tbody.appendChild(tr); 
    }
}

function toggleInputsPadrao(diaIdx) {
    const status = document.getElementById(`padrao_status_${diaIdx}`).value;
    const disabled = status === 'fechado';
    
    // 1. Trava/Destrava os campos
    document.getElementById(`padrao_inicio_${diaIdx}`).disabled = disabled;
    document.getElementById(`padrao_fim_${diaIdx}`).disabled = disabled;

    // 2. Muda a cor da linha (Pega a TR pelo ID que criamos)
    const linha = document.getElementById(`tr_padrao_${diaIdx}`);
    if (disabled) {
        linha.classList.add('fechado-padrao');
    } else {
        linha.classList.remove('fechado-padrao');
    }
}



    function salvarHorarioPadrao() {
        const novoPadrao = {};
        for (let i = 1; i <= 7; i++) {
            novoPadrao[i] = {
                status: document.getElementById(`padrao_status_${i}`).value,
                abertura: document.getElementById(`padrao_inicio_${i}`).value,
                fechamento: document.getElementById(`padrao_fim_${i}`).value
            };
        }
        db.ref("sistemas/config/Horarios/Padrao").set(novoPadrao)
            .then(() => { mostrarNotificacao("Horário Padrão salvo!", 'success'); fecharModalHorario('padrao'); })
			.catch(err => mostrarNotificacao("Erro ao salvar: " + err, 'error'));
    }

    function actualizarDropdownPeriodos() { // Alias para o nome correto
        atualizarDropdownPeriodos();
    }

function atualizarDropdownPeriodos() {
    const select = document.getElementById('selectPeriodoEspecial');
    // Adiciona a opção neutra (placeholder) no início
    select.innerHTML = '<option value="" disabled selected hidden>Selecione uma ação...</option><option value="novo">+ Criar Novo Período...</option>';
    
    const especiais = horariosGlobal.Especiais || {};
    Object.keys(especiais).forEach(id => {
        const p = especiais[id];
        const option = document.createElement('option');
        option.value = id;
        option.textContent = `${p.titulo} (${formatarData(p.inicio)} - ${formatarData(p.fim)})`;
        select.appendChild(option);
    });
}


function gerarListaDias() {
    const inicio = document.getElementById('dataInicioPeriodo').value;
    const fim = document.getElementById('dataFimPeriodo').value;
    const mStatus = document.getElementById('regraMestraStatus').value;
    const mInicio = document.getElementById('regraMestraInicio').value;
    const mFim = document.getElementById('regraMestraFim').value;
    
    if (!inicio || !fim) return mostrarNotificacao("Defina as datas de Início e Fim.", 'warning');
    
    const diasObj = {};
    let atual = new Date(inicio + "T00:00:00");
    const dataFim = new Date(fim + "T00:00:00");
    const existente = (periodoEmEdicaoID && horariosGlobal.Especiais[periodoEmEdicaoID]) ? horariosGlobal.Especiais[periodoEmEdicaoID].dias : {};
    
    while (atual <= dataFim) {
        const dataStr = atual.toISOString().split('T')[0];
        diasObj[dataStr] = existente[dataStr] || { status: mStatus, abertura: mInicio, fechamento: mFim };
        atual.setDate(atual.getDate() + 1);
    }
    renderizarListaDias(diasObj);
}

function renderizarListaDias(diasObj) {
    const container = document.getElementById('containerListaDiasEspeciais');
    container.innerHTML = '';
    
    if (!diasObj) return;
    
    const datasOrdenadas = Object.keys(diasObj).sort();
    
    datasOrdenadas.forEach(data => {
        const config = diasObj[data];
        const div = document.createElement('div');
        
        // Define classe se estiver fechado
        div.className = `linha-dia-especial ${config.status === 'fechado' ? 'fechado' : ''}`;
        div.dataset.data = data;
        
        // CÁLCULO DAS DATAS (Normal vs Curta)
        const dateParts = data.split('-'); // [aaaa, mm, dd]
        const anoCompleto = dateParts[0];
        const anoCurto = dateParts[0].slice(2); // Pega só os 2 últimos dígitos
        const mes = dateParts[1];
        const dia = dateParts[2];
        
        const diaSemana = ['Dom','Seg','Ter','Qua','Qui','Sex','Sáb'][new Date(data + "T00:00:00").getDay()];
        
        // Criação das strings visuais
        const textoDesktop = `${dia}/${mes}/${anoCompleto} (${diaSemana})`;
        const textoMobile  = `${dia}/${mes}/${anoCurto} (${diaSemana})`;

        div.innerHTML = `
            <div class="dia-label">
                <span class="view-desktop">${textoDesktop}</span>
                <span class="view-mobile" style="display:none;">${textoMobile}</span>
            </div>
            
            <select class="status-dia" onchange="atualizarLinhaDia(this)">
                <option value="aberto" ${config.status === 'aberto' ? 'selected' : ''}>Aberto</option>
                <option value="fechado" ${config.status === 'fechado' ? 'selected' : ''}>Fechado</option>
            </select>
            
            <input type="time" class="inicio-dia" value="${config.abertura}" ${config.status === 'fechado' ? 'disabled' : ''}> 
            
            <span class="separador-hora">às</span>
            
            <input type="time" class="fim-dia" value="${config.fechamento}" ${config.status === 'fechado' ? 'disabled' : ''}>
        `;
        container.appendChild(div);
    });
	atualizarVisibilidadeBotaoExpandir();
}


    window.atualizarLinhaDia = function(select) {
        const linha = select.closest('.linha-dia-especial');
        const inputs = linha.querySelectorAll('input[type="time"]');
        if (select.value === 'fechado') { linha.classList.add('fechado'); inputs.forEach(i => i.disabled = true); }
        else { linha.classList.remove('fechado'); inputs.forEach(i => i.disabled = false); }
    };



function salvarPeriodoEspecial() {
    const titulo = document.getElementById('nomePeriodo').value.trim();
    const inicio = document.getElementById('dataInicioPeriodo').value;
    const fim = document.getElementById('dataFimPeriodo').value;
    
    if (!titulo || !inicio || !fim) return mostrarNotificacao("Preencha Nome e Datas.", 'warning');
    
    const linhas = document.querySelectorAll('.linha-dia-especial');
    if (linhas.length === 0) return mostrarNotificacao("Gere a lista de dias antes de salvar.", 'warning');
    
    const diasObj = {};
    linhas.forEach(linha => {
        diasObj[linha.dataset.data] = {
            status: linha.querySelector('.status-dia').value,
            abertura: linha.querySelector('.inicio-dia').value,
            fechamento: linha.querySelector('.fim-dia').value
        };
    });

    const novoID = periodoEmEdicaoID || `especial_${Date.now()}`;
    
    db.ref(`sistemas/config/Horarios/Especiais/${novoID}`).set({
        titulo: titulo, 
        ativo: document.getElementById('periodoAtivo').checked, 
        inicio: inicio, 
        fim: fim, 
        dias: diasObj
    }).then(() => { 
        mostrarNotificacao("Período Especial salvo com sucesso!", 'success'); 
        atualizarDropdownPeriodos(); // Atualiza a lista lá em cima
        fecharModalHorario('especial'); // <--- O PULO DO GATO: FECHA A JANELA
    }).catch(error => {
        mostrarNotificacao("Erro ao salvar: " + error.message, 'error');
    });
}


function excluirPeriodoSelecionado() {
    // Segurança: se não tiver ID selecionado, para tudo.
    if (!periodoEmEdicaoID) return mostrarNotificacao("Nenhum período selecionado para exclusão.", 'warning');

    // Busca os dados do período atual para mostrar o nome na mensagem
    const periodo = horariosGlobal.Especiais[periodoEmEdicaoID];
    const nomeDoPeriodo = periodo ? periodo.titulo : "este período";

    // Cria uma mensagem de confirmação detalhada
    const mensagem = `⚠️ ATENÇÃO: EXCLUSÃO DE PERÍODO<br><br>` +
                     `Você tem certeza que deseja excluir permanentemente o período:<br>` +
                     `"<b>${nomeDoPeriodo}</b>"?<br><br>` +
                     `Todos os dias configurados dentro dele serão removidos.`;

    // Pergunta final
    mostrarConfirmacao(mensagem, () => {
        db.ref(`sistemas/config/Horarios/Especiais/${periodoEmEdicaoID}`).remove()
            .then(() => { 
                mostrarNotificacao("Período excluído com sucesso!", 'success'); 
                
                // Limpa a tela e volta ao estado inicial
                abrirGerenciadorHorarios('especial'); 
            })
            .catch(error => {
                mostrarNotificacao("Erro ao excluir: " + error.message, 'error');
            });
    });
}


    function formatarData(d) { if(!d) return ""; return d.split('-').reverse().join('/'); }

    // Helpers Gerais
    function showTab(id) {
        document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('tab-content-active'));
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        document.getElementById(id).classList.add('tab-content-active');
        const tabBtns = document.querySelectorAll('.tab');
        if(id==='reservas') tabBtns[0].classList.add('active');
        if(id==='duplas') tabBtns[1].classList.add('active');
        if(id==='convidados') tabBtns[2].classList.add('active');
        if(id==='piramide') tabBtns[3].classList.add('active');
        if(id==='piramide') mostrarQuadra('quadra1');
        if(id==='duplas') mostrarDuplasQuadra('quadra1');
        if(id==='reservas') { atualizarEstadoConfirmacao(); atualizarEstadoEdicaoOrganizador(); atualizarVisualOtimizacao(); }
    }
    
    function atualizarEstadoSistema() { const s = document.getElementById('sistema'); s.className = s.value === 'ON' ? 'on' : 'off'; }
    function atualizarEstadoPiramide() {
        const sel = document.getElementById('piramideAtiva');
        sel.className = sel.value === 'ON' ? 'piramide-on' : 'piramide-off';
        const els = document.querySelectorAll('#piramide input, #piramide button');
        els.forEach(el => el.disabled = sel.value !== 'ON');
        document.getElementById('piramideInicio').style.display = sel.value==='ON'?'inline':'none';
        document.getElementById('piramideFim').style.display = sel.value==='ON'?'inline':'none';
        document.getElementById('piramideSeparador').style.display = sel.value==='ON'?'inline':'none';
        if(sel.value==='ON') { 
            document.getElementById('piramideInicio').textContent = formatarData(window.piramideInicioData);
            document.getElementById('piramideFim').textContent = formatarData(window.piramideFimData);
            atualizarCamposPiramideQuadra1(); atualizarCamposPiramideQuadra2(); atualizarCamposPiramideQuadra3();
        }
        sel.disabled = false;
    }
    


// --- NOVA LÓGICA PIRÂMIDE (MODERNA) ---

function handlePiramideChange() {
    const val = document.getElementById("piramideAtiva").value;
    
    if(val === 'ON') {
        // Consulta o banco para ver se já existem datas salvas
        db.ref('sistemas/config/Piramide').once('value', s => {
            const c = s.val() || {};
            
            if(c.inicio && c.fim) {
                // Se existirem, pergunta se quer usar elas
                mostrarConfirmacao(`Datas salvas encontradas: <b>${c.inicio} a ${c.fim}</b>.<br>Deseja mantê-las?`, 
                    () => { 
                        // SIM: Usa as datas do banco
                        window.piramideInicioData = c.inicio; 
                        window.piramideFimData = c.fim; 
                        atualizarEstadoPiramide();
                    },
                    () => { 
                        // NÃO: Pergunta novas datas
                        // (Aqui usamos um pequeno delay para não sobrepor janelas)
                        setTimeout(() => iniciarFluxoDatasPiramide(), 200);
                    }
                );
            } else {
                // Se não existirem datas, pede para digitar
                iniciarFluxoDatasPiramide();
            }
        });
    } else {
        // Se desligou (OFF)
        if(window.piramideInicioData) {
            mostrarConfirmacao("Deseja apagar as datas salvas da memória temporária?", () => {
                window.piramideInicioData = ""; 
                window.piramideFimData = "";
                atualizarEstadoPiramide();
            });
        }
        atualizarEstadoPiramide();
    }
}

// Função auxiliar que pede as datas (Substitui os Prompts antigos)
function iniciarFluxoDatasPiramide() {
    // 1. Pede a Data Inicial
    mostrarInput("Configurar Pirâmide", "Digite a <b>Data de Início</b> (dd-mm-aaaa):", "Ex: 01-01-2024", (inicio) => {
        
        // Validação da Data Inicial
        if(!/^\d{2}-\d{2}-\d{4}$/.test(inicio)) {
            mostrarNotificacao("Formato de data inválido. Use dia-mês-ano (ex: 01-01-2024).", 'error');
            document.getElementById("piramideAtiva").value = "OFF";
            return;
        }
        
        // 2. Pede a Data Final (dentro do "OK" da primeira)
        setTimeout(() => {
            mostrarInput("Configurar Pirâmide", "Digite a <b>Data de Fim</b> (dd-mm-aaaa):", "Ex: 30-06-2024", (fim) => {
                
                // Validação da Data Final
                if(!/^\d{2}-\d{2}-\d{4}$/.test(fim)) {
                    mostrarNotificacao("Formato de data inválido.", 'error');
                    document.getElementById("piramideAtiva").value = "OFF";
                    return;
                }
                
                // Sucesso! Salva na memória e atualiza a tela
                window.piramideInicioData = inicio;
                window.piramideFimData = fim;
                atualizarEstadoPiramide();
                mostrarNotificacao("Datas da Pirâmide definidas com sucesso!", 'success');
            });
        }, 300); // Delay para transição suave entre janelas
    });
}

	
	
    
    function atualizarCamposPiramideQuadra1() { updatePiramideQ('1'); }
    function atualizarCamposPiramideQuadra2() { updatePiramideQ('2'); }
    function atualizarCamposPiramideQuadra3() { updatePiramideQ('3'); }
    function updatePiramideQ(n) {
        const isOn = document.getElementById('piramideAtiva').value === 'ON';
        const qOn = document.getElementById(`piramideQuadra${n}`).checked;
        const ctr = document.getElementById(`piramideQuadra${n}Container`);
        ctr.querySelectorAll('input').forEach(i => i.disabled = !isOn || !qOn);
        document.getElementById(`piramideQuadra${n}`).disabled = !isOn;
        // Logic for checkboxes dependency
        const sem = document.getElementById(`${n}-piramideSemana`); const excSem = document.getElementById(`${n}-piramideExceto17_19`);
        if(sem && excSem) excSem.disabled = !isOn || !qOn || !sem.checked;
        const sab = document.getElementById(`${n}-piramideSabado`); const excSab = document.getElementById(`${n}-piramideExceto7_12`);
        if(sab && excSab) excSab.disabled = !isOn || !qOn || !sab.checked;
        const dom = document.getElementById(`${n}-piramideDomingo`); const excDom = document.getElementById(`${n}-piramideExceto8_12`);
        if(dom && excDom) excDom.disabled = !isOn || !qOn || !dom.checked;
    }

    function atualizarEstadoDuplas() {
        const sel = document.getElementById('duplasAtiva');
        sel.className = sel.value === 'ON' ? 'duplas-on' : 'duplas-off';
        const tab = document.getElementById('duplas');
        tab.querySelectorAll('input, button').forEach(e => e.disabled = sel.value !== 'ON');
        for(let i=1;i<=3;i++) {
            const l = document.getElementById(`DuplasDiasQuadra${i}`);
            if(l) l.classList.toggle('disabled', sel.value !== 'ON');
        }
        sel.disabled = false;
        atualizarCamposDaQuadraDuplas(1); atualizarCamposDaQuadraDuplas(2); atualizarCamposDaQuadraDuplas(3);
    }
    function atualizarCamposDaQuadraDuplas(n) {
        const on = document.getElementById('duplasAtiva').value === 'ON';
        const qOn = document.getElementById(`duplasQuadra${n}Ativa`).checked;
        const lbl = document.getElementById(`DuplasDiasQuadra${n}`);
        if(lbl) lbl.classList.toggle('disabled', !on || !qOn);
        ['Semana','Sabado','Domingo'].forEach(d => {
            const cb = document.getElementById(`${n}-duplas${d}`);
            if(cb) {
                cb.disabled = !on || !qOn;
                const ctr = cb.closest('.duplas-day-container');
                ctr.querySelectorAll('.horario-input').forEach(i => i.disabled = !on || !qOn || !cb.checked);
            }
        });
        const semLbl = document.querySelector(`#duplasQuadra${n}Container .dias-semana-label-clickable`);
        if(semLbl) semLbl.style.cursor = (on && qOn && document.getElementById(`${n}-duplasSemana`).checked) ? 'pointer' : 'default';
    }
    function abrirModalDiasSemana(n) {
        quadraAtualParaDiasSemana = n;
        document.getElementById('modalDiasSemanaTitulo').innerText = document.querySelector(`#duplasQuadra${n}Container span`).innerText;
        const c = diasSemanaDuplasConfig[`Quadra-${n}`] || { segunda: true, terca: true, quarta: true, quinta: true, sexta: true };
        document.getElementById('duplas-segunda').checked = c.segunda; document.getElementById('duplas-terca').checked = c.terca;
        document.getElementById('duplas-quarta').checked = c.quarta; document.getElementById('duplas-quinta').checked = c.quinta;
        document.getElementById('duplas-sexta').checked = c.sexta;
        document.getElementById('modalDiasSemanaDuplas').style.display = 'flex';
    }
    function fecharModalDiasSemana() { document.getElementById('modalDiasSemanaDuplas').style.display = 'none'; }
 

function salvarModalDiasSemana() {
    if(!quadraAtualParaDiasSemana) return;
    diasSemanaDuplasConfig[`Quadra-${quadraAtualParaDiasSemana}`] = {
        segunda: document.getElementById('duplas-segunda').checked, terca: document.getElementById('duplas-terca').checked,
        quarta: document.getElementById('duplas-quarta').checked, quinta: document.getElementById('duplas-quinta').checked,
        sexta: document.getElementById('duplas-sexta').checked
    };
    mostrarNotificacao('Dias da semana atualizados! Clique em Salvar Configurações no final.', 'success');
    fecharModalDiasSemana();
}

	
    db.ref("sistemas/usuariosOnline").on("value", s => {
        const n = s.numChildren(); document.getElementById('usuariosOnline').value = n.toString().padStart(3,'0');
        listaUsuariosOnline=[]; s.forEach(c => listaUsuariosOnline.push(c.val().usuario));
    });
	
    document.getElementById('usuariosOnline').addEventListener('click', () => {
        const msg = listaUsuariosOnline.length ? `<b>Usuários:</b><br>${listaUsuariosOnline.join("<br>")}` : "Ninguém online.";
        mostrarNotificacao(msg, 'info');
    });

    function mostrarQuadra(q) {
        ['1','2','3'].forEach(n => document.getElementById(`piramideQuadra${n}Container`).style.display = `quadra${n}`===q ? 'block' : 'none');
        document.querySelectorAll('.piramide-botao').forEach(b => b.classList.remove('ativo'));
        document.querySelector(`.piramide-botao[onclick="mostrarQuadra('${q}')"]`).classList.add('ativo');
    }
    function mostrarDuplasQuadra(q) {
        ['1','2','3'].forEach(n => document.getElementById(`duplasQuadra${n}Container`).style.display = `quadra${n}`===q ? 'block' : 'none');
        document.querySelectorAll('.duplas-botao').forEach(b => b.classList.remove('ativo'));
        document.querySelector(`.duplas-botao[onclick="mostrarDuplasQuadra('${q}')"]`).classList.add('ativo');
    }

    // Exceções e Bloqueios
    async function abrirModalExcecao(n) {
        if(!document.getElementById('duplasAtiva').value==='ON' || !document.getElementById(`duplasQuadra${n}Ativa`).checked) return;
        if(!vlimparExcecoesAntigas) { await limparExcecoesAntigas(); vlimparExcecoesAntigas=true; }
        quadraAtualParaExcecao = n;
        renderizarExcecoes(n);
        document.getElementById('modalDatasEspeciais').style.display = 'flex';
    }
    function fecharModalExcecao() { document.getElementById('modalDatasEspeciais').style.display = 'none'; }
    function renderizarExcecoes(n) {
        const div = document.getElementById('listaExcecoes'); div.innerHTML='';
        const k = `Quadra-${n}`; const ex = excecoesDuplas[k] || {};
        if(Object.keys(ex).length===0) { div.innerHTML='<p>Nenhuma exceção.</p>'; return; }
        const ul = document.createElement('ul');
        Object.keys(ex).sort().forEach(d => {
            const li = document.createElement('li');
            li.innerHTML = `<div><div><strong>${formatarData(d)}</strong></div><div style="font-size:0.9em;color:#666">${ex[d].descricao||''}</div><div>${ex[d].regras.inicio}-${ex[d].regras.fim}</div></div><button class="btn-remover" onclick="removerExcecao('${k}','${d}')">X</button>`;
            ul.appendChild(li);
        });
        div.appendChild(ul);
    }
	
	
function adicionarExcecao() {
    const desc=document.getElementById('excecaoDescricao').value;
    const d=document.getElementById('excecaoData').value;
    const i=document.getElementById('excecaoInicio').value;
    const f=document.getElementById('excecaoFim').value;
    
    if(!d||!i||!f) return mostrarNotificacao("Preencha Data, Início e Fim.", 'warning');
    
    const dp = d.replace(/-/g,'/'); 
    if(!/^\d{2}\/\d{2}\/\d{4}$/.test(dp)) return mostrarNotificacao("Data inválida.", 'error');
    
    const p = dp.split('/'); const dbDate = `${p[2]}-${p[1]}-${p[0]}`;
    const k = `Quadra-${quadraAtualParaExcecao}`;
    
    db.ref().update({
        [`sistemas/config/Duplas/DatasEspeciais/${k}/${dbDate}`]: { descricao:desc, regras:{inicio:i,fim:f} },
        [`sistemas/config/Duplas/${k}/${k}-ativa`]: true
    }).then(()=>{ 
        mostrarNotificacao("Exceção adicionada!", 'success');
        renderizarExcecoes(quadraAtualParaExcecao); 
    });
}
	
	
function removerExcecao(k, d) { 
    mostrarConfirmacao("Deseja remover esta exceção?", () => {
        db.ref(`sistemas/config/Duplas/DatasEspeciais/${k}/${d}`).remove();
        mostrarNotificacao("Exceção removida.", 'success');
    });
}
    
    async function abrirModalBloqueio(n) {
        if(!vlimparBloqueiosAntigos) { await limparBloqueiosAntigos(); vlimparBloqueiosAntigos=true; }
        quadraAtualParaBloqueio = n; renderizarBloqueios(n);
        document.getElementById('modalBloqueioQuadra').style.display = 'flex';
    }
    function fecharModalBloqueio() { document.getElementById('modalBloqueioQuadra').style.display = 'none'; }
    function renderizarBloqueios(n) {
        const div = document.getElementById('listaBloqueios'); div.innerHTML='';
        const k = `Quadra-${n}`; const bl = bloqueiosQuadra[k] || {};
        if(Object.keys(bl).length===0) { div.innerHTML='<p>Nenhum bloqueio.</p>'; return; }
        const ul = document.createElement('ul');
        Object.keys(bl).sort().forEach(d => {
            const li = document.createElement('li');
            li.innerHTML = `<div><div><strong>${formatarData(d)}</strong></div><div style="font-size:0.9em;color:#666">${bl[d].descricao||''}</div><div>${bl[d].regras.inicio}-${bl[d].regras.fim}</div></div><button class="btn-remover" onclick="removerBloqueio('${k}','${d}')">X</button>`;
            ul.appendChild(li);
        });
        div.appendChild(ul);
    }
	
	
function adicionarBloqueio() {
    const desc=document.getElementById('bloqueioDescricao').value; 
    const d=document.getElementById('bloqueioData').value;
    const i=document.getElementById('bloqueioInicio').value; 
    const f=document.getElementById('bloqueioFim').value;
    
    if(!d||!i||!f) return mostrarNotificacao("Preencha tudo.", 'warning');
    
    const dp = d.replace(/-/g,'/'); 
    if(!/^\d{2}\/\d{2}\/\d{4}$/.test(dp)) return mostrarNotificacao("Data inválida.", 'error');
    
    const p = dp.split('/'); const dbDate = `${p[2]}-${p[1]}-${p[0]}`;
    const k = `Quadra-${quadraAtualParaBloqueio}`;
    
    if(bloqueiosQuadra[k] && bloqueiosQuadra[k][dbDate]) return mostrarNotificacao("Já existe bloqueio nesta data.", 'error');
    
    bloqueiosQuadra[k] = bloqueiosQuadra[k] || {};
    bloqueiosQuadra[k][dbDate] = { descricao:desc, regras:{inicio:i,fim:f} };
    
    mostrarNotificacao("Bloqueio adicionado (Temp). Salve as configurações.", 'success');
    document.getElementById('bloqueioDescricao').value=''; document.getElementById('bloqueioData').value='';
    renderizarBloqueios(quadraAtualParaBloqueio);
}
	
	
function removerBloqueio(k, d) { 
    mostrarConfirmacao("Remover este bloqueio?", () => {
        delete bloqueiosQuadra[k][d]; 
        renderizarBloqueios(quadraAtualParaBloqueio); 
        mostrarNotificacao("Removido (Temp). Salve as configurações.", 'success');
    });
}
    
    function limparExcecoesAntigas() { return limparAntigos(excecoesDuplas, 'Duplas/DatasEspeciais'); }
    function limparBloqueiosAntigos() { return limparAntigos(bloqueiosQuadra, 'Quadras/Bloqueios'); }
    function limparAntigos(obj, pathMid) {
        const d7 = new Date(); d7.setDate(d7.getDate()-7); d7.setHours(0,0,0,0);
        const up = {};
        for(const k in obj) {
            for(const d in obj[k]) {
                if(new Date(d+'T00:00:00') < d7) up[`sistemas/config/${pathMid}/${k}/${d}`] = null;
            }
        }
        return Object.keys(up).length ? db.ref().update(up) : Promise.resolve();
    }


function handleEstadoQuadraChange(el, n) {
    if(el.oldValue==='bloqueada' && el.value!=='bloqueada' && bloqueiosQuadra[`Quadra-${n}`]) {
        mostrarConfirmacao("Remover todos os bloqueios desta quadra?", 
            () => { // Callback Confirmar
                delete bloqueiosQuadra[`Quadra-${n}`];
                mostrarNotificacao("Bloqueios removidos.", 'success');
            },
            // Se cancelar (fechar modal), precisamos reverter o valor visualmente
            // Como nosso modal simples não tem callback de cancelar explícito para reversão de estado,
            // o ideal é que a mudança só ocorra se confirmar.
            // O select já mudou visualmente. Se o usuário não confirmar (fechar modal), 
            // a lógica ideal seria voltar o select.
            // Para simplificar: Se ele fechar o modal, os bloqueios ficam lá (delete não roda).
            // Apenas o select mudou. Se ele salvar, salva sem apagar os bloqueios (o que é seguro).
        );
    }
    if(el.value==='bloqueada') abrirModalBloqueio(n);
    el.oldValue = el.value;
}


   

    // Eventos Gerais
    document.addEventListener("DOMContentLoaded", function() { 
        showTab('reservas');
        
        for(let i=1; i<=3; i++) {
            const cb = document.getElementById(`${i}-duplasSemana`);
            const lbl = document.querySelector(`#duplasQuadra${i}Container .dias-semana-label-clickable`);
            if(cb) cb.addEventListener('change', () => atualizarCamposDaQuadraDuplas(i));
            if(lbl) lbl.addEventListener('click', () => { if(document.getElementById(`duplasQuadra${i}Ativa`).checked && cb.checked) abrirModalDiasSemana(i); });
            document.getElementById(`${i}-duplasSabado`).addEventListener('change', () => atualizarCamposDaQuadraDuplas(i));
            document.getElementById(`${i}-duplasDomingo`).addEventListener('change', () => atualizarCamposDaQuadraDuplas(i));
            const ld = document.getElementById(`DuplasDiasQuadra${i}`);
            if(ld) ld.addEventListener('dblclick', () => abrirModalExcecao(i));
        }

        const inputs = document.querySelectorAll('.horario-input'); 
        inputs.forEach(i => {
            i.addEventListener('input', formatarHorario);
            i.setAttribute('inputmode', 'numeric');
            i.setAttribute('maxlength', '5');
        });

        // Configurar Hold Events
        setupHoldEvent(document.getElementById('estadoQuadra1'), () => handleEstadoQuadraChange(document.getElementById('estadoQuadra1'), 1));
        setupHoldEvent(document.getElementById('estadoQuadra2'), () => handleEstadoQuadraChange(document.getElementById('estadoQuadra2'), 2));
        setupHoldEvent(document.getElementById('estadoQuadra3'), () => handleEstadoQuadraChange(document.getElementById('estadoQuadra3'), 3));
        //setupHoldEvent(document.getElementById('quebraHorarioDomingoAtiva'), handleQuebraHorarioChange);
		setupHoldEvent(document.getElementById('otimizacaoHorarios'), mudarOtimizacao);
        
		/*
		// CORREÇÃO: Aponta para o novo ID
		const elPerfil = document.getElementById('perfilSelect');
		if(elPerfil) setupHoldEvent(elPerfil, excluirAdministrador);
		*/

        // Tooltips
        const addTip = (id) => {
			const l = document.querySelector(`label[for="${id}"]`);
			if(l) {
				l.style.cursor='help';
				l.addEventListener('click', () => { 
					if(l.title) mostrarNotificacao(`ℹ️ <b>Informação:</b><br>${l.title.replace(/&#10;/g,'<br>')}`, 'info'); 
				});
			}
		};
        addTip('reservasPorConfirmacao'); addTip('horasParaExpirar'); addTip('edicaoOrganizador'); addTip('otimizacaoHorarios');
        addTip('labelDuplasRanking');
    });

    // Helpers UI
    function formatarDataInput(e) {
        let v = e.target.value.replace(/\D/g, '');
        if(v.length>8) v=v.substring(0,8);
        if(v.length>2) v=v.substring(0,2)+'/'+v.substring(2);
        if(v.length>5) v=v.substring(0,5)+'/'+v.substring(5);
        e.target.value = v;
    }
    function formatarHorario(e) {
        let v = e.target.value.replace(/\D/g, '');
        if(v.length>4) v=v.substring(0,4);
        if(v.length>2) v=v.slice(0,-2)+':'+v.slice(-2);
        e.target.value = v;
    }
    function atualizarEstadoConfirmacao() {
        const s = document.getElementById('reservasPorConfirmacao');
        document.getElementById('horasParaExpirar').disabled = s.value !== 'ON';
        s.className = s.value==='ON'?'confirmacao-on':'confirmacao-off';
    }
    function atualizarEstadoEdicaoOrganizador() {
        const s = document.getElementById('edicaoOrganizador');
        s.className = s.value==='ON'?'edicao-on':'edicao-off';
    }
    
	// Função disparada ao mudar o select (ON/OFF)
    function mudarOtimizacao() {
        atualizarVisualOtimizacao();
        // Se ligou (ON), abre o modal para configurar
        if(document.getElementById('otimizacaoHorarios').value === 'ON') {
            abrirModalQuebraHorario();
        }
    }
    
    // Função que apenas ajusta a cor do botão (Verde/Cinza)
    function atualizarVisualOtimizacao() {
        const s = document.getElementById('otimizacaoHorarios');
        // Reutilizamos as classes CSS existentes (quebra-on/quebra-off) pois são apenas visuais
        s.className = s.value === 'ON' ? 'quebra-on' : 'quebra-off';
    }
	
    
    function abrirModalQuebraHorario() {
        document.getElementById('quebraHorarioQuadra1').checked = quebraHorarioQuadrasConfig['Quadra-1']||false;
        document.getElementById('quebraHorarioQuadra2').checked = quebraHorarioQuadrasConfig['Quadra-2']||false;
        document.getElementById('quebraHorarioQuadra3').checked = quebraHorarioQuadrasConfig['Quadra-3']||false;
        document.getElementById('modalQuebraHorarioQuadras').style.display='flex';
    }
    function fecharModalQuebraHorario() { document.getElementById('modalQuebraHorarioQuadras').style.display='none'; }

	
function salvarModalQuebraHorario() {
    quebraHorarioQuadrasConfig = { 
        'Quadra-1': document.getElementById('quebraHorarioQuadra1').checked, 
        'Quadra-2': document.getElementById('quebraHorarioQuadra2').checked, 
        'Quadra-3': document.getElementById('quebraHorarioQuadra3').checked 
    };
    fecharModalQuebraHorario();
    mostrarNotificacao("Seleção confirmada! Não esqueça de clicar em 'Salvar Configurações' no final.", 'success');
}
	
    function atualizarEstadoDuplasRanking() {
        const s = document.getElementById('duplasRanking'); const l = document.getElementById('labelDuplasRanking');
        s.className = s.value==='ON'?'ranking-on':'ranking-off';
        if(l) l.classList.toggle('clickable-reset', s.value!=='ON');
    }
    function setupHoldEvent(el, cb) {
        let t;
        el.addEventListener('touchstart', () => t=setTimeout(cb,700));
        el.addEventListener('touchend', () => clearTimeout(t));
        el.addEventListener('touchmove', () => clearTimeout(t));
    }
    // Ranking Reset Logic
    document.addEventListener('DOMContentLoaded', () => {
        const lbl = document.getElementById('labelDuplasRanking');
        if(!lbl) return;
        let c=0; let t=null;
        lbl.addEventListener('click', () => {
            c++;
            if(c===1) t=setTimeout(()=>c=0,600);
            if(c===3) { clearTimeout(t); c=0; if(document.getElementById('duplasRanking').value==='OFF' && confirm("Zerar Ranking?") && confirm("Certeza?")) zerarRankingDuplas(); }
        });
    });
	
	
async function zerarRankingDuplas() {
    const snap = await db.ref('sistemas/cadastro/jogadores').once('value'); const j=snap.val();
    if(!j) return mostrarNotificacao("Banco de dados vazio.", 'error');
    
    const up={}; let count=0;
    for(const k in j) { if(j[k].jogosDeDuplasJogados || j[k].vitoriasEmDuplas) { up[`sistemas/cadastro/jogadores/${k}/jogosDeDuplasJogados`]=0; up[`sistemas/cadastro/jogadores/${k}/vitoriasEmDuplas`]=0; count++; } }
    
    if(!count) return mostrarNotificacao("Nada a zerar.", 'info');
    
    mostrarConfirmacao("Deseja ZERAR o ranking de duplas?", async () => {
        // Segunda confirmação de segurança (opcional, mas recomendada para ações destrutivas)
        // Como nosso modal é simples, vamos confiar em uma só ou usar um toast forte antes.
        // Vamos direto para a ação:
        await db.ref().update(up); 
        mostrarNotificacao("Ranking Zerado!", 'success');
    });
}
	
    
// ======================================================
// === LÓGICA DO GERENCIADOR DE AULAS ===
// ======================================================

// --- NOVA FUNÇÃO: Adicione esta função em qualquer lugar nos seus scripts ---
function preservarDadosInput() {
    // Pega os elementos da tela
    const checkAtivo = document.getElementById('aula-ativo');
    const inputProf = document.getElementById('aula-professor');

    // Garante que o objeto da quadra atual existe na memória
    if (!configAulasGlobal[quadraAulaAtual]) {
        configAulasGlobal[quadraAulaAtual] = { Ativo: false, Professor: '', Grade: {} };
    }

    // Salva o texto digitado na memória global
    if (checkAtivo) configAulasGlobal[quadraAulaAtual].Ativo = checkAtivo.checked;
    if (inputProf) configAulasGlobal[quadraAulaAtual].Professor = inputProf.value.trim();
}

// 1. Substitua a sua função selecionarQuadraAula por esta:
function selecionarQuadraAula(quadraKey, pularSalvamento = false) {
    
    // CORREÇÃO: Só salva o rascunho se NÃO for o carregamento inicial
    if (!pularSalvamento) {
        preservarDadosInput();
    }

    // Agora muda para a nova quadra
    quadraAulaAtual = quadraKey;
    
    // Atualiza visual dos botões
    ['Quadra1', 'Quadra2', 'Quadra3'].forEach((q, index) => {
        const btnId = `btn-aula-q${index+1}`; 
        const btn = document.getElementById(btnId);
        if (btn) {
            if (q === quadraKey) btn.classList.add('active');
            else btn.classList.remove('active');
        }
    });

    // Atualiza o Título
    const nomesPorExtenso = {
        'Quadra1': 'Quadra 1 - Coberta',
        'Quadra2': 'Quadra 2 - Aberta',
        'Quadra3': 'Quadra 3 - Coberta'
    };
    const elTitulo = document.getElementById('tituloAulaQuadra');
    if (elTitulo) {
        elTitulo.textContent = nomesPorExtenso[quadraKey];
    }

    // Carrega os dados da nova quadra para a tela
    const dados = configAulasGlobal[quadraKey] || { Ativo: false, Professor: '', Grade: {} };
    
    const checkAtivo = document.getElementById('aula-ativo');
    if(checkAtivo) checkAtivo.checked = dados.Ativo || false;
    
    const inputProf = document.getElementById('aula-professor');
    if(inputProf) {
        // Tenta definir o valor salvo no banco
        inputProf.value = dados.Professor || '';
        
        // CORREÇÃO: Verifica se a seleção funcionou.
        // Se inputProf.selectedIndex for -1, significa que o valor salvo (ex: "Rildo")
        // não existe na lista atual. Então forçamos para vazio.
        if (inputProf.selectedIndex === -1) {
            inputProf.value = "";
        }
    }

    renderizarTabelaAulas();
}


// 2. Atualize também a função de Salvar para garantir que ela pegue o último dado digitado
function salvarConfiguracaoAulas() {
    // Salva o rascunho atual antes de enviar
    preservarDadosInput();

    // Envia tudo para o banco
    db.ref('sistemas/config/Horarios/Aulas').set(configAulasGlobal)
    .then(() => {
        mostrarNotificacao('Grade de Aulas salva com sucesso!', 'success');
        fecharModalHorario('aulas');
    })
    .catch(err => mostrarNotificacao('Erro ao salvar: ' + err.message, 'error'));
}



// 2. Desenha a Grade (A Mágica acontece aqui)
// 2. Desenha a Grade (A Mágica acontece aqui)
function renderizarTabelaAulas() {
    const tbody = document.getElementById('tbodyAulas');
    if (!tbody) return;
    tbody.innerHTML = '';
    
    // Garante leitura segura (se não existir, usa vazio)
    const dadosQuadra = configAulasGlobal[quadraAulaAtual] || {};
    const gradeSalva = dadosQuadra.Grade || {};

    // Cria as linhas das 06:00 às 23:00
    for (let hora = 6; hora <= 22; hora++) {
        const tr = document.createElement('tr');
        
        // Texto do Horário (ex: "06:00 - 07:00")
        const horaInicio = String(hora).padStart(2,'0');
        const horaFim = String(hora + 1).padStart(2,'0');
        const textoHorario = `${horaInicio}:00 - ${horaFim}:00`;
        
        // 1. COLUNA DA ESQUERDA (Horário)
        const tdHoraEsq = document.createElement('td');
        tdHoraEsq.textContent = textoHorario;
        tr.appendChild(tdHoraEsq);

        // 2. COLUNAS DOS DIAS (Seg a Dom)
        for (let dia = 1; dia <= 7; dia++) {
            const td = document.createElement('td');
            const key = `${dia}_${hora}`; 

            // Verifica Horário Padrão
            const regrasPadrao = obterRegrasPadrao(dia);
            const estaAberto = verificarSeAbertoNoPadrao(regrasPadrao, hora);

            if (!estaAberto) {
                td.className = 'aula-cell-bloqueada';
            } else {
                const temAula = gradeSalva[key] === true;
                
                // Configuração visual inicial
                if (temAula) {
                    td.className = 'aula-cell-marcada';
                    td.textContent = 'Aula'; 
                } else {
                    td.className = 'aula-cell-livre';
                    td.textContent = '';
                }

                // --- EVENTO DE CLIQUE (AQUI ESTAVA O ERRO) ---
                td.onclick = () => {
                    // 1. SEGURANÇA: Garante que a estrutura existe na memória antes de gravar
                    if (!configAulasGlobal[quadraAulaAtual]) {
                        configAulasGlobal[quadraAulaAtual] = { Ativo: false, Professor: '', Grade: {} };
                    }
                    if (!configAulasGlobal[quadraAulaAtual].Grade) {
                        configAulasGlobal[quadraAulaAtual].Grade = {};
                    }

                    // 2. Agora é seguro gravar ou apagar
                    if (td.classList.contains('aula-cell-marcada')) {
                        td.className = 'aula-cell-livre';
                        td.textContent = '';
                        // Remove da memória
                        delete configAulasGlobal[quadraAulaAtual].Grade[key];
                    } else {
                        td.className = 'aula-cell-marcada';
                        td.textContent = 'Aula';
                        // Adiciona na memória (agora seguro)
                        configAulasGlobal[quadraAulaAtual].Grade[key] = true;
                    }
                };
            }
            tr.appendChild(td);
        }

        // 3. COLUNA DA DIREITA (Horário)
        const tdHoraDir = document.createElement('td');
        tdHoraDir.textContent = textoHorario;
        tr.appendChild(tdHoraDir);

        tbody.appendChild(tr);
    }
}




// 3. Funções Auxiliares de Horário
function obterRegrasPadrao(diaIdx) {
    if (horariosGlobal && horariosGlobal.Padrao) {
        return horariosGlobal.Padrao[diaIdx];
    }
    // Padrão de segurança se não carregar
    return { status: 'aberto', abertura: '06:00', fechamento: '23:00' };
}

function verificarSeAbertoNoPadrao(regra, hora) {
    if (!regra || regra.status === 'fechado') return false;
    const inicio = parseInt(regra.abertura.split(':')[0]);
    const fim = parseInt(regra.fechamento.split(':')[0]);
    return hora >= inicio && hora < fim;
}

// 4. Botões de Ação Rápida (Selecionar/Limpar)
function acaoAula(tipo) {
    const grade = configAulasGlobal[quadraAulaAtual].Grade || {};
    if (!configAulasGlobal[quadraAulaAtual].Grade) configAulasGlobal[quadraAulaAtual].Grade = grade;

    const tbody = document.getElementById('tbodyAulas');
    
    // Varre a tabela visual
    for (let r = 0; r < tbody.rows.length; r++) {
        const hora = r + 6;
        // As células clicáveis estão entre a coluna 1 e 7 (indices 1 a 7)
        // Lembre-se: Coluna 0 é horário, Coluna 8 é horário
        for (let c = 1; c <= 7; c++) {
            const cell = tbody.rows[r].cells[c];
            const key = `${c}_${hora}`;

            // Só altera se NÃO estiver bloqueado (Cinza)
            if (!cell.classList.contains('aula-cell-bloqueada')) {
                if (tipo === 'selecionar') {
                    // --- CORREÇÃO AQUI: Texto Padronizado "Aula" ---
                    cell.className = 'aula-cell-marcada';
                    cell.textContent = 'Aula';
                    grade[key] = true;
                } else {
                    cell.className = 'aula-cell-livre';
                    cell.textContent = '';
                    delete grade[key];
                }
            }
        }
    }
}







// Função para Maximizar/Restaurar a tela de aulas
// Função para Maximizar/Restaurar a tela de aulas
function alternarTelaCheiaAulas() {
    // 1. O PULO DO GATO: Remove qualquer seleção de texto (azul) imediatamente
    if (window.getSelection) {
        window.getSelection().removeAllRanges();
    }
    
    const modalContent = document.querySelector('#modalHorarioAulas .modal-content');
    
    if (modalContent) {
        // Alterna a classe 'maximizado'
        if (modalContent.classList.contains('maximizado')) {
            modalContent.classList.remove('maximizado');
        } else {
            modalContent.classList.add('maximizado');
        }
    }
}


// Variável global para controlar o tempo do clique
let ultimoTempoClique = 0;

function tratarCliqueHorario(event) {
    // 1. Remove qualquer seleção de texto (azul) imediatamente
    if (window.getSelection) {
        window.getSelection().removeAllRanges();
    }

    // 2. Calcula o tempo do clique atual
    const tempoAtual = new Date().getTime();
    const diferenca = tempoAtual - ultimoTempoClique;
    
    // 3. Verifica se foi um clique rápido (menos de 300ms) = Duplo Clique
    if (diferenca < 300 && diferenca > 0) {
        alternarTelaCheiaAulas(); // Maximiza a tela
        ultimoTempoClique = 0;    // Reseta para evitar triplo clique
    } else {
        // Se foi o primeiro clique, apenas guarda o tempo
        ultimoTempoClique = tempoAtual;
    }
}


// --- FUNÇÕES DO MODO FOCO (TELA CHEIA) ---

    // 1. Alterna entre Modo Foco e Normal
function alternarTelaCheiaEspecial() {
    const modal = document.getElementById('modalHorarioEspecial');
    const btn = document.getElementById('btnTelaCheiaEspecial');
    const iconSvg = document.getElementById('icon-fullscreen');
    
    // Paths dos desenhos (Opção 2: Explosão)
    const pathExpandir = "M7 14H5v5h5v-2H7v-3zm-2-4h2V7h3V5H5v5zm12 7h-3v2h5v-5h-2v3zM14 5v2h3v3h2V5h-5z";
    const pathComprimir = "M5 16h3v3h2v-5H5v2zm3-8H5v2h5V5H8v3zm6 11h2v-3h3v-2h-5v5zm2-11V5h-2v5h5V8h-3z";

    // Ativa/Desativa o CSS
    modal.classList.toggle('modo-foco');
    
    // Troca o ícone e o título
    if (modal.classList.contains('modo-foco')) {
        // Mudou para Foco -> Mostra ícone de Comprimir (Setas para dentro)
        iconSvg.innerHTML = `<path d="${pathComprimir}"/>`;
        btn.title = "Minimizar (Voltar ao normal)";
    } else {
        // Voltou ao Normal -> Mostra ícone de Expandir (Setas para fora)
        iconSvg.innerHTML = `<path d="${pathExpandir}"/>`;
        btn.title = "Tela Cheia (Modo Foco)";
    }
}


// 2. Controla se o botão deve aparecer (só se houver lista)
function atualizarVisibilidadeBotaoExpandir() {
    const container = document.getElementById('containerListaDiasEspeciais');
    const btn = document.getElementById('btnTelaCheiaEspecial');
    
    // Conta quantos itens de dia existem
    const linhas = container.querySelectorAll('.linha-dia-especial');
    
    if (linhas.length > 0) {
        // Mostra o botão forçando FLEX (para alinhar o ícone) e vencendo o CSS
        btn.style.setProperty('display', 'flex', 'important');
    } else {
        // Esconde o botão com força total (!important)
        btn.style.setProperty('display', 'none', 'important');
        
        // Segurança: Se esvaziou a lista e estava em tela cheia, volta ao normal
        const modal = document.getElementById('modalHorarioEspecial');
        if(modal.classList.contains('modo-foco')) {
            alternarTelaCheiaEspecial();
        }
    }
}

function atualizarCorPeriodoAtivo() {
    const chk = document.getElementById('periodoAtivo');
    const texto = document.getElementById('textoPeriodoAtivo');
    
    if (chk && texto) {
        if (chk.checked) {
            texto.style.color = '#2e7d32'; // Verde Escuro (Ativado)
        } else {
            texto.style.color = '#d32f2f'; // Vermelho (Desativado)
        }
    }
}

// --- FUNÇÃO DE CONTROLE DOS CHECKBOXES (ESPELHO) ---
    function gerenciarPermissoesInterativas(origem) {
        const chkMaster = document.getElementById('perm_super_admin');
        
        // Lista de todos os checkboxes "filhos"
        const idsFilhos = [
            'perm_acesso_config',
            'perm_gestao_jogadores',
            'perm_gerir_reservas',
            'perm_controle_quadras',
            'perm_gestor_aulas',
            'perm_gestor_torneios'
        ];

        // CENÁRIO 1: Clicou no "Acesso Total"
        if (origem === 'MASTER') {
            const estadoMestre = chkMaster.checked;
            // Força todos os filhos a terem o mesmo estado do mestre
            idsFilhos.forEach(id => {
                const el = document.getElementById(id);
                if (el) el.checked = estadoMestre;
            });
        } 
        // CENÁRIO 2: Clicou em um item individual
        else {
            let todosMarcados = true;
            
            // Verifica se SOBROU algum desmarcado
            idsFilhos.forEach(id => {
                const el = document.getElementById(id);
                if (el && !el.checked) todosMarcados = false;
            });

            // Se todos estiverem marcados, o mestre vira true. 
            // Se um estiver desmarcado, o mestre vira false.
            chkMaster.checked = todosMarcados;
        }
    }


// --- FUNÇÃO DE NOTIFICAÇÃO (TOAST) ---
function mostrarNotificacao(mensagem, tipo = 'success') {
    const container = document.getElementById('toastContainer');
    const toast = document.createElement('div');
    toast.className = `toast ${tipo}`;
    
    // Adiciona o cursor de "mãozinha" para indicar que é clicável
    toast.style.cursor = 'pointer'; 
    
    // Ícone baseado no tipo
    let icone = '✅';
    if (tipo === 'error') icone = '❌';
    if (tipo === 'warning') icone = '⚠️';

    toast.innerHTML = `<span style="margin-right: 10px; font-size: 1.2em;">${icone}</span> ${mensagem}`;
    
    container.appendChild(toast);

    // Função interna para remover o toast com animação
    const removerToast = () => {
        // Se já estiver removendo (animationName definido), não faz nada
        if (toast.style.animationName === 'fadeOutUp') return;

        toast.style.animation = 'fadeOutUp 0.3s forwards';
        toast.addEventListener('animationend', () => {
            if (toast.parentNode) {
                toast.remove();
            }
        });
    }; 

    // 1. EVENTO DE CLIQUE: Remove imediatamente
    toast.onclick = () => {
        removerToast();
    }; 

    // 2. TIMER AUTOMÁTICO: Remove após 4 segundos se ninguém clicar
    setTimeout(() => {
        // Verifica se o elemento ainda está na tela antes de tentar remover
        if (document.body.contains(toast)) {
            removerToast();
        }
    }, 4000);
}

// --- FUNÇÃO DE CONFIRMAÇÃO (MODAL) ---
function mostrarConfirmacao(mensagem, callbackConfirmar) {
    const modal = document.getElementById('modalConfirmacaoGlobal');
    const texto = document.getElementById('textoConf');
    const btnSim = document.getElementById('btnConfirmarConf');
    const btnNao = document.getElementById('btnCancelarConf');

    // Configura o texto
    texto.innerHTML = mensagem;
    modal.style.display = 'flex';

    // Ação do SIM (Remove listeners antigos para não duplicar)
    btnSim.onclick = function() {
        modal.style.display = 'none';
        if (callbackConfirmar) callbackConfirmar();
    };

    // Ação do NÃO
    btnNao.onclick = function() {
        modal.style.display = 'none';
    };
    
    // Focar no cancelar por segurança
    btnNao.focus();
}	


// --- FUNÇÃO DE INPUT (MODAL) ---
function mostrarInput(titulo, mensagem, placeholder, callbackConfirmar) {
    const modal = document.getElementById('modalInputGlobal');
    const tituloEl = document.getElementById('tituloInput');
    const textoEl = document.getElementById('textoInput');
    const inputEl = document.getElementById('campoInputGlobal');
    const btnSim = document.getElementById('btnConfirmarInput');
    const btnNao = document.getElementById('btnCancelarInput');

    tituloEl.textContent = titulo;
    textoEl.innerHTML = mensagem; // Permite HTML
    inputEl.value = '';
    inputEl.placeholder = placeholder || '';
    
    // Remove máscaras antigas se houver (opcional) e foca
    inputEl.oninput = null; 

    modal.style.display = 'flex';
    setTimeout(() => inputEl.focus(), 100);

    // Ação OK
    btnSim.onclick = function() {
        const valor = inputEl.value.trim();
        if (!valor) {
            mostrarNotificacao("O campo não pode ficar vazio.", "warning");
            inputEl.focus();
            return;
        }
        modal.style.display = 'none';
        if (callbackConfirmar) callbackConfirmar(valor);
    };

    // Ação Cancelar
    btnNao.onclick = function() {
        modal.style.display = 'none';
    };
}


// --- LÓGICA DE TEMA (CLARO/ESCURO) ---

function toggleTheme() {
    // 1. Alterna a classe no body
    document.body.classList.toggle('dark-mode');
    
    // 2. Verifica qual estado ficou
    const isDark = document.body.classList.contains('dark-mode');
    
    // 3. Salva na memória do navegador
    localStorage.setItem('theme', isDark ? 'dark' : 'light');
    
    // 4. Atualiza o ícone do botão
    atualizarIconeTema(isDark);
}

function atualizarIconeTema(isDark) {
    const btn = document.getElementById('theme-toggle-button');
    if (btn) {
        btn.textContent = isDark ? '☀️' : '🌙';
    }
}

// --- INICIALIZAÇÃO DO TEMA ---
document.addEventListener('DOMContentLoaded', () => {
    // Verifica se já existe preferência salva
    const savedTheme = localStorage.getItem('theme');
    
    // Se estiver salvo como 'dark', ativa. Caso contrário, mantém padrão (light).
    if (savedTheme === 'dark') {
        document.body.classList.add('dark-mode');
        atualizarIconeTema(true);
    } else {
        atualizarIconeTema(false);
    }
});



function abrirSeletorInteligente(modo) {
    modoCorAtual = modo;
    
    // DETECÇÃO DE CELULAR (Verifica se é touch ou tela pequena)
    const isMobile = ('ontouchstart' in window) || (window.innerWidth <= 800);

    if (isMobile) {
        // MODO CELULAR: Clica no input nativo invisível
        const idNative = modo === 'novo' ? 'nativeCorNovo' : 'nativeCorEdicao';
        document.getElementById(idNative).click();
    } else {
        // MODO PC: Abre nosso Modal de Bolinhas
        renderizarGridPC();
        document.getElementById('modalSeletorPC').style.display = 'flex';
    }
}

function renderizarGridPC() {
    const container = document.getElementById('gridCoresPC');
    container.innerHTML = '';
    
    CORES_DISPONIVEIS.forEach(cor => {
        const dot = document.createElement('div');
        dot.className = 'dot-pc';
        dot.style.backgroundColor = cor;
        dot.onclick = () => {
            atualizarCorInteligente(modoCorAtual, cor);
            document.getElementById('modalSeletorPC').style.display = 'none';
        };
        container.appendChild(dot);
    });
}

function atualizarCorInteligente(modo, cor) {
    if (modo === 'novo') {
        // Atualiza Modal Novo Perfil
        document.getElementById('corNovoPerfil').value = cor;
        document.getElementById('btnVisualCorNovo').style.backgroundColor = cor; 
        document.getElementById('nativeCorNovo').value = cor;
    } 
    else if (modo === 'edicao') {
        // Atualiza Modal Permissões (APENAS VISUALMENTE)
        document.getElementById('corPerfilEdicao').value = cor;
        document.getElementById('btnVisualCorEdicao').style.backgroundColor = cor;
        document.getElementById('nativeCorEdicao').value = cor;
        
    }
}

// --- Função para formatar texto (Title Case) ---  
function formatarTexto(texto) {
    if (!texto) return "";
    return texto
        .toLowerCase()          // 1. Tudo minúsculo
        .trim()                 // 2. Remove espaços nas pontas
        .split(' ')             // 3. Separa as palavras
        .filter(p => p !== "")  // 4. Remove espaços vazios duplos (segurança extra)
        .map(palavra => palavra.charAt(0).toUpperCase() + palavra.slice(1)) // 5. 1ª letra Maiúscula
        .join(' ');             // 6. Junta tudo de volta
}

function carregarListaProfessores() {
    db.ref('sistemas/cadastro/jogadores').on('value', snapshot => {
        const select = document.getElementById('aula-professor');
        
        // 1. Guarda quem estava selecionado antes da lista atualizar
        const valorAntesDaAtualizacao = select.value; 

        const jogadores = snapshot.val() || {};
        
        // Limpa e recria a opção padrão
        select.innerHTML = '<option value="">Sem Professor</option>';
        
        const listaNomesValidos = []; // Vamos usar isso para verificar depois

        Object.keys(jogadores).forEach(key => {
            const dados = jogadores[key];
            
            // Verifica se tem perfil "Professor"
            const ehProfessor = (dados.perfis && dados.perfis['Professor']) || 
                                (dados.funcoes && dados.funcoes.professor);

            if (ehProfessor) {
                const nomeExibicao = dados.apelido ? dados.apelido : key;
                const nomeFormatado = nomeExibicao.charAt(0).toUpperCase() + nomeExibicao.slice(1).toLowerCase();
                
                // Adiciona na lista de nomes válidos
                listaNomesValidos.push(nomeFormatado);
            }
        });

        listaNomesValidos.sort();

        // Cria as opções no HTML
        listaNomesValidos.forEach(nome => {
            const option = document.createElement('option');
            option.value = nome;
            option.textContent = nome;
            select.appendChild(option);
        });

        // 2. LÓGICA DE CORREÇÃO:
        // Se tínhamos alguém selecionado, verificamos se ele AINDA está na lista nova.
        if (valorAntesDaAtualizacao && listaNomesValidos.includes(valorAntesDaAtualizacao)) {
            // Se ele ainda é professor, mantém selecionado
            select.value = valorAntesDaAtualizacao;
        } else {
            // Se ele não é mais professor (foi excluído ou perdeu perfil), volta para o padrão
            select.value = ""; 
        }
    });
} 





</script>
</body>
</html>


