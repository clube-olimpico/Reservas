<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Configura√ß√µes do Sistema</title>

    <!-- Adiciona as vers√µes compat√≠veis do Firebase -->
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-database-compat.js"></script>

<style>

body {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; 
    background-color: #f8f9fa; /* Novo fundo cinza claro */
    color: #212529; /* Texto principal um pouco mais escuro */
    padding: 10px;
    display: flex;
    font-size: 18px;
    justify-content: center;
    align-items: flex-start; 
    min-height: 100vh;
    margin: 0;
    overflow-y: auto;
    box-sizing: border-box;  
}
.container {
    display: flex;
    align-items: center;
    margin-bottom: 10px;
    gap: 10px; 
}

.container label[for="Sistema"] {
    width: auto; /* Deixa o label ocupar o espa√ßo necess√°rio */
    margin-right: 10px; /* Espa√ßamento entre o label e o select */
    font-weight: bold;
    display: inline-block; /* Importante para o alinhamento */
    text-align: left; /* Alinha o texto √† esquerda */
    min-width: 100px; /* Define uma largura m√≠nima para o label */
}

#sistema {
    font-weight: bold;
}

/* Modifica√ß√£o para centralizar o item "Ativa" */
#piramide .piramide-ativa-container {
    justify-content: center;
	width: auto; /* Deixe o label se ajustar ao conte√∫do */
}

#piramide .piramide-ativa-container label {
    width: auto; /* Deixe o label se ajustar ao conte√∫do */
    margin-right: 10px;
    font-weight: bold;
}

#piramide .piramide-ativa-container select {
    width: 80px; /* Defina uma largura fixa para o select */
    border: 1px solid #ccc;
    border-radius: 5px;
	max-width: 4px; /* Mantenha a largura m√°xima */
}

/* Estilos para o container dos bot√µes (ESPEC√çFICO PARA A ABA PIR√ÇMIDE) */
#piramide .piramide-botoes-container {
    display: flex;
    justify-content: space-between;
    max-width: 400px; /* Mantenha a largura m√°xima */
    width: 90%;
    margin: 0 auto;
	
}

/* Estilos para os bot√µes (ESPEC√çFICO PARA A ABA PIR√ÇMIDE) */
#piramide .piramide-botao {
    flex: 1;
    margin: 0 5px;
    padding: 10px;
    box-sizing: border-box;
}

#piramide .piramide-botao:first-child {
    margin-left: 0;
}

#piramide .piramide-botao:last-child {
    margin-right: 0;
}

/* Ajustes espec√≠ficos para os cont√™ineres das quadras */
.quadra-container {
    margin-bottom: 5px;
    gap: 10px;
	
}

/* Estilo do container do formul√°rio */
.form-container {
    padding: 20px;
    background: #ffffff; /* Garante o fundo branco do cart√£o */
    border: none; /* Remove a borda antiga */
    border-radius: 12px; /* Cantos mais arredondados e suaves */
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08); /* Sombra mais moderna */
    width: 400px; /* Mant√©m a largura fixa */
    text-align: center;
    margin: 10px auto; /* Mant√©m a centraliza√ß√£o */
}

.title-container {
    display: flex;
    flex-direction: column;
    align-items: center;
    text-align: center;
    margin-bottom: 5px;
}

.title-container span {
    font-family: 'Arial', sans-serif; /* Ajusta a fonte */
    font-size: 1.3em; /* Ajusta o tamanho da fonte */
    font-weight: bold; /* Mant√©m o negrito */
    line-height: 1.0em; /* Aumenta o espa√ßamento vertical entre as linhas */
    letter-spacing: 3px; /* Aumenta o espa√ßamento entre as letras */
    text-align: center; /* Centraliza o texto */
}

/* REGRA GERAL PARA LABELS */
label {
    font-weight: bold;
    width: 190px;
    white-space: nowrap;
    text-align: left;
    display: inline-block; /* Alinhar labels e inputs */
}

/* REGRA GERAL PARA SELECTS */
select {
    flex: 1;
    padding: 5px;
    box-sizing: border-box; /* Incluir padding na largura */
    width: auto; /* Deixe o select se ajustar ao conte√∫do */
    min-width: 80px; /* Largura m√≠nima para selects */
}

button {
    margin-top: auto;
    margin-bottom: 20px;
    padding: 10px;
    font-size: 17px;
    background-color: #4CAF50;
    color: white;
    border: none;
    cursor: pointer;
    width: 250px;
    max-width: 90%;
    align-self: center;
    display: block;
}

button:hover {
    background-color: #45a049;
}

#sistema {
    font-weight: bold;
}

#sistema.on {
    color: white;
    background-color: green;
}

#sistema.off {
    color: white;
    background-color: red;
}

#piramideAtiva {
    font-weight: bold;
    margin-top: 0; /* Garante que n√£o h√° margem indesejada */
}

.piramide-on {
    color: green;
}

.piramide-off {
    color: red;
}

#loading {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: 2rem;
    text-align: center;
    z-index: 1000;
}

#content {
    display: none;
}

.hr-line {
    border: 0;
    height: 6px;
    background: linear-gradient(to bottom, #cccccc, #dddddd, #eeeeee, #ffffff);
    width: 90%;
    max-width: 99%;
    margin: 10px auto;
}

/* Ajustes para a se√ß√£o de convidados */
.convidados-container {
    margin-top: 20px;
}

.convidados-container,
.convidados-quadras,
.convidados-dias,
.convidados-options {
    width: 100%;
    max-width: 100%;
    overflow-x: hidden;
    box-sizing: border-box;
    padding: 0 10px;
}

.convidados-options label {
    display: flex;
    align-items: center;
    white-space: nowrap;
    width: 100%;
}

#convidados {
    overflow-x: hidden !important;
    max-width: 100% !important;
    width: 100%;
}

body.convidados-ativo {
    overflow-x: hidden !important;
}

/* Ajustes para a se√ß√£o de piramide */
.piramde-container {
    margin-top: 20px;
}

.piramde-container,
.piramde-quadras,
.piramde-dias,
.piramde-options {
    width: 100%;
    max-width: 100%;
    overflow-x: hidden;
    box-sizing: border-box;
    padding: 0 10px;
}

.piramde-options label {
    display: flex;
    align-items: center;
    white-space: nowrap;
    width: 100%;
	
}

#piramde {
    overflow-x: hidden !important;
    max-width: 100% !important;
    width: 100%;
}

body.piramde-ativo {
    overflow-x: hidden !important;
}

.centraliza-checkbox {
    display: flex;
    justify-content: center; /* Centraliza horizontalmente */
    align-items: center; /* Centraliza verticalmente */
    width: 100%; /* Ocupa toda a largura dispon√≠vel */
	margin-top: 10px;
}

#piramideQuadra1, #piramideQuadra2, #piramideQuadra3 {
    margin-right: 7px;
}

#PiramideDiasQuadra1, #PiramideDiasQuadra2, #PiramideDiasQuadra3 {
    margin-left: 7px;
}

/* ----------------- ADI√á√ïES PARA A ABA DUPLAS ----------------- */ 
#DuplasDiasQuadra1.disabled,
#DuplasDiasQuadra2.disabled,
#DuplasDiasQuadra3.disabled {
    cursor: not-allowed;
    color: #999;
}

#duplas .duplas-ativa-container {
    display: flex;
    align-items: center;
    justify-content: center;   /* Centraliza horizontalmente */
    width: 100%;               /* Garante que ocupa toda a largura dispon√≠vel */
    margin-top: 5px;
}

#duplas .duplas-ativa-container label {
    width: auto;
    margin-right: 10px;
    font-weight: bold;
}

#duplas .duplas-ativa-container select {
    width: 80px;
    border: 1px solid #ccc;
    border-radius: 5px;
	max-width: 4px;
}

#duplas .duplas-botoes-container { 
    display: flex;
    justify-content: space-between;
    max-width: 400px;
    width: 90%;
    margin: 0 auto;
	margin-bottom: 0px; /* Remove o espa√ßo inferior dos bot√µes */
}

#duplas .centraliza-checkbox {
    margin-top: -10px; /* Remove o espa√ßo superior dos checkboxes */
    margin-bottom: 10px; /* Opcional: espa√ßo abaixo do checkbox, ajuste se necess√°rio */
}

#duplas .duplas-botao {
    flex: 1;
    margin: 0 5px;
    padding: 10px;
    box-sizing: border-box;
    background-color: #4CAF50; /* opcional: ou deixe como est√° se quiser a mesma cor */
    color: white;
}

#duplas .duplas-botao.ativo {
    background-color: #2E7D32;
	font-weight: bold;         /* negrito */
    box-shadow: 0 0 5px rgba(0,0,0,0.3);
}

.duplas-container {
    margin-top: 20px;
}

.duplas-options {
    width: 100%;
    max-width: 100%;
    box-sizing: border-box;
}

.duplas-day-container {
    margin-bottom: 12px; 
}

#duplas .duplas-day-container {
    margin-bottom: 5px;
}

.duplas-day-container > label {
    font-weight: normal; 
    display: flex;
    align-items: center;
    width: auto;
}

.duplas-time-wrapper {
    padding-left: 25px; 
    margin-top: 4px;
}

#duplas .duplas-time-wrapper {
    padding-left: 5px; /* reduz o espa√ßo entre o checkbox e o campo de hora */
    margin-top: 0px;   /* opcional: remove espa√ßo vertical extra */
}

.horario-input {
    width: 60px;
    margin: 0 5px;
	text-align: center;
}

#duplasQuadra1Ativa, #duplasQuadra2Ativa, #duplasQuadra3Ativa {
    margin-right: 7px;
}

#DuplasDiasQuadra1, #DuplasDiasQuadra2, #DuplasDiasQuadra3 {
    margin-left: 7px;
    cursor: pointer; /* Adiciona cursor de ponteiro para indicar interatividade */
    
    /* Adicionado para prevenir a sele√ß√£o do texto no duplo clique */
    -webkit-user-select: none; /* Para Safari */
    -ms-user-select: none;     /* Para Internet Explorer/Edge */
    user-select: none;         /* Padr√£o */
}

#duplas .duplas-day-container > label {
    font-size: 15px; /* mesmo tamanho da pir√¢mide */
}

#duplas .horario-input {
    font-size: 15px; /* mesmo tamanho dos inputs da pir√¢mide */
}

/* Adicione estas regras para a aba Duplas */
#duplas .duplas-ativa-container select {
    font-weight: bold;
}

#duplasAtiva.duplas-on {
    color: green;
}

#duplasAtiva.duplas-off {
    color: red;
}



/* Ajustes para dispositivos m√≥veis */
@media (max-width: 768px) {
    .form-container {
        width: 90%;
        padding: 10px;
        margin: 1px auto;
        box-sizing: border-box;
    }
	
	/* --- Ajuste final de tamanho e alinhamento para a linha Sistema --- */
	#sistema {
		width: 70px;       /* Define uma largura fixa */
		min-width: 70px;   /* Garante que ele n√£o encolha */
		flex: none;        /* Remove completamente o comportamento flex de esticar/encolher */
	}

	#usuariosOnline {
		margin-left: auto; /* ESSENCIAL: Empurra a caixa "000" para a direita, alinhando-a com os bot√µes '+' abaixo */
	}
		
	.form-container .container > label {
		width: 150px; /* Reduz a largura fixa do r√≥tulo S√ì no celular */
	}
	
	/* --- IN√çCIO: Layout Definitivo e Corrigido para Aba Reservas (Mobile) --- */   

	/* 1. Define uma largura fixa e igual para TODOS os r√≥tulos da aba Reservas */
	#reservas .container label {
		width: 198px;
		flex-shrink: 0;
	}

	/* 3. Define a largura MENOR para os demais campos e os alinha √† DIREITA */
	#reservas #diasParaAgendar,
	#reservas #reservasPorConfirmacao,
	#reservas #horasParaExpirar,
	#reservas #edicaoOrganizador,
	#reservas #quebraHorarioDomingoAtiva { 
		max-width: 100px;
		width: 100%;
		margin-left: auto;
		flex: initial;
	}

	/* --- CORRE√á√ÉO DEFINITIVA PARA O CAMPO DOMINGO --- */
#reservas .container {
    display: flex !important;
    justify-content: space-between !important;
    align-items: center !important;
    flex-wrap: nowrap !important;
    width: 100% !important;
    gap: 10px !important;
}

#reservas .container > label[for="vDomingo"] {
    flex-shrink: 1 !important;     /* Permite que o r√≥tulo encolha um pouco se precisar de espa√ßo */
    margin-right: -5px !important; /* Adiciona um espa√ßamento fixo √† direita */
    text-align: left !important;
}


/* CORRE√á√ÉO: OCULTA COMPLETAMENTE O CONTAINER INTEIRO QUANDO FECHADO */
#vDomingo[value="fechado"] + #containerHorarioDomingo {
    display: none !important;
    visibility: hidden !important;
    width: 0 !important;
    height: 0 !important;
    opacity: 0 !important;
    overflow: hidden !important;
    pointer-events: none !important;
}


/* MOSTRA O CAMPO DE HOR√ÅRIO QUANDO DOMINGO ESTIVER "Aberto" */
#vDomingo.is-aberto + #containerHorarioDomingo {
    display: flex !important;
    visibility: visible !important;
    width: auto !important; /* Permite que o container se ajuste ao conte√∫do */
    height: auto !important;
    opacity: 1 !important;
    overflow: visible !important;
    pointer-events: auto !important;
}




#containerHorarioDomingo {
    display: none !important;
    align-items: center !important;
    gap: 1px !important;
    flex: none !important;
    margin: 0 !important;
    padding: 0 !important;
    justify-content: flex-end !important;
	
}

#containerHorarioDomingo span {
    font-size: 16px !important;
    margin: 0 !important;
    padding: 0 !important;
    flex-shrink: 0 !important;
	margin-left: -10px !important; /* espa√ßo entre aberto e relogio */
}

#vDomingoAte {
   	width: 40px !important;       /* um pouco menor */
    flex-shrink: 0 !important;
    font-size: 14px !important;
    text-align: center !important;
    border: 1px solid #ddd !important;
    background: white !important;
    padding: 1px 2px !important;  /* mais compacto */
    border-radius: 3px !important;
    margin-left: 0px !important;  /* s√≥ 2px do rel√≥gio */
}

/* ALINHAMENTO ESPEC√çFICO PARA "FECHADO" - DROPDOWN SOZINHO √Ä DIREITA */


/* Campo Domingo igual aos outros */


#reservas #vDomingo {
    max-width: 85px !important;
    width: 100% !important;
    margin-left: auto !important; /* Empurra para a direita */
    flex: 1 1 85px !important;
}

/* ESTILO ESPECIAL (para o estado "Aberto") */
/* √â AQUI QUE VOC√ä AJUSTA O TAMANHO DO CAMPO QUANDO "ABERTO" */
#reservas #vDomingo.is-aberto {
    /* 1. Defina a largura desejada */
    width: 65px !important;
    max-width: 65px !important;
    flex: 0 0 65px !important;
    margin-left: 0 !important;

    /* 2. Force o campo a obedecer a nova largura */
    padding: 5px 2px !important;       /* Reduz o espa√ßamento interno */
    font-size: 15px !important;        /* Reduz o tamanho da fonte do texto "Aberto" */
    box-sizing: border-box !important; /* Garante que o padding n√£o aumente a largura total */
}

/* --- FIM DA CORRE√á√ÉO DO CAMPO DOMINGO --- */
	/* --- FIM: Layout Definitivo e Corrigido para Aba Reservas (Mobile) --- */

    select {
        width: 100%;
        max-width: 100%;
        box-sizing: border-box;
    }
	
    .convidados-options {
        margin-left: -20px;
        white-space: nowrap;
    }

    .convidados-options label {
        max-width: 100%;
        white-space: normal;
        font-size: 15px;
    }
	.piramde-options label {
        max-width: 100%;
        white-space: normal;
        font-size: 15px;
    }
	
	/* 1. Diminui o tamanho da fonte das datas para economizar espa√ßo */
    #piramideInicio, #piramideFim, #piramideSeparador {
        font-size: 0.8em !important; /* Deixa a fonte 20% menor */
    }

    /* 2. Aproxima a data de in√≠cio do dropdown (seletor ON/OFF) */
    #piramideInicio {
        margin-left: 4px !important; /* Reduz a margem da esquerda */
    }

    /* 3. Ajusta o espa√ßo ao redor do "√†" */
    #piramideSeparador {
        margin: 0 2px !important; /* Reduz as margens laterais */
    }

    /* CORRE√á√ÉO DE FONTE PARA CELULAR */
    .duplas-day-container > label {
        font-size: 15px;
    }
    .horario-input {
        font-size: 14px;
    }
    /* FIM DA CORRE√á√ÉO */
	
	#piramide .piramide-botoes-container,
    #duplas .duplas-botoes-container {
        width: 100%;
    }

    #piramide .piramide-botao,
    #duplas .duplas-botao {
        flex: 1;
        margin: 5px;
		margin-top: 0px;
        padding: 10px;
		height: 35px;
		line-height: 15px;
        box-sizing: border-box;
        font-size: 16px;
        white-space: nowrap;
		align-items: center;
		justify-content: center;
    }
	
	.centraliza-checkbox {
       margin-top: 7px;
    }
	
	#duplas .centraliza-checkbox {
        display: flex;
        justify-content: center; 
        align-items: center;
        width: 100%;
        margin-top: -12px; 
        margin-bottom: 0;
    }

    .botao-salvar {
        position: fixed;
        bottom: 0;
        left: 0;
        width: 100%;
        display: flex;
        justify-content: center;
        background: white;
        padding: 5px 0;
		margin-bottom: -15px;
        box-shadow: 0 -2px 5px rgba(0, 0, 0, 0.1);
        z-index: 1000;
    }
	
    #main-content {
        min-height: 500px;
        position: relative;
        width: 100%;
        max-width: 100%;
        overflow: hidden;
        box-sizing: border-box;
    }
	
    .tab-content {
        display: none;
        padding: 10px;
        width: 100%;
        max-width: 100%;
        box-sizing: border-box;
        position: absolute;
        top: 40px;
        left: 0;
        bottom: 0;
        overflow-y: auto;
    }

    .tab-content-active {
        display: block;
    }
	
	.tabs .tab {
		padding: 15px 10px;    /* Reduz o espa√ßamento lateral de cada aba */
		font-size: 16px;       /* Usa o tamanho de fonte que voc√™ havia gostado */
		white-space: nowrap;   /* Garante que o texto n√£o quebre em duas linhas */ 
		
	}
	
	.tabs .tab {
        padding: 8px 10px;    /* Mant√©m o padding original do mobile */
        font-size: 16px;       /* Mant√©m a fonte original do mobile */
    }
}
/* fim de @media 768px */


.tab-content {
    display: none;
    padding: 10px;
    width: 100%;
    max-width: 100%;
    overflow: hidden;
    box-sizing: border-box;
}

.tab-content-active {
    display: block;
}

.tabs {
    display: flex;
    justify-content: center;
    margin-top: 10px;
    margin-bottom: 15px; /* Aumenta o espa√ßo abaixo das abas */
}

.tab {
    padding: 10px 20px;
    cursor: pointer;
    background: none; /* Remove o fundo cinza */
    border: none; /* Remove a borda antiga */
    border-bottom: 3px solid transparent; /* Borda inferior que ficar√° azul na aba ativa */
    color: #6c757d; /* Cor do texto secund√°ria */
    font-weight: 500;
    transition: all 0.2s ease-in-out; /* Adiciona uma transi√ß√£o suave */
    height: auto; /* Remove a altura fixa */
    display: flex;
    align-items: center;
    margin-bottom: -20px; /* Alinha a borda da aba com a borda do container */
}

.tab:hover {
    color: #0056b3; /* Cor ao passar o mouse */
}

.tab.active {
    background: none; /* Garante que n√£o tenha fundo branco */
    font-weight: 600;
    color: #007bff; /* Cor azul principal para a aba ativa */
    border-bottom-color: #007bff; /* Linha indicadora azul */
}

#usuariosOnline {
    background-color: #f2f2f2;
    font-weight: bold;
    border: 1px solid black;
    padding: 5px;
}

.botao-salvar { 
    position: fixed;
    bottom: 0;
    left: 0;
    width: 100%;
    display: flex;
    justify-content: center;
    background: white; /* Garante que o bot√£o n√£o se sobreponha ao conte√∫do */
    padding: 10px 0; /* Espa√ßamento para melhor apar√™ncia */
    box-shadow: 0 -2px 5px rgba(0, 0, 0, 0.1); /* Sombra para destacar */
    z-index: 1000; /* Garante que o bot√£o fique acima de outros elementos */
}

input[id$="Exceto17_19"] {
    margin-left: 20px; /* Ajuste este valor conforme necess√°rio */
}
input[id$="Exceto7_12"] {
    margin-left: 20px; /* Ajuste este valor conforme necess√°rio */
}
input[id$="Exceto8_12"] {
    margin-left: 20px; /* Ajuste este valor conforme necess√°rio */
}

#convidados {
        overflow-x: hidden !important;
        max-width: 100% !important;
        width: 100%;
        margin-top: 30px; /* Adiciona margem superior */
    }

/* Estilo para elementos desabilitados */
input:disabled, select:disabled, button:disabled {
    cursor: not-allowed; /* Altera o cursor para 'n√£o permitido' */
    opacity: 0.7;       /* Opcional: Diminui a opacidade para indicar que est√° desabilitado */
}

/* Adicione isso na se√ß√£o de estilos */
.piramide-botao {
    background-color: #4CAF50; /* Cor padr√£o */
    color: white;
}

.piramide-botao.ativo {
    background-color: #2E7D32; /* Verde mais escuro para o ativo */
    font-weight: bold;
    box-shadow: 0 0 5px rgba(0,0,0,0.3);
}

/* --- IN√çCIO: CSS para o Modal de Datas Especiais E Bloqueio --- */
.modal-overlay {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.6);
    z-index: 2000;
    justify-content: center;
    align-items: center;
}

.modal-content {
    background-color: white;
    padding: 20px;
    border-radius: 8px;
    box-shadow: 0 5px 15px rgba(0,0,0,0.3);
    width: 90%;
    max-width: 400px;
}

.modal-content h2 {
    margin-top: 0;
    color: #333;
    border-bottom: 1px solid #eee;
    padding-bottom: 10px;
    margin-bottom: 20px; /* Espa√ßo abaixo do t√≠tulo */
    text-align: center;
}

/* Regra para os containers DENTRO do modal */
.modal-content .container {
    gap: 15px;
}

/* Regra para os labels DENTRO do modal */
.modal-content .container label {
    width: 90px;        /* Largura fixa para os labels */
    flex-shrink: 0;     /* Impede que o label encolha */
    text-align: left;
    font-size: 16px;
}

/* Regra para os inputs DENTRO do modal */
.modal-content .container input[type="text"],
.modal-content .container input[type="date"],
.modal-content .container .time-input-wrapper {
    flex: 1; /* Faz o campo de entrada ocupar o espa√ßo restante */
}

.modal-content .container input {
    padding: 8px;
    border: 1px solid #ccc;
    border-radius: 4px;
    font-size: 16px;
    width: 100%;
    box-sizing: border-box;
}

.modal-content .time-input-wrapper {
    display: flex;
    align-items: center;
    gap: 10px;
}

/* Regra para a linha de bot√µes DENTRO do modal */
.modal-content .modal-buttons {
    justify-content: flex-end; /* Alinha os bot√µes √† direita */
    width: 100%;
    margin-top: 15px;
}

.modal-buttons button {
    padding: 8px 15px;
    border-radius: 5px;
    cursor: pointer;
    font-size: 16px;
    width: auto;
    margin: 0;
}

.modal-buttons .btn-adicionar {
    background-color: #4CAF50;
    color: white;
    border: none;
}

.modal-buttons .btn-fechar {
    background-color: #f44336;
    color: white;
    border: none;
}

.modal-content hr {
    width: 100%;
    border: none;
    border-top: 1px solid #eee;
    margin: 20px 0;
}

.modal-content h3 {
    margin-bottom: 10px;
    font-size: 1.1em;
}

#listaExcecoes ul, #listaBloqueios ul {
    list-style: none;
    padding: 0;
    /* As propriedades max-height e overflow-y foram removidas para permitir que a lista cres√ßa */
}

#listaExcecoes li, #listaBloqueios li {
    background-color: #f9f9f9;
    padding: 10px;
    border-radius: 4px;
    margin-bottom: 5px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-size: 15px;
}

#listaExcecoes .btn-remover, #listaBloqueios .btn-remover {
    background-color: #e57373;
    color: white;
    border: none;
    cursor: pointer;
    border-radius: 50%;
    width: 22px;
    height: 22px;
    padding: 0;
    font-size: 12px;
    font-weight: bold;
    display: flex;
    align-items: center;
    justify-content: center;
    line-height: 1;
}

/* --- ADI√á√ÉO PARA DESABILITAR A SELE√á√ÉO DE TEXTO --- */
.no-select {
    -webkit-user-select: none; /* Safari */
    -ms-user-select: none;     /* IE 10+ e Edge */
    user-select: none;         /* Padr√£o */
}

/* --- FIM: CSS para o Modal --- */

/* --- IN√çCIO: Estilo para o modal de Dias da Semana --- */
.dias-semana-label {
    display: flex;       /* Alinha o checkbox e o texto na mesma linha */
    align-items: center; /* Centraliza-os verticalmente */
    font-weight: normal;
    font-size: 16px;
    padding: 8px 0;      /* Adiciona um espa√ßamento vertical entre os dias */
    cursor: pointer;
    gap: 10px;           /* Cria um espa√ßo entre o checkbox e o texto */
}
/* --- FIM: Estilo para o modal de Dias da Semana --- */

#reservasPorConfirmacao.confirmacao-on {
    color: green;
}

#reservasPorConfirmacao.confirmacao-off {
    color: red;
}

/* fim de Estilos para o novo seletor ON/OFF de Confirma√ß√£o */

/* Estilos para o novo seletor edicaoOrganizador */
#edicaoOrganizador.edicao-on {
    color: green;
}

#edicaoOrganizador.edicao-off {
    color: red;
}

#quebraHorarioDomingoAtiva.quebra-on {
    color: green;
}

#quebraHorarioDomingoAtiva.quebra-off {
    color: red;
}

/* Impede a sele√ß√£o de texto nos campos ON/OFF ao pressionar no telem√≥vel */
#quebraHorarioDomingoAtiva,
#edicaoOrganizador,
#reservasPorConfirmacao,
#sistema,
#piramideAtiva,
#duplasAtiva {
    -webkit-user-select: none; /* Safari e Chrome no iOS */
    -moz-user-select: none;    /* Firefox */
    -ms-user-select: none;     /* Internet Explorer/Edge */
    user-select: none;         /* Padr√£o */
}

/* Estilo para o bot√£o de adicionar (+) ao lado do dropdown */
/* CORRE√á√ÉO DEFINITIVA para alinhamento do campo com bot√£o */
.input-group {
    display: flex;
    align-items: center;
    flex: 1;
}

.input-group select {
    width: 100%;
}

.add-button {
    /* Anula os estilos problem√°ticos da regra "button" geral */
    width: auto;
    max-width: none;
    margin: 0;
    padding: 0;

    /* Estilos visuais corretos para o bot√£o '+' */
    background: none;
    border: none;
    color: #007bff;
    cursor: pointer;
    font-size: 28px;
    font-weight: 400;
    line-height: 1;
    margin-left: 8px; /* Espa√ßamento do dropdown */
}

.add-button:hover {
    color: #0056b3;
}

/* Garante que o input de texto tamb√©m se alinhe dentro do grupo */
.input-group input[type="text"] {
    width: 100%;
    padding: 5px;
    box-sizing: border-box;
    border: 1px solid #ced4da;
    border-radius: .25rem;
}

/* Estilo para o campo de texto n√£o edit√°vel */
#arbitro[readonly] {
    background-color: #e9ecef; /* Fundo cinza claro */
    cursor: default;
}

/* Estilo para o novo bot√£o de Mudar/Trocar (üîÅ) */
.swap-button {
    /* Anula os estilos da regra "button" geral */
    width: auto;
    max-width: none;
    margin: 0;
    padding: 0;

    /* Estilos visuais */
    background: none;
    border: none;
    color: #6c757d; /* Um tom de cinza */
    cursor: pointer;
    font-size: 20px; /* Tamanho ajustado para o √≠cone üîÅ */
    line-height: 1;
    margin-left: 8px;
}

.swap-button:hover {
    color: #343a40; /* Cinza mais escuro */
}


/* =================================================================== */
/* REGRA FINAL PARA DIMINUIR E ALINHAR TODOS OS CAMPOS DE RESERVAS   */
/* =================================================================== */

#reservas .container select {
    max-width: 170px;   /*  AJUSTE ESTE VALOR PARA MUDAR A LARGURA */
    width: 100%;
    margin-left: auto;  /* Empurra os campos para a direita */
    flex: initial  ;    /* Impede que os campos se estiquem demais */
}


/* ... seu CSS existente termina aqui ... */

/* --- ESTILOS PARA O MODAL DE ADICIONAR ADMINISTRADOR --- */
.lista-jogadores-scroll {
    max-height: 300px; /* Altura m√°xima da lista */
    overflow-y: auto;  /* Adiciona barra de rolagem vertical */
    border: 1px solid #eee;
    border-radius: 4px;
    margin-top: 15px;
}

.item-jogador {
    padding: 12px 10px;
    cursor: pointer;
    border-bottom: 1px solid #f0f0f0;
    font-size: 16px;
}

.item-jogador:last-child {
    border-bottom: none;
}

.item-jogador:hover {
    background-color: #f5f5f5;
}
/* --- FIM DOS ESTILOS --- */


#containerHorarioDomingo {
        margin-left: 2px !important;
        gap: 2px !important;
    }
    
    #vDomingoAte {
        width: 35px !important;
        font-size: 13px !important;
        padding: 1px !important;
    }
    
    #reservas .container {
        gap: 5px;
    }
}

/* Atualiza o estilo do seletor 'Ativa' (adiciona negrito) */
#duplasAtiva.duplas-on {
    color: green;
    font-weight: bold;
}
#duplasAtiva.duplas-off {
    color: red;
    font-weight: bold;
}

/* NOVO BLOCO: Estilo para o novo seletor 'Ranking' */
#duplasRanking.ranking-on {
    color: green;
    font-weight: bold;
}
#duplasRanking.ranking-off {
    color: red;
    font-weight: bold;
}


/* --- IN√çCIO DOS AJUSTES VISUAIS DO LABEL RANKING --- */
#labelDuplasRanking.clickable-reset {
    cursor: pointer;           /* 1. Altera o cursor para a "m√£ozinha" */
    user-select: none;         /* 2. Impede a sele√ß√£o do texto (padr√£o) */
    -webkit-user-select: none; /* Para navegadores Chrome/Safari */
    -ms-user-select: none;     /* Para navegadores Microsoft */
}
/* --- FIM DOS AJUSTES --- */


</style>



</head>
<body>

<div id="loading">
    Carregando... Aguarde.
</div>

<div id="content">
    <div class="form-container">
        <div class="title-container">
           <span>Configura√ß√µes</span>
        </div>

        <hr class="hr-line">

        <div class="container">
            <label for="sistema">Sistema:</label>
            <select id="sistema" onchange="atualizarEstadoSistema()">
                <option value="ON">ON</option>
                <option value="OFF">OFF</option>
            </select>
            <input type="text" id="usuariosOnline" placeholder="000" readonly maxlength="3" style="width: 40px; height: 15px; text-align: center;" title="N√∫mero de usu√°rios online (3 d√≠gitos)">
            <script>
				document.getElementById('usuariosOnline').addEventListener('mousedown', function(event) {
					event.preventDefault();
					this.blur();
					window.getSelection().removeAllRanges();
				});
			</script>
		</div>
		
		<div class="container">
			<label for="administradores">Administradores:</label>
			<div class="input-group">
				<select id="administradores" 
						class="no-select"
						ondblclick="excluirAdministrador()" 
						title="Selecione um administrador. D√™ um duplo clique (PC) ou pressione e segure (Celular) para excluir.">
				</select>
				<button type="button" class="add-button" title="Adicionar Administrador" onclick="abrirModalAdicionarAdmin()">+</button>
			</div>
		</div>
		
		<div class="container">
            <label for="arbitro">√Årbitro:</label>
            <div class="input-group">
                <input type="text" id="arbitro" readonly placeholder="RONALDO TABORDA">
                <button type="button" class="swap-button" title="Mudar √Årbitro" onclick="abrirModalMudarArbitro()">&#128260;</button>
            </div>
        </div>

        
        <div class="container quadra-container">
            <label for="estadoQuadra1">Quadra 1 - Coberta:</label>
            <select id="estadoQuadra1" class="no-select" onfocus="this.oldValue = this.value;" onchange="handleEstadoQuadraChange(this, 1)" ondblclick="handleEstadoQuadraChange(this, 1)">
                <option value="liberada">Liberada</option>
                <option value="interditada">Interditada</option>
				<option value="bloqueada">Bloqueada</option>
				
            </select>
        </div>
        <div class="container quadra-container">
            <label for="estadoQuadra2">Quadra 2 - Aberta:</label>
            <select id="estadoQuadra2" class="no-select" onfocus="this.oldValue = this.value;" onchange="handleEstadoQuadraChange(this, 2)" ondblclick="handleEstadoQuadraChange(this, 2)">
                <option value="liberada">Liberada</option>
                <option value="interditada">Interditada</option>
				<option value="bloqueada">Bloqueada</option>
            </select>
        </div>
        <div class="container quadra-container">
            <label for="estadoQuadra3">Quadra 3 - Coberta:</label>
            <select id="estadoQuadra3" class="no-select" onfocus="this.oldValue = this.value;" onchange="handleEstadoQuadraChange(this, 3)" ondblclick="handleEstadoQuadraChange(this, 3)">
                <option value="liberada">Liberada</option>
                <option value="interditada">Interditada</option>
				<option value="bloqueada">Bloqueada</option>
            </select>
        </div>
    </div>

    <div id="main-content">
        <div class="tabs">
            <div class="tab active" onclick="showTab('reservas')">Reservas</div>
            <div class="tab" onclick="showTab('duplas')">Duplas</div>
			<div class="tab" onclick="showTab('convidados')">Convidados</div>
            <div class="tab" onclick="showTab('piramide')">Pir√¢mide</div>
        </div>
		
		<div id="reservas" class="tab-content tab-content-active">
			<div style="border: 1px solid #ddd; padding: 15px; border-radius: 5px;">
			
			    <div class="container" style="flex-wrap: nowrap; overflow: visible;">
    <label for="vDomingo" style="flex-shrink: 0;">Estado de Domingo:</label>
    <select id="vDomingo" style="flex-shrink: 0;">
        <option value="aberto">Aberto</option>
        <option value="fechado">Fechado</option>
    </select>
    <div id="containerHorarioDomingo" style="display:none; align-items: center; gap: 0px; white-space: nowrap; flex-shrink: 0; margin-left: 0px;">
        <span style="font-size: 15px; flex-shrink: 0;">üïí</span>
        <input type="text" id="vDomingoAte" readonly style="border: 1px solid #ddd; background: white; font-weight: bold; font-size: 14px; width: 45px; text-align: center; padding: 2px; border-radius: 3px; flex-shrink: 0;" />
    </div>
</div>
				
				

				<div class="container">
					<label for="diasParaAgendar">Dias para Agendar:</label>
					<select id="diasParaAgendar">
						<option value="0">0</option>
						<option value="1">1</option>
						<option value="2">2</option>
						<option value="3">3</option>
						<option value="4">4</option>
					</select>
				</div> 
				
				<div class="container">
					<label for="reservasPorConfirmacao" title="ON: Reservas com m√∫ltiplos s√≥cios exigem que cada um confirme sua presen√ßa.&#10;‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ&#10;OFF: Todas as reservas s√£o confirmadas instantaneamente.">Confirma√ß√£o Reservas:</label>
					<select id="reservasPorConfirmacao" onchange="atualizarEstadoConfirmacao()">
						<option value="ON">ON</option>
						<option value="OFF">OFF</option>
					</select>
				</div>

				

				<div class="container">
					<label for="horasParaExpirar" title="Define o tempo m√°ximo que os jogadores t√™m para aceitar ou recusar um convite.&#10;‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ&#10;Se o prazo expirar, a reserva √© cancelada automaticamente.">Prazo para Confirma√ß√£o:</label>
					<select id="horasParaExpirar">
						<option value="1">1 hora</option>
						<option value="2">2 horas</option>
						<option value="3">3 horas</option>
						<option value="4">4 horas</option>
						<option value="6">6 horas</option>
						<option value="12">12 horas</option> 
					</select>
				</div>
				

				<div class="container">
					<label for="edicaoOrganizador" title="ON: Permite que o organizador de uma reserva pendente possa adicionar ou remover jogadores.&#10;‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ&#10;OFF: O organizador pode apenas excluir a reserva.">Edi√ß√£o pelo Organizador:</label>
					<select id="edicaoOrganizador" onchange="atualizarEstadoEdicaoOrganizador()">
						<option value="ON">ON</option>
						<option value="OFF">OFF</option>
					</select>
				</div>

				

				<div class="container">
					<label for="quebraHorarioDomingoAtiva" title="ON: Permite agendamentos livres no domingo.&#10;‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ&#10;OFF: Abre uma janela para voc√™ escolher em quais quadras a regra de otimiza√ß√£o (apenas reservas 8-10h e 10-12h) ser√° aplicada.">Quebra Hor√°rio Domingo:</label>
					<select id="quebraHorarioDomingoAtiva" onchange="handleQuebraHorarioChange()" ondblclick="if(this.value === 'OFF') { abrirModalQuebraHorario(); }">
						<option value="ON">ON</option>
						<option value="OFF">OFF</option>
					</select>
				</div>

			</div>
		</div>
		
		

        <div id="convidados" class="tab-content">
            <div class="container convidados-quadras">
                <label style="font-weight: bold;">Quadras:</label>
                <div class="convidados-options">
                    <label style="font-weight: normal;"><input type="checkbox" id="convidadosQuadra1" style="margin-top: 5px;"> Quadra 1 - Coberta</label>
                    <label style="font-weight: normal;"><input type="checkbox" id="convidadosQuadra2" style="margin-right: 5px;"> Quadra 2 - Aberta</label>
                    <label style="font-weight: normal;"><input type="checkbox" id="convidadosQuadra3" style="margin-right: 5px;"> Quadra 3 - Coberta</label>
                </div>
            </div>
            <div class="container convidados-dias">
                <label style="font-weight: bold;">Dias:</label>
                <div class="convidados-options">
                    <label style="font-weight: normal;"><input type="checkbox" id="convidadosSemana" style="margin-right: 5px;"> Durante a Semana</label>
                    <label style="font-weight: normal;"><input type="checkbox" id="convidadosFimDeSemana" style="margin-right: 5px;"> Fim de Semana</label>
                </div>
            </div>
        </div>

        <div id="piramide" class="tab-content">
            <div class="container piramide-ativa-container">
				<label for="piramideAtiva">Ativa:</label>
				<select id="piramideAtiva" onchange="handlePiramideChange()">
					<option value="ON">ON</option>
					<option value="OFF">OFF</option>
				</select>
				<span id="piramideInicio" style="display: none; font-weight: bold; margin-left: 10px;"></span>
				<span id="piramideSeparador" style="display: none; margin: 0 5px;">√†</span>
				<span id="piramideFim" style="display: none; font-weight: bold;"></span>
			</div>

            <div class="container piramide-botoes-container">
                <button class="piramide-botao" onclick="mostrarQuadra('quadra1')">Quadra - 1</button>
                <button class="piramide-botao" onclick="mostrarQuadra('quadra2')">Quadra - 2</button>
                <button class="piramide-botao" onclick="mostrarQuadra('quadra3')">Quadra - 3</button>
            </div>

            <div id="piramideQuadra1Container" class="piramide-quadra-container">
                <div class="container piramide-quadras">
                    <div class="piramde-options centraliza-checkbox">
                        <input type="checkbox" id="piramideQuadra1">
                        <span>Quadra 1 - Coberta</span>
                    </div>
                </div>
                <div class="container piramide-dias">
                    <label class="dias-label" style="font-weight: bold;" id="PiramideDiasQuadra1">Dias:</label>
                    <div class="piramde-options">
                        <label style="font-weight: normal;"><input type="checkbox" id="1-piramideSemana" style="margin-right: 5px;"> Dias de Semana</label>
                        <label style="font-weight: normal; color: red;"><input type="checkbox" id="1-piramideExceto17_19" style="margin-right: 5px;"> Exceto 17:00 - 19:00</label>
                        <label style="font-weight: normal;"><input type="checkbox" id="1-piramideSabado" style="margin-right: 5px;"> S√°bado</label>
                        <label style="font-weight: normal; color: red;"><input type="checkbox" id="1-piramideExceto7_12" style="margin-right: 5px;"> Exceto 07:00 - 12:00</label>
                        <label style="font-weight: normal;"><input type="checkbox" id="1-piramideDomingo" style="margin-right: 5px;"> Domingo</label>
                        <label style="font-weight: normal; color: red;"><input type="checkbox" id="1-piramideExceto8_12" style="margin-right: 5px;"> Exceto 08:00 - 12:00</label>
                    </div>
                </div>
            </div>

            <div id="piramideQuadra2Container" class="piramide-quadra-container" style="display: none;">
                <div class="container piramide-quadras">
                    <div class="piramde-options centraliza-checkbox">
                        <input type="checkbox" id="piramideQuadra2">
                        <span>Quadra 2 - Aberta</span>
                    </div>
                </div>
                <div class="container piramide-dias">
                    <label class="dias-label" style="font-weight: bold;" id="PiramideDiasQuadra2">Dias:</label>
                    <div class="piramde-options">
                        <label style="font-weight: normal;"><input type="checkbox" id="2-piramideSemana" style="margin-right: 5px;"> Dias de Semana</label>
                        <label style="font-weight: normal; color: red;"><input type="checkbox" id="2-piramideExceto17_19" style="margin-right: 5px;"> Exceto 17:00 - 19:00</label>
                        <label style="font-weight: normal;"><input type="checkbox" id="2-piramideSabado" style="margin-right: 5px;"> S√°bado</label>
                        <label style="font-weight: normal; color: red;"><input type="checkbox" id="2-piramideExceto7_12" style="margin-right: 5px;"> Exceto 07:00 - 12:00</label>
                        <label style="font-weight: normal;"><input type="checkbox" id="2-piramideDomingo" style="margin-right: 5px;"> Domingo</label>
                        <label style="font-weight: normal; color: red;"><input type="checkbox" id="2-piramideExceto8_12" style="margin-right: 5px;"> Exceto 08:00 - 12:00</label>
                    </div>
                </div>
            </div>

            <div id="piramideQuadra3Container" class="piramide-quadra-container" style="display: none;">
                <div class="container piramide-quadras">
                    <div class="piramde-options centraliza-checkbox">
                        <input type="checkbox" id="piramideQuadra3">
                        <span>Quadra 3 - Coberta</span>
                    </div>
                </div>
                <div class="container piramide-dias">
                    <label class="dias-label" style="font-weight: bold;" id="PiramideDiasQuadra3">Dias:</label>
                    <div class="piramde-options">
                        <label style="font-weight: normal;"><input type="checkbox" id="3-piramideSemana" style="margin-right: 5px;"> Dias de Semana</label>
                        <label style="font-weight: normal; color: red;"><input type="checkbox" id="3-piramideExceto17_19" style="margin-right: 5px;"> Exceto 17:00 - 19:00</label>
                        <label style="font-weight: normal;"><input type="checkbox" id="3-piramideSabado" style="margin-right: 5px;"> S√°bado</label>
                        <label style="font-weight: normal; color: red;"><input type="checkbox" id="3-piramideExceto7_12" style="margin-right: 5px;"> Exceto 07:00 - 12:00</label>
                        <label style="font-weight: normal;"><input type="checkbox" id="3-piramideDomingo" style="margin-right: 5px;"> Domingo</label>
                        <label style="font-weight: normal; color: red;"><input type="checkbox" id="3-piramideExceto8_12" style="margin-right: 5px;"> Exceto 08:00 - 12:00</label>
                    </div>
                </div>
            </div>
        </div>
		
		<div id="duplas" class="tab-content">
            <div class="container duplas-ativa-container">
                <label for="duplasAtiva">Ativa:</label>
                <select id="duplasAtiva" onchange="atualizarEstadoDuplas()">
                    <option value="ON">ON</option>
                    <option value="OFF">OFF</option>
                </select>
                
                <label id="labelDuplasRanking" for="duplasRanking" style="margin-left: 15px;" title="Com o Ranking em OFF, d√™ um triplo clique aqui para zerar os dados do ranking.">Ranking:</label> 
                <select id="duplasRanking" onchange="atualizarEstadoDuplasRanking()">
                    <option value="ON">ON</option>
                    <option value="OFF">OFF</option>
                </select>
            </div>

            <div class="container duplas-botoes-container">
                <button class="duplas-botao" onclick="mostrarDuplasQuadra('quadra1')">Quadra - 1</button>
                <button class="duplas-botao" onclick="mostrarDuplasQuadra('quadra2')">Quadra - 2</button>
                <button class="duplas-botao" onclick="mostrarDuplasQuadra('quadra3')">Quadra - 3</button>
            </div>

            <div id="duplasQuadra1Container" class="duplas-container">
                <div class="centraliza-checkbox">
                    <input type="checkbox" id="duplasQuadra1Ativa">
                    <span>Quadra 1 - Coberta</span>
                </div>
                <div class="container">
                    <label class="dias-label" style="font-weight: bold;" id="DuplasDiasQuadra1">Dias:</label>
                    <div class="duplas-options">
                        <div class="duplas-day-container">
							<div style="display: flex; align-items: center;"> <input type="checkbox" id="1-duplasSemana">
								<span class="dias-semana-label-clickable" style="margin-left: 5px; user-select: none;">Dias de Semana</span>
							</div>
							<div class="duplas-time-wrapper">
								<input type="text" id="1-duplasSemanaInicio" class="horario-input" placeholder="HH:MM"> :
								<input type="text" id="1-duplasSemanaFim" class="horario-input" placeholder="HH:MM">
							</div>
						</div>
                        <div class="duplas-day-container">
                            <label><input type="checkbox" id="1-duplasSabado"> S√°bado</label>
                            <div class="duplas-time-wrapper">
                                <input type="text" id="1-duplasSabadoInicio" class="horario-input" placeholder="HH:MM"> :
                                <input type="text" id="1-duplasSabadoFim" class="horario-input" placeholder="HH:MM">
                            </div>
                        </div>
                        <div class="duplas-day-container">
                            <label><input type="checkbox" id="1-duplasDomingo"> Domingo</label>
                            <div class="duplas-time-wrapper">
                                <input type="text" id="1-duplasDomingoInicio" class="horario-input" placeholder="HH:MM"> :
                                <input type="text" id="1-duplasDomingoFim" class="horario-input" placeholder="HH:MM">
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="duplasQuadra2Container" class="duplas-container" style="display: none;">
                 <div class="centraliza-checkbox">
                    <input type="checkbox" id="duplasQuadra2Ativa">
                    <span>Quadra 2 - Aberta</span>
                </div>
                <div class="container">
                    <label class="dias-label" style="font-weight: bold;" id="DuplasDiasQuadra2">Dias:</label>
                    <div class="duplas-options">
                        <div class="duplas-day-container">
							<div style="display: flex; align-items: center;"> <input type="checkbox" id="2-duplasSemana">
								<span class="dias-semana-label-clickable" style="margin-left: 5px; user-select: none;">Dias de Semana</span>
							</div>
							<div class="duplas-time-wrapper">
								<input type="text" id="2-duplasSemanaInicio" class="horario-input" placeholder="HH:MM"> :
								<input type="text" id="2-duplasSemanaFim" class="horario-input" placeholder="HH:MM">
							</div>
						</div>
                        <div class="duplas-day-container">
                            <label><input type="checkbox" id="2-duplasSabado"> S√°bado</label>
                            <div class="duplas-time-wrapper">
                                <input type="text" id="2-duplasSabadoInicio" class="horario-input" placeholder="HH:MM"> :
                                <input type="text" id="2-duplasSabadoFim" class="horario-input" placeholder="HH:MM">
                            </div>
                        </div>
                        <div class="duplas-day-container">
                            <label><input type="checkbox" id="2-duplasDomingo"> Domingo</label>
                            <div class="duplas-time-wrapper">
                                <input type="text" id="2-duplasDomingoInicio" class="horario-input" placeholder="HH:MM"> :
                                <input type="text" id="2-duplasDomingoFim" class="horario-input" placeholder="HH:MM">
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="duplasQuadra3Container" class="duplas-container" style="display: none;">
                 <div class="centraliza-checkbox">
                    <input type="checkbox" id="duplasQuadra3Ativa">
                    <span>Quadra 3 - Coberta</span>
                </div>
                <div class="container">
                    <label class="dias-label" style="font-weight: bold;" id="DuplasDiasQuadra3">Dias:</label>
                    <div class="duplas-options">
                        <div class="duplas-day-container">
							<div style="display: flex; align-items: center;"> <input type="checkbox" id="3-duplasSemana">
								<span class="dias-semana-label-clickable" style="margin-left: 5px; user-select: none;">Dias de Semana</span>
							</div>
							<div class="duplas-time-wrapper">
								<input type="text" id="3-duplasSemanaInicio" class="horario-input" placeholder="HH:MM"> :
								<input type="text" id="3-duplasSemanaFim" class="horario-input" placeholder="HH:MM">
							</div>
						</div>
                        <div class="duplas-day-container">
                            <label><input type="checkbox" id="3-duplasSabado"> S√°bado</label>
                            <div class="duplas-time-wrapper">
                                <input type="text" id="3-duplasSabadoInicio" class="horario-input" placeholder="HH:MM"> :
                                <input type="text" id="3-duplasSabadoFim" class="horario-input" placeholder="HH:MM">
                            </div>
                        </div>
                        <div class="duplas-day-container">
                            <label><input type="checkbox" id="3-duplasDomingo"> Domingo</label>
                            <div class="duplas-time-wrapper">
                                <input type="text" id="3-duplasDomingoInicio" class="horario-input" placeholder="HH:MM"> :
                                <input type="text" id="3-duplasDomingoFim" class="horario-input" placeholder="HH:MM">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>  
	
	
    <div class="container botao-salvar">
        <button onclick="salvarConfiguracoes()" id="button-piramide">Salvar Configura√ß√µes</button> 
    </div>
	
</div>

<div id="modalDatasEspeciais" class="modal-overlay"> 
    <div class="modal-content">
        <h2 id="modalTitulo">Exce√ß√µes Quadra 1</h2>
        
        <div class="container">
            <label for="excecaoDescricao">Descri√ß√£o:</label>
            <input type="text" id="excecaoDescricao">
        </div>

        <div class="container">
            <label for="excecaoData">Data:</label>
            <input type="text" id="excecaoData" placeholder="dd/mm/aaaa" oninput="formatarDataInput(event)">
        </div>

        <div class="container">
            <label>Hor√°rio:</label>
            <div style="display: flex; align-items: center; gap: 10px; width: 100%;">
                <input type="time" id="excecaoInicio">
                <span>√†s</span>
                <input type="time" id="excecaoFim">
            </div>
        </div>
        
        <div class="container modal-buttons">
            <button class="btn-fechar" onclick="fecharModalExcecao()">Fechar</button>
            <button class="btn-adicionar" onclick="adicionarExcecao()">Adicionar</button>
        </div>
        
        <hr>
        <h3>Exce√ß√µes Configuradas</h3>
        <div id="listaExcecoes">
        </div>
    </div>
</div>

<div id="modalBloqueioQuadra" class="modal-overlay"> 
    <div class="modal-content">
        <h2 id="modalBloqueioTitulo">Bloqueio Quadra 1</h2>
        
        <div class="container">
            <label for="bloqueioDescricao">Descri√ß√£o:</label>
            <input type="text" id="bloqueioDescricao">
        </div>

        <div class="container">
            <label for="bloqueioData">Data:</label>
            <input type="text" id="bloqueioData" placeholder="dd/mm/aaaa" oninput="formatarDataInput(event)">
        </div>

        <div class="container">
            <label>Hor√°rio:</label>
            <div style="display: flex; align-items: center; gap: 10px; width: 100%;">
                <input type="time" id="bloqueioInicio">
                <span>√†s</span>
                <input type="time" id="bloqueioFim">
            </div>
        </div>
        
        <div class="container modal-buttons">
            <button class="btn-fechar" onclick="fecharModalBloqueio()">Fechar</button>
            <button class="btn-adicionar" onclick="adicionarBloqueio()">Adicionar</button>
        </div>
        
        <hr>
        <h3>Bloqueios Configurados</h3>
        <div id="listaBloqueios">
        </div>
    </div>
</div>


<div id="modalDiasSemanaDuplas" class="modal-overlay">
    <div class="modal-content">
        <h2 id="modalDiasSemanaTitulo">Dias de Semana - Duplas</h2>
        
        <div id="diasSemanaCheckboxContainer">
            <label class="dias-semana-label"><input type="checkbox" id="duplas-segunda"> Segunda-Feira</label>
            <label class="dias-semana-label"><input type="checkbox" id="duplas-terca"> Ter√ßa-Feira</label>
            <label class="dias-semana-label"><input type="checkbox" id="duplas-quarta"> Quarta-Feira</label>
            <label class="dias-semana-label"><input type="checkbox" id="duplas-quinta"> Quinta-Feira</label>
            <label class="dias-semana-label"><input type="checkbox" id="duplas-sexta"> Sexta-Feira</label>
        </div>
        
        <hr>

        <div class="container modal-buttons">
            <button class="btn-fechar" onclick="fecharModalDiasSemana()">Fechar</button>
            <button class="btn-adicionar" onclick="salvarModalDiasSemana()">Salvar</button>
        </div>
    </div>
</div>

<div id="modalQuebraHorarioQuadras" class="modal-overlay">
    <div class="modal-content">
        <h2 id="modalQuebraHorarioTitulo">Otimiza√ß√£o de Domingo   Selecionar Quadras</h2>
        
        <div id="quebraHorarioCheckboxContainer">
            <label class="dias-semana-label"><input type="checkbox" id="quebraHorarioQuadra1"> Quadra 1 - Coberta</label>
            <label class="dias-semana-label"><input type="checkbox" id="quebraHorarioQuadra2"> Quadra 2 - Aberta</label>
            <label class="dias-semana-label"><input type="checkbox" id="quebraHorarioQuadra3"> Quadra 3 - Coberta</label>
        </div>
        
        <hr>

        <div class="container modal-buttons">
            <button class="btn-fechar" onclick="fecharModalQuebraHorario()">Fechar</button>
            <button class="btn-adicionar" onclick="salvarModalQuebraHorario()">Salvar</button>
        </div>
    </div>
</div>


<div id="modalAdicionarAdmin" class="modal-overlay">
    <div class="modal-content">
        <h2>Adicionar Novo Administrador</h2>
        
        <div class="container">
            <input type="text" id="buscaJogadorInput" oninput="filtrarJogadores()" placeholder="Buscar jogador pelo apelido..." style="width: 100%; padding: 8px; font-size: 16px;">
        </div>

        <div id="listaJogadoresContainer" class="lista-jogadores-scroll">
            </div>
        
        <hr>

        <div class="container modal-buttons">
            <button class="btn-fechar" onclick="fecharModalAdicionarAdmin()">Fechar</button>
        </div>
    </div>
</div>

<div id="modalMudarArbitro" class="modal-overlay">
    <div class="modal-content">
        <h2>Mudar √Årbitro</h2>
        
        <div class="container">
            <input type="text" id="buscaArbitroInput" oninput="filtrarJogadoresArbitro()" placeholder="Buscar jogador pelo nome completo..." style="width: 100%; padding: 8px; font-size: 16px;">
        </div>

        <div id="listaJogadoresArbitroContainer" class="lista-jogadores-scroll">
            </div>
        
        <hr>

        <div class="container modal-buttons">
            <button class="btn-fechar" onclick="fecharModalMudarArbitro()">Fechar</button>
        </div>
    </div>
</div>


<script>
    const firebaseConfig = {
        apiKey: "YOUR_API_KEY",
        authDomain: "agenda-5ce95.firebaseapp.com",
        databaseURL: "https://agenda-5ce95-default-rtdb.firebaseio.com/",
        projectId: "agenda-5ce95",
        storageBucket: "agenda-5ce95.appspot.com",
        messagingSenderId: "852007565195",
        appId: "1:852007565195:web:d7bd789d140858f53f618e"
    };
    const app = firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    const usuariosOnlineInput = document.getElementById('usuariosOnline'); // Declare fora do listener
    let listaUsuariosOnline = []; // Se voc√™ for usar esta lista aqui, tamb√©m declare fora
	let excecoesDuplas = {}; // Objeto para armazenar o estado das exce√ß√µes
	let vlimparExcecoesAntigas = false;
	let vlimparBloqueiosAntigos = false;
	// INSIRA ESTAS DUAS LINHAS
	let quadraAtualParaDiasSemana = null;
	let diasSemanaDuplasConfig = {};
	

  db.ref("sistemas/usuariosOnline").on("value", snapshot => {
        const numUsuariosOnline = snapshot.numChildren();
        console.log(`Usu√°rios ativos: ${numUsuariosOnline}`);
        usuariosOnlineInput.value = numUsuariosOnline.toString().padStart(3, '0');

        // Atualiza a lista de usu√°rios
        listaUsuariosOnline = [];
        snapshot.forEach(childSnapshot => {
            const usuario = childSnapshot.val().usuario;
            listaUsuariosOnline.push(usuario);
        });
    });

    usuariosOnlineInput.addEventListener('click', function() {
        exibirUsuariosLogados();
    });

    function exibirUsuariosLogados() {
        if (listaUsuariosOnline.length > 0) {
            const mensagem = "Usu√°rios Logados:\n" + listaUsuariosOnline.join("\n");
            alert(mensagem);
        } else {
            alert("Nenhum usu√°rio logado no momento.");
        }
    }
	
function showTab(tabId) {
    document.querySelectorAll('.tab-content').forEach(content => {
        content.classList.remove('tab-content-active');
    });
    document.querySelectorAll('.tab').forEach(button => {
        button.classList.remove('active');
    });

    document.getElementById(tabId).classList.add('tab-content-active');
    document.querySelector(`.tab[onclick="showTab('${tabId}')"]`).classList.add('active');

    // Se for a aba Pir√¢mide, garante que "Quadra 1" aparece
    if (tabId === 'piramide') {
        mostrarQuadra('quadra1');
    }

    // Se for a aba Duplas, garante que "Quadra 1" aparece
    if (tabId === 'duplas') {
        mostrarDuplasQuadra('quadra1');
    }
	
	if (tabId === 'reservas') {
		atualizarEstadoConfirmacao(); // <-- for√ßa aplicar a cor correta ao abrir a aba
		atualizarEstadoEdicaoOrganizador();
		atualizarEstadoQuebraDomingo();
	}
	

}

		
		
		
    function atualizarEstadoSistema() {
    // Adicione esta linha para depura√ß√£o
		console.log("Fun√ß√£o atualizarEstadoSistema foi chamada!"); 

		const sistema = document.getElementById('sistema');
		if (sistema.value === 'ON') {
			sistema.style.backgroundColor = 'green';
			sistema.style.color = 'white';
		} else {
			sistema.style.backgroundColor = 'red';
			sistema.style.color = 'white';
		}
	}
	
	
 function atualizarEstadoPiramide() {
    const piramideAtiva = document.getElementById("piramideAtiva");
    const piramideTab = document.getElementById("piramide");
    const piramideBotoes = document.querySelectorAll("#piramide .piramide-botao");
    const piramideInicioEl = document.getElementById("piramideInicio");
    const piramideFimEl = document.getElementById("piramideFim");
    const piramideSeparadorEl = document.getElementById("piramideSeparador");

    if (piramideAtiva.value === 'ON') {
        piramideAtiva.classList.remove("piramide-off");
        piramideAtiva.classList.add("piramide-on");

        const inicio = window.piramideInicioData;
        const fim = window.piramideFimData;

        // Apenas mostra as datas se elas existirem
        if (inicio && fim) {
            piramideInicioEl.textContent = inicio.replace(/-/g, '/');
            piramideFimEl.textContent = fim.replace(/-/g, '/');
            piramideInicioEl.style.display = 'inline';
            piramideFimEl.style.display = 'inline';
            piramideSeparadorEl.style.display = 'inline';
        }

        // Habilita os controles
        piramideTab.querySelectorAll('input, select, button').forEach(el => el.disabled = false);
        piramideBotoes.forEach(botao => botao.disabled = false);
        atualizarCamposPiramideQuadra1();
        atualizarCamposPiramideQuadra2();
        atualizarCamposPiramideQuadra3();

    } else { // Se o valor for "OFF"
        piramideAtiva.classList.remove("piramide-on");
        piramideAtiva.classList.add("piramide-off");

        // Esconde as datas
        piramideInicioEl.style.display = 'none';
        piramideFimEl.style.display = 'none';
        piramideSeparadorEl.style.display = 'none';

        // Desabilita os controles
        const todosElementos = piramideTab.querySelectorAll('input, select, button');
        todosElementos.forEach(el => {
            el.disabled = true;
        });
        piramideAtiva.disabled = false;
        piramideBotoes.forEach(botao => botao.disabled = true);
    }
}

// =====================================================================
// IN√çCIO DO NOVO BLOCO DE C√ìDIGO - SUBSTITUA A FUN√á√ÉO ANTIGA POR ESTE
// =====================================================================

function handlePiramideChange() {
    const piramideAtivaSelect = document.getElementById("piramideAtiva");
    const piramideRef = db.ref('sistemas/config/Piramide'); // Refer√™ncia direta ao n√≥ da Pir√¢mide no Firebase

    if (piramideAtivaSelect.value === "ON") {
        // --- L√ìGICA PARA ATIVAR A PIR√ÇMIDE ---
        piramideRef.once('value', snapshot => {
            const config = snapshot.val() || {};
            const inicioSalvo = config.inicio;
            const fimSalvo = config.fim;

            let operacaoValida = true; // Flag para controlar se a opera√ß√£o foi bem-sucedida

            // 1. Verifica se j√° existem datas salvas no banco
            if (inicioSalvo && fimSalvo) {
                const manter = confirm(`J√° existem datas cadastradas (${inicioSalvo} a ${fimSalvo}).\n\nDeseja mant√™-las?`);
                
                if (manter) {
                    // 2. Se o usu√°rio quer manter, apenas atualizamos as vari√°veis locais para a UI
                    window.piramideInicioData = inicioSalvo;
                    window.piramideFimData = fimSalvo;
                } else {
                    // 3. Se n√£o quer manter, solicita novas datas
                    operacaoValida = solicitarNovasDatasPiramide();
                }
            } else {
                // 4. Se n√£o existem datas, solicita novas datas
                operacaoValida = solicitarNovasDatasPiramide();
            }

            // Se o usu√°rio cancelou o prompt ou inseriu dados inv√°lidos, revertemos o dropdown
            if (!operacaoValida) {
                piramideAtivaSelect.value = "OFF";
            }
            
            // Atualiza a interface gr√°fica para refletir o estado final
            atualizarEstadoPiramide();
        });

    } else {
        // --- L√ìGICA PARA DESATIVAR A PIR√ÇMIDE (mantida a sua l√≥gica original) ---
        if (window.piramideInicioData || window.piramideFimData) {
            const zerarDatas = confirm(
                "Voc√™ desativou a Pir√¢mide.\n\nDeseja apagar as datas do torneio (In√≠cio e Fim)?\n\n- Clique em 'OK' para apagar as datas.\n- Clique em 'Cancelar' para mant√™-las salvas para o futuro."
            );

            if (zerarDatas) { 
                window.piramideInicioData = "";
                window.piramideFimData = "";
                alert("As datas do torneio foram zeradas. Clique em 'Salvar Configura√ß√µes' para confirmar a altera√ß√£o.");
            }
        }
        atualizarEstadoPiramide();   
    }
}

/**
 * Fun√ß√£o auxiliar para solicitar e validar novas datas da Pir√¢mide.
 * Retorna true se as datas foram inseridas com sucesso, e false caso contr√°rio.
 */
function solicitarNovasDatasPiramide() {
    const inicio = prompt("Digite a data de IN√çCIO do torneio (formato dd-mm-aaaa):");
    if (inicio === null) {
        alert("Ativa√ß√£o cancelada.");
        return false;
    }

    const fim = prompt("Digite a data de FIM do torneio (formato dd-mm-aaaa):");
    if (fim === null) {
        alert("Ativa√ß√£o cancelada.");
        return false;
    }

    // Valida√ß√£o do formato das datas
    if (!/^\d{2}-\d{2}-\d{4}$/.test(inicio) || !/^\d{2}-\d{2}-\d{4}$/.test(fim)) {
        alert("Formato de data inv√°lido. Por favor, use dd-mm-aaaa. A ativa√ß√£o foi cancelada.");
        return false;
    }

    // Salva as novas datas nas vari√°veis globais que a fun√ß√£o salvarConfiguracoes() ir√° usar
    window.piramideInicioData = inicio;
    window.piramideFimData = fim;
    return true;
}

// =====================================================================
// FIM DO NOVO BLOCO DE C√ìDIGO
// =====================================================================

function atualizarCamposPiramideQuadra1() {
    const piramideAtiva = document.getElementById('piramideAtiva').value === 'ON';
    const quadra1Ativa = document.getElementById('piramideQuadra1').checked; // Novo: Verifica se a quadra est√° ativa
    const piramideSemana = document.getElementById('1-piramideSemana');
    const piramideExceto17_19 = document.getElementById('1-piramideExceto17_19');
    const piramideSabado = document.getElementById('1-piramideSabado');
    const piramideExceto7_12 = document.getElementById('1-piramideExceto7_12');
    const piramideDomingo = document.getElementById('1-piramideDomingo');
    const piramideExceto8_12 = document.getElementById('1-piramideExceto8_12');

    // Desabilita ou habilita os campos da Quadra 1
    const quadra1Container = document.getElementById('piramideQuadra1Container');
    const inputsQuadra1 = quadra1Container.querySelectorAll('input, select');
    inputsQuadra1.forEach(input => {
        input.disabled = !piramideAtiva || !quadra1Ativa; // Modificado: Desabilita se piramide n√£o ativa OU quadra n√£o ativa
    });

    // Habilita/desabilita 'piramideAtiva' e 'piramideQuadra1' sempre
    document.getElementById('piramideAtiva').disabled = false;
    document.getElementById('piramideQuadra1').disabled = !piramideAtiva; // Mant√©m habilitado se a pir√¢mide estiver ativa

    // Verifica o estado do checkbox "Dias de Semana"
    if (piramideSemana) {
        if (!piramideSemana.checked) {
            if (piramideExceto17_19) {
                piramideExceto17_19.disabled = true;
                piramideExceto17_19.checked = false;
            }
        } else {
            if (piramideExceto17_19) {
                // CORRIGIDO: Adicionada a verifica√ß√£o de 'piramideAtiva' para n√£o reabilitar indevidamente.
                piramideExceto17_19.disabled = !piramideAtiva || !quadra1Ativa;
            }
        }
    }

    // Verifica o estado do checkbox "S√°bado"
    if (piramideSabado) {
        if (!piramideSabado.checked) {
            if (piramideExceto7_12) {
                piramideExceto7_12.disabled = true;
                piramideExceto7_12.checked = false;
            }
        } else {
            if (piramideExceto7_12) {
                 // CORRIGIDO: Adicionada a verifica√ß√£o de 'piramideAtiva' para n√£o reabilitar indevidamente.
                piramideExceto7_12.disabled = !piramideAtiva || !quadra1Ativa;
            }
        }
    }

    // Verifica o estado do checkbox "Domingo"
    if (piramideDomingo) {
        if (!piramideDomingo.checked) {
            if (piramideExceto8_12) {
                piramideExceto8_12.disabled = true;
                piramideExceto8_12.checked = false;
            }
        } else {
            if (piramideExceto8_12) {
                 // CORRIGIDO: Adicionada a verifica√ß√£o de 'piramideAtiva' para n√£o reabilitar indevidamente.
                piramideExceto8_12.disabled = !piramideAtiva || !quadra1Ativa;
            }
        }
    }
}



function atualizarCamposPiramideQuadra2() {
    const piramideAtiva = document.getElementById('piramideAtiva').value === 'ON';
    const quadra2Ativa = document.getElementById('piramideQuadra2').checked; // Novo
    const piramideSemana = document.getElementById('2-piramideSemana');
    const piramideExceto17_19 = document.getElementById('2-piramideExceto17_19');
    const piramideSabado = document.getElementById('2-piramideSabado');
    const piramideExceto7_12 = document.getElementById('2-piramideExceto7_12');
    const piramideDomingo = document.getElementById('2-piramideDomingo');
    const piramideExceto8_12 = document.getElementById('2-piramideExceto8_12');

    // Desabilita ou habilita os campos da Quadra 2
    const quadra2Container = document.getElementById('piramideQuadra2Container');
    const inputsQuadra2 = quadra2Container.querySelectorAll('input, select');
    inputsQuadra2.forEach(input => {
        input.disabled = !piramideAtiva || !quadra2Ativa; // Modificado
    });

    // Habilita/desabilita 'piramideAtiva' e 'piramideQuadra2' sempre
    document.getElementById('piramideAtiva').disabled = false;
    document.getElementById('piramideQuadra2').disabled = !piramideAtiva; // Mant√©m habilitado se a pir√¢mide estiver ativa

    // Verifica o estado do checkbox "Dias de Semana"
    if (piramideSemana) {
        if (!piramideSemana.checked) {
            if (piramideExceto17_19) {
                piramideExceto17_19.disabled = true;
                piramideExceto17_19.checked = false;
            }
        } else {
            if (piramideExceto17_19) {
                // CORRIGIDO: Adicionada a verifica√ß√£o de 'piramideAtiva' para n√£o reabilitar indevidamente.
                piramideExceto17_19.disabled = !piramideAtiva || !quadra2Ativa;
            }
        }
    }

    // Verifica o estado do checkbox "S√°bado"
    if (piramideSabado) {
        if (!piramideSabado.checked) {
            if (piramideExceto7_12) {
                piramideExceto7_12.disabled = true;
                piramideExceto7_12.checked = false;
            }
        } else {
            if (piramideExceto7_12) {
                // CORRIGIDO: Adicionada a verifica√ß√£o de 'piramideAtiva' para n√£o reabilitar indevidamente.
                piramideExceto7_12.disabled = !piramideAtiva || !quadra2Ativa;
            }
        }
    }

    // Verifica o estado do checkbox "Domingo"
    if (piramideDomingo) {
        if (!piramideDomingo.checked) {
            if (piramideExceto8_12) {
                piramideExceto8_12.disabled = true;
                piramideExceto8_12.checked = false;
            }
        } else {
            if (piramideExceto8_12) {
                // CORRIGIDO: Adicionada a verifica√ß√£o de 'piramideAtiva' para n√£o reabilitar indevidamente.
                piramideExceto8_12.disabled = !piramideAtiva || !quadra2Ativa;
            }
        }
    }
}



function atualizarCamposPiramideQuadra3() {
    const piramideAtiva = document.getElementById('piramideAtiva').value === 'ON';
    const quadra3Ativa = document.getElementById('piramideQuadra3').checked; // Novo
    const piramideSemana = document.getElementById('3-piramideSemana');
    const piramideExceto17_19 = document.getElementById('3-piramideExceto17_19');
    const piramideSabado = document.getElementById('3-piramideSabado');
    const piramideExceto7_12 = document.getElementById('3-piramideExceto7_12');
    const piramideDomingo = document.getElementById('3-piramideDomingo');
    const piramideExceto8_12 = document.getElementById('3-piramideExceto8_12');

    // Desabilita ou habilita os campos da Quadra 3
    const quadra3Container = document.getElementById('piramideQuadra3Container');
    const inputsQuadra3 = quadra3Container.querySelectorAll('input, select');
    inputsQuadra3.forEach(input => {
        input.disabled = !piramideAtiva || !quadra3Ativa; // Modificado
    });

    // Habilita/desabilita 'piramideAtiva' e 'piramideQuadra3' sempre
    document.getElementById('piramideAtiva').disabled = false;
    document.getElementById('piramideQuadra3').disabled = !piramideAtiva; // Mant√©m habilitado se a pir√¢mide estiver ativa

    // Verifica o estado do checkbox "Dias de Semana"
    if (piramideSemana) {
        if (!piramideSemana.checked) {
            if (piramideExceto17_19) {
                piramideExceto17_19.disabled = true;
                piramideExceto17_19.checked = false;
            }
        } else {
            if (piramideExceto17_19) {
                // CORRIGIDO: Adicionada a verifica√ß√£o de 'piramideAtiva' para n√£o reabilitar indevidamente.
                piramideExceto17_19.disabled = !piramideAtiva || !quadra3Ativa;
            }
        }
    }

    // Verifica o estado do checkbox "S√°bado"
    if (piramideSabado) {
        if (!piramideSabado.checked) {
            if (piramideExceto7_12) {
                piramideExceto7_12.disabled = true;
                piramideExceto7_12.checked = false;
            }
        } else {
            if (piramideExceto7_12) {
                // CORRIGIDO: Adicionada a verifica√ß√£o de 'piramideAtiva' para n√£o reabilitar indevidamente.
                piramideExceto7_12.disabled = !piramideAtiva || !quadra3Ativa;
            }
        }
    }

    // Verifica o estado do checkbox "Domingo"
    if (piramideDomingo) {
        if (!piramideDomingo.checked) {
            if (piramideExceto8_12) {
                piramideExceto8_12.disabled = true;
                piramideExceto8_12.checked = false;
            }
        } else {
            if (piramideExceto8_12) {
                // CORRIGIDO: Adicionada a verifica√ß√£o de 'piramideAtiva' para n√£o reabilitar indevidamente.
                piramideExceto8_12.disabled = !piramideAtiva || !quadra3Ativa;
            }
        }
    }
}


// ADICIONE ESTA NOVA FUN√á√ÉO
function atualizarEstadoDuplas() {
    const duplasAtivaSelect = document.getElementById('duplasAtiva');
    const isAtiva = duplasAtivaSelect.value === 'ON';
    const duplasTab = document.getElementById('duplas');

    // L√≥gica de cores
    if (isAtiva) {
        duplasAtivaSelect.classList.remove('duplas-off');
        duplasAtivaSelect.classList.add('duplas-on');
    } else {
        duplasAtivaSelect.classList.remove('duplas-on');
        duplasAtivaSelect.classList.add('duplas-off');
    }

    // Habilita/desabilita todos os campos da aba
    const allFields = duplasTab.querySelectorAll('input, button');
    allFields.forEach(field => {
        field.disabled = !isAtiva;
    });

    // --- NOVA L√ìGICA ADICIONADA ---
    // Habilita/desabilita os labels de "Dias" para o duplo clique
    for (let i = 1; i <= 3; i++) {
        const labelDias = document.getElementById(`DuplasDiasQuadra${i}`);
        if (labelDias) {
            if (isAtiva) {
                labelDias.classList.remove('disabled');
            } else {
                labelDias.classList.add('disabled');
            }
        }
    }
    // --- FIM DA NOVA L√ìGICA ---

    // Garante que o seletor "Ativa" nunca seja desabilitado
    duplasAtivaSelect.disabled = false;

    // Atualiza o estado de cada quadra individualmente
    atualizarCamposDaQuadraDuplas(1);
    atualizarCamposDaQuadraDuplas(2);
    atualizarCamposDaQuadraDuplas(3);
}

// ADICIONE ESTA NOVA FUN√á√ÉO
function atualizarCamposDaQuadraDuplas(quadraNumero) {
    const isDuplasAtiva = document.getElementById('duplasAtiva').value === 'ON';
    const isQuadraAtiva = document.getElementById(`duplasQuadra${quadraNumero}Ativa`).checked;

    // --- L√ìGICA ADICIONADA ---
    const labelDias = document.getElementById(`DuplasDiasQuadra${quadraNumero}`);
    if (labelDias) {
        // Desabilita o label 'Dias:' se a aba Duplas ou a quadra espec√≠fica estiverem inativas.
        if (!isDuplasAtiva || !isQuadraAtiva) {
            labelDias.classList.add('disabled');
        } else {
            labelDias.classList.remove('disabled');
        }
    }
    // --- FIM DA L√ìGICA ADICIONADA ---

    const dias = ['Semana', 'Sabado', 'Domingo'];

    dias.forEach(dia => {
        const diaCheckbox = document.getElementById(`${quadraNumero}-duplas${dia}`);
        if (!diaCheckbox) return;

        const dayContainer = diaCheckbox.closest('.duplas-day-container');
        const timeInputs = dayContainer.querySelectorAll('.horario-input');

        // Habilita/desabilita o checkbox do dia
        diaCheckbox.disabled = !isDuplasAtiva || !isQuadraAtiva;

        // Habilita/desabilita os campos de hor√°rio
        const shouldTimeBeDisabled = !isDuplasAtiva || !isQuadraAtiva || !diaCheckbox.checked;
        timeInputs.forEach(input => {
            input.disabled = shouldTimeBeDisabled;
            if (shouldTimeBeDisabled) {
                // ANTES: input.value = '';
                // CORRIGIDO: A linha acima foi removida para preservar o valor.
            }
        });
    });
	
	// --- INSIRA O BLOCO DE C√ìDIGO ABAIXO NO FINAL DA FUN√á√ÉO ---
    // --- ATUALIZADO: Atualiza o cursor do label "Dias de Semana" ---
	const semanaLabel = document.querySelector(`#duplasQuadra${quadraNumero}Container .dias-semana-label-clickable`);
	const semanaCheckbox = document.getElementById(`${quadraNumero}-duplasSemana`);

	// A condi√ß√£o agora verifica se a aba, a quadra e o dia da semana est√£o todos ativos
	if (isDuplasAtiva && isQuadraAtiva && semanaCheckbox.checked) {
		semanaLabel.style.cursor = 'pointer';
		semanaLabel.title = 'Clique para configurar os dias espec√≠ficos';
	} else {
		semanaLabel.style.cursor = 'default';
		semanaLabel.title = '';
	}
    // --- FIM DO BLOCO INSERIDO ---
}



// ADICIONE ESTA NOVA FUN√á√ÉO
function formatarHorario(event) {
    const input = event.target;

    // 1. Mant√©m apenas os d√≠gitos e remove qualquer outra coisa.
    let valor = input.value.replace(/\D/g, '');

    // 2. Limita a entrada a um m√°ximo de 4 d√≠gitos (ex: 2359).
    if (valor.length > 4) {
        valor = valor.substring(0, 4);
    }

    // 3. Adiciona os dois pontos ":" automaticamente.
    // Se o usu√°rio digitar "800", vira "8:00". Se digitar "1830", vira "18:30".
    if (valor.length > 2) {
        valor = valor.slice(0, valor.length - 2) + ':' + valor.slice(valor.length - 2);
    }

    // 4. Atualiza o valor no campo.
    input.value = valor;
}

// Vari√°vel de controle para a tela de "Carregando..."
let carregamentoInicialConcluido = false;

function carregarConfiguracoes() {
    return new Promise((resolve, reject) => {
        // Bloco 1: .once() para a carga inicial r√°pida da p√°gina
        db.ref("sistemas/config").once("value")
            .then(snapshot => {
                const data = snapshot.val();
                if (data) {
				    popularAdministradores(data.Administradores); 
                    document.getElementById('sistema').value = data.Abrir ? 'ON' : 'OFF'; 
                    atualizarEstadoSistema();
					
                    document.getElementById('vDomingo').value = data.vDomingo || "aberto";
					document.getElementById('vDomingoAte').value = data.vDomingoAte || '';

					const vDomingoSelect = document.getElementById('vDomingo');
					const containerHorario = document.getElementById('containerHorarioDomingo');

					// --- IN√çCIO DA CORRE√á√ÉO ---
					// L√≥gica que agora aplica o layout correto no carregamento da p√°gina
					if (vDomingoSelect.value === 'aberto') {
						containerHorario.style.display = 'flex';
						if (window.innerWidth > 768) { // Aplica apenas no computador
							vDomingoSelect.style.maxWidth = '100px';
							vDomingoSelect.style.width = '120px';
							vDomingoSelect.style.flex = '0 0 120px';
						} else { // Aplica no celular
							vDomingoSelect.classList.add('is-aberto');
						}
					} else {
						containerHorario.style.display = 'none';
						if (window.innerWidth > 768) { // Limpa os estilos no computador
							vDomingoSelect.style.maxWidth = '';
							vDomingoSelect.style.width = '';
							vDomingoSelect.style.flex = '';
						} else { // Limpa a classe no celular
							vDomingoSelect.classList.remove('is-aberto');
						}
					}

                    document.getElementById('diasParaAgendar').value = (6 - (data.DiasParaLimpar || 6)).toString();
                    document.getElementById('estadoQuadra1').value = data.Quadras?.Quadra1 || "liberada";
                    document.getElementById('estadoQuadra2').value = data.Quadras?.Quadra2 || "liberada";
                    document.getElementById('estadoQuadra3').value = data.Quadras?.Quadra3 || "liberada";
					
					document.getElementById('reservasPorConfirmacao').value = data.ReservasPorConfirmacao ? 'ON' : 'OFF';
					document.getElementById('horasParaExpirar').value = data.horasParaExpirar || '2';
					document.getElementById('edicaoOrganizador').value = data.OrganizadorEdicao ? 'ON' : 'OFF';
					
					
					const arbitroData = data.Arbitro;
					if (arbitroData && typeof arbitroData === 'object' && arbitroData.apelido) {
						// Se for o novo formato de objeto, exibe o apelido
						document.getElementById('arbitro').value = arbitroData.apelido;
					} else if (typeof arbitroData === 'string') {
						// Se for o formato antigo (apenas texto), exibe o texto
						document.getElementById('arbitro').value = arbitroData;
					} else {
						// Caso contr√°rio, deixa o campo vazio
						document.getElementById('arbitro').value = '';
					} 
					
					// Carrega a nova estrutura de Quebra de Hor√°rio
					const quebraConfig = data.QuebraDeHorarioDomingo || { ativa: true, quadras: {} };
					document.getElementById('quebraHorarioDomingoAtiva').value = quebraConfig.ativa ? 'ON' : 'OFF';
					quebraHorarioQuadrasConfig = quebraConfig.quadras || {}; // Popula a vari√°vel tempor√°ria

                    const convidados = data.Convidados || {};
                    document.getElementById('convidadosQuadra1').checked = convidados.Quadra1 || false;
                    document.getElementById('convidadosQuadra2').checked = convidados.Quadra2 || false;
                    document.getElementById('convidadosQuadra3').checked = convidados.Quadra3 || false;
                    document.getElementById('convidadosSemana').checked = convidados.DiasDeSemana || false;
                    document.getElementById('convidadosFimDeSemana').checked = convidados.FimDeSemana || false;

                    const piramide = data.Piramide || {};
                    const quadra1P = piramide["Quadra-1"] || {};
                    const quadra2P = piramide["Quadra-2"] || {};
                    const quadra3P = piramide["Quadra-3"] || {};
                    document.getElementById('piramideAtiva').value = piramide.ativa ? 'ON' : 'OFF';
					window.piramideInicioData = piramide.inicio || "";
                    window.piramideFimData = piramide.fim || "";
                    document.getElementById('piramideQuadra1').checked = quadra1P["Quadra-1-ativa"] || false;
                    document.getElementById('1-piramideSemana').checked = quadra1P["1-DiasDeSemana"] || false;
                    document.getElementById('1-piramideExceto17_19').checked = quadra1P["1-DiasDeSemana-exceto-17-19"] || false;
                    document.getElementById('1-piramideSabado').checked = quadra1P["1-Sabado"] || false;
                    document.getElementById('1-piramideExceto7_12').checked = quadra1P["1-Sabado-exceto-7-12"] || false;
                    document.getElementById('1-piramideDomingo').checked = quadra1P["1-Domingo"] || false;
                    document.getElementById('1-piramideExceto8_12').checked = quadra1P["1-Domingo-exceto-8-12"] || false;
                    document.getElementById('piramideQuadra2').checked = quadra2P["Quadra-2-ativa"] || false;
                    document.getElementById('2-piramideSemana').checked = quadra2P["2-DiasDeSemana"] || false;
                    document.getElementById('2-piramideExceto17_19').checked = quadra2P["2-DiasDeSemana-exceto-17-19"] || false;
                    document.getElementById('2-piramideSabado').checked = quadra2P["2-Sabado"] || false;
                    document.getElementById('2-piramideExceto7_12').checked = quadra2P["2-Sabado-exceto-7-12"] || false;
                    document.getElementById('2-piramideDomingo').checked = quadra2P["2-Domingo"] || false;
                    document.getElementById('2-piramideExceto8_12').checked = quadra2P["2-Domingo-exceto-8-12"] || false;
                    document.getElementById('piramideQuadra3').checked = quadra3P["Quadra-3-ativa"] || false;
                    document.getElementById('3-piramideSemana').checked = quadra3P["3-DiasDeSemana"] || false;
                    document.getElementById('3-piramideExceto17_19').checked = quadra3P["3-DiasDeSemana-exceto-17-19"] || false;
                    document.getElementById('3-piramideSabado').checked = quadra3P["3-Sabado"] || false;
                    document.getElementById('3-piramideExceto7_12').checked = quadra3P["3-Sabado-exceto-7-12"] || false;
                    document.getElementById('3-piramideDomingo').checked = quadra3P["3-Domingo"] || false;
                    document.getElementById('3-piramideExceto8_12').checked = quadra3P["3-Domingo-exceto-8-12"] || false;
                    
                    const duplas = data.Duplas || {};
                    
                    // --- INSER√á√ÉO 1: Bloco para carregar a configura√ß√£o de Dias da Semana ---
                    diasSemanaDuplasConfig = {};
                    for (let i = 1; i <= 3; i++) {
                        const quadraKey = `Quadra-${i}`;
                        if (duplas[quadraKey] && duplas[quadraKey].DiasDeSemanaConfig) {
                            diasSemanaDuplasConfig[quadraKey] = duplas[quadraKey].DiasDeSemanaConfig;
                        } else {
                            diasSemanaDuplasConfig[quadraKey] = { segunda: true, terca: true, quarta: true, quinta: true, sexta: true };
                        }
                    }
                    // --- FIM DA INSER√á√ÉO 1 ---

                    const quadra1D = duplas["Quadra-1"] || {};
                    const quadra2D = duplas["Quadra-2"] || {};
                    const quadra3D = duplas["Quadra-3"] || {};
                    document.getElementById('duplasAtiva').value = duplas.ativa ? 'ON' : 'OFF';
					
					document.getElementById('duplasRanking').value = duplas.Ranking ? 'ON' : 'OFF';
                    atualizarEstadoDuplasRanking();
				
                    document.getElementById('duplasQuadra1Ativa').checked = quadra1D["Quadra-1-ativa"] || false;
                    document.getElementById('1-duplasSemana').checked = quadra1D["1-DiasDeSemana"] || false;
                    document.getElementById('1-duplasSemanaInicio').value = quadra1D["1-DiasDeSemana-Inicio"] || '';
                    document.getElementById('1-duplasSemanaFim').value = quadra1D["1-DiasDeSemana-Fim"] || '';
                    document.getElementById('1-duplasSabado').checked = quadra1D["1-Sabado"] || false;
                    document.getElementById('1-duplasSabadoInicio').value = quadra1D["1-Sabado-Inicio"] || '';
                    document.getElementById('1-duplasSabadoFim').value = quadra1D["1-Sabado-Fim"] || '';
                    document.getElementById('1-duplasDomingo').checked = quadra1D["1-Domingo"] || false;
                    document.getElementById('1-duplasDomingoInicio').value = quadra1D["1-Domingo-Inicio"] || '';
                    document.getElementById('1-duplasDomingoFim').value = quadra1D["1-Domingo-Fim"] || '';
                    document.getElementById('duplasQuadra2Ativa').checked = quadra2D["Quadra-2-ativa"] || false;
                    document.getElementById('2-duplasSemana').checked = quadra2D["2-DiasDeSemana"] || false;
                    document.getElementById('2-duplasSemanaInicio').value = quadra2D["2-DiasDeSemana-Inicio"] || '';
                    document.getElementById('2-duplasSemanaFim').value = quadra2D["2-DiasDeSemana-Fim"] || '';
                    document.getElementById('2-duplasSabado').checked = quadra2D["2-Sabado"] || false;
                    document.getElementById('2-duplasSabadoInicio').value = quadra2D["2-Sabado-Inicio"] || '';
                    document.getElementById('2-duplasSabadoFim').value = quadra2D["2-Sabado-Fim"] || '';
                    document.getElementById('2-duplasDomingo').checked = quadra2D["2-Domingo"] || false;
                    document.getElementById('2-duplasDomingoInicio').value = quadra2D["2-Domingo-Inicio"] || '';
                    document.getElementById('2-duplasDomingoFim').value = quadra2D["2-Domingo-Fim"] || '';
                    document.getElementById('duplasQuadra3Ativa').checked = quadra3D["Quadra-3-ativa"] || false;
                    document.getElementById('3-duplasSemana').checked = quadra3D["3-DiasDeSemana"] || false;
                    document.getElementById('3-duplasSemanaInicio').value = quadra3D["3-DiasDeSemana-Inicio"] || '';
                    document.getElementById('3-duplasSemanaFim').value = quadra3D["3-DiasDeSemana-Fim"] || '';
                    document.getElementById('3-duplasSabado').checked = quadra3D["3-Sabado"] || false;
                    document.getElementById('3-duplasSabadoInicio').value = quadra3D["3-Sabado-Inicio"] || '';
                    document.getElementById('3-duplasSabadoFim').value = quadra3D["3-Sabado-Fim"] || '';
                    document.getElementById('3-duplasDomingo').checked = quadra3D["3-Domingo"] || false;
                    document.getElementById('3-duplasDomingoInicio').value = quadra3D["3-Domingo-Inicio"] || '';
                    document.getElementById('3-duplasDomingoFim').value = quadra3D["3-Domingo-Fim"] || '';
                }
                resolve();
            })
            .catch(error => {
                console.error("Erro na carga inicial das configura√ß√µes:", error);
                reject(error);
            });

        // Bloco 2: .on() para escutar altera√ß√µes em tempo real
        db.ref("sistemas/config").on("value", (snapshot) => {
            const data = snapshot.val();
            if (data) {
			    popularAdministradores(data.Administradores);
				
                bloqueiosQuadra = data.Quadras?.Bloqueios || {};
                
                document.getElementById('sistema').value = data.Abrir ? 'ON' : 'OFF';
                atualizarEstadoSistema();
                document.getElementById('vDomingo').value = data.vDomingo || "aberto";
                document.getElementById('vDomingoAte').value = data.vDomingoAte;
                document.getElementById('diasParaAgendar').value = (6 - (data.DiasParaLimpar || 6)).toString();
				
				document.getElementById('reservasPorConfirmacao').value = data.ReservasPorConfirmacao ? 'ON' : 'OFF';
				atualizarEstadoConfirmacao();
				
				document.getElementById('horasParaExpirar').value = data.horasParaExpirar || '2';
				
				document.getElementById('edicaoOrganizador').value = data.OrganizadorEdicao ? 'ON' : 'OFF';
				atualizarEstadoEdicaoOrganizador();
				
				const arbitroData = data.Arbitro;
					if (arbitroData && typeof arbitroData === 'object' && arbitroData.apelido) {
						// Se for o novo formato de objeto, exibe o apelido
						document.getElementById('arbitro').value = arbitroData.apelido;
					} else if (typeof arbitroData === 'string') {
						// Se for o formato antigo (apenas texto), exibe o texto
						document.getElementById('arbitro').value = arbitroData;
					} else {
						// Caso contr√°rio, deixa o campo vazio
						document.getElementById('arbitro').value = '';
					}  
				
				// Carrega a nova estrutura de Quebra de Hor√°rio
				const quebraConfig = data.QuebraDeHorarioDomingo || { ativa: true, quadras: {} };
				document.getElementById('quebraHorarioDomingoAtiva').value = quebraConfig.ativa ? 'ON' : 'OFF';
				quebraHorarioQuadrasConfig = quebraConfig.quadras || {}; // Popula a vari√°vel tempor√°ria
				atualizarEstadoQuebraDomingo();

                document.getElementById('estadoQuadra1').value = data.Quadras?.Quadra1 || "liberada";
                document.getElementById('estadoQuadra2').value = data.Quadras?.Quadra2 || "liberada";
                document.getElementById('estadoQuadra3').value = data.Quadras?.Quadra3 || "liberada";

                const convidados = data.Convidados || {};
                document.getElementById('convidadosQuadra1').checked = convidados.Quadra1 || false;
                document.getElementById('convidadosQuadra2').checked = convidados.Quadra2 || false;
                document.getElementById('convidadosQuadra3').checked = convidados.Quadra3 || false;
                document.getElementById('convidadosSemana').checked = convidados.DiasDeSemana || false;
                document.getElementById('convidadosFimDeSemana').checked = convidados.FimDeSemana || false;

                const piramide = data.Piramide || {};
                const quadra1P = piramide["Quadra-1"] || {};
                const quadra2P = piramide["Quadra-2"] || {};
                const quadra3P = piramide["Quadra-3"] || {};
                document.getElementById('piramideAtiva').value = piramide.ativa ? 'ON' : 'OFF';
				window.piramideInicioData = piramide.inicio || "";
                window.piramideFimData = piramide.fim || "";
                document.getElementById('piramideQuadra1').checked = quadra1P["Quadra-1-ativa"] || false;
                document.getElementById('1-piramideSemana').checked = quadra1P["1-DiasDeSemana"] || false;
                document.getElementById('1-piramideExceto17_19').checked = quadra1P["1-DiasDeSemana-exceto-17-19"] || false;
                document.getElementById('1-piramideSabado').checked = quadra1P["1-Sabado"] || false;
                document.getElementById('1-piramideExceto7_12').checked = quadra1P["1-Sabado-exceto-7-12"] || false;
                document.getElementById('1-piramideDomingo').checked = quadra1P["1-Domingo"] || false;
                document.getElementById('1-piramideExceto8_12').checked = quadra1P["1-Domingo-exceto-8-12"] || false;
                document.getElementById('piramideQuadra2').checked = quadra2P["Quadra-2-ativa"] || false;
                document.getElementById('2-piramideSemana').checked = quadra2P["2-DiasDeSemana"] || false;
                document.getElementById('2-piramideExceto17_19').checked = quadra2P["2-DiasDeSemana-exceto-17-19"] || false;
                document.getElementById('2-piramideSabado').checked = quadra2P["2-Sabado"] || false;
                document.getElementById('2-piramideExceto7_12').checked = quadra2P["2-Sabado-exceto-7-12"] || false;
                document.getElementById('2-piramideDomingo').checked = quadra2P["2-Domingo"] || false;
                document.getElementById('2-piramideExceto8_12').checked = quadra2P["2-Domingo-exceto-8-12"] || false;
                document.getElementById('piramideQuadra3').checked = quadra3P["Quadra-3-ativa"] || false;
                document.getElementById('3-piramideSemana').checked = quadra3P["3-DiasDeSemana"] || false;
                document.getElementById('3-piramideExceto17_19').checked = quadra3P["3-DiasDeSemana-exceto-17-19"] || false;
                document.getElementById('3-piramideSabado').checked = quadra3P["3-Sabado"] || false;
                document.getElementById('3-piramideExceto7_12').checked = quadra3P["3-Sabado-exceto-7-12"] || false;
                document.getElementById('3-piramideDomingo').checked = quadra3P["3-Domingo"] || false;
                document.getElementById('3-piramideExceto8_12').checked = quadra3P["3-Domingo-exceto-8-12"] || false;

                const duplas = data.Duplas || {};
                excecoesDuplas = duplas.DatasEspeciais || {};

                // --- INSER√á√ÉO 2: Bloco para carregar a configura√ß√£o de Dias da Semana ---
                diasSemanaDuplasConfig = {};
                for (let i = 1; i <= 3; i++) {
                    const quadraKey = `Quadra-${i}`;
                    if (duplas[quadraKey] && duplas[quadraKey].DiasDeSemanaConfig) {
                        diasSemanaDuplasConfig[quadraKey] = duplas[quadraKey].DiasDeSemanaConfig;
                    } else {
                        diasSemanaDuplasConfig[quadraKey] = { segunda: true, terca: true, quarta: true, quinta: true, sexta: true };
                    }
                }
                // --- FIM DA INSER√á√ÉO 2 ---

                const quadra1D = duplas["Quadra-1"] || {};
                const quadra2D = duplas["Quadra-2"] || {};
                const quadra3D = duplas["Quadra-3"] || {};
                document.getElementById('duplasAtiva').value = duplas.ativa ? 'ON' : 'OFF';
				
				document.getElementById('duplasRanking').value = duplas.Ranking ? 'ON' : 'OFF';
                atualizarEstadoDuplasRanking();
				
                document.getElementById('duplasQuadra1Ativa').checked = quadra1D["Quadra-1-ativa"] || false;
                document.getElementById('1-duplasSemana').checked = quadra1D["1-DiasDeSemana"] || false;
                document.getElementById('1-duplasSemanaInicio').value = quadra1D["1-DiasDeSemana-Inicio"] || '';
                document.getElementById('1-duplasSemanaFim').value = quadra1D["1-DiasDeSemana-Fim"] || '';
                document.getElementById('1-duplasSabado').checked = quadra1D["1-Sabado"] || false;
                document.getElementById('1-duplasSabadoInicio').value = quadra1D["1-Sabado-Inicio"] || '';
                document.getElementById('1-duplasSabadoFim').value = quadra1D["1-Sabado-Fim"] || '';
                document.getElementById('1-duplasDomingo').checked = quadra1D["1-Domingo"] || false;
                document.getElementById('1-duplasDomingoInicio').value = quadra1D["1-Domingo-Inicio"] || '';
                document.getElementById('1-duplasDomingoFim').value = quadra1D["1-Domingo-Fim"] || '';
                document.getElementById('duplasQuadra2Ativa').checked = quadra2D["Quadra-2-ativa"] || false;
                document.getElementById('2-duplasSemana').checked = quadra2D["2-DiasDeSemana"] || false;
                document.getElementById('2-duplasSemanaInicio').value = quadra2D["2-DiasDeSemana-Inicio"] || '';
                document.getElementById('2-duplasSemanaFim').value = quadra2D["2-DiasDeSemana-Fim"] || '';
                document.getElementById('2-duplasSabado').checked = quadra2D["2-Sabado"] || false;
                document.getElementById('2-duplasSabadoInicio').value = quadra2D["2-Sabado-Inicio"] || '';
                document.getElementById('2-duplasSabadoFim').value = quadra2D["2-Sabado-Fim"] || '';
                document.getElementById('2-duplasDomingo').checked = quadra2D["2-Domingo"] || false;
                document.getElementById('2-duplasDomingoInicio').value = quadra2D["2-Domingo-Inicio"] || '';
                document.getElementById('2-duplasDomingoFim').value = quadra2D["2-Domingo-Fim"] || '';
                document.getElementById('duplasQuadra3Ativa').checked = quadra3D["Quadra-3-ativa"] || false;
                document.getElementById('3-duplasSemana').checked = quadra3D["3-DiasDeSemana"] || false;
                document.getElementById('3-duplasSemanaInicio').value = quadra3D["3-DiasDeSemana-Inicio"] || '';
                document.getElementById('3-duplasSemanaFim').value = quadra3D["3-DiasDeSemana-Fim"] || '';
                document.getElementById('3-duplasSabado').checked = quadra3D["3-Sabado"] || false;
                document.getElementById('3-duplasSabadoInicio').value = quadra3D["3-Sabado-Inicio"] || '';
                document.getElementById('3-duplasSabadoFim').value = quadra3D["3-Sabado-Fim"] || '';
                document.getElementById('3-duplasDomingo').checked = quadra3D["3-Domingo"] || false;
                document.getElementById('3-duplasDomingoInicio').value = quadra3D["3-Domingo-Inicio"] || '';
                document.getElementById('3-duplasDomingoFim').value = quadra3D["3-Domingo-Fim"] || '';

                atualizarEstadoPiramide();
                atualizarCamposPiramideQuadra1();
                atualizarCamposPiramideQuadra2();
                atualizarCamposPiramideQuadra3();
                atualizarEstadoDuplas();
                for (let i = 1; i <= 3; i++) {
                    atualizarCamposDaQuadraDuplas(i);
                }

                if (modal.style.display === 'flex') {
                    renderizarExcecoes(quadraAtualParaExcecao);
                }
                if (modalBloqueio.style.display === 'flex') {
                    renderizarBloqueios(quadraAtualParaBloqueio);
                }
            }

            if (!carregamentoInicialConcluido) {
                carregamentoInicialConcluido = true;
            }
        }, (error) => {
            console.error("Erro no listener em tempo real:", error);
            if (!carregamentoInicialConcluido) {
                carregamentoInicialConcluido = true;
                reject(error);
            }
        });
    });
}


function salvarConfiguracoes() {
    // Obt√©m os valores dos campos gerais
    const abrir = document.getElementById('sistema').value === 'ON';
    const vDomingo = document.getElementById('vDomingo').value;
    const vDomingoAte = document.getElementById('vDomingoAte').value;
    const diasParaLimpar = 6 - parseInt(document.getElementById('diasParaAgendar').value);
    const estadoQuadra1 = document.getElementById('estadoQuadra1').value;
    const estadoQuadra2 = document.getElementById('estadoQuadra2').value;
    const estadoQuadra3 = document.getElementById('estadoQuadra3').value;
	
	const reservasPorConfirmacao = document.getElementById('reservasPorConfirmacao').value === 'ON';
    
	const horasParaExpirar = parseInt(document.getElementById('horasParaExpirar').value);
	const organizadorEdicao = document.getElementById('edicaoOrganizador').value === 'ON';
	const quebraHorarioDomingo = {
		ativa: document.getElementById('quebraHorarioDomingoAtiva').value === 'ON',
		quadras: quebraHorarioQuadrasConfig // Usa os dados salvos pelo modal
	};

    // Captura os valores dos checkboxes de convidados
    const convidados = {
        DiasDeSemana: document.getElementById('convidadosSemana').checked,
        FimDeSemana: document.getElementById('convidadosFimDeSemana').checked,
        Quadra1: document.getElementById('convidadosQuadra1').checked,
        Quadra2: document.getElementById('convidadosQuadra2').checked,
        Quadra3: document.getElementById('convidadosQuadra3').checked
    };

    // Captura os valores da Pir√¢mide
    const piramide = {
        ativa: document.getElementById('piramideAtiva').value === 'ON',
		inicio: window.piramideInicioData || "",
        fim: window.piramideFimData || "",
        "Quadra-1": {
            "Quadra-1-ativa": document.getElementById('piramideQuadra1').checked,
            "1-DiasDeSemana": document.getElementById('1-piramideSemana').checked,
            "1-DiasDeSemana-exceto-17-19": document.getElementById('1-piramideExceto17_19').checked,
            "1-Sabado": document.getElementById('1-piramideSabado').checked,
            "1-Sabado-exceto-7-12": document.getElementById('1-piramideExceto7_12').checked,
            "1-Domingo": document.getElementById('1-piramideDomingo').checked,
            "1-Domingo-exceto-8-12": document.getElementById('1-piramideExceto8_12').checked
        },
        "Quadra-2": {
            "Quadra-2-ativa": document.getElementById('piramideQuadra2').checked,
            "2-DiasDeSemana": document.getElementById('2-piramideSemana').checked,
            "2-DiasDeSemana-exceto-17-19": document.getElementById('2-piramideExceto17_19').checked,
            "2-Sabado": document.getElementById('2-piramideSabado').checked,
            "2-Sabado-exceto-7-12": document.getElementById('2-piramideExceto7_12').checked,
            "2-Domingo": document.getElementById('2-piramideDomingo').checked,
            "2-Domingo-exceto-8-12": document.getElementById('2-piramideExceto8_12').checked
        },
        "Quadra-3": {
            "Quadra-3-ativa": document.getElementById('piramideQuadra3').checked,
            "3-DiasDeSemana": document.getElementById('3-piramideSemana').checked,
            "3-DiasDeSemana-exceto-17-19": document.getElementById('3-piramideExceto17_19').checked,
            "3-Sabado": document.getElementById('3-piramideSabado').checked,
            "3-Sabado-exceto-7-12": document.getElementById('3-piramideExceto7_12').checked,
            "3-Domingo": document.getElementById('3-piramideDomingo').checked,
            "3-Domingo-exceto-8-12": document.getElementById('3-piramideExceto8_12').checked  
        }
    };

    // --- IN√çCIO DA NOVA SE√á√ÉO PARA DUPLAS ---
    const duplas = {
        ativa: document.getElementById('duplasAtiva').value === 'ON',
		Ranking: document.getElementById('duplasRanking').value === 'ON',
        "Quadra-1": {
            "Quadra-1-ativa": document.getElementById('duplasQuadra1Ativa').checked,
            "1-DiasDeSemana": document.getElementById('1-duplasSemana').checked,
            "1-DiasDeSemana-Inicio": document.getElementById('1-duplasSemanaInicio').value,
            "1-DiasDeSemana-Fim": document.getElementById('1-duplasSemanaFim').value,
            "1-Sabado": document.getElementById('1-duplasSabado').checked,
            "1-Sabado-Inicio": document.getElementById('1-duplasSabadoInicio').value,
            "1-Sabado-Fim": document.getElementById('1-duplasSabadoFim').value,
            "1-Domingo": document.getElementById('1-duplasDomingo').checked,
            "1-Domingo-Inicio": document.getElementById('1-duplasDomingoInicio').value,
            "1-Domingo-Fim": document.getElementById('1-duplasDomingoFim').value,
			// --- L√ìGICA CONDICIONAL ADICIONADA AQUI ---
            ...(document.getElementById('1-duplasSemana').checked && { 
                "DiasDeSemanaConfig": diasSemanaDuplasConfig['Quadra-1'] || { segunda: true, terca: true, quarta: true, quinta: true, sexta: true }
            }) 
        },
        "Quadra-2": {
            "Quadra-2-ativa": document.getElementById('duplasQuadra2Ativa').checked,
            "2-DiasDeSemana": document.getElementById('2-duplasSemana').checked,
            "2-DiasDeSemana-Inicio": document.getElementById('2-duplasSemanaInicio').value,
            "2-DiasDeSemana-Fim": document.getElementById('2-duplasSemanaFim').value,
            "2-Sabado": document.getElementById('2-duplasSabado').checked,
            "2-Sabado-Inicio": document.getElementById('2-duplasSabadoInicio').value,
            "2-Sabado-Fim": document.getElementById('2-duplasSabadoFim').value,
            "2-Domingo": document.getElementById('2-duplasDomingo').checked,
            "2-Domingo-Inicio": document.getElementById('2-duplasDomingoInicio').value,
            "2-Domingo-Fim": document.getElementById('2-duplasDomingoFim').value,
			// --- L√ìGICA CONDICIONAL ADICIONADA AQUI ---
            ...(document.getElementById('2-duplasSemana').checked && { 
                "DiasDeSemanaConfig": diasSemanaDuplasConfig['Quadra-2'] || { segunda: true, terca: true, quarta: true, quinta: true, sexta: true }
            }) 
        },
        "Quadra-3": {
            "Quadra-3-ativa": document.getElementById('duplasQuadra3Ativa').checked,
            "3-DiasDeSemana": document.getElementById('3-duplasSemana').checked,
            "3-DiasDeSemana-Inicio": document.getElementById('3-duplasSemanaInicio').value,
            "3-DiasDeSemana-Fim": document.getElementById('3-duplasSemanaFim').value,
            "3-Sabado": document.getElementById('3-duplasSabado').checked,
            "3-Sabado-Inicio": document.getElementById('3-duplasSabadoInicio').value,
            "3-Sabado-Fim": document.getElementById('3-duplasSabadoFim').value,
            "3-Domingo": document.getElementById('3-duplasDomingo').checked,
            "3-Domingo-Inicio": document.getElementById('3-duplasDomingoInicio').value,
            "3-Domingo-Fim": document.getElementById('3-duplasDomingoFim').value,
			// --- L√ìGICA CONDICIONAL ADICIONADA AQUI ---
            ...(document.getElementById('3-duplasSemana').checked && { 
                "DiasDeSemanaConfig": diasSemanaDuplasConfig['Quadra-3'] || { segunda: true, terca: true, quarta: true, quinta: true, sexta: true }
            }) 
        },
		DatasEspeciais: excecoesDuplas // << ADICIONE ESTA LINHA
    };
    // --- FIM DA NOVA SE√á√ÉO PARA DUPLAS ---

    // Salva as configura√ß√µes no Firebase
    db.ref("sistemas/config").update({
        Abrir: abrir,
        vDomingo,
        vDomingoAte,
        DiasParaLimpar: diasParaLimpar,
		ReservasPorConfirmacao: reservasPorConfirmacao,
		horasParaExpirar: horasParaExpirar,
		OrganizadorEdicao: organizadorEdicao,
		QuebraDeHorarioDomingo: quebraHorarioDomingo,
        Quadras: {
            Quadra1: estadoQuadra1,
            Quadra2: estadoQuadra2,
            Quadra3: estadoQuadra3,
			Bloqueios: bloqueiosQuadra // <-- MUDAN√áA AQUI: Adiciona os dados de bloqueio ao salvar
        },
        Convidados: convidados,
        Piramide: piramide,
        Duplas: duplas // <-- DADOS DE DUPLAS ADICIONADOS AQUI
    })
    .then(() => alert("Configura√ß√µes salvas com sucesso!"))
    .catch(error => {
        console.error("Erro ao salvar configura√ß√µes:", error);
        alert("Erro ao salvar configura√ß√µes. Verifique o console para mais detalhes.");
    });
}

    // Exibe a tela de carregamento enquanto carrega as configura√ß√µes
    window.onload = function() {
        const loadingElement = document.getElementById('loading');
        const contentElement = document.getElementById('content');

        loadingElement.style.display = 'block';
        contentElement.style.display = 'none';
		
	

        carregarConfiguracoes()
            .then(() => {
                loadingElement.style.display = 'none';
                contentElement.style.display = 'block';
				atualizarEstadoSistema(); 
		    })
            .catch(error => {
                console.error("Erro ao carregar configura√ß√µes:", error);
            });
    };
	
	
document.addEventListener("DOMContentLoaded", function() { 
    showTab('reservas');
    atualizarEstadoPiramide();
	atualizarEstadoDuplas();

    // Adiciona o evento onchange para o checkbox "Ativa"
    //document.getElementById('piramideAtiva').onchange = atualizarEstadoPiramide;

    // Adiciona os event listeners para os checkboxes das quadras
    document.getElementById('piramideQuadra1').onchange = atualizarCamposPiramideQuadra1;
    document.getElementById('piramideQuadra2').onchange = atualizarCamposPiramideQuadra2;
    document.getElementById('piramideQuadra3').onchange = atualizarCamposPiramideQuadra3;

    // Adiciona o evento onchange aos checkboxes "Dias de Semana", "S√°bado" e "Domingo" para cada quadra
    document.getElementById('1-piramideSemana').onchange = atualizarCamposPiramideQuadra1;
    document.getElementById('1-piramideSabado').onchange = atualizarCamposPiramideQuadra1;
    document.getElementById('1-piramideDomingo').onchange = atualizarCamposPiramideQuadra1;

    document.getElementById('2-piramideSemana').onchange = atualizarCamposPiramideQuadra2;
    document.getElementById('2-piramideSabado').onchange = atualizarCamposPiramideQuadra2;
    document.getElementById('2-piramideDomingo').onchange = atualizarCamposPiramideQuadra2;

    document.getElementById('3-piramideSemana').onchange = atualizarCamposPiramideQuadra3;
    document.getElementById('3-piramideSabado').onchange = atualizarCamposPiramideQuadra3;
    document.getElementById('3-piramideDomingo').onchange = atualizarCamposPiramideQuadra3;

    // Chamadas iniciais para atualizar o estado dos campos
    atualizarCamposPiramideQuadra1();
    atualizarCamposPiramideQuadra2();
    atualizarCamposPiramideQuadra3();
    
    // Define o primeiro bot√£o como ativo por padr√£o
    document.querySelector('.piramide-botao').classList.add('ativo');
	
	document.getElementById('duplasQuadra1Ativa').addEventListener('change', () => atualizarCamposDaQuadraDuplas(1)); 
    document.getElementById('duplasQuadra2Ativa').addEventListener('change', () => atualizarCamposDaQuadraDuplas(2));
    document.getElementById('duplasQuadra3Ativa').addEventListener('change', () => atualizarCamposDaQuadraDuplas(3));
	
	
	// Substitua o loop anterior por este
	// Substitua o loop anterior por este
for (let i = 1; i <= 3; i++) {
    const semanaCheckbox = document.getElementById(`${i}-duplasSemana`);
    const semanaLabel = document.querySelector(`#duplasQuadra${i}Container .dias-semana-label-clickable`);

    // Evento para o CHECKBOX: Apenas marca/desmarca e atualiza a UI.
    semanaCheckbox.addEventListener('change', () => {
        atualizarCamposDaQuadraDuplas(i);
    });

    // Evento para o TEXTO "Dias de Semana": Abre o modal.
    semanaLabel.addEventListener('click', () => {
        // CONDI√á√ÉO CORRIGIDA: Agora verifica se a quadra principal E o checkbox de semana est√£o marcados.
        if (document.getElementById(`duplasQuadra${i}Ativa`).checked && semanaCheckbox.checked) {
            abrirModalDiasSemana(i);
        }
    });

    // Listeners para S√°bado e Domingo (permanecem iguais)
    document.getElementById(`${i}-duplasSabado`).addEventListener('change', () => atualizarCamposDaQuadraDuplas(i));
    document.getElementById(`${i}-duplasDomingo`).addEventListener('change', () => atualizarCamposDaQuadraDuplas(i));
}
	
	// Encontra todos os campos de hor√°rio para aplicar as novas regras.
    const camposDeHorario = document.querySelectorAll('.horario-input');

    camposDeHorario.forEach(input => {
        // Tarefa 1 e 3: Aplica a fun√ß√£o de formata√ß√£o autom√°tica a cada mudan√ßa.
        input.addEventListener('input', formatarHorario);

        // Tarefa 2: Garante o teclado num√©rico no celular e limita o tamanho total.
        input.setAttribute('inputmode', 'numeric'); // Pede o teclado num√©rico.
        input.setAttribute('maxlength', '5');       // Limita o tamanho para 5 caracteres (ex: "18:30").
    });
	
	// Adiciona o evento de duplo clique nos labels "Dias:" da aba Duplas
    for (let i = 1; i <= 3; i++) {
        const labelDias = document.getElementById(`DuplasDiasQuadra${i}`);
        if (labelDias) {
            labelDias.addEventListener('dblclick', () => abrirModalExcecao(i)); 
        }
    }
	
	// --- NOVO: Configura evento de "segurar" para mobile ---
    const selectQuadra1 = document.getElementById('estadoQuadra1');
    const selectQuadra2 = document.getElementById('estadoQuadra2');
    const selectQuadra3 = document.getElementById('estadoQuadra3');
    const selectQuebraDomingo = document.getElementById('quebraHorarioDomingoAtiva');
	const selectAdmins = document.getElementById('administradores');

    // Atualiza as chamadas antigas para usar a nova fun√ß√£o gen√©rica
    setupHoldEvent(selectQuadra1, () => handleEstadoQuadraChange(selectQuadra1, 1));
    setupHoldEvent(selectQuadra2, () => handleEstadoQuadraChange(selectQuadra2, 2));
    setupHoldEvent(selectQuadra3, () => handleEstadoQuadraChange(selectQuadra3, 3));

    // Adiciona a nova chamada para o campo "Quebra Hor√°rio Domingo"
    setupHoldEvent(selectQuebraDomingo, handleQuebraHorarioHold);
	
	setupHoldEvent(selectAdmins, excluirAdministrador);
	
	
	
});

document.addEventListener('DOMContentLoaded', function () {
    const vDomingoSelect = document.getElementById('vDomingo');
    const vDomingoAteInput = document.getElementById('vDomingoAte');

    vDomingoSelect.addEventListener('change', function () {
    const containerHorario = document.getElementById('containerHorarioDomingo');
    const vDomingoAteInput = document.getElementById('vDomingoAte');
    const isMobile = window.innerWidth <= 768; // Verifica se a tela √© de celular

    if (this.value === 'aberto') {
        const horario = prompt("At√© que horas o clube ficar√° aberto no domingo? (ex: 18:00)", vDomingoAteInput.value || "18:00");

        if (horario) { // Se o usu√°rio deu OK
            vDomingoAteInput.value = horario;
            containerHorario.style.display = 'flex';

            if (isMobile) {
                this.classList.add('is-aberto'); // No celular, adiciona a classe
            } else {
                // No computador, mant√©m o comportamento original que voc√™ j√° tinha
                this.style.maxWidth = '100px';
                this.style.width = '120px';
                this.style.flex = '0 0 120px';
            }
        } else { // Se o usu√°rio cancelou o prompt
            this.value = 'fechado'; // Reverte a sele√ß√£o
            containerHorario.style.display = 'none';

            if (isMobile) {
                this.classList.remove('is-aberto');
            } else {
                // No computador, limpa os estilos
                this.style.maxWidth = '';
                this.style.width = '';
                this.style.flex = '';
            }
        }
    } else { // Se o valor for "fechado"
        vDomingoAteInput.value = '';
        containerHorario.style.display = 'none';

        if (isMobile) {
            this.classList.remove('is-aberto');
        } else {
            // No computador, limpa os estilos
            this.style.maxWidth = '';
            this.style.width = '';
            this.style.flex = '';
        }
    }
});
  
	
	// --- IN√çCIO DO NOVO C√ìDIGO PARA TOOLTIPS COM CLIQUE ---

    // Fun√ß√£o auxiliar para adicionar o evento de clique nos labels
const adicionarTooltipDeClique = (labelFor) => {
    const label = document.querySelector(`label[for="${labelFor}"]`);
    if (label) {
        // Adiciona um cursor de ajuda para indicar que o label √© clic√°vel
        label.style.cursor = 'help';
        
        label.addEventListener('click', function() {
            const descricao = this.getAttribute('title');
            // --- IN√çCIO DA ALTERA√á√ÉO ---
            const titulo = this.textContent; // Pega o texto do pr√≥prio label (ex: "Quebra Hor√°rio Domingo:")
            
            if (descricao) {
                // Usa a vari√°vel 'titulo' em vez do texto fixo "Informa√ß√£o"
                alert(`‚ÑπÔ∏è ${titulo}\n\n${descricao.replace(/&#10;/g, '\n')}`);
            }
            // --- FIM DA ALTERA√á√ÉO ---
        });
    }
};

    // Adiciona o listener para cada um dos labels da aba "Reservas"
    adicionarTooltipDeClique('reservasPorConfirmacao');
    adicionarTooltipDeClique('horasParaExpirar');
    adicionarTooltipDeClique('edicaoOrganizador');
    adicionarTooltipDeClique('quebraHorarioDomingoAtiva');

    // --- FIM DO NOVO C√ìDIGO ---

});

// Permite abrir o prompt ao clicar no campo de hor√°rio ou no √≠cone
document.getElementById('containerHorarioDomingo').addEventListener('dblclick', function () {
    const horarioAtual = document.getElementById('vDomingoAte').value || "18:00";
    const novoHorario = prompt("At√© que horas o clube ficar√° aberto no domingo? (ex: 18:00)", horarioAtual);
    if (novoHorario) {
        document.getElementById('vDomingoAte').value = novoHorario;
    }
});


function mostrarQuadra(quadraId) {
    // Esconde todos os containers de quadra
    document.getElementById('piramideQuadra1Container').style.display = 'none';
    document.getElementById('piramideQuadra2Container').style.display = 'none';
    document.getElementById('piramideQuadra3Container').style.display = 'none';
    
    // Remove a classe 'ativo' de todos os bot√µes
    document.querySelectorAll('.piramide-botao').forEach(botao => {
        botao.classList.remove('ativo');
    });
    
    // Adiciona a classe 'ativo' ao bot√£o clicado
    const botaoClicado = document.querySelector(`.piramide-botao[onclick="mostrarQuadra('${quadraId}')"]`);
    if (botaoClicado) {
        botaoClicado.classList.add('ativo');
    }

    // Exibe o container da quadra clicada
    document.getElementById('piramide' + quadraId.charAt(0).toUpperCase() + quadraId.slice(1) + 'Container').style.display = 'block';
}

function mostrarDuplasQuadra(quadraId) {
    // Esconde todos os containers de quadra
    document.getElementById('duplasQuadra1Container').style.display = 'none';
    document.getElementById('duplasQuadra2Container').style.display = 'none';
    document.getElementById('duplasQuadra3Container').style.display = 'none';
    
    // Remove a classe 'ativo' de todos os bot√µes
    document.querySelectorAll('.duplas-botao').forEach(botao => {
        botao.classList.remove('ativo');
    });

    // Adiciona a classe 'ativo' ao bot√£o clicado
    const botaoClicado = document.querySelector(`.duplas-botao[onclick="mostrarDuplasQuadra('${quadraId}')"]`);
    if (botaoClicado) {
        botaoClicado.classList.add('ativo');
    }

    // Exibe o container da quadra clicada
    document.getElementById('duplas' + quadraId.charAt(0).toUpperCase() + quadraId.slice(1) + 'Container').style.display = 'block';
}

// --- GERENCIAMENTO DE EXCE√á√ïES (IN√çCIO) ---
const modal = document.getElementById('modalDatasEspeciais');
const listaExcecoesDiv = document.getElementById('listaExcecoes');
let quadraAtualParaExcecao = null;


/**
 * NOVO: Verifica e remove exce√ß√µes com mais de 7 dias.
 * Esta fun√ß√£o √© chamada ao abrir o modal de exce√ß√µes.
 * Ela calcula a data limite e envia um √∫nico comando de atualiza√ß√£o
 * para remover todas as entradas antigas de uma vez.
 */
function limparExcecoesAntigas() {
    console.log("Verificando exce√ß√µes antigas para limpeza...");
    const seteDiasAtras = new Date();
    seteDiasAtras.setDate(seteDiasAtras.getDate() - 7);
    seteDiasAtras.setHours(0, 0, 0, 0);

    const updates = {};
    const allExcecoes = excecoesDuplas || {};

    // Itera por todas as quadras e suas exce√ß√µes
    for (const quadraKey in allExcecoes) {
        if (Object.hasOwnProperty.call(allExcecoes, quadraKey)) {
            const excecoesDaQuadra = allExcecoes[quadraKey];
            for (const dataString in excecoesDaQuadra) {
                if (Object.hasOwnProperty.call(excecoesDaQuadra, dataString)) {
                    // A dataString est√° no formato 'YYYY-MM-DD'
                    const dataExcecao = new Date(dataString + 'T00:00:00');

                    // Se a data da exce√ß√£o for mais antiga que 7 dias atr√°s
                    if (dataExcecao < seteDiasAtras) {
                        const path = `sistemas/config/Duplas/DatasEspeciais/${quadraKey}/${dataString}`;
                        updates[path] = null; // Marcar para exclus√£o no Firebase
                    }
                }
            }
        }
    }

    // Se houver atualiza√ß√µes a serem feitas, envia o comando para o Firebase
    if (Object.keys(updates).length > 0) {
        console.log(`Limpando ${Object.keys(updates).length} exce√ß√µes com mais de 7 dias.`);
        return db.ref().update(updates); // Retorna uma promessa para a opera√ß√£o de atualiza√ß√£o
    } else {
        console.log("Nenhuma exce√ß√£o antiga para limpar.");
        return Promise.resolve(); // Nenhuma atualiza√ß√£o necess√°ria, retorna uma promessa resolvida
    }
}

/**
 * Verifica e remove bloqueios de quadra com mais de 7 dias.
 */
function limparBloqueiosAntigos() {
    console.log("Verificando bloqueios antigos para limpeza...");
    const seteDiasAtras = new Date();
    seteDiasAtras.setDate(seteDiasAtras.getDate() - 7);
    seteDiasAtras.setHours(0, 0, 0, 0);

    const updates = {};
    const allBloqueios = bloqueiosQuadra || {};

    // Itera por todas as quadras e seus bloqueios
    for (const quadraKey in allBloqueios) {
        if (Object.hasOwnProperty.call(allBloqueios, quadraKey)) {
            const bloqueiosDaQuadra = allBloqueios[quadraKey];
            for (const dataString in bloqueiosDaQuadra) {
                if (Object.hasOwnProperty.call(bloqueiosDaQuadra, dataString)) {
                    const dataBloqueio = new Date(dataString + 'T00:00:00');

                    // Se a data do bloqueio for mais antiga que 7 dias atr√°s
                    if (dataBloqueio < seteDiasAtras) {
                        const path = `sistemas/config/Quadras/Bloqueios/${quadraKey}/${dataString}`;
                        updates[path] = null; // Marcar para exclus√£o no Firebase
                    }
                }
            }
        }
    }

    // Se houver atualiza√ß√µes a serem feitas, envia o comando para o Firebase
    if (Object.keys(updates).length > 0) {
        console.log(`Limpando ${Object.keys(updates).length} bloqueios com mais de 7 dias.`);
        return db.ref().update(updates);
    } else {
        console.log("Nenhum bloqueio antigo para limpar.");
        return Promise.resolve();
    }
}


/**
 * MODIFICADO: Abre o modal de exce√ß√µes e executa a limpeza autom√°tica.
 * A fun√ß√£o agora √© 'async' para poder usar 'await' e garantir que a
 * limpeza termine antes de exibir os dados.
 */
async function abrirModalExcecao(quadraNumero) {
    const isDuplasAtiva = document.getElementById('duplasAtiva').value === 'ON';
    const isQuadraAtiva = document.getElementById(`duplasQuadra${quadraNumero}Ativa`).checked;

    // Impede a abertura do modal se a aba ou a quadra estiverem inativas
    if (!isDuplasAtiva || !isQuadraAtiva) {
        return; 
    }

    // --- L√ìGICA DE LIMPEZA CONDICIONAL ---
    if (vlimparExcecoesAntigas === false) {
        try {
            // Espera a fun√ß√£o de limpeza terminar antes de continuar
            await limparExcecoesAntigas();
            vlimparExcecoesAntigas = true; // Marca que a limpeza foi executada
        } catch (error) {
            console.error("Ocorreu um erro durante a limpeza de exce√ß√µes antigas:", error);
            alert("N√£o foi poss√≠vel limpar as exce√ß√µes antigas. Verifique o console.");
        }
    }
    // --- FIM DA L√ìGICA DE LIMPEZA ---

    quadraAtualParaExcecao = quadraNumero;
    
    const containerId = `duplasQuadra${quadraNumero}Container`;
    const containerElement = document.getElementById(containerId);
    let nomeDaQuadra = `Exce√ß√µes Quadra ${quadraNumero}`;

    if (containerElement) {
        const spanDoTitulo = containerElement.querySelector('.centraliza-checkbox span');
        if (spanDoTitulo) {
            nomeDaQuadra = spanDoTitulo.innerText;
        }
    }
    document.getElementById('modalTitulo').innerText = nomeDaQuadra;

    // Renderiza a lista de exce√ß√µes, que j√° estar√° atualizada
    // ap√≥s a limpeza, gra√ßas ao listener `on('value')`.
    renderizarExcecoes(quadraNumero);
    modal.style.display = 'flex';
}



function fecharModalExcecao() {
    modal.style.display = 'none';
}

function renderizarExcecoes(quadraNumero) {
    listaExcecoesDiv.innerHTML = ''; // Limpa a lista atual
    const quadraKey = `Quadra-${quadraNumero}`;
    const excecoesDaQuadra = excecoesDuplas[quadraKey] || {};

    if (Object.keys(excecoesDaQuadra).length === 0) {
        listaExcecoesDiv.innerHTML = '<p>Nenhuma exce√ß√£o cadastrada.</p>';
        return;
    }

    const ul = document.createElement('ul');
    // Ordena as datas antes de exibi-las
    Object.keys(excecoesDaQuadra).sort().forEach(data => {
        const excecao = excecoesDaQuadra[data];
        const li = document.createElement('li');
        
        // --- L√ìGICA DE EXIBI√á√ÉO EM M√öLTIPLAS LINHAS ---
        li.innerHTML = `
            <div>
                <div><strong>${formatarDataParaExibicao(data)}</strong></div>
                <div style="font-style: italic; color: #555;">${excecao.descricao || 'Sem descri√ß√£o'}</div>
                <div>${excecao.regras.inicio} √†s ${excecao.regras.fim}</div>
            </div>
            <button class="btn-remover" onclick="removerExcecao('${quadraKey}', '${data}')">X</button>
        `;
        // --- FIM DA L√ìGICA DE EXIBI√á√ÉO ---

        ul.appendChild(li);
    });
    listaExcecoesDiv.appendChild(ul);
}



function adicionarExcecao() {
    const descricao = document.getElementById('excecaoDescricao').value.trim();
    const dataDigitada = document.getElementById('excecaoData').value.trim();
    const inicio = document.getElementById('excecaoInicio').value;
    const fim = document.getElementById('excecaoFim').value;

    if (!dataDigitada || !inicio || !fim) {
        alert('Por favor, preencha a data (no formato DD/MM/AAAA) e os hor√°rios da exce√ß√£o.');
        return;
    }

    // --- IN√çCIO DA L√ìGICA DE CONVERS√ÉO DE DATA ---
    const dataPadronizada = dataDigitada.replace(/-/g, '/');
    if (!/^\d{2}\/\d{2}\/\d{4}$/.test(dataPadronizada)) {
        alert("Formato de data inv√°lido. Por favor, use DD/MM/AAAA.");
        return;
    }
    const partes = dataPadronizada.split('/');
    const dataFormatadaParaBanco = `${partes[2]}-${partes[1]}-${partes[0]}`;
    // --- FIM DA L√ìGICA DE CONVERS√ÉO DE DATA ---

    const hoje = new Date();
    hoje.setHours(0, 0, 0, 0);
    const dataSelecionada = new Date(dataFormatadaParaBanco + 'T00:00:00');

    if (dataSelecionada < hoje) {
        alert('N√£o √© permitido cadastrar datas passadas.');
        return;
    }

    const quadraKey = `Quadra-${quadraAtualParaExcecao}`;
    const novaExcecao = {
        descricao: descricao,
        regras: { inicio: inicio, fim: fim }
    };
    const updates = {};
    updates[`sistemas/config/Duplas/DatasEspeciais/${quadraKey}/${dataFormatadaParaBanco}`] = novaExcecao;
    updates[`sistemas/config/Duplas/${quadraKey}/${quadraKey}-ativa`] = true;

    db.ref().update(updates).then(() => {
        alert("Data de exce√ß√£o adicionada com sucesso!");
        document.getElementById('excecaoDescricao').value = '';
        document.getElementById('excecaoData').value = '';
        document.getElementById('excecaoInicio').value = '';
        document.getElementById('excecaoFim').value = '';
    }).catch(error => {
        console.error("Erro ao salvar exce√ß√£o:", error);
        alert("Ocorreu um erro ao salvar a exce√ß√£o.");
    });
}


/**
 * MODIFICADA: Remove uma exce√ß√£o diretamente do Firebase.
 * A fun√ß√£o agora constr√≥i o caminho para o dado a ser removido e usa .remove().
 * Uma mensagem de confirma√ß√£o √© exibida antes da exclus√£o.
 */
function removerExcecao(quadraKey, dataExcecao) {
    if (confirm(`Tem certeza que deseja remover a exce√ß√£o do dia ${formatarDataParaExibicao(dataExcecao)}?`)) {
        
        const dataPath = `sistemas/config/Duplas/DatasEspeciais/${quadraKey}/${dataExcecao}`;

        // Remove o n√≥ espec√≠fico do Firebase
        db.ref(dataPath).remove().then(() => {
            console.log("Data removida com sucesso!");
            alert("Data removida com sucesso!");
            // O listener 'on("value")' vai cuidar de atualizar a UI.
        }).catch(error => {
            console.error("Erro ao remover exce√ß√£o:", error);
            alert("Ocorreu um erro ao remover a exce√ß√£o.");
        });
    }
}




function formatarDataParaExibicao(data) {
    const partes = data.split('-');
    return `${partes[2]}/${partes[1]}/${partes[0]}`;
}

// --- MUDAN√áA AQUI: Fun√ß√£o atualizada para fechar os dois modais ---
window.onclick = function(event) {
    if (event.target == modal) { // Modal de Exce√ß√µes
        fecharModalExcecao();
    }
    if (event.target == modalBloqueio) { // Modal de Bloqueio
        fecharModalBloqueio();
    }
    // ADICIONADO: Verifica o modal de Dias da Semana
    if (event.target == document.getElementById('modalDiasSemanaDuplas')) {
        fecharModalDiasSemana();
    }
}

 
// --- GERENCIAMENTO DE EXCE√á√ïES (FIM) ---


// --- NOVO: GERENCIAMENTO DE BLOQUEIO DE QUADRA (IN√çCIO) ---

// Vari√°veis de controle para o novo modal de bloqueio
const modalBloqueio = document.getElementById('modalBloqueioQuadra');
const listaBloqueiosDiv = document.getElementById('listaBloqueios');
let quadraAtualParaBloqueio = null;
let bloqueiosQuadra = {}; // Objeto para armazenar os bloqueios (atualmente, s√≥ no lado do cliente)

/**
 * Fun√ß√£o chamada pelo evento onchange dos selects de estado da quadra.
 * Verifica se a op√ß√£o "bloqueada" foi selecionada para abrir o modal.
 * @param {HTMLElement} selectElement - O elemento <select> que foi alterado.
 * @param {number} quadraNumero - O n√∫mero da quadra (1, 2 ou 3).
 */
function handleEstadoQuadraChange(selectElement, quadraNumero) {
    const novoValor = selectElement.value;
    const valorAntigo = selectElement.oldValue; // Pega o valor antigo que guardamos com o 'onfocus'
    const quadraKey = `Quadra-${quadraNumero}`;
    const nomeDaQuadra = document.querySelector(`label[for="estadoQuadra${quadraNumero}"]`).innerText.replace(':', '');

    // Condi√ß√£o principal: s√≥ age se o status estiver mudando DE "Bloqueada" PARA outra coisa.
    if (valorAntigo === 'bloqueada' && novoValor !== 'bloqueada') {
        const bloqueiosExistentes = bloqueiosQuadra[quadraKey];
        
        // Verifica se realmente existem bloqueios configurados para esta quadra.
        if (bloqueiosExistentes && Object.keys(bloqueiosExistentes).length > 0) {
            
            // Monta e exibe a mensagem de confirma√ß√£o. 
            const confirmacao = confirm(
                `‚ö†Ô∏è Aten√ß√£o!\n\nA ${nomeDaQuadra} possui bloqueios de datas espec√≠ficos.\n\nAo alterar o status para "${novoValor}", todos esses bloqueios ser√£o removidos.\n\nDeseja continuar e excluir todos os bloqueios desta quadra?`
            );

            if (confirmacao) {
                // Se o usu√°rio clicar em "OK", deleta os bloqueios do objeto JavaScript.
                delete bloqueiosQuadra[quadraKey];
                alert(`Todos os bloqueios da ${nomeDaQuadra} foram removidos.\n\nClique em "Salvar Configura√ß√µes" no final da p√°gina para tornar a mudan√ßa permanente.`);
            } else {
                // Se o usu√°rio clicar em "Cancelar", reverte a mudan√ßa no dropdown e para a execu√ß√£o.
                alert("Opera√ß√£o cancelada. O status da quadra e seus bloqueios n√£o foram alterados.");
                selectElement.value = valorAntigo; // Reverte para "Bloqueada"
                return; 
            }
        }
    }

    // L√≥gica original: se o novo estado for "bloqueada", abre o modal de configura√ß√£o.
    if (novoValor === 'bloqueada') {
        abrirModalBloqueio(quadraNumero);
    }

    // Atualiza o valor 'antigo' para a pr√≥xima vez que a fun√ß√£o for chamada.
    selectElement.oldValue = novoValor;
}

/**
 * Abre o modal de bloqueio para a quadra especificada e executa a limpeza autom√°tica.
 * @param {number} quadraNumero - O n√∫mero da quadra a ser bloqueada.
 */
async function abrirModalBloqueio(quadraNumero) {
    // --- L√ìGICA DE LIMPEZA CONDICIONAL ---
    if (vlimparBloqueiosAntigos === false) {
        try {
            await limparBloqueiosAntigos();
            vlimparBloqueiosAntigos = true; // Marca que a limpeza foi executada nesta sess√£o
        } catch (error) {
            console.error("Ocorreu um erro durante a limpeza de bloqueios antigos:", error);
            alert("N√£o foi poss√≠vel limpar os bloqueios antigos. Verifique o console.");
        }
    }
    // --- FIM DA L√ìGICA DE LIMPEZA ---

    quadraAtualParaBloqueio = quadraNumero;
    
    // Define o t√≠tulo do modal dinamicamente com base no label da quadra
    const labelQuadra = document.querySelector(`label[for="estadoQuadra${quadraNumero}"]`).innerText;
    document.getElementById('modalBloqueioTitulo').innerText = `${labelQuadra}`;
    
    // Renderiza os bloqueios j√° existentes para a quadra selecionada
    renderizarBloqueios(quadraNumero);
    modalBloqueio.style.display = 'flex';
}



/**
 * Fecha o modal de bloqueio.
 */
function fecharModalBloqueio() {
    modalBloqueio.style.display = 'none';
}

/**
 * Renderiza a lista de bloqueios no modal.
 * @param {number} quadraNumero - O n√∫mero da quadra cujos bloqueios ser√£o exibidos.
 */
function renderizarBloqueios(quadraNumero) {
    listaBloqueiosDiv.innerHTML = '';
    const quadraKey = `Quadra-${quadraNumero}`;
    const bloqueiosDaQuadra = bloqueiosQuadra[quadraKey] || {};

    if (Object.keys(bloqueiosDaQuadra).length === 0) {
        listaBloqueiosDiv.innerHTML = '<p>Nenhum bloqueio cadastrado.</p>';
        return;
    }

    const ul = document.createElement('ul');
    // Ordena as datas antes de exibir 
    Object.keys(bloqueiosDaQuadra).sort().forEach(data => {
        const bloqueio = bloqueiosDaQuadra[data];
        const li = document.createElement('li');
        
        li.innerHTML = `
            <div>
                <div><strong>${formatarDataParaExibicao(data)}</strong></div>
                <div style="font-style: italic; color: #555;">${bloqueio.descricao || 'Sem descri√ß√£o'}</div>
                <div>${bloqueio.regras.inicio} √†s ${bloqueio.regras.fim}</div>
            </div>
            <button class="btn-remover" onclick="removerBloqueio('${quadraKey}', '${data}')">X</button>
        `;
        ul.appendChild(li);
    });
    listaBloqueiosDiv.appendChild(ul);
}

/**
 * Adiciona um novo bloqueio √† estrutura de dados 'bloqueiosQuadra'.
 */
function adicionarBloqueio() {
    const descricao = document.getElementById('bloqueioDescricao').value.trim();
    const dataDigitada = document.getElementById('bloqueioData').value.trim();
    const inicio = document.getElementById('bloqueioInicio').value;
    const fim = document.getElementById('bloqueioFim').value;

    if (!dataDigitada || !inicio || !fim) {
        alert('Por favor, preencha a data (no formato DD/MM/AAAA) e os hor√°rios.');
        return;
    }

    // --- L√ìGICA DE CONVERS√ÉO E VALIDA√á√ÉO DE DATA ---
    const dataPadronizada = dataDigitada.replace(/-/g, '/');
    if (!/^\d{2}\/\d{2}\/\d{4}$/.test(dataPadronizada)) {
        alert("Formato de data inv√°lido. Por favor, use DD/MM/AAAA.");
        return;
    }
    const partes = dataPadronizada.split('/'); // Ex: "09/07/2025" -> ["09", "07", "2025"]
    const dataFormatadaParaBanco = `${partes[2]}-${partes[1]}-${partes[0]}`; // Cria "2025-07-09"
    // --- FIM DA L√ìGICA ---

    const quadraKey = `Quadra-${quadraAtualParaBloqueio}`;
    if (!bloqueiosQuadra[quadraKey]) {
        bloqueiosQuadra[quadraKey] = {};
    }

    if (bloqueiosQuadra[quadraKey][dataFormatadaParaBanco]) {
        alert("J√° existe um bloqueio para esta data. Para alterar, remova o existente e adicione um novo.");
        return;
    }

    bloqueiosQuadra[quadraKey][dataFormatadaParaBanco] = {
        descricao: descricao,
        regras: { inicio, fim }
    };

    alert("Bloqueio adicionado com sucesso! Lembre-se de clicar em 'Salvar Configura√ß√µes'.");

    document.getElementById('bloqueioDescricao').value = '';
    document.getElementById('bloqueioData').value = '';
    document.getElementById('bloqueioInicio').value = '';
    document.getElementById('bloqueioFim').value = '';

    renderizarBloqueios(quadraAtualParaBloqueio);
}

/**
 * Remove um bloqueio da estrutura de dados 'bloqueiosQuadra'.
 * @param {string} quadraKey - A chave da quadra (ex: 'Quadra-1').
 * @param {string} dataBloqueio - A data do bloqueio a ser removido (ex: '2025-06-26').
 */
function removerBloqueio(quadraKey, dataBloqueio) {
    if (confirm(`Tem certeza que deseja remover o bloqueio do dia ${formatarDataParaExibicao(dataBloqueio)}?`)) {
        if (bloqueiosQuadra[quadraKey] && bloqueiosQuadra[quadraKey][dataBloqueio]) {
            delete bloqueiosQuadra[quadraKey][dataBloqueio];
            alert("Bloqueio removido. Lembre-se de salvar as configura√ß√µes para persistir a altera√ß√£o.");
            renderizarBloqueios(quadraAtualParaBloqueio);
        }
    }
}
// --- NOVO: GERENCIAMENTO DE BLOQUEIO DE QUADRA (FIM) ---


/**
 * Abre o modal para configurar os dias da semana para uma quadra espec√≠fica.
 * @param {number} quadraNumero - O n√∫mero da quadra (1, 2 ou 3).
 */
function abrirModalDiasSemana(quadraNumero) {
    quadraAtualParaDiasSemana = quadraNumero;
    const quadraKey = `Quadra-${quadraNumero}`;

    // Define o t√≠tulo do modal dinamicamente
    const quadraNome = document.querySelector(`#duplasQuadra${quadraNumero}Container .centraliza-checkbox span`).innerText;
    document.getElementById('modalDiasSemanaTitulo').innerText = `${quadraNome}`;

    // Carrega a configura√ß√£o atual para os checkboxes do modal
    // Se n√£o houver configura√ß√£o, o padr√£o √© todos os dias marcados
    const config = diasSemanaDuplasConfig[quadraKey] || {
        segunda: true, terca: true, quarta: true, quinta: true, sexta: true
    };

    document.getElementById('duplas-segunda').checked = config.segunda;
    document.getElementById('duplas-terca').checked = config.terca;
    document.getElementById('duplas-quarta').checked = config.quarta;
    document.getElementById('duplas-quinta').checked = config.quinta;
    document.getElementById('duplas-sexta').checked = config.sexta;

    // Exibe o modal
    document.getElementById('modalDiasSemanaDuplas').style.display = 'flex';
}


/**
 * Fecha o modal de configura√ß√£o dos dias da semana.
 */
function fecharModalDiasSemana() {
    document.getElementById('modalDiasSemanaDuplas').style.display = 'none';
    quadraAtualParaDiasSemana = null;
}


/**
 * Salva a configura√ß√£o dos dias da semana (no objeto JavaScript) e fecha o modal.
 */
function salvarModalDiasSemana() {
    if (!quadraAtualParaDiasSemana) return;

    const quadraKey = `Quadra-${quadraAtualParaDiasSemana}`;

    const config = {
        segunda: document.getElementById('duplas-segunda').checked,
        terca: document.getElementById('duplas-terca').checked,
        quarta: document.getElementById('duplas-quarta').checked,
        quinta: document.getElementById('duplas-quinta').checked,
        sexta: document.getElementById('duplas-sexta').checked
    };

    // Atualiza o objeto de configura√ß√£o global
    diasSemanaDuplasConfig[quadraKey] = config;

    alert('Configura√ß√£o salva. Clique em "Salvar Configura√ß√µes" no final da p√°gina para gravar as mudan√ßas.');
    fecharModalDiasSemana();
}



/**
 * Configura um evento de "pressionar e segurar" para um elemento em dispositivos m√≥veis.
 * @param {HTMLElement} element - O elemento ao qual o evento ser√° adicionado.
 * @param {function} callback - A fun√ß√£o a ser chamada ap√≥s o tempo de espera.
 */
function setupHoldEvent(element, callback) {
    let holdTimer;

    element.addEventListener('touchstart', function(e) {
        // A linha e.preventDefault(); foi REMOVIDA daqui.
        holdTimer = setTimeout(function() {
            callback(); // Chama a fun√ß√£o que passamos como argumento
        }, 700);
    });

    element.addEventListener('touchend', function(e) {
        clearTimeout(holdTimer);
    });

    element.addEventListener('touchmove', function(e) {
        clearTimeout(holdTimer);
    });
}



/**
 * Formata o valor de um campo de texto para o formato de data DD/MM/AAAA enquanto o usu√°rio digita.
 * @param {Event} event - O evento de input disparado pelo campo.
 */
function formatarDataInput(event) {
    const input = event.target;
    // Remove tudo que n√£o for n√∫mero
    let valor = input.value.replace(/\D/g, '');

    // Limita o tamanho em 8 d√≠gitos (DDMMYYYY)
    if (valor.length > 8) {
        valor = valor.substring(0, 8);
    }

    // Adiciona a primeira barra (DD/...)
    if (valor.length > 2) {
        valor = valor.substring(0, 2) + '/' + valor.substring(2);
    }

    // Adiciona a segunda barra (DD/MM/...)
    if (valor.length > 5) {
        valor = valor.substring(0, 5) + '/' + valor.substring(5);
    }

    // Atualiza o valor no campo
    input.value = valor;
}

// Substitua a sua fun√ß√£o inteira por esta
function atualizarEstadoConfirmacao() {
    const confirmacaoSelect = document.getElementById('reservasPorConfirmacao');
    const prazoSelect = document.getElementById('horasParaExpirar');
    const isAtiva = confirmacaoSelect.value === 'ON';

    // Habilita ou desabilita o campo de prazo
    prazoSelect.disabled = !isAtiva;

    // Aplica a classe de cor correta
    if (isAtiva) {
        confirmacaoSelect.classList.remove('confirmacao-off');
        confirmacaoSelect.classList.add('confirmacao-on');
    } else {
        confirmacaoSelect.classList.remove('confirmacao-on');
        confirmacaoSelect.classList.add('confirmacao-off');
    }
}

function atualizarEstadoEdicaoOrganizador() {
    const edicaoSelect = document.getElementById('edicaoOrganizador');
    const isAtiva = edicaoSelect.value === 'ON';

    // Aplica a classe de cor correta
    if (isAtiva) {
        edicaoSelect.classList.remove('edicao-off');
        edicaoSelect.classList.add('edicao-on');
    } else {
        edicaoSelect.classList.remove('edicao-on');
        edicaoSelect.classList.add('edicao-off');
    }
}


/**
 * Fun√ß√£o que APENAS atualiza o estado visual (cores) do campo.
 * √â seguro cham√°-la a qualquer momento para refrescar a UI.
 */
function atualizarEstadoQuebraDomingo() {
    const quebraSelect = document.getElementById('quebraHorarioDomingoAtiva');
    const isAtiva = quebraSelect.value === 'ON'; // 'ON' significa que a quebra √© PERMITIDA

    // L√≥gica de cor
    if (isAtiva) {
        quebraSelect.classList.remove('quebra-off');
        quebraSelect.classList.add('quebra-on');
    } else {
        quebraSelect.classList.remove('quebra-on');
        quebraSelect.classList.add('quebra-off');
    }
}


// Vari√°vel para guardar o estado tempor√°rio dos checkboxes do modal
let quebraHorarioQuadrasConfig = {};

/**
 * Abre o modal e preenche os checkboxes com os valores guardados na vari√°vel.
 */
function abrirModalQuebraHorario() {
    // Carrega os valores atuais nos checkboxes
    document.getElementById('quebraHorarioQuadra1').checked = quebraHorarioQuadrasConfig['Quadra-1'] || false;
    document.getElementById('quebraHorarioQuadra2').checked = quebraHorarioQuadrasConfig['Quadra-2'] || false;
    document.getElementById('quebraHorarioQuadra3').checked = quebraHorarioQuadrasConfig['Quadra-3'] || false;

    // Exibe o modal
    document.getElementById('modalQuebraHorarioQuadras').style.display = 'flex';
}

/**
 * Simplesmente fecha o modal sem salvar.
 */
function fecharModalQuebraHorario() {
    document.getElementById('modalQuebraHorarioQuadras').style.display = 'none';
}


/**
 * L√™ o estado dos checkboxes, guarda na vari√°vel tempor√°ria e fecha o modal.
 */
/**
 * L√™ o estado dos checkboxes, guarda na vari√°vel tempor√°ria e fecha o modal.
 */
function salvarModalQuebraHorario() {
    quebraHorarioQuadrasConfig = {
        'Quadra-1': document.getElementById('quebraHorarioQuadra1').checked,
        'Quadra-2': document.getElementById('quebraHorarioQuadra2').checked,
        'Quadra-3': document.getElementById('quebraHorarioQuadra3').checked
    };
    
    // 1. Fecha o modal imediatamente
    fecharModalQuebraHorario();

    // 2. Usa o setTimeout para atrasar o alerta, permitindo que a tela seja redesenhada.
    setTimeout(function() {
        alert('Configura√ß√£o por quadra guardada. Clique em "Salvar Configura√ß√µes" no final da p√°gina para gravar as mudan√ßas.');
    }, 0); // Um atraso de 0 milissegundos √© suficiente para que funcione.
}



/**
 * Fun√ß√£o chamada quando o UTILIZADOR altera o valor do dropdown.
 * Ela atualiza a cor e, se necess√°rio, abre o modal.
 */
function handleQuebraHorarioChange() {
    // Primeiro, chama a fun√ß√£o que apenas atualiza a cor
    atualizarEstadoQuebraDomingo();

    // Depois, verifica se o valor √© OFF para abrir o modal
    const quebraSelect = document.getElementById('quebraHorarioDomingoAtiva');
    if (quebraSelect.value === 'OFF') {
        abrirModalQuebraHorario(); 
    }
}


function handleQuebraHorarioHold() {
    const quebraSelect = document.getElementById('quebraHorarioDomingoAtiva');
    if (quebraSelect.value === 'OFF') {
        abrirModalQuebraHorario();
    }
}

function popularAdministradores(administradoresData) {
    const administradoresSelect = document.getElementById('administradores');
    administradoresSelect.innerHTML = ''; 

    if (administradoresData && typeof administradoresData === 'object') {
        // Itera sobre os valores, que agora s√£o objetos {nomeCompleto, apelido}
        Object.values(administradoresData).forEach(adminObj => {
            if (adminObj && adminObj.nomeCompleto && adminObj.apelido) {
                const option = document.createElement('option');
                
                // O VALOR interno (escondido) √© o Nome Completo, usado para exclus√£o
                option.value = adminObj.nomeCompleto;
                
                // O TEXTO exibido para o usu√°rio √© o Apelido
                option.textContent = adminObj.apelido;
                
                administradoresSelect.appendChild(option);
            }
        });
    }
}


// =======================================================================
// IN√çCIO: L√ìGICA PARA ADICIONAR NOVOS ADMINISTRADORES (VERS√ÉO AJUSTADA)
// =======================================================================

// Vari√°vel global para guardar a lista de jogadores e evitar m√∫ltiplas buscas no Firebase
let listaJogadoresDisponiveis = [];

/**
 * Fecha o modal de adicionar administrador.
 */
function fecharModalAdicionarAdmin() {
    document.getElementById('modalAdicionarAdmin').style.display = 'none';
}

/**
 * Renderiza a lista de jogadores dentro do modal.
 * @param {object[]} jogadores - Um array de objetos {nomeCompleto, apelido}.
 */
function renderizarListaJogadores(jogadores) {
    const container = document.getElementById('listaJogadoresContainer');
    container.innerHTML = ''; // Limpa a lista atual

    if (jogadores.length === 0) {
        container.innerHTML = '<p style="padding: 10px; text-align: center;">Nenhum jogador encontrado.</p>';
        return;
    }

    jogadores.forEach(jogador => {
        const div = document.createElement('div');
        div.className = 'item-jogador';
        // Exibe o nome completo para o usu√°rio
        div.textContent = jogador.nomeCompleto; 
        // Ao clicar, passa o apelido para a fun√ß√£o de sele√ß√£o
        div.onclick = () => selecionarNovoAdmin(jogador.nomeCompleto, jogador.apelido);
        container.appendChild(div);
    });
}

/**
 * Filtra a lista de jogadores com base no que foi digitado no campo de busca.
 */
function filtrarJogadores() {
    const termoBusca = document.getElementById('buscaJogadorInput').value.toLowerCase();
    const jogadoresFiltrados = listaJogadoresDisponiveis.filter(jogador => 
        // Procura no nome completo
        jogador.nomeCompleto.toLowerCase().includes(termoBusca)
    );
    renderizarListaJogadores(jogadoresFiltrados);
}

/**
 * Fun√ß√£o principal que abre o modal, busca os dados e prepara a lista.
 */
async function abrirModalAdicionarAdmin() {
    // 1. Obter a lista de administradores atuais a partir do dropdown
    const adminSelect = document.getElementById('administradores');
    // Converte para caixa alta para uma compara√ß√£o segura
    const adminsAtuais = Array.from(adminSelect.options).map(opt => opt.value.toUpperCase());

    // 2. Buscar todos os jogadores do Firebase
    try {
        const snapshot = await db.ref('sistemas/cadastro/jogadores').once('value');
        const todosJogadoresObj = snapshot.val();
        
        if (!todosJogadoresObj) {
            alert("N√£o foi poss√≠vel carregar la lista de jogadores.");
            return;
        }

        // 3. Filtrar e preparar a lista de jogadores que podem ser admins
        listaJogadoresDisponiveis = Object.entries(todosJogadoresObj)
            // Mapeia para um objeto com nome completo (a chave) e apelido
            .map(([nomeCompleto, dados]) => ({
                nomeCompleto: nomeCompleto,
                apelido: dados.apelido
            }))
            // Filtra jogadores sem apelido ou que j√° s√£o admins
            .filter(jogador => 
                jogador.apelido && !adminsAtuais.includes(jogador.apelido.toUpperCase())
            ) 
            // Ordena alfabeticamente pelo nome completo
            .sort((a, b) => a.nomeCompleto.localeCompare(b.nomeCompleto)); 

        // 4. Renderizar a lista inicial e abrir o modal
        document.getElementById('buscaJogadorInput').value = ''; // Limpa a busca
        renderizarListaJogadores(listaJogadoresDisponiveis);
        document.getElementById('modalAdicionarAdmin').style.display = 'flex';

    } catch (error) {
        console.error("Erro ao buscar jogadores:", error);
        alert("Ocorreu um erro ao buscar a lista de jogadores. Verifique o console.");
    }
}

/**
 * Adiciona o jogador selecionado como um novo administrador no Firebase.
 * @param {string} apelido - O apelido do jogador a ser adicionado.
 */
/**
 * Adiciona o jogador selecionado como um novo administrador no Firebase,
 * salvando um objeto com nome completo e apelido.
 */
async function selecionarNovoAdmin(nomeCompleto, apelido) { // Agora recebe ambos os par√¢metros
    if (!confirm(`Tem certeza que deseja adicionar "${nomeCompleto}" como administrador?`)) {
        return;
    }

    try {
        const adminRef = db.ref('sistemas/config/Administradores');
        const snapshot = await adminRef.once('value');
        const adminsObj = snapshot.val() || {};

        let proximoNumero = 1;
        if (Object.keys(adminsObj).length > 0) {
            const numeros = Object.keys(adminsObj)
                .map(key => parseInt(key.replace('admin-', ''), 10))
                .filter(num => !isNaN(num));
            if (numeros.length > 0) {
                proximoNumero = Math.max(...numeros) + 1;
            }
        }
        const novaChave = `admin-${proximoNumero}`;
        
        // Cria o objeto para salvar
        const adminData = {
            nomeCompleto: nomeCompleto.toUpperCase(),
            apelido: apelido.toUpperCase()
        };

        await adminRef.child(novaChave).set(adminData);
        
        alert(`"${apelido}" foi adicionado como administrador com sucesso!`);
        fecharModalAdicionarAdmin();

    } catch (error) {
        console.error("Erro ao adicionar administrador:", error);
        alert("Ocorreu um erro ao salvar o novo administrador. Verifique o console.");
    }
}
// =======================================================================
// FIM: L√ìGICA PARA ADICIONAR NOVOS ADMINISTRADORES (VERS√ÉO AJUSTADA)
// =======================================================================


// ... sua fun√ß√£o selecionarNovoAdmin() termina aqui ...

/**
 * Exclui o administrador que est√° selecionado no dropdown,
 * acionado por um duplo clique no pr√≥prio campo <select>.
 */
async function excluirAdministrador() {
    const adminSelect = document.getElementById('administradores');
    
    // 1. Verifica se um administrador est√° realmente selecionado
    if (adminSelect.selectedIndex === -1) {
        // Se nada estiver selecionado, n√£o faz nada.
        return; 
    }

    // --- VALIDA√á√ÉO DE SEGURAN√áA ADICIONADA ---
    // Verifica se este √© o √∫ltimo administrador na lista
    if (adminSelect.options.length <= 1) {
        alert("N√£o √© poss√≠vel remover o √∫ltimo administrador. O sistema precisa de pelo menos um respons√°vel.");
        return; // Impede a exclus√£o
    }
    // --- FIM DA VALIDA√á√ÉO ---
    
    const adminParaExcluir = adminSelect.value;

    // 2. Pede confirma√ß√£o ao usu√°rio (passo de seguran√ßa crucial)
    if (!confirm(`Tem certeza que deseja remover "${adminParaExcluir}" da lista de administradores?`)) {
        return;
    }

    try {
        const adminRef = db.ref('sistemas/config/Administradores');
        const snapshot = await adminRef.once('value');
        const adminsObj = snapshot.val();

        if (!adminsObj) {
            // Caso raro, mas √© bom ter a verifica√ß√£o.
            alert("N√£o h√° administradores para excluir.");
            return;
        }

        // ... dentro da fun√ß√£o excluirAdministrador() ...
        let chaveParaExcluir = null;
			// 3. Itera sobre o objeto de administradores para encontrar a chave correta
			//    (ex: "admin-1") que corresponde ao nome selecionado.
			for (const chave in adminsObj) {
				// CORRE√á√ÉO: Verifica a propriedade 'nomeCompleto' dentro do objeto
				if (adminsObj[chave].nomeCompleto && adminsObj[chave].nomeCompleto.toUpperCase() === adminParaExcluir.toUpperCase()) {
					chaveParaExcluir = chave;
					break; // Encontrou a chave, pode parar o loop.
				}
			}
	// ...

        // 4. Se encontrou a chave, remove o dado do Firebase.
        if (chaveParaExcluir) {
            await adminRef.child(chaveParaExcluir).remove();
            alert(`Administrador "${adminParaExcluir}" removido com sucesso!`);
            // A lista ser√° atualizada automaticamente pelo listener .on() que j√° existe.
        } else {
            alert("N√£o foi poss√≠vel encontrar o administrador no banco de dados para realizar a exclus√£o.");
        }

    } catch (error) {
        console.error("Erro ao excluir administrador:", error);
        alert("Ocorreu um erro ao excluir o administrador. Verifique o console.");
    }
}
// =======================================================================
// FIM: L√ìGICA PARA ADICIONAR/EXCLUIR NOVOS ADMINISTRADORES
// =======================================================================


// =======================================================================
// FIM: L√ìGICA PARA ADICIONAR/EXCLUIR NOVOS ADMINISTRADORES
// =======================================================================


// =======================================================================
// IN√çCIO: L√ìGICA PARA MUDAR O √ÅRBITRO
// =======================================================================

// Vari√°vel global para a lista de jogadores dispon√≠veis para serem √°rbitros
let listaJogadoresParaArbitro = [];

/**
 * Fecha o modal de mudan√ßa de √°rbitro.
 */
function fecharModalMudarArbitro() {
    document.getElementById('modalMudarArbitro').style.display = 'none';
}

/**
 * Renderiza a lista de jogadores no modal de √°rbitros.
 * @param {object[]} jogadores - Array de objetos {nomeCompleto, apelido}.
 */
function renderizarListaJogadoresArbitro(jogadores) {
    const container = document.getElementById('listaJogadoresArbitroContainer');
    container.innerHTML = '';

    if (jogadores.length === 0) {
        container.innerHTML = '<p style="padding: 10px; text-align: center;">Nenhum jogador encontrado.</p>';
        return;
    }

    jogadores.forEach(jogador => {
        const div = document.createElement('div');
        div.className = 'item-jogador';
        div.textContent = jogador.nomeCompleto;
        div.onclick = () => selecionarNovoArbitro(jogador.nomeCompleto, jogador.apelido);
        container.appendChild(div);
    });
}

/**
 * Filtra a lista de jogadores para √°rbitro com base na busca.
 */
function filtrarJogadoresArbitro() {
    const termoBusca = document.getElementById('buscaArbitroInput').value.toLowerCase();
    const jogadoresFiltrados = listaJogadoresParaArbitro.filter(jogador =>
        jogador.nomeCompleto.toLowerCase().includes(termoBusca)
    );
    renderizarListaJogadoresArbitro(jogadoresFiltrados);
}

/**
 * Abre o modal para escolher o novo √°rbitro.
 */
async function abrirModalMudarArbitro() {
    // 1. Obter o √°rbitro atual para exclu√≠-lo da lista de sele√ß√£o
    const arbitroAtual = document.getElementById('arbitro').value;

    try {
        const snapshot = await db.ref('sistemas/cadastro/jogadores').once('value');
        const todosJogadoresObj = snapshot.val();

        if (!todosJogadoresObj) {
            alert("N√£o foi poss√≠vel carregar a lista de jogadores.");
            return;
        }

        // 2. Prepara a lista de jogadores, filtrando o √°rbitro atual
        listaJogadoresParaArbitro = Object.entries(todosJogadoresObj)
            .map(([nomeCompleto, dados]) => ({
                nomeCompleto: nomeCompleto,
                apelido: dados.apelido
            }))
            .filter(jogador => jogador.apelido && jogador.apelido.toUpperCase() !== arbitroAtual.toUpperCase())
            .sort((a, b) => a.nomeCompleto.localeCompare(b.nomeCompleto));

        // 3. Renderiza a lista e exibe o modal
        document.getElementById('buscaArbitroInput').value = '';
        renderizarListaJogadoresArbitro(listaJogadoresParaArbitro);
        document.getElementById('modalMudarArbitro').style.display = 'flex';

    } catch (error) {
        console.error("Erro ao buscar jogadores:", error);
        alert("Ocorreu um erro ao buscar a lista de jogadores. Verifique o console.");
    }
}

/**
 * Define o jogador selecionado como o novo √°rbitro no Firebase.
 * @param {string} apelido - O apelido do jogador escolhido.
 */
/**
 * Define o novo √°rbitro no Firebase, salvando um objeto com nome completo e apelido.
 */
async function selecionarNovoArbitro(nomeCompleto, apelido) { // Agora recebe ambos
    if (!confirm(`Deseja definir "${apelido}" como o novo √°rbitro?`)) {
        return;
    }

    try {
        // Cria o objeto para salvar
        const arbitroData = {
            nomeCompleto: nomeCompleto.toUpperCase(),
            apelido: apelido.toUpperCase()
        };
        
        await db.ref('sistemas/config/Arbitro').set(arbitroData);

        alert(`"${apelido}" foi definido como o novo √°rbitro com sucesso!`);
        fecharModalMudarArbitro();

    } catch (error) {
        console.error("Erro ao definir novo √°rbitro:", error);
        alert("Ocorreu um erro ao salvar o novo √°rbitro. Verifique o console.");
    }
}
// =======================================================================
// FIM: L√ìGICA PARA MUDAR O √ÅRBITRO
// =======================================================================


// ADICIONE ESTA NOVA FUN√á√ÉO COMPLETA
function atualizarEstadoDuplasRanking() {
    const rankingSelect = document.getElementById('duplasRanking');
    const labelRanking = document.getElementById('labelDuplasRanking'); // Pega o elemento do label
    const isAtiva = rankingSelect.value === 'ON';

    if (isAtiva) {
        rankingSelect.classList.remove('ranking-off');
        rankingSelect.classList.add('ranking-on');
        // Se o ranking est√° ON, remove a classe clic√°vel do label
        if (labelRanking) {
            labelRanking.classList.remove('clickable-reset');
        }
    } else {
        rankingSelect.classList.remove('ranking-on');
        rankingSelect.classList.add('ranking-off');
        // Se o ranking est√° OFF, adiciona a classe clic√°vel ao label
        if (labelRanking) {
            labelRanking.classList.add('clickable-reset');
        }
    }
}



// =======================================================================
// IN√çCIO: L√ìGICA PARA ZERAR O RANKING DE DUPLAS
// =======================================================================

/**
 * Zera os campos 'jogosDeDuplasJogados' e 'vitoriasEmDuplas' para todos os jogadores.
 */
async function zerarRankingDuplas() {
    console.log("Iniciando processo para zerar o ranking de duplas...");
    const jogadoresRef = db.ref('sistemas/cadastro/jogadores');
    
    try {
        const snapshot = await jogadoresRef.once('value');
        const jogadores = snapshot.val();
        
        if (!jogadores) {
            alert("Nenhum jogador encontrado no cadastro.");
            return;
        }

        const updates = {};
        let jogadoresAfetados = 0;

        // Itera sobre cada jogador para preparar a atualiza√ß√£o
        for (const nomeCompleto in jogadores) {
            const jogador = jogadores[nomeCompleto];
            // Verifica se o jogador tem dados de ranking para serem zerados
            if (jogador.jogosDeDuplasJogados || jogador.vitoriasEmDuplas) {
                updates[`sistemas/cadastro/jogadores/${nomeCompleto}/jogosDeDuplasJogados`] = 0;
                updates[`sistemas/cadastro/jogadores/${nomeCompleto}/vitoriasEmDuplas`] = 0;
                jogadoresAfetados++;
            }
        }

        if (jogadoresAfetados === 0) {
            alert("Nenhum jogador com dados de ranking para zerar.");
            return;
        }

        // Envia todas as atualiza√ß√µes para o Firebase de uma s√≥ vez
        await db.ref().update(updates);
        
        alert(`O ranking de duplas foi zerado com sucesso para ${jogadoresAfetados} jogador(es)!`);
        console.log("Ranking de duplas zerado com sucesso.");

    } catch (error) {
        console.error("Erro ao zerar o ranking de duplas:", error);
        alert("Ocorreu um erro ao tentar zerar o ranking. Verifique o console para mais detalhes.");
    }
}

// =======================================================================
// FIM: L√ìGICA PARA ZERAR O RANKING DE DUPLAS
// =======================================================================


// --- L√ìGICA PARA O GATILHO DE TRIPLO CLIQUE ---
document.addEventListener('DOMContentLoaded', function() {
    const labelRanking = document.getElementById('labelDuplasRanking');
    if (!labelRanking) return;

    let clickCount = 0;
    let clickTimer = null;

    labelRanking.addEventListener('click', function() {
        clickCount++;

        if (clickCount === 1) {
            clickTimer = setTimeout(() => {
                // Reseta o contador se o tempo expirar
                clickCount = 0;
            }, 600); // O usu√°rio tem 600ms entre os cliques
        }

        if (clickCount === 3) {
            clearTimeout(clickTimer);
            clickCount = 0;
            
            // 1. Condi√ß√£o: Verifica se o Ranking est√° OFF
            const rankingSelect = document.getElementById('duplasRanking');
            if (rankingSelect.value === 'OFF') {
                
                // 2. Primeira confirma√ß√£o
                if (confirm("Deseja zerar permanentemente todo o hist√≥rico do Ranking de Duplas?")) {
                    
                    // 3. Segunda confirma√ß√£o
                    if (confirm("ATEN√á√ÉO: Esta opera√ß√£o n√£o pode ser desfeita. Tem certeza absoluta?")) {
                        
                        // 4. A√ß√£o
                        zerarRankingDuplas();
                    }
                }
            }
        }
    });
});


</script>
</body>
</html>
