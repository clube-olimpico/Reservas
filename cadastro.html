<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cadastro de Jogadores</title>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-database-compat.js"></script>
    <style>
	    html, body {
            width: 100%;
            overflow-x: hidden;
        }
        body {
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 0;
            padding-bottom: 60px;
            position: relative;
            min-height: 100vh; 
            background-color: #f4f7f6;
			overflow-x: hidden;
        }
        .tab-container {
            display: flex; 
            justify-content: center;
            width: 100%;
            background-color: white;
            padding: 5px 10px;
            gap: 10px;
            box-shadow: 0px 4px 6px rgba(0, 0, 0, 0.1);     
            border-bottom: 3px solid #ccc;
            position: relative; 
            box-sizing: border-box;
        }
        .tab-button {
            padding: 6px 20px;
            font-size: 16px;
            cursor: pointer;
            border: 2px solid transparent;
            background-color: #4CAF50;
            color: white;
            font-weight: bold;
            margin: 0;
            border-radius: 5px;
            transition: 0.3s;
            position: relative;
        }
        .tab-button.selected {
            background-color: #228B22;
            border: 2px solid black;
        }
        .tab-button.selected::after {
            content: "";
            display: block;
            width: 100%;
            height: 3px;
            background-color: #228B22;
            position: absolute;
            bottom: -8px;
            left: 0;
        }
        .tab-content {
            display: none;
            width: 100%;
            align-items: center;
            flex-direction: column;
        }
        .tab-content.active {
            display: flex;
        }
        .form-container {
            padding: 20px;
            border: 1px solid #ccc;
            border-radius: 5px;
            box-shadow: 2px 2px 10px rgba(0, 0, 0, 0.1);
            width: 400px;
            text-align: center;
            margin-top: 10px;
            background-color: white;
        }
		.form-container h2 {
			margin-top: 0px; 
		}
        .form-group {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 10px;
            width: 100%;
        }
        label {
            flex: 1;
            text-align: left;
            min-width: 100px;
        }
        input, select {
            flex: 3;
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 3px;
            text-align: left;
            width: 100%; 
            box-sizing: border-box; 
        }
        button {
            margin-top: 1px;
            width: 100%;
            padding: 8px 10px;
            background-color: #4CAF50;
            color: white;
			font-size: 16px; 
            font-weight: bold;
            border: none;
            cursor: pointer;
            border-radius: 3px;
        }
table {
    width: 100%;              /* ocupa toda a tela */
    max-width: none;          /* remove limite de 800px */
    border-collapse: collapse;
    margin-top: 15px;
}

        th, td {
            border: 1px solid #ccc;
            padding: 7px;
            text-align: center;
        }
        th {
            background-color: #f2f2f2;
        }
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: white;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 24px;
            z-index: 1000;
        }
        .footer {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background-color: #f2f2f2; 
            color: #333; 
            text-align: center;
            padding: 10px 0;
            font-size: 16px;
            font-weight: bold;
            box-shadow: 0px -2px 10px rgba(0, 0, 0, 0.2); 
            z-index: 1000;
        }
        #classe {
            width: 200px;
            margin-right: 110px;
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 3px;
        }
        #simbolo_piramide {
            font-size: 24px; 
            color: black;
            margin-left: 5px;
            display: flex;
            align-items: center; 
            justify-content: center;
            height: 100%; 
        }
        .piramide-clicada {
            color: blue !important; 
            font-weight: bold;
            transform: scale(1.3) rotate(0deg); 
            text-shadow: 2px 2px 8px rgba(0, 0, 255, 0.6); 
            transition: transform 0.2s ease-in-out, text-shadow 0.3s ease-in-out; 
        }
        .birthday-container {
            max-width: 800px;
            width: 95%;
            margin: 15px auto;
            background-color: #ffffff;
            padding: 10px 30px 20px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
        }
        .birthday-container h1 {
            text-align: center;
            color: #2c3e50;
            border-bottom: 2px solid #e0e0e0;
            padding-bottom: 10px;
            margin-bottom: 20px;
            margin-top: 0;
        }
        .filters {
            display: flex;
            gap: 15px;
            margin-bottom: 25px; 
            flex-wrap: wrap;
        }
        .filters input, .filters select {
            flex-grow: 1;
            padding: 12px;
            font-size: 16px;
            border: 1px solid #ccc;
            border-radius: 5px;
            transition: border-color 0.2s;
        }
        .filters input:focus, .filters select:focus {
            outline: none;
            border-color: #007bff;
        }
        #birthdayList {
            margin-top: 20px;
            min-height: 100px;
        }
        .month-group {
            margin-bottom: 25px;
        }
        .month-group h2 {
            color: #0056b3;
            border-bottom: 1px solid #eee;
            padding-bottom: 5px;
        }
        .birthday-item {
            display: flex;
            align-items: center;
            padding: 10px 5px;
            border-bottom: 1px solid #f0f0f0;
        }
        .birthday-item:last-child {
            border-bottom: none;
        }
        .birthday-day {
            font-weight: bold;
            color: #333;
            flex-shrink: 0;
            margin-right: 15px;
        }
        .birthday-name {
            color: #555;
            text-align: left;
        }
        .nickname {
            color: #888;
            margin-left: 5px;
        }
        .status-message {
            text-align: center;
            color: #888;
            font-size: 1.1em;
            padding: 30px;
        }
        @media (max-width: 480px) {
            .tab-button {
                flex-grow: 1;
                text-align: center;
                padding: 6px 10px;
            }
            .form-container { width: 85%; max-width: 350px; }
            .form-group { position: relative; width: 100%; align-items: flex-start; }
            input, select { width: 100%; margin-left: 0; max-width: none; }
            label[for="niver"] { line-height: 1.1; }
            #classe { width: 139px !important; margin-right: 10px; }
            #piramide { margin-left: -5px !important; width: 30px !important; }
            #simbolo_piramide { margin-left: -18px !important; align-items: center; }
            #filtrarPiramide { margin-left: 3px !important; margin-top: 5px; }
			.birthday-container {
				box-sizing: border-box;
				width: 100%;
				padding-left: 15px;
				padding-right: 15px;
			}
			.filters {
				gap: 8px;
			}
			.filters select {
				padding-left: 6px;
				padding-right: 6px;
			}
        }
    </style>
</head>
<body>
    <div id="loadingOverlay" class="loading-overlay">Carregando... Aguarde.</div>

    <div class="tab-container">
        <button class="tab-button selected" onclick="mostrarAba(event, 'cadastro')">Cadastro</button>
        <button class="tab-button" onclick="mostrarAba(event, 'consulta')">Consulta</button>
        <button class="tab-button" onclick="mostrarAba(event, 'aniversarios')">Aniversários</button>
    </div>

    <div id="cadastroConsultaTab" class="tab-content active">
        <div class="form-container">
            <h2 id="titulo">Cadastro de Jogadores</h2>
            <div class="form-group">
                <label for="nome">Nome:</label>
                <input type="text" id="nome" placeholder="Digite o nome" required>
            </div>
            <div class="form-group">
                <label for="apelido">Apelido:</label>
                <input type="text" id="apelido" placeholder="Digite o apelido" required>
            </div>
            <div class="form-group">
                <label for="niver">Data de Nascimento:</label>
                <input type="date" id="niver">
            </div>
            <div class="form-group">
                <label for="socio">Sócio:</label>
                <select id="socio">
                    <option value="" selected disabled>Escolha um tipo</option>
                    <option value="titular">Titular</option>
                    <option value="dependente">Dependente</option>
                </select>
            </div>
            <div class="form-group">
                <label for="classe">Classe:</label>
                <select id="classe" style="width: 200px; margin-right: 20px;">
                    <option value="" selected disabled>Escolha a Classe</option>
                    <option value="A">A</option>
                    <option value="B">B</option>
                    <option value="C">C</option>
                    <option value="">(Sem classe)</option>
                </select>
                <span id="simbolo_piramide" style="margin-left: 10px; margin-right: 10px;">🔺</span>
                <input type="text" id="piramide" maxlength="2" style="width: 40px; height: 35px; text-align: center; margin-left: 10px; font-size: 16px; padding: 5px; border: 1px solid #ccc; border-radius: 3px;" value="">
                <input type="checkbox" id="filtrarPiramide" style="margin-left: 10px;"> 
            </div>
            <button id="botaoAcao" onclick="acaoFormulario()">Cadastrar</button>
        </div>
    </div>

    <table id="tabelaJogadoresContainer">
        <thead>
            <tr>
                <th>Nome</th>
                <th>Apelido</th>
                <th>Sócio</th>
            </tr>
        </thead>
        <tbody id="tabela-jogadores"></tbody>
    </table>

    <div id="aniversariosTab" class="tab-content">
        <div class="birthday-container">
            <h1>Aniversariantes</h1>
            <div class="filters">
                <input type="text" id="nameSearch" placeholder="nome ou apelido...">
                <select id="monthFilter">
                    <option value="0">Todos os meses</option>
                    <option value="1">Janeiro</option>
                    <option value="2">Fevereiro</option>
                    <option value="3">Março</option>
                    <option value="4">Abril</option>
                    <option value="5">Maio</option>
                    <option value="6">Junho</option>
                    <option value="7">Julho</option>
                    <option value="8">Agosto</option>
                    <option value="9">Setembro</option>
                    <option value="10">Outubro</option>
                    <option value="11">Novembro</option>
                    <option value="12">Dezembro</option>
                </select>
            </div>
            <div id="birthdayList">
                <p class="status-message">Carregando aniversariantes...</p>
            </div>
        </div>
    </div>

    <div class="footer" id="footer">
        Total de Jogadores: <span id="totalJogadores">0</span>
    </div>

    <script>
        const firebaseConfig = {
            apiKey: "SUA_API_KEY",
            authDomain: "agenda-5ce95.firebaseapp.com",
            databaseURL: "https://agenda-5ce95-default-rtdb.firebaseio.com/",
            projectId: "agenda-5ce95",
            storageBucket: "agenda-5ce95.appspot.com",
            messagingSenderId: "852007565195",
            appId: "1:852007565195:web:d7bd789d140858f53f618e"
        };
        const app = firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        
        let modoCadastro = true;
        let placeholderSpan = null;
        let criteriosConsulta = { nome: "", apelido: "", socio: "", classe: "", niver: "" };

        function atualizarTotalJogadores() {
            const totalJogadores = document.getElementById("tabela-jogadores").children.length;
            document.getElementById("totalJogadores").textContent = totalJogadores;
        }

        function acaoFormulario() {
            if (document.getElementById("botaoAcao").textContent === "Salvar") {
                salvarJogador();
            } else if (modoCadastro) {
                cadastrarJogador();
            } else {
                consultarJogador();
            }
        }

        function isMobile() {
            return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
        }

        if (isMobile()) {
            const niverInput = document.getElementById("niver");
            const niverLabel = document.querySelector('label[for="niver"]');
            placeholderSpan = document.createElement("span");
            placeholderSpan.textContent = "dd/mm/aaaa";
            placeholderSpan.style.cssText = "color: #999; position: absolute; left: " + (niverLabel.offsetWidth + 10) + "px; top: 8px; pointer-events: none;";
            niverInput.parentNode.insertBefore(placeholderSpan, niverInput.nextSibling);
            niverInput.addEventListener("focus", () => placeholderSpan.style.display = "none");
            niverInput.addEventListener("blur", () => {
                if (niverInput.value === "") placeholderSpan.style.display = "inline";
            });
        }

        function cadastrarJogador() {
            const nome = document.getElementById("nome").value.trim().toUpperCase();
            let apelido = document.getElementById("apelido").value.trim();
            const socio = document.getElementById("socio").value;
            const classe = document.getElementById("classe").value;
            let niver = document.getElementById("niver").value;
            const piramide = document.getElementById("piramide").value.trim();
            if (nome === "" || apelido === "" || niver === "") return alert("Preencha todos os campos obrigatórios.");
            const partesData = niver.split("-");
            if (partesData.length === 3) niver = `${partesData[2]}/${partesData[1]}/${partesData[0]}`;
            if (!/^[A-Z\s]+$/.test(nome)) return alert("O nome deve conter apenas letras e espaços.");
            if (socio === "") return alert("Escolha um tipo de sócio.");
            if (classe === "" && document.getElementById("classe").selectedIndex === 0) return alert("Escolha uma classe ou selecione '(Sem classe)'");
            apelido = apelido.toLowerCase().replace(/\b\w/g, letra => letra.toUpperCase());
            const piramideValue = piramide.trim() === "" ? "" : piramide;
            const jogadorRef = database.ref("sistemas/cadastro/jogadores/" + nome);
            const apelidoRef = database.ref("sistemas/cadastro/apelidos/" + apelido);
            const [ano, mes, dia] = partesData;
            const dataNascimento = new Date(ano, mes - 1, dia);
            const hoje = new Date();
            let idade = hoje.getFullYear() - dataNascimento.getFullYear();
            if (hoje.getMonth() < dataNascimento.getMonth() || (hoje.getMonth() === dataNascimento.getMonth() && hoje.getDate() < dataNascimento.getDate())) {
                idade--;
            }
            if (idade > 21 && socio === "dependente") {
                const relacionamento = prompt("Dependente maior de 21 anos. É cônjuge ou filho(a)?").trim().toLowerCase();
                const conjugeAceito = ["conjuge", "cônjuge", "esposa", "esposo", "marido"].includes(relacionamento);
                if (!conjugeAceito) {
                    alert("Não é possível cadastrar filho(a) maior de 21 anos como dependente.");
                    limparCampos();
                    return;
                }
            }
            jogadorRef.get().then(snapshot => {
                if (snapshot.exists()) {
                    alert("Já existe um jogador com esse Nome.");
                    limparCampos();
                    return;
                }
                apelidoRef.get().then(snapshot => {
                    if (snapshot.exists()) {
                        alert("Já existe um jogador com esse Apelido.");
                        limparCampos();
                        return;
                    }
                    jogadorRef.set({ apelido, socio, classe, niver, piramide: piramideValue })
                        .then(() => apelidoRef.set(true).then(() => {
                            alert("Jogador cadastrado com sucesso!");
                            limparCampos();
                            carregarJogadores();
                        }));
                });
            });
        }

        function limparCampos() {
            document.getElementById("nome").value = "";
            document.getElementById("apelido").value = "";
            document.getElementById("niver").value = "";
            document.getElementById("socio").value = "";
            document.getElementById("classe").value = "";
            document.getElementById("piramide").value = "";
            const nomeInput = document.getElementById("nome");
            nomeInput.disabled = false;
            nomeInput.style.backgroundColor = "";
            nomeInput.style.border = "";
        }

        function consultarJogador() {
            criteriosConsulta.nome = document.getElementById("nome").value.trim().toUpperCase();
            criteriosConsulta.apelido = document.getElementById("apelido").value.trim().toLowerCase();
            criteriosConsulta.socio = document.getElementById("socio").value;
            criteriosConsulta.classe = document.getElementById("classe").value;
            criteriosConsulta.niver = document.getElementById("niver").value;
            let piramide = document.getElementById("piramide").value.trim();
            const filtrarPiramide = document.getElementById("filtrarPiramide").checked;
            const piramideAtivada = document.getElementById("simbolo_piramide").classList.contains("piramide-clicada");
            if (Object.values(criteriosConsulta).every(v => v === "") && piramide === "" && !filtrarPiramide && !piramideAtivada) {
                return alert("Digite pelo menos um critério para consulta.");
            }
            const tabela = document.getElementById("tabela-jogadores");
            tabela.innerHTML = "";
            database.ref("sistemas/cadastro/jogadores").once("value", snapshot => {
                let encontrado = false;
                snapshot.forEach(childSnapshot => {
                    const jogadorNome = childSnapshot.key;
                    const jogador = childSnapshot.val();
                    if (jogadorNome.toUpperCase() === "CONVIDADO") return;
                    const jogadorApelido = jogador.apelido.toLowerCase();
                    const jogadorSocio = jogador.socio;
                    const jogadorClasse = jogador.classe || "";
                    const jogadorNiver = jogador.niver || "";
                    const jogadorPiramide = jogador.piramide || "";
                    const filtroNome = criteriosConsulta.nome === "" || jogadorNome.includes(criteriosConsulta.nome);
                    const filtroApelido = criteriosConsulta.apelido === "" || jogadorApelido.includes(criteriosConsulta.apelido);
                    let filtroSocio = true;
                    if (criteriosConsulta.socio !== "" && criteriosConsulta.socio !== "todos") filtroSocio = jogadorSocio === criteriosConsulta.socio;
                    let filtroClasse = true;
                    if (criteriosConsulta.classe === "todos") {} 
                    else if (criteriosConsulta.classe === "") filtroClasse = jogadorClasse === "";
                    else filtroClasse = jogadorClasse === criteriosConsulta.classe;
                    const filtroNiver = criteriosConsulta.niver === "" || jogadorNiver === criteriosConsulta.niver;
                    let filtroPiramide = true;
                    if (piramideAtivada && filtrarPiramide) filtroPiramide = (jogadorPiramide === piramide) && (jogadorPiramide >= 1 && jogadorPiramide <= 99);
                    else if (piramideAtivada) filtroPiramide = jogadorPiramide >= 1 && jogadorPiramide <= 99;
                    else if (filtrarPiramide) filtroPiramide = piramide === "" ? jogadorPiramide === "" : jogadorPiramide === piramide;
                    if (filtroNome && filtroApelido && filtroSocio && filtroClasse && filtroNiver && filtroPiramide) {
                        encontrado = true;
                        const row = document.createElement("tr");
                        row.innerHTML = `<td style="text-align: left;">${jogadorNome}</td><td style="text-align: left;">${jogadorApelido.replace(/\b\w/g, letra => letra.toUpperCase())}</td><td>${jogadorSocio}</td>`;
                        let clickTimeout, isDoubleClick = false;
                        row.addEventListener("click", () => {
                            clickTimeout = setTimeout(() => { if (!isDoubleClick) excluirJogador(jogadorNome, jogador.apelido); }, 300);
                        });
                        row.addEventListener("dblclick", () => {
                            isDoubleClick = true;
                            clearTimeout(clickTimeout);
                            editarJogador(jogadorNome);
                            setTimeout(() => { isDoubleClick = false; }, 350);
                        });
                        tabela.appendChild(row);
                    }
                });
                if (!encontrado) alert("Nenhum jogador encontrado.");
                atualizarTotalJogadores();
            });
        }

        function editarJogador(nome) {
            database.ref("sistemas/cadastro/jogadores/" + nome).once("value").then((snapshot) => {
                if (snapshot.exists()) {
                    const jogador = snapshot.val();
                    document.getElementById("nome").value = nome;
                    document.getElementById("apelido").value = jogador.apelido;
                    document.getElementById("socio").value = jogador.socio || "";
                    document.getElementById("classe").value = jogador.classe || "";
                    const niverInput = document.getElementById("niver");
                    if (jogador.niver && jogador.niver.includes('/')) {
                        const [dia, mes, ano] = jogador.niver.split('/');
                        niverInput.value = `${ano}-${mes}-${dia}`;
                        if (placeholderSpan) {
                            placeholderSpan.style.display = 'none';
                        }
                    } else {
                        niverInput.value = "";
                        if (placeholderSpan) {
                            placeholderSpan.style.display = 'inline';
                        }
                    }
                    document.getElementById("piramide").value = jogador.piramide || "";
                    document.getElementById("nome").disabled = true;
                    document.getElementById("botaoAcao").textContent = "Salvar";
                    modoCadastro = false;
                } else {
                    alert("Jogador não encontrado.");
                }
            });
	    }

        function salvarJogador() {
            const nome = document.getElementById("nome").value.trim().toUpperCase();
            let apelido = document.getElementById("apelido").value.trim();
            const socio = document.getElementById("socio").value;
            const classe = document.getElementById("classe").value;
            let niver = document.getElementById("niver").value;
            const piramide = document.getElementById("piramide").value.trim();
            if (niver) {
                niver = niver.split("-").reverse().join("/");
            }
            apelido = apelido.toLowerCase().replace(/\b\w/g, letra => letra.toUpperCase());
            const piramideValue = piramide.trim() === "" ? "" : piramide;
            let mensagemConfirmacao = `
                Confirme os dados do jogador:
                Nome: ${nome}
                Apelido: ${apelido}
                Sócio: ${socio}
                Classe: ${classe || "(Sem classe)"}
                Data de Nascimento: ${niver || "(Não informada)"}
                Pirâmide: ${piramideValue || "(Não informada)"}
            `;
            const confirmacao = confirm(mensagemConfirmacao);
            if (!confirmacao) {
                return;
            }
            const criteriosOriginais = { ...criteriosConsulta };
            database.ref("sistemas/cadastro/jogadores/" + nome).update({
                apelido: apelido || "",
                socio: socio || "",
                classe: classe || "",
                niver: niver,
                piramide: piramideValue
            }).then(() => {
                alert("Jogador atualizado com sucesso!");
                limparCampos();
                if (!modoCadastro && (criteriosOriginais.nome || criteriosOriginais.apelido || criteriosOriginais.socio || criteriosOriginais.classe || criteriosOriginais.niver)) {
                    criteriosConsulta = { ...criteriosOriginais };
                    document.getElementById("nome").value = criteriosConsulta.nome;
                    document.getElementById("apelido").value = criteriosConsulta.apelido;
                    document.getElementById("socio").value = criteriosConsulta.socio;
                    document.getElementById("classe").value = criteriosConsulta.classe || "";
                    document.getElementById("niver").value = criteriosConsulta.niver;
                    consultarJogador();
                } else {
                    carregarJogadores();
                }
                document.getElementById("botaoAcao").textContent = modoCadastro ? "Cadastrar" : "Consultar";
            }).catch((error) => {
                console.error("Erro ao atualizar jogador:", error);
                alert("Ocorreu um erro ao atualizar o jogador.");
            });
        }

        function excluirJogador(nome, apelido) {
            if (!confirm(`Tem certeza que deseja excluir o jogador ${nome} (${apelido})?`)) return;
            database.ref("sistemas/cadastro/jogadores/" + nome).remove()
                .then(() => database.ref("sistemas/cadastro/apelidos/" + apelido).remove()
                    .then(() => {
                        alert("Jogador excluído com sucesso!");
                        carregarJogadores();
                    }));
        }

        function carregarJogadores() {
            const tabela = document.getElementById("tabela-jogadores");
            database.ref("sistemas/cadastro/jogadores").on("value", (snapshot) => {
                tabela.innerHTML = "";
                snapshot.forEach((childSnapshot) => {
                    const nome = childSnapshot.key;
                    const jogador = childSnapshot.val();
                    if (nome.toUpperCase() === "CONVIDADO") return;
                    const row = document.createElement("tr");
                    row.innerHTML = `<td style="text-align: left;">${nome}</td><td>${jogador.apelido}</td><td>${jogador.socio}</td>`;
                    let clickTimeout, isDoubleClick = false;
                    row.addEventListener("click", () => {
                        clickTimeout = setTimeout(() => { if (!isDoubleClick) excluirJogador(nome, jogador.apelido); }, 300);
                    });
                    row.addEventListener("dblclick", () => {
                        isDoubleClick = true;
                        clearTimeout(clickTimeout);
                        editarJogador(nome);
                        setTimeout(() => { isDoubleClick = false; }, 350);
                    });
                    tabela.appendChild(row);
                });
                atualizarTotalJogadores();
                document.getElementById("loadingOverlay").style.display = "none";
            });
        }

        function mostrarCadastro(event) {
            document.getElementById("titulo").textContent = "Cadastro de Jogadores";
            document.getElementById("botaoAcao").textContent = "Cadastrar";
            modoCadastro = true;
            document.getElementById("piramide").disabled = false;
            document.getElementById("filtrarPiramide").checked = false;
            limparCampos();
            carregarJogadores();
            const socioSelect = document.getElementById("socio");
            let todosOption = socioSelect.querySelector('option[value="todos"]');
            if (todosOption) socioSelect.removeChild(todosOption);
            const classeSelect = document.getElementById("classe");
            let classeOption = classeSelect.querySelector('option[value="todos"]');
            if (classeOption) classeSelect.removeChild(classeOption);
            const simboloPiramide = document.getElementById("simbolo_piramide");
            if (simboloPiramide) {
                simboloPiramide.textContent = "🔺";
                simboloPiramide.classList.remove("piramide-clicada");
                simboloPiramide.removeEventListener("click", alternarCorPiramide);
                simboloPiramide.style.cursor = "default";
            }
        }

        function mostrarConsulta(event) {
            document.getElementById("titulo").textContent = "Consulta de Jogadores";
            document.getElementById("botaoAcao").textContent = "Consultar";
            modoCadastro = false;
            document.getElementById("filtrarPiramide").checked = false;
            limparCampos();
            carregarJogadores();
            const socioSelect = document.getElementById("socio");
            if (!socioSelect.querySelector('option[value="todos"]')) {
                const todosOption = document.createElement("option");
                todosOption.value = "todos";
                todosOption.textContent = "Todos";
                socioSelect.insertBefore(todosOption, socioSelect.options[1]);
            }
            socioSelect.value = "todos";
            const classeSelect = document.getElementById("classe");
            if (!classeSelect.querySelector('option[value="todos"]')) {
                const classeOption = document.createElement("option");
                classeOption.value = "todos";
                classeOption.textContent = "Todos";
                classeSelect.insertBefore(classeOption, classeSelect.options[1]);
            }
            classeSelect.value = "todos";
            const simboloPiramide = document.getElementById("simbolo_piramide");
            if (simboloPiramide) {
                simboloPiramide.textContent = "🔺";
                simboloPiramide.classList.remove("piramide-clicada");
                simboloPiramide.addEventListener("click", alternarCorPiramide);
                simboloPiramide.style.cursor = "pointer";
            }
        }
        
        function alternarCorPiramide() {
            const simboloPiramide = document.getElementById("simbolo_piramide");
            if (simboloPiramide) {
                simboloPiramide.classList.toggle("piramide-clicada");
            }
        }
        
        function mostrarAba(event, abaId) {
            document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('selected'));
            event.target.classList.add('selected');
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            const footer = document.getElementById('footer');
            const tabela = document.getElementById('tabelaJogadoresContainer');
            if (abaId === 'aniversarios') {
                document.getElementById('aniversariosTab').classList.add('active');
                footer.style.display = 'none';
                tabela.style.display = 'none';
                loadBirthdayData();
            } else {
                document.getElementById('cadastroConsultaTab').classList.add('active');
                footer.style.display = 'block';
                tabela.style.display = 'table';
                if (abaId === 'cadastro') {
                    const cadastroTabButton = document.querySelector('.tab-button[onclick*="cadastro"]');
                    mostrarCadastro({ target: cadastroTabButton });
                } else {
                    const consultaTabButton = document.querySelector('.tab-button[onclick*="consulta"]');
                    mostrarConsulta({ target: consultaTabButton });
                }
            }
        }
        
        let allPlayersBirthday = [];
        const nameSearch = document.getElementById('nameSearch');
        const monthFilter = document.getElementById('monthFilter');
        const birthdayList = document.getElementById('birthdayList');
        const monthNames = ["", "Janeiro", "Fevereiro", "Março", "Abril", "Maio", "Junho", "Julho", "Agosto", "Setembro", "Outubro", "Novembro", "Dezembro"];
        const monthlyBirthdayCounts = {};

        function capitalizeWords(str) {
            if (!str) return '';
            return str.toLowerCase().replace(/\b\w/g, char => char.toUpperCase());
        }

        function loadBirthdayData() {
            if (allPlayersBirthday.length > 0) {
                renderBirthdayList();
                return;
            }
            const playersRef = database.ref('sistemas/cadastro/jogadores');
            playersRef.once('value').then(snapshot => {
                const playerData = snapshot.val();
                if (!playerData) {
                    birthdayList.innerHTML = '<p class="status-message">Nenhum jogador encontrado.</p>';
                    return;
                }
                for (const fullName in playerData) {
                    const player = playerData[fullName];
                    if (player.niver && player.niver.length === 10 && player.niver !== "01/01/2001") {
                        const [day, month] = player.niver.split('/');
                        const monthInt = parseInt(month);
                        allPlayersBirthday.push({
                            fullName: capitalizeWords(fullName),
                            nickname: capitalizeWords(player.apelido),
                            day: parseInt(day),
                            month: monthInt,
                        });
                        monthlyBirthdayCounts[monthInt] = (monthlyBirthdayCounts[monthInt] || 0) + 1;
                    }
                }
                renderBirthdayList();
            });
        }

        function renderBirthdayList() {
            const searchTerm = nameSearch.value.toLowerCase();
            const selectedMonth = parseInt(monthFilter.value);
            const filteredPlayers = allPlayersBirthday.filter(player => 
                (player.fullName.toLowerCase().includes(searchTerm) || player.nickname.toLowerCase().includes(searchTerm)) &&
                (selectedMonth === 0 || player.month === selectedMonth)
            );
            birthdayList.innerHTML = '';
            if (filteredPlayers.length === 0) {
                birthdayList.innerHTML = '<p class="status-message">Nenhum aniversariante encontrado.</p>';
                return;
            }
            const groupedByMonth = {};
            filteredPlayers.forEach(player => {
                if (!groupedByMonth[player.month]) groupedByMonth[player.month] = [];
                groupedByMonth[player.month].push(player);
            });
            for (const month in groupedByMonth) {
                groupedByMonth[month].sort((a, b) => a.day - b.day);
            }
            Object.keys(groupedByMonth).sort((a,b) => a - b).forEach(month => {
                const monthDiv = document.createElement('div');
                monthDiv.className = 'month-group';
                monthDiv.innerHTML = `<h2>${monthNames[month]}</h2>`;
                const totalPlayerCountInMonth = monthlyBirthdayCounts[month] || 0;
                groupedByMonth[month].forEach(player => {
                    const itemDiv = document.createElement('div');
                    itemDiv.className = 'birthday-item';
                    const daySpan = document.createElement('span');
                    daySpan.className = 'birthday-day';
                    daySpan.textContent = (totalPlayerCountInMonth === 1) ? `Dia ${String(player.day).padStart(2, '0')}` : String(player.day).padStart(2, '0');
                    const nameSpan = document.createElement('span');
                    nameSpan.className = 'birthday-name';
                    nameSpan.textContent = player.fullName;
                    if (player.fullName.toLowerCase() !== player.nickname.toLowerCase()) {
                        const nicknameSpan = document.createElement('span');
                        nicknameSpan.className = 'nickname';
                        nicknameSpan.textContent = `(${player.nickname})`;
                        nameSpan.appendChild(nicknameSpan);
                    }
                    itemDiv.appendChild(daySpan);
                    itemDiv.appendChild(nameSpan);
                    monthDiv.appendChild(itemDiv);
                });
                birthdayList.appendChild(monthDiv);
            });
        }
        
        document.addEventListener('DOMContentLoaded', () => {
            const selectedButton = document.querySelector('.tab-button.selected');
            mostrarAba({ target: selectedButton }, 'cadastro');
            nameSearch.addEventListener('input', renderBirthdayList);
            monthFilter.addEventListener('change', renderBirthdayList);
        });
    </script>
</body>
</html>
}
